/*! Fabric.js Copyright 2008-2014, Printio (Juriy Zaytsev, Maxim Chernyak) */
;var fabric=fabric||{version:"1.4.9"};if(typeof exports!=="undefined"){exports.fabric=fabric}if(typeof document!=="undefined"&&typeof window!=="undefined"){fabric.document=document;fabric.window=window}else{fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>");fabric.window=fabric.document.createWindow()}fabric.isTouchSupported="ontouchstart" in fabric.document.documentElement;fabric.isLikelyNode=typeof Buffer!=="undefined"&&typeof window==="undefined";fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"];fabric.DPI=96;(function(){function d(e,f){if(!this.__eventListeners[e]){return}if(f){fabric.util.removeFromArray(this.__eventListeners[e],f)}else{this.__eventListeners[e].length=0}}function c(e,f){if(!this.__eventListeners){this.__eventListeners={}}if(arguments.length===1){for(var g in e){this.on(g,e[g])}}else{if(!this.__eventListeners[e]){this.__eventListeners[e]=[]}this.__eventListeners[e].push(f)}return this}function a(e,f){if(!this.__eventListeners){return}if(arguments.length===0){this.__eventListeners={}}else{if(arguments.length===1&&typeof arguments[0]==="object"){for(var g in e){d.call(this,g,e[g])}}else{d.call(this,e,f)}}return this}function b(g,h){if(!this.__eventListeners){return}var f=this.__eventListeners[g];if(!f){return}for(var j=0,e=f.length;j<e;j++){f[j].call(this,h||{})}return this}fabric.Observable={observe:c,stopObserving:a,fire:b,on:c,off:a,trigger:b}})();fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var a=0,b=arguments.length;a<b;a++){this._onObjectAdded(arguments[a])}this.renderOnAddRemove&&this.renderAll();return this},insertAt:function(b,a,d){var c=this.getObjects();if(d){c[a]=b}else{c.splice(a,0,b)}this._onObjectAdded(b);this.renderOnAddRemove&&this.renderAll();return this},remove:function(){var d=this.getObjects(),a;for(var b=0,c=arguments.length;b<c;b++){a=d.indexOf(arguments[b]);if(a!==-1){d.splice(a,1);this._onObjectRemoved(arguments[b])}}this.renderOnAddRemove&&this.renderAll();return this},forEachObject:function(d,b){var c=this.getObjects(),a=c.length;while(a--){d.call(b,c[a],a,c)}return this},getObjects:function(a){if(typeof a==="undefined"){return this._objects}return this._objects.filter(function(b){return b.type===a})},item:function(a){return this.getObjects()[a]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(a){return this.getObjects().indexOf(a)>-1},complexity:function(){return this.getObjects().reduce(function(a,b){a+=b.complexity?b.complexity():0;return a},0)}};(function(c){var d=Math.sqrt,b=Math.atan2,a=Math.PI/180;fabric.util={removeFromArray:function(g,f){var e=g.indexOf(f);if(e!==-1){g.splice(e,1)}return g},getRandomInt:function(f,e){return Math.floor(Math.random()*(e-f+1))+f},degreesToRadians:function(e){return e*a},radiansToDegrees:function(e){return e/a},rotatePoint:function(e,g,k){var f=Math.sin(k),i=Math.cos(k);e.subtractEquals(g);var j=e.x*i-e.y*f,h=e.x*f+e.y*i;return new fabric.Point(j,h).addEquals(g)},transformPoint:function(g,f,e){if(e){return new fabric.Point(f[0]*g.x+f[1]*g.y,f[2]*g.x+f[3]*g.y)}return new fabric.Point(f[0]*g.x+f[1]*g.y+f[4],f[2]*g.x+f[3]*g.y+f[5])},invertTransform:function(f){var g=f.slice(),e=1/(f[0]*f[3]-f[1]*f[2]);g=[e*f[3],-e*f[1],-e*f[2],e*f[0],0,0];var h=fabric.util.transformPoint({x:f[4],y:f[5]},g);g[4]=-h.x;g[5]=-h.y;return g},toFixed:function(f,e){return parseFloat(Number(f).toFixed(e))},parseUnit:function(g){var f=/\D{0,2}$/.exec(g),e=parseFloat(g);switch(f[0]){case"mm":return e*fabric.DPI/25.4;case"cm":return e*fabric.DPI/2.54;case"in":return e*fabric.DPI;case"pt":return e*fabric.DPI/72;case"pc":return e*fabric.DPI/72*12;default:return e}},falseFunction:function(){return false},getKlass:function(f,e){f=fabric.util.string.camelize(f.charAt(0).toUpperCase()+f.slice(1));return fabric.util.resolveNamespace(e)[f]},resolveNamespace:function(g){if(!g){return fabric}var j=g.split("."),e=j.length,h=c||fabric.window;for(var f=0;f<e;++f){h=h[j[f]]}return h},loadImage:function(g,i,h,f){if(!g){i&&i.call(h,g);return}var e=fabric.util.createImage();e.onload=function(){i&&i.call(h,e);e=e.onload=e.onerror=null};e.onerror=function(){fabric.log("Error loading "+e.src);i&&i.call(h,null,true);e=e.onload=e.onerror=null};if(g.indexOf("data")!==0&&typeof f!=="undefined"){e.crossOrigin=f}e.src=g},enlivenObjects:function(i,l,g,f){i=i||[];function h(){if(++k===e){l&&l(j)}}var j=[],k=0,e=i.length;if(!e){l&&l(j);return}i.forEach(function(p,n){if(!p||!p.type){h();return}var m=fabric.util.getKlass(p.type,g);if(m.async){m.fromObject(p,function(q,o){if(!o){j[n]=q;f&&f(p,j[n])}h()})}else{j[n]=m.fromObject(p);f&&f(p,j[n]);h()}})},groupSVGElements:function(g,f,h){var e;e=new fabric.PathGroup(g,f);if(typeof h!=="undefined"){e.setSourcePath(h)}return e},populateWithProperties:function(j,f,h){if(h&&Object.prototype.toString.call(h)==="[object Array]"){for(var g=0,e=h.length;g<e;g++){if(h[g] in j){f[h[g]]=j[h[g]]}}}},drawDashedLine:function(n,l,i,e,j,p){var q=e-l,o=j-i,g=d(q*q+o*o),f=b(o,q),m=p.length,h=0,k=true;n.save();n.translate(l,i);n.moveTo(0,0);n.rotate(f);l=0;while(g>l){l+=p[h++%m];if(l>g){l=g}n[k?"lineTo":"moveTo"](l,0);k=!k}n.restore()},createCanvasElement:function(e){e||(e=fabric.document.createElement("canvas"));if(!e.getContext&&typeof G_vmlCanvasManager!=="undefined"){G_vmlCanvasManager.initElement(e)}return e},createImage:function(){return fabric.isLikelyNode?new (require("canvas").Image)():fabric.document.createElement("img")},createAccessors:function(e){var j=e.prototype;for(var g=j.stateProperties.length;g--;){var k=j.stateProperties[g],l=k.charAt(0).toUpperCase()+k.slice(1),f="set"+l,h="get"+l;if(!j[h]){j[h]=(function(i){return new Function('return this.get("'+i+'")')})(k)}if(!j[f]){j[f]=(function(i){return new Function("value",'return this.set("'+i+'", value)')})(k)}}},clipContext:function(f,e){e.save();e.beginPath();f.clipTo(e);e.clip()},multiplyTransformMatrices:function(h,f){var m=[[h[0],h[2],h[4]],[h[1],h[3],h[5]],[0,0,1]],l=[[f[0],f[2],f[4]],[f[1],f[3],f[5]],[0,0,1]],n=[];for(var e=0;e<3;e++){n[e]=[];for(var j=0;j<3;j++){var i=0;for(var g=0;g<3;g++){i+=m[e][g]*l[g][j]}n[e][j]=i}}return[n[0][0],n[1][0],n[0][1],n[1][1],n[0][2],n[1][2]]},getFunctionBody:function(e){return(String(e).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},normalizePoints:function(j,g){var f=fabric.util.array.min(j,"x"),k=fabric.util.array.min(j,"y");f=f<0?f:0;k=f<0?k:0;for(var h=0,e=j.length;h<e;h++){j[h].x-=(g.width/2+f)||0;j[h].y-=(g.height/2+k)||0}},isTransparent:function(o,m,k,j){if(j>0){if(m>j){m-=j}else{m=0}if(k>j){k-=j}else{k=0}}var f=true,e=o.getImageData(m,k,(j*2)||1,(j*2)||1);for(var h=3,g=e.data.length;h<g;h+=4){var n=e.data[h];f=n<=0;if(f===false){break}}e=null;return f}}})(typeof exports!=="undefined"?exports:this);(function(){var a={},b={},d=Array.prototype.join,c;function f(p,o,n,m,h,w,r,l,k){c=d.call(arguments);if(a[c]){return a[c]}var F=g(r,n,m,l,k,p,o),G=(F.x1-F.x0)*(F.x1-F.x0)+(F.y1-F.y0)*(F.y1-F.y0),z=1/G-0.25;if(z<0){z=0}var B=Math.sqrt(z);if(w===h){B=-B}var D=0.5*(F.x0+F.x1)-B*(F.y1-F.y0),j=0.5*(F.y0+F.y1)+B*(F.x1-F.x0),v=Math.atan2(F.y0-j,F.x0-D),u=Math.atan2(F.y1-j,F.x1-D),C=u-v;if(C<0&&w===1){C+=2*Math.PI}else{if(C>0&&w===0){C-=2*Math.PI}}var A=Math.ceil(Math.abs(C/(Math.PI*0.5+0.001))),q=[];for(var E=0;E<A;E++){var t=v+E*C/A,s=v+(E+1)*C/A;q[E]=[D,j,t,s,n,m,F.sinTh,F.cosTh]}a[c]=q;return q}function g(r,i,h,l,k,u,q){var j=r*(Math.PI/180),t=Math.sin(j),p=Math.cos(j);i=Math.abs(i);h=Math.abs(h);var v=p*(l-u)+t*(k-q),s=p*(k-q)-t*(l-u),o=(v*v)/(i*i)+(s*s)/(h*h);o*=0.25;if(o>1){o=Math.sqrt(o);i*=o;h*=o}var n=p/i,m=t/i,z=(-t)/h,w=(p)/h;return{x0:n*l+m*k,y0:z*l+w*k,x1:n*u+m*q,y1:z*u+w*q,sinTh:t,cosTh:p}}function e(n,k,x,v,p,o,D,z){c=d.call(arguments);if(b[c]){return b[c]}var m=Math.sin(x),y=Math.cos(x),j=Math.sin(v),w=Math.cos(v),F=z*p,E=-D*o,r=D*p,q=z*o,s=0.25*(v-x),u=(8/3)*Math.sin(s)*Math.sin(s)/Math.sin(s*2),C=n+y-u*m,l=k+m+u*y,A=n+w,h=k+j,B=A+u*j,i=h-u*w;b[c]=[F*C+E*l,r*C+q*l,F*B+E*i,r*B+q*i,F*A+E*h,r*A+q*h];return b[c]}fabric.util.drawArc=function(v,r,p,q){var k=q[0],h=q[1],l=q[2],t=q[3],u=q[4],o=q[5],n=q[6],j=f(o,n,k,h,t,u,l,r,p);for(var m=0;m<j.length;m++){var s=e.apply(this,j[m]);v.bezierCurveTo.apply(v,s)}}})();(function(){var e=Array.prototype.slice;if(!Array.prototype.indexOf){Array.prototype.indexOf=function(h){if(this===void 0||this===null){throw new TypeError()}var i=Object(this),f=i.length>>>0;if(f===0){return -1}var j=0;if(arguments.length>0){j=Number(arguments[1]);if(j!==j){j=0}else{if(j!==0&&j!==Number.POSITIVE_INFINITY&&j!==Number.NEGATIVE_INFINITY){j=(j>0||-1)*Math.floor(Math.abs(j))}}}if(j>=f){return -1}var g=j>=0?j:Math.max(f-Math.abs(j),0);for(;g<f;g++){if(g in i&&i[g]===h){return g}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(j,h){for(var g=0,f=this.length>>>0;g<f;g++){if(g in this){j.call(h,this[g],g,this)}}}}if(!Array.prototype.map){Array.prototype.map=function(k,j){var g=[];for(var h=0,f=this.length>>>0;h<f;h++){if(h in this){g[h]=k.call(j,this[h],h,this)}}return g}}if(!Array.prototype.every){Array.prototype.every=function(j,h){for(var g=0,f=this.length>>>0;g<f;g++){if(g in this&&!j.call(h,this[g],g,this)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function(j,h){for(var g=0,f=this.length>>>0;g<f;g++){if(g in this&&j.call(h,this[g],g,this)){return true}}return false}}if(!Array.prototype.filter){Array.prototype.filter=function(k,j){var g=[],l;for(var h=0,f=this.length>>>0;h<f;h++){if(h in this){l=this[h];if(k.call(j,l,h,this)){g.push(l)}}}return g}}if(!Array.prototype.reduce){Array.prototype.reduce=function(h){var f=this.length>>>0,g=0,j;if(arguments.length>1){j=arguments[1]}else{do{if(g in this){j=this[g++];break}if(++g>=f){throw new TypeError()}}while(true)}for(;g<f;g++){if(g in this){j=h.call(null,j,this[g],g,this)}}return j}}function b(l,k){var h=e.call(arguments,2),g=[];for(var j=0,f=l.length;j<f;j++){g[j]=h.length?l[j][k].apply(l[j],h):l[j][k].call(l[j])}return g}function a(g,f){return d(g,f,function(i,h){return i>=h})}function c(g,f){return d(g,f,function(i,h){return i<h})}function d(k,h,j){if(!k||k.length===0){return}var g=k.length-1,f=h?k[g][h]:k[g];if(h){while(g--){if(j(k[g][h],f)){f=k[g][h]}}}else{while(g--){if(j(k[g],f)){f=k[g]}}}return f}fabric.util.array={invoke:b,min:c,max:a}})();(function(){function b(c,e){for(var d in e){c[d]=e[d]}return c}function a(c){return b({},c)}fabric.util.object={extend:b,clone:a}})();(function(){if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}}function b(d){return d.replace(/-+(.)?/g,function(e,f){return f?f.toUpperCase():""})}function c(d,e){return d.charAt(0).toUpperCase()+(e?d.slice(1):d.slice(1).toLowerCase())}function a(d){return d.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}fabric.util.string={camelize:b,capitalize:c,escapeXml:a}}());(function(){var c=Array.prototype.slice,a=Function.prototype.apply,b=function(){};if(!Function.prototype.bind){Function.prototype.bind=function(d){var g=this,e=c.call(arguments,1),f;if(e.length){f=function(){return a.call(g,this instanceof b?this:d,e.concat(c.call(arguments)))}}else{f=function(){return a.call(g,this instanceof b?this:d,arguments)}}b.prototype=this.prototype;f.prototype=new b();return f}}})();(function(){var g=Array.prototype.slice,f=function(){},d=(function(){for(var h in {toString:1}){if(h==="toString"){return false}}return true})(),c=function(h,k,i){for(var j in k){if(j in h.prototype&&typeof h.prototype[j]==="function"&&(k[j]+"").indexOf("callSuper")>-1){h.prototype[j]=(function(l){return function(){var n=this.constructor.superclass;this.constructor.superclass=i;var m=k[l].apply(this,arguments);this.constructor.superclass=n;if(l!=="initialize"){return m}}})(j)}else{h.prototype[j]=k[j]}if(d){if(k.toString!==Object.prototype.toString){h.prototype.toString=k.toString}if(k.valueOf!==Object.prototype.valueOf){h.prototype.valueOf=k.valueOf}}}};function b(){}function a(h){var i=this.constructor.superclass.prototype[h];return(arguments.length>1)?i.apply(this,g.call(arguments,1)):i.call(this)}function e(){var l=null,k=g.call(arguments,0);if(typeof k[0]==="function"){l=k.shift()}function h(){this.initialize.apply(this,arguments)}h.superclass=l;h.subclasses=[];if(l){b.prototype=l.prototype;h.prototype=new b();l.subclasses.push(h)}for(var j=0,m=k.length;j<m;j++){c(h,k[j],l)}if(!h.prototype.initialize){h.prototype.initialize=f}h.prototype.constructor=h;h.prototype.callSuper=a;return h}fabric.util.createClass=e})();(function(){var r="unknown";function m(u){var x=Array.prototype.slice.call(arguments,1),w,v,s=x.length;for(v=0;v<s;v++){w=typeof u[x[v]];if(!(/^(?:function|object|unknown)$/).test(w)){return false}}return true}var g,q,j=(function(){var s=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+s++)}})();(function(){var s={};g=function(t){return s[t]};q=function(u,t){s[u]=t}})();function d(s,t){return{handler:t,wrappedHandler:l(s,t)}}function l(s,t){return function(u){t.call(g(s),u||fabric.window.event)}}function f(t,s){return function(x){if(o[t]&&o[t][s]){var v=o[t][s];for(var w=0,u=v.length;w<u;w++){v[w].call(this,x||fabric.window.event)}}}}var p=(m(fabric.document.documentElement,"addEventListener","removeEventListener")&&m(fabric.window,"addEventListener","removeEventListener")),h=(m(fabric.document.documentElement,"attachEvent","detachEvent")&&m(fabric.window,"attachEvent","detachEvent")),n={},o={},k,c;if(p){k=function(t,s,u){t.addEventListener(s,u,false)};c=function(t,s,u){t.removeEventListener(s,u,false)}}else{if(h){k=function(u,s,v){var t=j(u);q(t,u);if(!n[t]){n[t]={}}if(!n[t][s]){n[t][s]=[]}var w=d(t,v);n[t][s].push(w);u.attachEvent("on"+s,w.wrappedHandler)};c=function(w,t,x){var v=j(w),y;if(n[v]&&n[v][t]){for(var u=0,s=n[v][t].length;u<s;u++){y=n[v][t][u];if(y&&y.handler===x){w.detachEvent("on"+t,y.wrappedHandler);n[v][t][u]=null}}}}}else{k=function(u,s,v){var t=j(u);if(!o[t]){o[t]={}}if(!o[t][s]){o[t][s]=[];var w=u["on"+s];if(w){o[t][s].push(w)}u["on"+s]=f(t,s)}o[t][s].push(v)};c=function(x,u,y){var w=j(x);if(o[w]&&o[w][u]){var t=o[w][u];for(var v=0,s=t.length;v<s;v++){if(t[v]===y){t.splice(v,1)}}}}}}fabric.util.addListener=k;fabric.util.removeListener=c;function i(v,t){v||(v=fabric.window.event);var u=v.target||(typeof v.srcElement!==r?v.srcElement:null),s=fabric.util.getScrollLeftTop(u,t);return{x:b(v)+s.left,y:a(v)+s.top}}var b=function(s){return(typeof s.clientX!==r?s.clientX:0)},a=function(s){return(typeof s.clientY!==r?s.clientY:0)};function e(t,v,s){var u=t.type==="touchend"?"changedTouches":"touches";return(t[u]&&t[u][0]?(t[u][0][v]-(t[u][0][v]-t[u][0][s]))||t[s]:t[s])}if(fabric.isTouchSupported){b=function(s){return e(s,"pageX","clientX")};a=function(s){return e(s,"pageY","clientY")}}fabric.util.getPointer=i;fabric.util.object.extend(fabric.util,fabric.Observable)})();(function(){function d(g,i){var k=g.style;if(!k){return g}if(typeof i==="string"){g.style.cssText+=";"+i;return i.indexOf("opacity")>-1?b(g,i.match(/opacity:\s*(\d?\.?\d*)/)[1]):g}for(var j in i){if(j==="opacity"){b(g,i[j])}else{var h=(j==="float"||j==="cssFloat")?(typeof k.styleFloat==="undefined"?"cssFloat":"styleFloat"):j;k[h]=i[j]}}return g}var f=fabric.document.createElement("div"),e=typeof f.style.opacity==="string",a=typeof f.style.filter==="string",c=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,b=function(g){return g};if(e){b=function(g,h){g.style.opacity=h;return g}}else{if(a){b=function(g,h){var i=g.style;if(g.currentStyle&&!g.currentStyle.hasLayout){i.zoom=1}if(c.test(i.filter)){h=h>=0.9999?"":("alpha(opacity="+(h*100)+")");i.filter=i.filter.replace(c,h)}else{i.filter+=" alpha(opacity="+(h*100)+")"}return g}}}fabric.util.setStyle=d})();(function(){var j=Array.prototype.slice;function i(l){return typeof l==="string"?fabric.document.getElementById(l):l}var k,c=function(l){return j.call(l,0)};try{k=c(fabric.document.childNodes) instanceof Array}catch(b){}if(!k){c=function(m){var l=new Array(m.length),n=m.length;while(n--){l[n]=m[n]}return l}}function d(m,l){var n=fabric.document.createElement(m);for(var o in l){if(o==="class"){n.className=l[o]}else{if(o==="for"){n.htmlFor=l[o]}else{n.setAttribute(o,l[o])}}}return n}function h(l,m){if(l&&(" "+l.className+" ").indexOf(" "+m+" ")===-1){l.className+=(l.className?" ":"")+m}}function g(m,n,l){if(typeof n==="string"){n=d(n,l)}if(m.parentNode){m.parentNode.replaceChild(n,m)}n.appendChild(m);return n}function a(p,o){var q,m,s=0,r=0,n=fabric.document.documentElement,l=fabric.document.body||{scrollLeft:0,scrollTop:0};m=p;while(p&&p.parentNode&&!q){p=p.parentNode;if(p!==fabric.document&&fabric.util.getElementStyle(p,"position")==="fixed"){q=p}if(p!==fabric.document&&m!==o&&fabric.util.getElementStyle(p,"position")==="absolute"){s=0;r=0}else{if(p===fabric.document){s=l.scrollLeft||n.scrollLeft||0;r=l.scrollTop||n.scrollTop||0}else{s+=p.scrollLeft||0;r+=p.scrollTop||0}}}return{left:s,top:r}}function f(o){var m,r=o&&o.ownerDocument,p={left:0,top:0},s={left:0,top:0},q,n={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r){return{left:0,top:0}}for(var l in n){s[n[l]]+=parseInt(e(o,l),10)||0}m=r.documentElement;if(typeof o.getBoundingClientRect!=="undefined"){p=o.getBoundingClientRect()}q=fabric.util.getScrollLeftTop(o,null);return{left:p.left+q.left-(m.clientLeft||0)+s.left,top:p.top+q.top-(m.clientTop||0)+s.top}}var e;if(fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle){e=function(m,l){return fabric.document.defaultView.getComputedStyle(m,null)[l]}}else{e=function(m,l){var n=m.style[l];if(!n&&m.currentStyle){n=m.currentStyle[l]}return n}}(function(){var m=fabric.document.documentElement.style,n="userSelect" in m?"userSelect":"MozUserSelect" in m?"MozUserSelect":"WebkitUserSelect" in m?"WebkitUserSelect":"KhtmlUserSelect" in m?"KhtmlUserSelect":"";function o(p){if(typeof p.onselectstart!=="undefined"){p.onselectstart=fabric.util.falseFunction}if(n){p.style[n]="none"}else{if(typeof p.unselectable==="string"){p.unselectable="on"}}return p}function l(p){if(typeof p.onselectstart!=="undefined"){p.onselectstart=null}if(n){p.style[n]=""}else{if(typeof p.unselectable==="string"){p.unselectable=""}}return p}fabric.util.makeElementUnselectable=o;fabric.util.makeElementSelectable=l})();(function(){function l(m,q){var o=fabric.document.getElementsByTagName("head")[0],n=fabric.document.createElement("script"),p=true;n.onload=n.onreadystatechange=function(r){if(p){if(typeof this.readyState==="string"&&this.readyState!=="loaded"&&this.readyState!=="complete"){return}p=false;q(r||fabric.window.event);n=n.onload=n.onreadystatechange=null}};n.src=m;o.appendChild(n)}fabric.util.getScript=l})();fabric.util.getById=i;fabric.util.toArray=c;fabric.util.makeElement=d;fabric.util.addClass=h;fabric.util.wrapElement=g;fabric.util.getScrollLeftTop=a;fabric.util.getElementOffset=f;fabric.util.getElementStyle=e})();(function(){function d(e,f){return e+(/\?/.test(e)?"&":"?")+f}var c=(function(){var h=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest()}];for(var e=h.length;e--;){try{var g=h[e]();if(g){return h[e]}}catch(f){}}})();function a(){}function b(g,f){f||(f={});var j=f.method?f.method.toUpperCase():"GET",h=f.onComplete||function(){},i=c(),e;i.onreadystatechange=function(){if(i.readyState===4){h(i);i.onreadystatechange=a}};if(j==="GET"){e=null;if(typeof f.parameters==="string"){g=d(g,f.parameters)}}i.open(j,g,true);if(j==="POST"||j==="PUT"){i.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}i.send(e);return i}fabric.util.request=b})();fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){["log","warn"].forEach(function(a){if(typeof console[a]!=="undefined"&&console[a].apply){fabric[a]=function(){return console[a].apply(console,arguments)}}})}(function(){function a(d){b(function(k){d||(d={});var f=k||+new Date(),h=d.duration||500,o=f+h,g,l=d.onChange||function(){},i=d.abort||function(){return false},m=d.easing||function(r,q,u,s){return -u*Math.cos(r/s*(Math.PI/2))+u+q},e="startValue" in d?d.startValue:0,n="endValue" in d?d.endValue:100,p=d.byValue||n-e;d.onStart&&d.onStart();(function j(q){g=q||+new Date();var r=g>o?h:(g-f);if(i()){d.onComplete&&d.onComplete();return}l(m(r,e,p,h));if(g>o){d.onComplete&&d.onComplete();return}b(j)})(f)})}var c=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(d){fabric.window.setTimeout(d,1000/60)};function b(){return c.apply(fabric.window,arguments)}fabric.util.animate=a;fabric.util.requestAnimFrame=b})();(function(){function y(C,F,E,D){if(C<Math.abs(F)){C=F;D=E/4}else{D=E/(2*Math.PI)*Math.asin(F/C)}return{a:C,c:F,p:E,s:D}}function p(D,C,E){return D.a*Math.pow(2,10*(C-=1))*Math.sin((C*E-D.s)*(2*Math.PI)/D.p)}function o(D,C,F,E){return F*((D=D/E-1)*D*D+1)+C}function s(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D+C}return F/2*((D-=2)*D*D+2)+C}function r(D,C,F,E){return F*(D/=E)*D*D*D+C}function f(D,C,F,E){return -F*((D=D/E-1)*D*D*D-1)+C}function j(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D*D+C}return -F/2*((D-=2)*D*D*D-2)+C}function w(D,C,F,E){return F*(D/=E)*D*D*D*D+C}function i(D,C,F,E){return F*((D=D/E-1)*D*D*D*D+1)+C}function l(D,C,F,E){D/=E/2;if(D<1){return F/2*D*D*D*D*D+C}return F/2*((D-=2)*D*D*D*D+2)+C}function e(D,C,F,E){return -F*Math.cos(D/E*(Math.PI/2))+F+C}function m(D,C,F,E){return F*Math.sin(D/E*(Math.PI/2))+C}function t(D,C,F,E){return -F/2*(Math.cos(Math.PI*D/E)-1)+C}function B(D,C,F,E){return(D===0)?C:F*Math.pow(2,10*(D/E-1))+C}function c(D,C,F,E){return(D===E)?C+F:F*(-Math.pow(2,-10*D/E)+1)+C}function h(D,C,F,E){if(D===0){return C}if(D===E){return C+F}D/=E/2;if(D<1){return F/2*Math.pow(2,10*(D-1))+C}return F/2*(-Math.pow(2,-10*--D)+2)+C}function g(D,C,F,E){return -F*(Math.sqrt(1-(D/=E)*D)-1)+C}function n(D,C,F,E){return F*Math.sqrt(1-(D=D/E-1)*D)+C}function v(D,C,F,E){D/=E/2;if(D<1){return -F/2*(Math.sqrt(1-D*D)-1)+C}return F/2*(Math.sqrt(1-(D-=2)*D)+1)+C}function q(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I;if(E===1){return C+J}if(!H){H=I*0.3}var G=y(D,J,H,F);return -p(G,E,I)+C}function x(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I;if(E===1){return C+J}if(!H){H=I*0.3}var G=y(D,J,H,F);return G.a*Math.pow(2,-10*E)*Math.sin((E*I-G.s)*(2*Math.PI)/G.p)+G.c+C}function a(E,C,J,I){var F=1.70158,H=0,D=J;if(E===0){return C}E/=I/2;if(E===2){return C+J}if(!H){H=I*(0.3*1.5)}var G=y(D,J,H,F);if(E<1){return -0.5*p(G,E,I)+C}return G.a*Math.pow(2,-10*(E-=1))*Math.sin((E*I-G.s)*(2*Math.PI)/G.p)*0.5+G.c+C}function k(D,C,G,F,E){if(E===undefined){E=1.70158}return G*(D/=F)*D*((E+1)*D-E)+C}function u(D,C,G,F,E){if(E===undefined){E=1.70158}return G*((D=D/F-1)*D*((E+1)*D+E)+1)+C}function z(D,C,G,F,E){if(E===undefined){E=1.70158}D/=F/2;if(D<1){return G/2*(D*D*(((E*=(1.525))+1)*D-E))+C}return G/2*((D-=2)*D*(((E*=(1.525))+1)*D+E)+2)+C}function d(D,C,F,E){return F-b(E-D,0,F,E)+C}function b(D,C,F,E){if((D/=E)<(1/2.75)){return F*(7.5625*D*D)+C}else{if(D<(2/2.75)){return F*(7.5625*(D-=(1.5/2.75))*D+0.75)+C}else{if(D<(2.5/2.75)){return F*(7.5625*(D-=(2.25/2.75))*D+0.9375)+C}else{return F*(7.5625*(D-=(2.625/2.75))*D+0.984375)+C}}}}function A(D,C,F,E){if(D<E/2){return d(D*2,0,F,E)*0.5+C}return b(D*2-E,0,F,E)*0.5+F*0.5+C}fabric.util.ease={easeInQuad:function(D,C,F,E){return F*(D/=E)*D+C},easeOutQuad:function(D,C,F,E){return -F*(D/=E)*(D-2)+C},easeInOutQuad:function(D,C,F,E){D/=(E/2);if(D<1){return F/2*D*D+C}return -F/2*((--D)*(D-2)-1)+C},easeInCubic:function(D,C,F,E){return F*(D/=E)*D*D+C},easeOutCubic:o,easeInOutCubic:s,easeInQuart:r,easeOutQuart:f,easeInOutQuart:j,easeInQuint:w,easeOutQuint:i,easeInOutQuint:l,easeInSine:e,easeOutSine:m,easeInOutSine:t,easeInExpo:B,easeOutExpo:c,easeInOutExpo:h,easeInCirc:g,easeOutCirc:n,easeInOutCirc:v,easeInElastic:q,easeOutElastic:x,easeInOutElastic:a,easeInBack:k,easeOutBack:u,easeInOutBack:z,easeInBounce:d,easeOutBounce:b,easeInOutBounce:A}}());(function(p){var m=p.fabric||(p.fabric={}),u=m.util.object.extend,j=m.util.string.capitalize,v=m.util.object.clone,l=m.util.toFixed,o=m.util.parseUnit,r=m.util.multiplyTransformMatrices,s={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},h={stroke:"strokeOpacity",fill:"fillOpacity"};function a(w){if(w in s){return s[w]}return w}function i(w,A,z){var x=Object.prototype.toString.call(A)==="[object Array]",y;if((w==="fill"||w==="stroke")&&A==="none"){A=""}else{if(w==="fillRule"){A=(A==="evenodd")?"destination-over":A}else{if(w==="strokeDashArray"){A=A.replace(/,/g," ").split(/\s+/).map(function(B){return parseInt(B)})}else{if(w==="transformMatrix"){if(z&&z.transformMatrix){A=r(z.transformMatrix,m.parseTransformAttribute(A))}else{A=m.parseTransformAttribute(A)}}else{if(w==="visible"){A=(A==="none"||A==="hidden")?false:true;if(z&&z.visible===false){A=false}}else{if(w==="originX"){A=A==="start"?"left":A==="end"?"right":"center"}else{y=x?A.map(o):o(A)}}}}}}return(!x&&isNaN(y)?A:y)}function c(y){for(var w in h){if(!y[w]||typeof y[h[w]]==="undefined"){continue}if(y[w].indexOf("url(")===0){continue}var x=new m.Color(y[w]);y[w]=x.setAlpha(l(x.getAlpha()*y[h[w]],2)).toRgba();delete y[h[w]]}return y}m.parseTransformAttribute=(function(){function w(P,Q){var R=Q[0];P[0]=Math.cos(R);P[1]=Math.sin(R);P[2]=-Math.sin(R);P[3]=Math.cos(R)}function A(R,S){var Q=S[0],P=(S.length===2)?S[1]:S[0];R[0]=Q;R[3]=P}function N(P,Q){P[2]=Q[0]}function y(P,Q){P[1]=Q[0]}function I(P,Q){P[4]=Q[0];if(Q.length===2){P[5]=Q[1]}}var C=[1,0,0,1,0,0],x="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",K="(?:\\s+,?\\s*|,\\s*)",D="(?:(skewX)\\s*\\(\\s*("+x+")\\s*\\))",B="(?:(skewY)\\s*\\(\\s*("+x+")\\s*\\))",L="(?:(rotate)\\s*\\(\\s*("+x+")(?:"+K+"("+x+")"+K+"("+x+"))?\\s*\\))",O="(?:(scale)\\s*\\(\\s*("+x+")(?:"+K+"("+x+"))?\\s*\\))",G="(?:(translate)\\s*\\(\\s*("+x+")(?:"+K+"("+x+"))?\\s*\\))",J="(?:(matrix)\\s*\\(\\s*("+x+")"+K+"("+x+")"+K+"("+x+")"+K+"("+x+")"+K+"("+x+")"+K+"("+x+")\\s*\\))",H="(?:"+J+"|"+G+"|"+O+"|"+L+"|"+D+"|"+B+")",E="(?:"+H+"(?:"+K+H+")*)",M="^\\s*(?:"+E+"?)\\s*$",F=new RegExp(M),z=new RegExp(H,"g");return function(S){var P=C.concat(),Q=[];if(!S||(S&&!F.test(S))){return P}S.replace(z,function(W){var T=new RegExp(H).exec(W).filter(function(X){return(X!==""&&X!=null)}),U=T[1],V=T.slice(2).map(parseFloat);switch(U){case"translate":I(P,V);break;case"rotate":V[0]=m.util.degreesToRadians(V[0]);w(P,V);break;case"scale":A(P,V);break;case"skewX":N(P,V);break;case"skewY":y(P,V);break;case"matrix":P=V;break}Q.push(P.concat());P=C.concat()});var R=Q[0];while(Q.length>1){Q.shift();R=m.util.multiplyTransformMatrices(R,Q[0])}return R}})();function b(C,x){var z=C.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(!z){return}var D=z[1],y=z[3],B=z[4],A=z[5],w=z[6];if(D){x.fontStyle=D}if(y){x.fontWeight=isNaN(parseFloat(y))?y:parseFloat(y)}if(B){x.fontSize=parseFloat(B)}if(w){x.fontFamily=w}if(A){x.lineHeight=A==="normal"?1:A}}function n(y,x){var w,z;y.replace(/;$/,"").split(";").forEach(function(A){var B=A.split(":");w=a(B[0].trim().toLowerCase());z=i(w,B[1].trim());if(w==="font"){b(z,x)}else{x[w]=z}})}function k(y,x){var w,z;for(var A in y){if(typeof y[A]==="undefined"){continue}w=a(A.toLowerCase());z=i(w,y[A]);if(w==="font"){b(z,x)}else{x[w]=z}}}function t(x){var B=x.nodeName,z=x.getAttribute("class"),w=x.getAttribute("id"),F={};for(var A in m.cssRules){var E=(z&&new RegExp("^\\."+z).test(A))||(w&&new RegExp("^#"+w).test(A))||(new RegExp("^"+B).test(A));if(E){for(var D in m.cssRules[A]){var y=a(D),C=i(y,m.cssRules[A][D]);F[y]=C}}}return F}function e(I){var K=I.getElementsByTagName("use");while(K.length){var z=K[0],C=z.getAttribute("xlink:href").substr(1),H=z.getAttribute("x")||0,G=z.getAttribute("y")||0,A=I.getElementById(C).cloneNode(true),w=(z.getAttribute("transform")||"")+" translate("+H+", "+G+")",E;for(var D=0,J=z.attributes,B=J.length;D<B;D++){var F=J.item(D);if(F.nodeName==="x"||F.nodeName==="y"||F.nodeName==="xlink:href"){continue}if(F.nodeName==="transform"){w=w+" "+F.nodeValue}else{A.setAttribute(F.nodeName,F.nodeValue)}}A.setAttribute("transform",w);A.removeAttribute("id");E=z.parentNode;E.replaceChild(A,z)}}function f(z,w){w[3]=w[0]=(w[0]>w[3]?w[3]:w[0]);if(!(w[0]!==1||w[3]!==1||w[4]!==0||w[5]!==0)){return}var x=document.createElement("g");while(z.firstChild!=null){var y=z.firstChild;x.appendChild(y)}x.setAttribute("transform","matrix("+w[0]+" "+w[1]+" "+w[2]+" "+w[3]+" "+w[4]+" "+w[5]+")");z.appendChild(x)}m.parseSVGDocument=(function(){var w=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,x="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",y=new RegExp("^\\s*("+x+"+)\\s*,?\\s*("+x+"+)\\s*,?\\s*("+x+"+)\\s*,?\\s*("+x+"+)\\s*$");function z(A,B){while(A&&(A=A.parentNode)){if(B.test(A.nodeName)){return true}}return false}return function(S,D,B){if(!S){return}var J=new Date();e(S);var E=S.getAttribute("viewBox"),I=parseFloat(S.getAttribute("width")),L=parseFloat(S.getAttribute("height")),G,K;if(E&&(E=E.match(y))){var Q=parseFloat(E[1]),O=parseFloat(E[2]),R=1,P=1;G=parseFloat(E[3]);K=parseFloat(E[4]);if(I&&I!==G){R=I/G}if(L&&L!==K){P=L/K}f(S,[R,0,0,P,-Q,-O])}var F=m.util.toArray(S.getElementsByTagName("*"));if(F.length===0&&m.isLikelyNode){F=S.selectNodes('//*[name(.)!="svg"]');var A=[];for(var M=0,N=F.length;M<N;M++){A[M]=F[M]}F=A}var H=F.filter(function(T){return w.test(T.tagName)&&!z(T,/^(?:pattern|defs)$/)});if(!H||(H&&!H.length)){D&&D([],{});return}var C={width:I?I:G,height:L?L:K,widthAttr:I,heightAttr:L};m.gradientDefs=u(m.getGradientDefs(S),m.gradientDefs);m.cssRules=u(m.getCSSRules(S),m.cssRules);m.parseElements(H,function(T){m.documentParsingTime=new Date()-J;if(D){D(T,C)}},v(C),B)}})();var q={has:function(w,x){x(false)},get:function(){},set:function(){}};function d(y){var x=y.objects,w=y.options;x=x.map(function(z){return m[j(z.type)].fromObject(z)});return({objects:x,options:w})}function g(w,x,y){if(x[y]&&x[y].toSVG){w.push('<pattern x="0" y="0" id="',y,'Pattern" ','width="',x[y].source.width,'" height="',x[y].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',x[y].source.width,'" height="',x[y].source.height,'" xlink:href="',x[y].source.src,'"></image></pattern>')}}u(m,{resolveGradients:function(z){for(var w=z.length;w--;){var x=z[w].get("fill");if(!(/^url\(/).test(x)){continue}var y=x.slice(5,x.length-1);if(m.gradientDefs[y]){z[w].set("fill",m.Gradient.fromElement(m.gradientDefs[y],z[w]))}}},getGradientDefs:function(B){var y=B.getElementsByTagName("linearGradient"),w=B.getElementsByTagName("radialGradient"),z,x,A={};x=y.length;for(;x--;){z=y[x];A[z.getAttribute("id")]=z}x=w.length;for(;x--;){z=w[x];A[z.getAttribute("id")]=z}return A},parseAttributes:function(y,x){if(!y){return}var A,w={};if(y.parentNode&&/^[g|a]$/i.test(y.parentNode.nodeName)){w=m.parseAttributes(y.parentNode,x)}var z=x.reduce(function(C,B){A=y.getAttribute(B);if(A){B=a(B);A=i(B,A,w);C[B]=A}return C},{});z=u(z,u(t(y),m.parseStyleAttribute(y)));return c(u(w,z))},parseElements:function(y,z,x,w){new m.ElementsParser(y,z,x,w).parse()},parseStyleAttribute:function(x){var w={},y=x.getAttribute("style");if(!y){return w}if(typeof y==="string"){n(y,w)}else{k(y,w)}return w},parsePointsAttribute:function(z){if(!z){return null}z=z.replace(/,/g," ").trim();z=z.split(/\s+/);var x=[],y,w;y=0;w=z.length;for(;y<w;y+=2){x.push({x:parseFloat(z[y]),y:parseFloat(z[y+1])})}return x},getCSSRules:function(B){var z=B.getElementsByTagName("style"),x={},C;for(var y=0,w=z.length;y<w;y++){var A=z[0].textContent;A=A.replace(/\/\*[\s\S]*?\*\//g,"");C=A.match(/[^{]*\{[\s\S]*?\}/g);C=C.map(function(D){return D.trim()});C.forEach(function(I){var G=I.match(/([\s\S]*?)\s*\{([^}]*)\}/);I=G[1];var D=G[2].trim(),K=D.replace(/;$/,"").split(/\s*;\s*/);if(!x[I]){x[I]={}}for(var F=0,H=K.length;F<H;F++){var E=K[F].split(/\s*:\s*/),L=E[0],J=E[1];x[I][L]=J}})}return x},loadSVGFromURL:function(x,z,w){x=x.replace(/^\n\s*/,"").trim();q.has(x,function(A){if(A){q.get(x,function(C){var B=d(C);z(B.objects,B.options)})}else{new m.util.request(x,{method:"get",onComplete:y})}});function y(B){var A=B.responseXML;if(A&&!A.documentElement&&m.window.ActiveXObject&&B.responseText){A=new ActiveXObject("Microsoft.XMLDOM");A.async="false";A.loadXML(B.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}if(!A||!A.documentElement){return}m.parseSVGDocument(A.documentElement,function(D,C){q.set(x,{objects:m.util.array.invoke(D,"toObject"),options:C});z(D,C)},w)}},loadSVGFromString:function(x,A,w){x=x.trim();var y;if(typeof DOMParser!=="undefined"){var z=new DOMParser();if(z&&z.parseFromString){y=z.parseFromString(x,"text/xml")}}else{if(m.window.ActiveXObject){y=new ActiveXObject("Microsoft.XMLDOM");y.async="false";y.loadXML(x.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,""))}}m.parseSVGDocument(y.documentElement,function(C,B){A(C,B)},w)},createSVGFontFacesMarkup:function(z){var x="";for(var y=0,w=z.length;y<w;y++){if(z[y].type!=="text"||!z[y].path){continue}x+=["@font-face {","font-family: ",z[y].fontFamily,"; ","src: url('",z[y].path,"')","}"].join("")}if(x){x=['<style type="text/css">',"<![CDATA[",x,"]]>","</style>"].join("")}return x},createSVGRefElementsMarkup:function(x){var w=[];g(w,x,"backgroundColor");g(w,x,"overlayColor");return w.join("")}})})(typeof exports!=="undefined"?exports:this);fabric.ElementsParser=function(c,d,b,a){this.elements=c;this.callback=d;this.options=b;this.reviver=a};fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length);this.numElements=this.elements.length;this.createObjects()};fabric.ElementsParser.prototype.createObjects=function(){for(var b=0,a=this.elements.length;b<a;b++){(function(d,c){setTimeout(function(){d.createObject(d.elements[c],c)},0)})(this,b)}};fabric.ElementsParser.prototype.createObject=function(c,b){var a=fabric[fabric.util.string.capitalize(c.tagName)];if(a&&a.fromElement){try{this._createObject(a,c,b)}catch(d){fabric.log(d)}}else{this.checkIfDone()}};fabric.ElementsParser.prototype._createObject=function(a,c,b){if(a.async){a.fromElement(c,this.createCallback(b,c),this.options)}else{var d=a.fromElement(c,this.options);this.reviver&&this.reviver(c,d);this.instances[b]=d;this.checkIfDone()}};fabric.ElementsParser.prototype.createCallback=function(a,b){var c=this;return function(d){c.reviver&&c.reviver(b,d);c.instances[a]=d;c.checkIfDone()}};fabric.ElementsParser.prototype.checkIfDone=function(){if(--this.numElements===0){this.instances=this.instances.filter(function(a){return a!=null});fabric.resolveGradients(this.instances);this.callback(this.instances)}};(function(b){var c=b.fabric||(b.fabric={});if(c.Point){c.warn("fabric.Point is already defined");return}c.Point=a;function a(d,e){this.x=d;this.y=e}a.prototype={constructor:a,add:function(d){return new a(this.x+d.x,this.y+d.y)},addEquals:function(d){this.x+=d.x;this.y+=d.y;return this},scalarAdd:function(d){return new a(this.x+d,this.y+d)},scalarAddEquals:function(d){this.x+=d;this.y+=d;return this},subtract:function(d){return new a(this.x-d.x,this.y-d.y)},subtractEquals:function(d){this.x-=d.x;this.y-=d.y;return this},scalarSubtract:function(d){return new a(this.x-d,this.y-d)},scalarSubtractEquals:function(d){this.x-=d;this.y-=d;return this},multiply:function(d){return new a(this.x*d,this.y*d)},multiplyEquals:function(d){this.x*=d;this.y*=d;return this},divide:function(d){return new a(this.x/d,this.y/d)},divideEquals:function(d){this.x/=d;this.y/=d;return this},eq:function(d){return(this.x===d.x&&this.y===d.y)},lt:function(d){return(this.x<d.x&&this.y<d.y)},lte:function(d){return(this.x<=d.x&&this.y<=d.y)},gt:function(d){return(this.x>d.x&&this.y>d.y)},gte:function(d){return(this.x>=d.x&&this.y>=d.y)},lerp:function(e,d){return new a(this.x+(e.x-this.x)*d,this.y+(e.y-this.y)*d)},distanceFrom:function(f){var e=this.x-f.x,d=this.y-f.y;return Math.sqrt(e*e+d*d)},midPointFrom:function(d){return new a(this.x+(d.x-this.x)/2,this.y+(d.y-this.y)/2)},min:function(d){return new a(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new a(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,e){this.x=d;this.y=e},setFromPoint:function(d){this.x=d.x;this.y=d.y},swap:function(e){var d=this.x,f=this.y;this.x=e.x;this.y=e.y;e.x=d;e.y=f}}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Intersection){b.warn("fabric.Intersection is already defined");return}function c(d){this.status=d;this.points=[]}b.Intersection=c;b.Intersection.prototype={appendPoint:function(d){this.points.push(d)},appendPoints:function(d){this.points=this.points.concat(d)}};b.Intersection.intersectLineLine=function(h,g,l,k){var m,e=(k.x-l.x)*(h.y-l.y)-(k.y-l.y)*(h.x-l.x),j=(g.x-h.x)*(h.y-l.y)-(g.y-h.y)*(h.x-l.x),i=(k.y-l.y)*(g.x-h.x)-(k.x-l.x)*(g.y-h.y);if(i!==0){var f=e/i,d=j/i;if(0<=f&&f<=1&&0<=d&&d<=1){m=new c("Intersection");m.points.push(new b.Point(h.x+f*(g.x-h.x),h.y+f*(g.y-h.y)))}else{m=new c()}}else{if(e===0||j===0){m=new c("Coincident")}else{m=new c("Parallel")}}return m};b.Intersection.intersectLinePolygon=function(e,d,l){var m=new c(),f=l.length;for(var h=0;h<f;h++){var k=l[h],j=l[(h+1)%f],g=c.intersectLineLine(e,d,k,j);m.appendPoints(g.points)}if(m.points.length>0){m.status="Intersection"}return m};b.Intersection.intersectPolygonPolygon=function(j,h){var f=new c(),l=j.length;for(var k=0;k<l;k++){var g=j[k],e=j[(k+1)%l],d=c.intersectLinePolygon(g,e,h);f.appendPoints(d.points)}if(f.points.length>0){f.status="Intersection"}return f};b.Intersection.intersectPolygonRectangle=function(n,e,d){var g=e.min(d),m=e.max(d),f=new b.Point(m.x,g.y),l=new b.Point(g.x,m.y),k=c.intersectLinePolygon(g,f,n),j=c.intersectLinePolygon(f,m,n),i=c.intersectLinePolygon(m,l,n),h=c.intersectLinePolygon(l,g,n),o=new c();o.appendPoints(k.points);o.appendPoints(j.points);o.appendPoints(i.points);o.appendPoints(h.points);if(o.points.length>0){o.status="Intersection"}return o}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={});if(c.Color){c.warn("fabric.Color is already defined.");return}function d(e){if(!e){this.setSource([0,0,0,1])}else{this._tryParsingColor(e)}}c.Color=d;c.Color.prototype={_tryParsingColor:function(e){var f;if(e in d.colorNameMap){e=d.colorNameMap[e]}if(e==="transparent"){this.setSource([255,255,255,0]);return}f=d.sourceFromHex(e);if(!f){f=d.sourceFromRgb(e)}if(!f){f=d.sourceFromHsl(e)}if(f){this.setSource(f)}},_rgbToHsl:function(e,k,n){e/=255,k/=255,n/=255;var j,p,f,o=c.util.array.max([e,k,n]),i=c.util.array.min([e,k,n]);f=(o+i)/2;if(o===i){j=p=0}else{var m=o-i;p=f>0.5?m/(2-o-i):m/(o+i);switch(o){case e:j=(k-n)/m+(k<n?6:0);break;case k:j=(n-e)/m+2;break;case n:j=(e-k)/m+4;break}j/=6}return[Math.round(j*360),Math.round(p*100),Math.round(f*100)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsl("+e[0]+","+e[1]+"%,"+e[2]+"%)"},toHsla:function(){var f=this.getSource(),e=this._rgbToHsl(f[0],f[1],f[2]);return"hsla("+e[0]+","+e[1]+"%,"+e[2]+"%,"+f[3]+")"},toHex:function(){var i=this.getSource(),h,f,e;h=i[0].toString(16);h=(h.length===1)?("0"+h):h;f=i[1].toString(16);f=(f.length===1)?("0"+f):f;e=i[2].toString(16);e=(e.length===1)?("0"+e):e;return h.toUpperCase()+f.toUpperCase()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var e=this.getSource();e[3]=f;this.setSource(e);return this},toGrayscale:function(){var g=this.getSource(),f=parseInt((g[0]*0.3+g[1]*0.59+g[2]*0.11).toFixed(0),10),e=g[3];this.setSource([f,f,f,e]);return this},toBlackWhite:function(e){var h=this.getSource(),g=(h[0]*0.3+h[1]*0.59+h[2]*0.11).toFixed(0),f=h[3];e=e||127;g=(Number(g)<Number(e))?0:255;this.setSource([g,g,g,f]);return this},overlayWith:function(l){if(!(l instanceof d)){l=new d(l)}var e=[],k=this.getAlpha(),h=0.5,j=this.getSource(),f=l.getSource();for(var g=0;g<3;g++){e.push(Math.round((j[g]*(1-h))+(f[g]*h)))}e[3]=k;this.setSource(e);return this}};c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/;c.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;c.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"};function a(g,f,e){if(e<0){e+=1}if(e>1){e-=1}if(e<1/6){return g+(f-g)*6*e}if(e<1/2){return f}if(e<2/3){return g+(f-g)*(2/3-e)*6}return g}c.Color.fromRgb=function(e){return d.fromSource(d.sourceFromRgb(e))};c.Color.sourceFromRgb=function(f){var h=f.match(d.reRGBa);if(h){var j=parseInt(h[1],10)/(/%$/.test(h[1])?100:1)*(/%$/.test(h[1])?255:1),i=parseInt(h[2],10)/(/%$/.test(h[2])?100:1)*(/%$/.test(h[2])?255:1),e=parseInt(h[3],10)/(/%$/.test(h[3])?100:1)*(/%$/.test(h[3])?255:1);return[parseInt(j,10),parseInt(i,10),parseInt(e,10),h[4]?parseFloat(h[4]):1]}};c.Color.fromRgba=d.fromRgb;c.Color.fromHsl=function(e){return d.fromSource(d.sourceFromHsl(e))};c.Color.sourceFromHsl=function(k){var n=k.match(d.reHSLa);if(!n){return}var m=(((parseFloat(n[1])%360)+360)%360)/360,u=parseFloat(n[2])/(/%$/.test(n[2])?100:1),j=parseFloat(n[3])/(/%$/.test(n[3])?100:1),e,o,t;if(u===0){e=o=t=j}else{var f=j<=0.5?j*(u+1):j+u-j*u,i=j*2-f;e=a(i,f,m+1/3);o=a(i,f,m);t=a(i,f,m-1/3)}return[Math.round(e*255),Math.round(o*255),Math.round(t*255),n[4]?parseFloat(n[4]):1]};c.Color.fromHsla=d.fromHsl;c.Color.fromHex=function(e){return d.fromSource(d.sourceFromHex(e))};c.Color.sourceFromHex=function(h){if(h.match(d.reHex)){var k=h.slice(h.indexOf("#")+1),f=(k.length===3),j=f?(k.charAt(0)+k.charAt(0)):k.substring(0,2),i=f?(k.charAt(1)+k.charAt(1)):k.substring(2,4),e=f?(k.charAt(2)+k.charAt(2)):k.substring(4,6);return[parseInt(j,16),parseInt(i,16),parseInt(e,16),1]}};c.Color.fromSource=function(e){var f=new d();f.setSource(e);return f}})(typeof exports!=="undefined"?exports:this);(function(){function f(h){var g=h.getAttribute("style"),k=h.getAttribute("offset"),j,n;k=parseFloat(k)/(/%$/.test(k)?100:1);if(g){var m=g.split(/\s*;\s*/);if(m[m.length-1]===""){m.pop()}for(var l=m.length;l--;){var o=m[l].split(/\s*:\s*/),q=o[0].trim(),p=o[1].trim();if(q==="stop-color"){j=p}else{if(q==="stop-opacity"){n=p}}}}if(!j){j=h.getAttribute("stop-color")||"rgb(0,0,0)"}if(!n){n=h.getAttribute("stop-opacity")}j=new fabric.Color(j).toRgb();return{offset:k,color:j,opacity:isNaN(parseFloat(n))?1:parseFloat(n)}}function c(g){return{x1:g.getAttribute("x1")||0,y1:g.getAttribute("y1")||0,x2:g.getAttribute("x2")||"100%",y2:g.getAttribute("y2")||0}}function e(g){return{x1:g.getAttribute("fx")||g.getAttribute("cx")||"50%",y1:g.getAttribute("fy")||g.getAttribute("cy")||"50%",r1:0,x2:g.getAttribute("cx")||"50%",y2:g.getAttribute("cy")||"50%",r2:g.getAttribute("r")||"50%"}}fabric.Gradient=fabric.util.createClass({initialize:function(g){g||(g={});var h={};this.id=fabric.Object.__uid++;this.type=g.type||"linear";h={x1:g.coords.x1||0,y1:g.coords.y1||0,x2:g.coords.x2||0,y2:g.coords.y2||0};if(this.type==="radial"){h.r1=g.coords.r1||0;h.r2=g.coords.r2||0}this.coords=h;this.gradientUnits=g.gradientUnits||"objectBoundingBox";this.colorStops=g.colorStops.slice()},addColorStop:function(h){for(var g in h){var i=new fabric.Color(h[g]);this.colorStops.push({offset:g,color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(j,h){var l=fabric.util.object.clone(this.coords),g;this.colorStops.sort(function(m,i){return m.offset-i.offset});if(h&&this.gradientUnits==="userSpaceOnUse"){l.x1+=j.width/2;l.y1+=j.height/2;l.x2+=j.width/2;l.y2+=j.height/2}else{if(this.gradientUnits==="objectBoundingBox"){d(j,l)}}if(this.type==="linear"){g=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',l.x1,'" y1="',l.y1,'" x2="',l.x2,'" y2="',l.y2,'">']}else{if(this.type==="radial"){g=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',l.x2,'" cy="',l.y2,'" r="',l.r2,'" fx="',l.x1,'" fy="',l.y1,'">']}}for(var k=0;k<this.colorStops.length;k++){g.push("<stop ",'offset="',(this.colorStops[k].offset*100)+"%",'" style="stop-color:',this.colorStops[k].color,(this.colorStops[k].opacity?";stop-opacity: "+this.colorStops[k].opacity:";"),'"/>')}g.push((this.type==="linear"?"</linearGradient>":"</radialGradient>"));return g.join("")},toLive:function(h){var m;if(!this.type){return}if(this.type==="linear"){m=h.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2)}else{if(this.type==="radial"){m=h.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2)}}for(var l=0,g=this.colorStops.length;l<g;l++){var j=this.colorStops[l].color,k=this.colorStops[l].opacity,n=this.colorStops[l].offset;if(typeof k!=="undefined"){j=new fabric.Color(j).setAlpha(k).toRgba()}m.addColorStop(parseFloat(n),j)}return m}});fabric.util.object.extend(fabric.Gradient,{fromElement:function(m,g){var o=m.getElementsByTagName("stop"),l=(m.nodeName==="linearGradient"?"linear":"radial"),j=m.getAttribute("gradientUnits")||"objectBoundingBox",h=[],n={};if(l==="linear"){n=c(m)}else{if(l==="radial"){n=e(m)}}for(var k=o.length;k--;){h.push(f(o[k]))}a(g,n);return new fabric.Gradient({type:l,coords:n,gradientUnits:j,colorStops:h})},forObject:function(h,g){g||(g={});a(h,g);return new fabric.Gradient(g)}});function a(i,h){for(var j in h){if(typeof h[j]==="string"&&/^\d+%$/.test(h[j])){var g=parseFloat(h[j],10);if(j==="x1"||j==="x2"||j==="r2"){h[j]=fabric.util.toFixed(i.width*g/100,2)}else{if(j==="y1"||j==="y2"){h[j]=fabric.util.toFixed(i.height*g/100,2)}}}b(h,j,i)}}function b(h,i,g){if(i==="x1"||i==="x2"){h[i]-=fabric.util.toFixed(g.width/2,2)}else{if(i==="y1"||i==="y2"){h[i]-=fabric.util.toFixed(g.height/2,2)}}}function d(h,g){for(var i in g){b(g,i,h);if(i==="x1"||i==="x2"||i==="r2"){g[i]=fabric.util.toFixed(g[i]/h.width*100,2)+"%"}else{if(i==="y1"||i==="y2"){g[i]=fabric.util.toFixed(g[i]/h.height*100,2)+"%"}}}}})();fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(a){a||(a={});this.id=fabric.Object.__uid++;if(a.source){if(typeof a.source==="string"){if(typeof fabric.util.getFunctionBody(a.source)!=="undefined"){this.source=new Function(fabric.util.getFunctionBody(a.source))}else{var b=this;this.source=fabric.util.createImage();fabric.util.loadImage(a.source,function(c){b.source=c})}}else{this.source=a.source}}if(a.repeat){this.repeat=a.repeat}if(a.offsetX){this.offsetX=a.offsetX}if(a.offsetY){this.offsetY=a.offsetY}},toObject:function(){var a;if(typeof this.source==="function"){a=String(this.source)}else{if(typeof this.source.src==="string"){a=this.source.src}}return{source:a,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(b){var a=typeof this.source==="function"?this.source():this.source,d=a.width/b.getWidth(),c=a.height/b.getHeight(),e="";if(a.src){e=a.src}else{if(a.toDataURL){e=a.toDataURL()}}return'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+'" y="'+this.offsetY+'" width="'+d+'" height="'+c+'"><image x="0" y="0" width="'+a.width+'" height="'+a.height+'" xlink:href="'+e+'"></image></pattern>'},toLive:function(a){var b=typeof this.source==="function"?this.source():this.source;if(!b){return""}if(typeof b.src!=="undefined"){if(!b.complete){return""}if(b.naturalWidth===0||b.naturalHeight===0){return""}}return a.createPattern(b,this.repeat)}});(function(a){var b=a.fabric||(a.fabric={});if(b.Shadow){b.warn("fabric.Shadow is already defined.");return}b.Shadow=b.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:false,includeDefaultValues:true,initialize:function(c){if(typeof c==="string"){c=this._parseShadow(c)}for(var d in c){this[d]=c[d]}this.id=b.Object.__uid++},_parseShadow:function(f){var e=f.trim(),d=b.Shadow.reOffsetsAndBlur.exec(e)||[],c=e.replace(b.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:c.trim(),offsetX:parseInt(d[1],10)||0,offsetY:parseInt(d[2],10)||0,blur:parseInt(d[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(c){var d="SourceAlpha";if(c&&(c.fill===this.color||c.stroke===this.color)){d="SourceGraphic"}return('<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+d+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>')},toObject:function(){if(this.includeDefaultValues){return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY}}var d={},c=b.Shadow.prototype;if(this.color!==c.color){d.color=this.color}if(this.blur!==c.blur){d.blur=this.blur}if(this.offsetX!==c.offsetX){d.offsetX=this.offsetX}if(this.offsetY!==c.offsetY){d.offsetY=this.offsetY}return d}});b.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/})(typeof exports!=="undefined"?exports:this);(function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var d=fabric.util.object.extend,b=fabric.util.getElementOffset,c=fabric.util.removeFromArray,a=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(f,e){e||(e={});this._initStatic(f,e);fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:true,stateful:true,renderOnAddRemove:true,clipTo:null,controlsAboveOverlay:false,allowTouchScrolling:false,imageSmoothingEnabled:true,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(f,e){this._objects=[];this._createLowerCanvas(f);this._initOptions(e);this._setImageSmoothing();if(e.overlayImage){this.setOverlayImage(e.overlayImage,this.renderAll.bind(this))}if(e.backgroundImage){this.setBackgroundImage(e.backgroundImage,this.renderAll.bind(this))}if(e.backgroundColor){this.setBackgroundColor(e.backgroundColor,this.renderAll.bind(this))}if(e.overlayColor){this.setOverlayColor(e.overlayColor,this.renderAll.bind(this))}this.calcOffset()},calcOffset:function(){this._offset=b(this.lowerCanvasEl);return this},setOverlayImage:function(f,g,e){return this.__setBgOverlayImage("overlayImage",f,g,e)},setBackgroundImage:function(f,g,e){return this.__setBgOverlayImage("backgroundImage",f,g,e)},setOverlayColor:function(f,e){return this.__setBgOverlayColor("overlayColor",f,e)},setBackgroundColor:function(e,f){return this.__setBgOverlayColor("backgroundColor",e,f)},_setImageSmoothing:function(){var e=this.getContext();e.imageSmoothingEnabled=this.imageSmoothingEnabled;e.webkitImageSmoothingEnabled=this.imageSmoothingEnabled;e.mozImageSmoothingEnabled=this.imageSmoothingEnabled;e.msImageSmoothingEnabled=this.imageSmoothingEnabled;e.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(f,g,h,e){if(typeof g==="string"){fabric.util.loadImage(g,function(i){this[f]=new fabric.Image(i,e);h&&h()},this)}else{this[f]=g;h&&h()}return this},__setBgOverlayColor:function(f,e,h){if(e&&e.source){var g=this;fabric.util.loadImage(e.source,function(i){g[f]=new fabric.Pattern({source:i,repeat:e.repeat,offsetX:e.offsetX,offsetY:e.offsetY});h&&h()})}else{this[f]=e;h&&h()}return this},_createCanvasElement:function(){var e=fabric.document.createElement("canvas");if(!e.style){e.style={}}if(!e){throw a}this._initCanvasElement(e);return e},_initCanvasElement:function(e){fabric.util.createCanvasElement(e);if(typeof e.getContext==="undefined"){throw a}},_initOptions:function(e){for(var f in e){this[f]=e[f]}this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0;this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style){return}this.lowerCanvasEl.width=this.width;this.lowerCanvasEl.height=this.height;this.lowerCanvasEl.style.width=this.width+"px";this.lowerCanvasEl.style.height=this.height+"px";this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(e){this.lowerCanvasEl=fabric.util.getById(e)||this._createCanvasElement();this._initCanvasElement(this.lowerCanvasEl);fabric.util.addClass(this.lowerCanvasEl,"lower-canvas");if(this.interactive){this._applyCanvasStyle(this.lowerCanvasEl)}this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e){return this._setDimension("width",e)},setHeight:function(e){return this._setDimension("height",e)},setDimensions:function(e){for(var f in e){this._setDimension(f,e[f])}return this},_setDimension:function(f,e){this.lowerCanvasEl[f]=e;this.lowerCanvasEl.style[f]=e+"px";if(this.upperCanvasEl){this.upperCanvasEl[f]=e;this.upperCanvasEl.style[f]=e+"px"}if(this.cacheCanvasEl){this.cacheCanvasEl[f]=e}if(this.wrapperEl){this.wrapperEl.style[f]=e+"px"}this[f]=e;this.calcOffset();this.renderAll();return this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(g){this.viewportTransform=g;this.renderAll();for(var f=0,e=this._objects.length;f<e;f++){this._objects[f].setCoords()}return this},zoomToPoint:function(f,j){var h=f;f=fabric.util.transformPoint(f,fabric.util.invertTransform(this.viewportTransform));this.viewportTransform[0]=j;this.viewportTransform[3]=j;var k=fabric.util.transformPoint(f,this.viewportTransform);this.viewportTransform[4]+=h.x-k.x;this.viewportTransform[5]+=h.y-k.y;this.renderAll();for(var g=0,e=this._objects.length;g<e;g++){this._objects[g].setCoords()}return this},setZoom:function(e){this.zoomToPoint(new fabric.Point(0,0),e);return this},absolutePan:function(f){this.viewportTransform[4]=-f.x;this.viewportTransform[5]=-f.y;this.renderAll();for(var g=0,e=this._objects.length;g<e;g++){this._objects[g].setCoords()}return this},relativePan:function(e){return this.absolutePan(new fabric.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(e,g){if(!g){return}e.save();var f=this.viewportTransform;e.transform(f[0],f[1],f[2],f[3],f[4],f[5]);g.render(e);e.restore();if(!this.controlsAboveOverlay){g._renderControls(e)}},_onObjectAdded:function(e){this.stateful&&e.setupState();e.canvas=this;e.setCoords();this.fire("object:added",{target:e});e.fire("added")},_onObjectRemoved:function(e){if(this.getActiveObject()===e){this.fire("before:selection:cleared",{target:e});this._discardActiveObject();this.fire("selection:cleared")}this.fire("object:removed",{target:e});e.fire("removed")},clearContext:function(e){e.clearRect(0,0,this.width,this.height);return this},getContext:function(){return this.contextContainer},clear:function(){this._objects.length=0;if(this.discardActiveGroup){this.discardActiveGroup()}if(this.discardActiveObject){this.discardActiveObject()}this.clearContext(this.contextContainer);if(this.contextTop){this.clearContext(this.contextTop)}this.fire("canvas:cleared");this.renderAll();return this},renderAll:function(e){var f=this[(e===true&&this.interactive)?"contextTop":"contextContainer"],g=this.getActiveGroup();if(this.contextTop&&this.selection&&!this._groupSelector){this.clearContext(this.contextTop)}if(!e){this.clearContext(f)}this.fire("before:render");if(this.clipTo){fabric.util.clipContext(this,f)}this._renderBackground(f);this._renderObjects(f,g);this._renderActiveGroup(f,g);if(this.clipTo){f.restore()}this._renderOverlay(f);if(this.controlsAboveOverlay&&this.interactive){this.drawControls(f)}this.fire("after:render");return this},_renderObjects:function(e,g){var f,h;if(!g){for(f=0,h=this._objects.length;f<h;++f){this._draw(e,this._objects[f])}}else{for(f=0,h=this._objects.length;f<h;++f){if(this._objects[f]&&!g.contains(this._objects[f])){this._draw(e,this._objects[f])}}}},_renderActiveGroup:function(e,f){if(f){var g=[];this.forEachObject(function(h){if(f.contains(h)){g.push(h)}});f._set("objects",g);this._draw(e,f)}},_renderBackground:function(e){if(this.backgroundColor){e.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(e):this.backgroundColor;e.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)}if(this.backgroundImage){this._draw(e,this.backgroundImage)}},_renderOverlay:function(e){if(this.overlayColor){e.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(e):this.overlayColor;e.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)}if(this.overlayImage){this._draw(e,this.overlayImage)}},renderTop:function(){var e=this.contextTop||this.contextContainer;this.clearContext(e);if(this.selection&&this._groupSelector){this._drawSelection()}var f=this.getActiveGroup();if(f){f.render(e)}this._renderOverlay(e);this.fire("after:render");return this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(e){this._centerObject(e,new fabric.Point(this.getCenter().left,e.getCenterPoint().y));this.renderAll();return this},centerObjectV:function(e){this._centerObject(e,new fabric.Point(e.getCenterPoint().x,this.getCenter().top));this.renderAll();return this},centerObject:function(f){var e=this.getCenter();this._centerObject(f,new fabric.Point(e.left,e.top));this.renderAll();return this},_centerObject:function(f,e){f.setPositionByOrigin(e,"center","center");return this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(e,h){var f=this.getActiveGroup();if(f){this.discardActiveGroup()}var g={objects:this._toObjects(e,h)};d(g,this.__serializeBgOverlay());fabric.util.populateWithProperties(this,g,h);if(f){this.setActiveGroup(new fabric.Group(f.getObjects(),{originX:"center",originY:"center"}));f.forEachObject(function(i){i.set("active",true)});if(this._currentTransform){this._currentTransform.target=this.getActiveGroup()}}return g},_toObjects:function(e,f){return this.getObjects().map(function(g){return this._toObject(g,e,f)},this)},_toObject:function(e,g,i){var f;if(!this.includeDefaultValues){f=e.includeDefaultValues;e.includeDefaultValues=false}var h=e[g](i);if(!this.includeDefaultValues){e.includeDefaultValues=f}return h},__serializeBgOverlay:function(){var e={background:(this.backgroundColor&&this.backgroundColor.toObject)?this.backgroundColor.toObject():this.backgroundColor};if(this.overlayColor){e.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor}if(this.backgroundImage){e.backgroundImage=this.backgroundImage.toObject()}if(this.overlayImage){e.overlayImage=this.overlayImage.toObject()}return e},toSVG:function(g,e){g||(g={});var f=[];this._setSVGPreamble(f,g);this._setSVGHeader(f,g);this._setSVGBgOverlayColor(f,"backgroundColor");this._setSVGBgOverlayImage(f,"backgroundImage");this._setSVGObjects(f,e);this._setSVGBgOverlayColor(f,"overlayColor");this._setSVGBgOverlayImage(f,"overlayImage");f.push("</svg>");return f.join("")},_setSVGPreamble:function(e,f){if(!f.suppressPreamble){e.push('<?xml version="1.0" encoding="',(f.encoding||"UTF-8"),'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')}},_setSVGHeader:function(e,f){e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',(f.viewBox?f.viewBox.width:this.width),'" ','height="',(f.viewBox?f.viewBox.height:this.height),'" ',(this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null),(f.viewBox?'viewBox="'+f.viewBox.x+" "+f.viewBox.y+" "+f.viewBox.width+" "+f.viewBox.height+'" ':null),'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(g,f){var j=this.getActiveGroup();if(j){this.discardActiveGroup()}for(var h=0,k=this.getObjects(),e=k.length;h<e;h++){g.push(k[h].toSVG(f))}if(j){this.setActiveGroup(new fabric.Group(j.getObjects()));j.forEachObject(function(i){i.set("active",true)})}},_setSVGBgOverlayImage:function(e,f){if(this[f]&&this[f].toSVG){e.push(this[f].toSVG())}},_setSVGBgOverlayColor:function(e,f){if(this[f]&&this[f].source){e.push('<rect x="',this[f].offsetX,'" y="',this[f].offsetY,'" ','width="',(this[f].repeat==="repeat-y"||this[f].repeat==="no-repeat"?this[f].source.width:this.width),'" height="',(this[f].repeat==="repeat-x"||this[f].repeat==="no-repeat"?this[f].source.height:this.height),'" fill="url(#'+f+'Pattern)"',"></rect>")}else{if(this[f]&&f==="overlayColor"){e.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[f],'"',"></rect>")}}},sendToBack:function(e){c(this._objects,e);this._objects.unshift(e);return this.renderAll&&this.renderAll()},bringToFront:function(e){c(this._objects,e);this._objects.push(e);return this.renderAll&&this.renderAll()},sendBackwards:function(f,g){var e=this._objects.indexOf(f);if(e!==0){var h=this._findNewLowerIndex(f,e,g);c(this._objects,f);this._objects.splice(h,0,f);this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(g,e,j){var k;if(j){k=e;for(var h=e-1;h>=0;--h){var f=g.intersectsWithObject(this._objects[h])||g.isContainedWithinObject(this._objects[h])||this._objects[h].isContainedWithinObject(g);if(f){k=h;break}}}else{k=e-1}return k},bringForward:function(f,g){var e=this._objects.indexOf(f);if(e!==this._objects.length-1){var h=this._findNewUpperIndex(f,e,g);c(this._objects,f);this._objects.splice(h,0,f);this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(g,e,j){var k;if(j){k=e;for(var h=e+1;h<this._objects.length;++h){var f=g.intersectsWithObject(this._objects[h])||g.isContainedWithinObject(this._objects[h])||this._objects[h].isContainedWithinObject(g);if(f){k=h;break}}}else{k=e+1}return k},moveTo:function(f,e){c(this._objects,f);this._objects.splice(e,0,f);return this.renderAll&&this.renderAll()},dispose:function(){this.clear();this.interactive&&this.removeListeners();return this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}});d(fabric.StaticCanvas.prototype,fabric.Observable);d(fabric.StaticCanvas.prototype,fabric.Collection);d(fabric.StaticCanvas.prototype,fabric.DataURLExporter);d(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(g){var h=fabric.util.createCanvasElement();if(!h||!h.getContext){return null}var f=h.getContext("2d");if(!f){return null}switch(g){case"getImageData":return typeof f.getImageData!=="undefined";case"setLineDash":return typeof f.setLineDash!=="undefined";case"toDataURL":return typeof h.toDataURL!=="undefined";case"toDataURLWithQuality":try{h.toDataURL("image/jpeg",0);return true}catch(i){}return false;default:return null}}});fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject})();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(a){this.shadow=new fabric.Shadow(a);return this},_setBrushStyles:function(){var a=this.canvas.contextTop;a.strokeStyle=this.color;a.lineWidth=this.width;a.lineCap=this.strokeLineCap;a.lineJoin=this.strokeLineJoin},_setShadow:function(){if(!this.shadow){return}var a=this.canvas.contextTop;a.shadowColor=this.shadow.color;a.shadowBlur=this.shadow.blur;a.shadowOffsetX=this.shadow.offsetX;a.shadowOffsetY=this.shadow.offsetY},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="";a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0}});(function(){var b=fabric.util.array.min,a=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(c){this.canvas=c;this._points=[]},onMouseDown:function(c){this._prepareForDrawing(c);this._captureDrawingPath(c);this._render()},onMouseMove:function(c){this._captureDrawingPath(c);this.canvas.clearContext(this.canvas.contextTop);this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(d){var c=new fabric.Point(d.x,d.y);this._reset();this._addPoint(c);this.canvas.contextTop.moveTo(c.x,c.y)},_addPoint:function(c){this._points.push(c)},_reset:function(){this._points.length=0;this._setBrushStyles();this._setShadow()},_captureDrawingPath:function(c){var d=new fabric.Point(c.x,c.y);this._addPoint(d)},_render:function(){var d=this.canvas.contextTop,e=this.canvas.viewportTransform,h=this._points[0],g=this._points[1];d.save();d.transform(e[0],e[1],e[2],e[3],e[4],e[5]);d.beginPath();if(this._points.length===2&&h.x===g.x&&h.y===g.y){h.x-=0.5;g.x+=0.5}d.moveTo(h.x,h.y);for(var f=1,c=this._points.length;f<c;f++){var j=h.midPointFrom(g);d.quadraticCurveTo(h.x,h.y,j.x,j.y);h=this._points[f];g=this._points[f+1]}d.lineTo(h.x,h.y);d.stroke();d.restore()},_getSVGPathData:function(){this.box=this.getPathBoundingBox(this._points);return this.convertPointsToSVGPath(this._points,this.box.minX,this.box.minY)},getPathBoundingBox:function(k){var d=[],g=[],l=k[0],j=k[1],c=l;for(var e=1,f=k.length;e<f;e++){var h=l.midPointFrom(j);d.push(c.x);d.push(h.x);g.push(c.y);g.push(h.y);l=k[e];j=k[e+1];c=h}d.push(l.x);g.push(l.y);return{minX:b(d),minY:b(g),maxX:a(d),maxY:a(g)}},convertPointsToSVGPath:function(j,d,c){var l=[],k=new fabric.Point(j[0].x-d,j[0].y-c),h=new fabric.Point(j[1].x-d,j[1].y-c);l.push("M ",j[0].x-d," ",j[0].y-c," ");for(var e=1,f=j.length;e<f;e++){var g=k.midPointFrom(h);l.push("Q ",k.x," ",k.y," ",g.x," ",g.y," ");k=new fabric.Point(j[e].x-d,j[e].y-c);if((e+1)<j.length){h=new fabric.Point(j[e+1].x-d,j[e+1].y-c)}}l.push("L ",k.x," ",k.y," ");return l},createPath:function(d){var c=new fabric.Path(d);c.fill=null;c.stroke=this.color;c.strokeWidth=this.width;c.strokeLineCap=this.strokeLineCap;c.strokeLineJoin=this.strokeLineJoin;if(this.shadow){this.shadow.affectStroke=true;c.setShadow(this.shadow)}return c},_finalizeAndAddPath:function(){var c=this.canvas.contextTop;c.closePath();var g=this._getSVGPathData().join("");if(g==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}var d=this.box.minX+(this.box.maxX-this.box.minX)/2,e=this.box.minY+(this.box.maxY-this.box.minY)/2;this.canvas.contextTop.arc(d,e,3,0,Math.PI*2,false);var f=this.createPath(g);f.set({left:d,top:e,originX:"center",originY:"center"});this.canvas.add(f);f.setCoords();this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderAll();this.canvas.fire("path:created",{path:f})}})})();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(a){this.canvas=a;this.points=[]},drawDot:function(d){var a=this.addPoint(d),b=this.canvas.contextTop,c=this.canvas.viewportTransform;b.save();b.transform(c[0],c[1],c[2],c[3],c[4],c[5]);b.fillStyle=a.fill;b.beginPath();b.arc(a.x,a.y,a.radius,0,Math.PI*2,false);b.closePath();b.fill();b.restore()},onMouseDown:function(a){this.points.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.drawDot(a)},onMouseMove:function(a){this.drawDot(a)},onMouseUp:function(){var g=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var f=[];for(var c=0,b=this.points.length;c<b;c++){var a=this.points[c],e=new fabric.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&e.setShadow(this.shadow);f.push(e)}var d=new fabric.Group(f,{originX:"center",originY:"center"});d.canvas=this.canvas;this.canvas.add(d);this.canvas.fire("path:created",{path:d});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=g;this.canvas.renderAll()},addPoint:function(c){var d=new fabric.Point(c.x,c.y),a=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,b=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();d.radius=a;d.fill=b;this.points.push(d);return d}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:false,optimizeOverlapping:true,initialize:function(a){this.canvas=a;this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0;this.canvas.clearContext(this.canvas.contextTop);this._setShadow();this.addSprayChunk(a);this.render()},onMouseMove:function(a){this.addSprayChunk(a);this.render()},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=false;var h=[];for(var c=0,a=this.sprayChunks.length;c<a;c++){var d=this.sprayChunks[c];for(var b=0,k=d.length;b<k;b++){var f=new fabric.Rect({width:d[b].width,height:d[b].width,left:d[b].x+1,top:d[b].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&f.setShadow(this.shadow);h.push(f)}}if(this.optimizeOverlapping){h=this._getOptimizedRects(h)}var g=new fabric.Group(h,{originX:"center",originY:"center"});g.canvas=this.canvas;this.canvas.add(g);this.canvas.fire("path:created",{path:g});this.canvas.clearContext(this.canvas.contextTop);this._resetShadow();this.canvas.renderOnAddRemove=e;this.canvas.renderAll()},_getOptimizedRects:function(c){var b={},e;for(var d=0,a=c.length;d<a;d++){e=c[d].left+""+c[d].top;if(!b[e]){b[e]=c[d]}}var f=[];for(e in b){f.push(b[e])}return f},render:function(){var c=this.canvas.contextTop;c.fillStyle=this.color;var d=this.canvas.viewportTransform;c.save();c.transform(d[0],d[1],d[2],d[3],d[4],d[5]);for(var e=0,b=this.sprayChunkPoints.length;e<b;e++){var a=this.sprayChunkPoints[e];if(typeof a.opacity!=="undefined"){c.globalAlpha=a.opacity}c.fillRect(a.x,a.y,a.width,a.width)}c.restore()},addSprayChunk:function(f){this.sprayChunkPoints=[];var c,g,e,b=this.width/2;for(var d=0;d<this.density;d++){c=fabric.util.getRandomInt(f.x-b,f.x+b);g=fabric.util.getRandomInt(f.y-b,f.y+b);if(this.dotWidthVariance){e=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance)}else{e=this.dotWidth}var a=new fabric.Point(c,g);a.width=e;if(this.randomOpacity){a.opacity=fabric.util.getRandomInt(0,100)/100}this.sprayChunkPoints.push(a)}this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var d=20,b=5,c=fabric.document.createElement("canvas"),a=c.getContext("2d");c.width=c.height=d+b;a.fillStyle=this.color;a.beginPath();a.arc(d/2,d/2,d/2,0,Math.PI*2,false);a.closePath();a.fill();return c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles");this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(b){var a=this.callSuper("createPath",b);a.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()});return a}});(function(){var c=fabric.util.getPointer,d=fabric.util.degreesToRadians,f=fabric.util.radiansToDegrees,e=Math.atan2,b=Math.abs,a=0.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(i,h){h||(h={});this._initStatic(i,h);this._initInteractive();this._createCacheCanvas();fabric.Canvas.activeInstance=this},uniScaleTransform:false,centeredScaling:false,centeredRotation:false,interactive:true,selection:true,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:false,targetFindTolerance:0,skipTargetFind:false,_initInteractive:function(){this._currentTransform=null;this._groupSelector=null;this._initWrapperElement();this._createUpperCanvas();this._initEventListeners();this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this);this.calcOffset()},_resetCurrentTransform:function(i){var h=this._currentTransform;h.target.set({scaleX:h.original.scaleX,scaleY:h.original.scaleY,left:h.original.left,top:h.original.top});if(this._shouldCenterTransform(i,h.target)){if(h.action==="rotate"){this._setOriginToCenter(h.target)}else{if(h.originX!=="center"){if(h.originX==="right"){h.mouseXSign=-1}else{h.mouseXSign=1}}if(h.originY!=="center"){if(h.originY==="bottom"){h.mouseYSign=-1}else{h.mouseYSign=1}}h.originX="center";h.originY="center"}}else{h.originX=h.original.originX;h.originY=h.original.originY}},containsPoint:function(j,i){var k=this.getPointer(j,true),h=this._normalizePointer(i,k);return(i.containsPoint(h)||i._findTargetCorner(k))},_normalizePointer:function(j,m){var l=this.getActiveGroup(),i=m.x,n=m.y,k=(l&&j.type!=="group"&&l.contains(j)),h;if(k){h=new fabric.Point(l.left,l.top);h=fabric.util.transformPoint(h,this.viewportTransform,true);i-=h.x;n-=h.y}return{x:i,y:n}},isTargetTransparent:function(l,h,m){var i=l.hasBorders,j=l.transparentCorners;l.hasBorders=l.transparentCorners=false;this._draw(this.contextCache,l);l.hasBorders=i;l.transparentCorners=j;var k=fabric.util.isTransparent(this.contextCache,h,m,this.targetFindTolerance);this.clearContext(this.contextCache);return k},_shouldClearSelection:function(k,j){var i=this.getActiveGroup(),h=this.getActiveObject();return(!j||(j&&i&&!i.contains(j)&&i!==j&&!k.shiftKey)||(j&&!j.evented)||(j&&!j.selectable&&h&&h!==j))},_shouldCenterTransform:function(k,j){if(!j){return}var i=this._currentTransform,h;if(i.action==="scale"||i.action==="scaleX"||i.action==="scaleY"){h=this.centeredScaling||j.centeredScaling}else{if(i.action==="rotate"){h=this.centeredRotation||j.centeredRotation}}return h?!k.altKey:k.altKey},_getOriginFromCorner:function(j,i){var h={x:j.originX,y:j.originY};if(i==="ml"||i==="tl"||i==="bl"){h.x="right"}else{if(i==="mr"||i==="tr"||i==="br"){h.x="left"}}if(i==="tl"||i==="mt"||i==="tr"){h.y="bottom"}else{if(i==="bl"||i==="mb"||i==="br"){h.y="top"}}return h},_getActionFromCorner:function(j,h){var i="drag";if(h){i=(h==="ml"||h==="mr")?"scaleX":(h==="mt"||h==="mb")?"scaleY":h==="mtr"?"rotate":"scale"}return i},_setupCurrentTransform:function(l,k){if(!k){return}var m=this.getPointer(l),i=k._findTargetCorner(this.getPointer(l,true)),j=this._getActionFromCorner(k,i),h=this._getOriginFromCorner(k,i);this._currentTransform={target:k,action:j,scaleX:k.scaleX,scaleY:k.scaleY,offsetX:m.x-k.left,offsetY:m.y-k.top,originX:h.x,originY:h.y,ex:m.x,ey:m.y,left:k.left,top:k.top,theta:d(k.angle),width:k.width*k.scaleX,mouseXSign:1,mouseYSign:1};this._currentTransform.original={left:k.left,top:k.top,scaleX:k.scaleX,scaleY:k.scaleY,originX:h.x,originY:h.y};this._resetCurrentTransform(l)},_translateObject:function(h,j){var i=this._currentTransform.target;if(!i.get("lockMovementX")){i.set("left",h-this._currentTransform.offsetX)}if(!i.get("lockMovementY")){i.set("top",j-this._currentTransform.offsetY)}},_scaleObject:function(o,n,k){var p=this._currentTransform,i=p.target,l=i.get("lockScalingX"),j=i.get("lockScalingY");if(l&&j){return}var h=i.translateToOriginPoint(i.getCenterPoint(),p.originX,p.originY),m=i.toLocalPoint(new fabric.Point(o,n),p.originX,p.originY);this._setLocalMouse(m,p);this._setObjectScale(m,p,l,j,k);i.setPositionByOrigin(h,p.originX,p.originY)},_setObjectScale:function(m,h,j,i,l){var k=h.target;h.newScaleX=k.scaleX;h.newScaleY=k.scaleY;if(l==="equally"&&!j&&!i){this._scaleObjectEqually(m,k,h)}else{if(!l){h.newScaleX=m.x/(k.width+k.strokeWidth);h.newScaleY=m.y/(k.height+k.strokeWidth);j||k.set("scaleX",h.newScaleX);i||k.set("scaleY",h.newScaleY)}else{if(l==="x"&&!k.get("lockUniScaling")){h.newScaleX=m.x/(k.width+k.strokeWidth);j||k.set("scaleX",h.newScaleX)}else{if(l==="y"&&!k.get("lockUniScaling")){h.newScaleY=m.y/(k.height+k.strokeWidth);i||k.set("scaleY",h.newScaleY)}}}}this._flipObject(h)},_scaleObjectEqually:function(l,i,h){var k=l.y+l.x,j=(i.height+(i.strokeWidth))*h.original.scaleY+(i.width+(i.strokeWidth))*h.original.scaleX;h.newScaleX=h.original.scaleX*k/j;h.newScaleY=h.original.scaleY*k/j;i.set("scaleX",h.newScaleX);i.set("scaleY",h.newScaleY)},_flipObject:function(h){if(h.newScaleX<0){if(h.originX==="left"){h.originX="right"}else{if(h.originX==="right"){h.originX="left"}}}if(h.newScaleY<0){if(h.originY==="top"){h.originY="bottom"}else{if(h.originY==="bottom"){h.originY="top"}}}},_setLocalMouse:function(j,h){var i=h.target;if(h.originX==="right"){j.x*=-1}else{if(h.originX==="center"){j.x*=h.mouseXSign*2;if(j.x<0){h.mouseXSign=-h.mouseXSign}}}if(h.originY==="bottom"){j.y*=-1}else{if(h.originY==="center"){j.y*=h.mouseYSign*2;if(j.y<0){h.mouseYSign=-h.mouseYSign}}}if(b(j.x)>i.padding){if(j.x<0){j.x+=i.padding}else{j.x-=i.padding}}else{j.x=0}if(b(j.y)>i.padding){if(j.y<0){j.y+=i.padding}else{j.y-=i.padding}}else{j.y=0}},_rotateObject:function(h,m){var i=this._currentTransform;if(i.target.get("lockRotation")){return}var j=e(i.ey-i.top,i.ex-i.left),l=e(m-i.top,h-i.left),k=f(l-j+i.theta);if(k<0){k=360+k}i.target.angle=k},setCursor:function(h){this.upperCanvasEl.style.cursor=h},_resetObjectTransform:function(h){h.scaleX=1;h.scaleY=1;h.setAngle(0)},_drawSelection:function(){var i=this.contextTop,h=this._groupSelector,o=h.left,n=h.top,m=b(o),k=b(n);i.fillStyle=this.selectionColor;i.fillRect(h.ex-((o>0)?0:-o),h.ey-((n>0)?0:-n),m,k);i.lineWidth=this.selectionLineWidth;i.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){var l=h.ex+a-((o>0)?0:m),j=h.ey+a-((n>0)?0:k);i.beginPath();fabric.util.drawDashedLine(i,l,j,l+m,j,this.selectionDashArray);fabric.util.drawDashedLine(i,l,j+k-1,l+m,j+k-1,this.selectionDashArray);fabric.util.drawDashedLine(i,l,j,l,j+k,this.selectionDashArray);fabric.util.drawDashedLine(i,l+m-1,j,l+m-1,j+k,this.selectionDashArray);i.closePath();i.stroke()}else{i.strokeRect(h.ex+a-((o>0)?0:m),h.ey+a-((n>0)?0:k),m,k)}},_isLastRenderedObject:function(h){return(this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(h,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(h,true)))},findTarget:function(k,h){if(this.skipTargetFind){return}if(this._isLastRenderedObject(k)){return this.lastRenderedObjectWithControlsAboveOverlay}var i=this.getActiveGroup();if(i&&!h&&this.containsPoint(k,i)){return i}var j=this._searchPossibleTargets(k);this._fireOverOutEvents(j);return j},_fireOverOutEvents:function(h){if(h){if(this._hoveredTarget!==h){this.fire("mouse:over",{target:h});h.fire("mouseover");if(this._hoveredTarget){this.fire("mouse:out",{target:this._hoveredTarget});this._hoveredTarget.fire("mouseout")}this._hoveredTarget=h}}else{if(this._hoveredTarget){this.fire("mouse:out",{target:this._hoveredTarget});this._hoveredTarget.fire("mouseout");this._hoveredTarget=null}}},_checkTarget:function(j,i,k){if(i&&i.visible&&i.evented&&this.containsPoint(j,i)){if((this.perPixelTargetFind||i.perPixelTargetFind)&&!i.isEditing){var h=this.isTargetTransparent(i,k.x,k.y);if(!h){return true}}else{return true}}},_searchPossibleTargets:function(k){var j,l=this.getPointer(k,true),h=this._objects.length;while(h--){if(this._checkTarget(k,this._objects[h],l)){this.relatedTarget=this._objects[h];j=this._objects[h];break}}return j},getPointer:function(l,j,i){if(!i){i=this.upperCanvasEl}var m=c(l,i),k=i.getBoundingClientRect(),h;m.x=m.x-this._offset.left;m.y=m.y-this._offset.top;if(!j){m=fabric.util.transformPoint(m,fabric.util.invertTransform(this.viewportTransform))}if(k.width===0||k.height===0){h={width:1,height:1}}else{h={width:i.width/k.width,height:i.height/k.height}}return{x:m.x*h.width,y:m.y*h.height}},_createUpperCanvas:function(){var h=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement();fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+h);this.wrapperEl.appendChild(this.upperCanvasEl);this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl);this._applyCanvasStyle(this.upperCanvasEl);this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement();this.cacheCanvasEl.setAttribute("width",this.width);this.cacheCanvasEl.setAttribute("height",this.height);this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass});fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"});fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(i){var j=this.getWidth()||i.width,h=this.getHeight()||i.height;fabric.util.setStyle(i,{position:"absolute",width:j+"px",height:h+"px",left:0,top:0});i.width=j;i.height=h;fabric.util.makeElementUnselectable(i)},_copyCanvasStyle:function(i,h){h.style.cssText=i.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(h){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=h;h.set("active",true)},setActiveObject:function(h,i){this._setActiveObject(h);this.renderAll();this.fire("object:selected",{target:h,e:i});h.fire("selected",{e:i});return this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){if(this._activeObject){this._activeObject.set("active",false)}this._activeObject=null},discardActiveObject:function(h){this._discardActiveObject();this.renderAll();this.fire("selection:cleared",{e:h});return this},_setActiveGroup:function(h){this._activeGroup=h;if(h){h.set("active",true)}},setActiveGroup:function(i,h){this._setActiveGroup(i);if(i){this.fire("object:selected",{target:i,e:h});i.fire("selected",{e:h})}return this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var h=this.getActiveGroup();if(h){h.destroy()}this.setActiveGroup(null)},discardActiveGroup:function(h){this._discardActiveGroup();this.fire("selection:cleared",{e:h});return this},deactivateAll:function(){var j=this.getObjects(),k=0,h=j.length;for(;k<h;k++){j[k].set("active",false)}this._discardActiveGroup();this._discardActiveObject();return this},deactivateAllWithDispatch:function(i){var h=this.getActiveGroup()||this.getActiveObject();if(h){this.fire("before:selection:cleared",{target:h,e:i})}this.deactivateAll();if(h){this.fire("selection:cleared",{e:i})}return this},drawControls:function(h){var i=this.getActiveGroup();if(i){this._drawGroupControls(h,i)}else{this._drawObjectsControls(h)}},_drawGroupControls:function(h,i){i._renderControls(h)},_drawObjectsControls:function(j){for(var k=0,h=this._objects.length;k<h;++k){if(!this._objects[k]||!this._objects[k].active){continue}this._objects[k]._renderControls(j);this.lastRenderedObjectWithControlsAboveOverlay=this._objects[k]}}});for(var g in fabric.StaticCanvas){if(g!=="prototype"){fabric.Canvas[g]=fabric.StaticCanvas[g]}}if(fabric.isTouchSupported){fabric.Canvas.prototype._setCursorFromEvent=function(){}}fabric.Element=fabric.Canvas})();(function(){var a={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},b=fabric.util.addListener,c=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents();b(fabric.window,"resize",this._onResize);b(this.upperCanvasEl,"mousedown",this._onMouseDown);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"mousewheel",this._onMouseWheel);b(this.upperCanvasEl,"touchstart",this._onMouseDown);b(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof Event!=="undefined"&&"add" in Event){Event.add(this.upperCanvasEl,"gesture",this._onGesture);Event.add(this.upperCanvasEl,"drag",this._onDrag);Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange);Event.add(this.upperCanvasEl,"shake",this._onShake)}},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this);this._onMouseMove=this._onMouseMove.bind(this);this._onMouseUp=this._onMouseUp.bind(this);this._onResize=this._onResize.bind(this);this._onGesture=this._onGesture.bind(this);this._onDrag=this._onDrag.bind(this);this._onShake=this._onShake.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){c(fabric.window,"resize",this._onResize);c(this.upperCanvasEl,"mousedown",this._onMouseDown);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"mousewheel",this._onMouseWheel);c(this.upperCanvasEl,"touchstart",this._onMouseDown);c(this.upperCanvasEl,"touchmove",this._onMouseMove);if(typeof Event!=="undefined"&&"remove" in Event){Event.remove(this.upperCanvasEl,"gesture",this._onGesture);Event.remove(this.upperCanvasEl,"drag",this._onDrag);Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange);Event.remove(this.upperCanvasEl,"shake",this._onShake)}},_onGesture:function(f,d){this.__onTransformGesture&&this.__onTransformGesture(f,d)},_onDrag:function(f,d){this.__onDrag&&this.__onDrag(f,d)},_onMouseWheel:function(f,d){this.__onMouseWheel&&this.__onMouseWheel(f,d)},_onOrientationChange:function(f,d){this.__onOrientationChange&&this.__onOrientationChange(f,d)},_onShake:function(f,d){this.__onShake&&this.__onShake(f,d)},_onMouseDown:function(d){this.__onMouseDown(d);b(fabric.document,"touchend",this._onMouseUp);b(fabric.document,"touchmove",this._onMouseMove);c(this.upperCanvasEl,"mousemove",this._onMouseMove);c(this.upperCanvasEl,"touchmove",this._onMouseMove);if(d.type==="touchstart"){c(this.upperCanvasEl,"mousedown",this._onMouseDown)}else{b(fabric.document,"mouseup",this._onMouseUp);b(fabric.document,"mousemove",this._onMouseMove)}},_onMouseUp:function(d){this.__onMouseUp(d);c(fabric.document,"mouseup",this._onMouseUp);c(fabric.document,"touchend",this._onMouseUp);c(fabric.document,"mousemove",this._onMouseMove);c(fabric.document,"touchmove",this._onMouseMove);b(this.upperCanvasEl,"mousemove",this._onMouseMove);b(this.upperCanvasEl,"touchmove",this._onMouseMove);if(d.type==="touchend"){var f=this;setTimeout(function(){b(f.upperCanvasEl,"mousedown",f._onMouseDown)},400)}},_onMouseMove:function(d){!this.allowTouchScrolling&&d.preventDefault&&d.preventDefault();this.__onMouseMove(d)},_onResize:function(){this.calcOffset()},_shouldRender:function(e,f){var d=this.getActiveGroup()||this.getActiveObject();return !!((e&&(e.isMoving||e!==d))||(!e&&!!d)||(!e&&!d&&!this._groupSelector)||(f&&this._previousPointer&&this.selection&&(f.x!==this._previousPointer.x||f.y!==this._previousPointer.y)))},__onMouseUp:function(f){var d;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(f);return}if(this._currentTransform){this._finalizeCurrentTransform();d=this._currentTransform.target}else{d=this.findTarget(f,true)}var g=this._shouldRender(d,this.getPointer(f));this._maybeGroupObjects(f);if(d){d.isMoving=false}g&&this.renderAll();this._handleCursorAndEvent(f,d)},_handleCursorAndEvent:function(f,d){this._setCursorFromEvent(f,d);var g=this;setTimeout(function(){g._setCursorFromEvent(f,d)},50);this.fire("mouse:up",{target:d,e:f});d&&d.fire("mouseup",{e:f})},_finalizeCurrentTransform:function(){var d=this._currentTransform,e=d.target;if(e._scaling){e._scaling=false}e.setCoords();if(this.stateful&&e.hasStateChanged()){this.fire("object:modified",{target:e});e.fire("modified")}this._restoreOriginXY(e)},_restoreOriginXY:function(e){if(this._previousOriginX&&this._previousOriginY){var d=e.translateToOriginPoint(e.getCenterPoint(),this._previousOriginX,this._previousOriginY);e.originX=this._previousOriginX;e.originY=this._previousOriginY;e.left=d.x;e.top=d.y;this._previousOriginX=null;this._previousOriginY=null}},_onMouseDownInDrawingMode:function(f){this._isCurrentlyDrawing=true;this.discardActiveObject(f).renderAll();if(this.clipTo){fabric.util.clipContext(this,this.contextTop)}var d=fabric.util.invertTransform(this.viewportTransform),g=fabric.util.transformPoint(this.getPointer(f,true),d);this.freeDrawingBrush.onMouseDown(g);this.fire("mouse:down",{e:f})},_onMouseMoveInDrawingMode:function(f){if(this._isCurrentlyDrawing){var d=fabric.util.invertTransform(this.viewportTransform),g=fabric.util.transformPoint(this.getPointer(f,true),d);this.freeDrawingBrush.onMouseMove(g)}this.setCursor(this.freeDrawingCursor);this.fire("mouse:move",{e:f})},_onMouseUpInDrawingMode:function(d){this._isCurrentlyDrawing=false;if(this.clipTo){this.contextTop.restore()}this.freeDrawingBrush.onMouseUp();this.fire("mouse:up",{e:d})},__onMouseDown:function(h){var d="which" in h?h.which===1:h.button===1;if(!d&&!fabric.isTouchSupported){return}if(this.isDrawingMode){this._onMouseDownInDrawingMode(h);return}if(this._currentTransform){return}var g=this.findTarget(h),j=this.getPointer(h,true);this._previousPointer=j;var i=this._shouldRender(g,j),f=this._shouldGroup(h,g);if(this._shouldClearSelection(h,g)){this._clearSelection(h,g,j)}else{if(f){this._handleGrouping(h,g);g=this.getActiveGroup()}}if(g&&g.selectable&&!f){this._beforeTransform(h,g);this._setupCurrentTransform(h,g)}i&&this.renderAll();this.fire("mouse:down",{target:g,e:h});g&&g.fire("mousedown",{e:h})},_beforeTransform:function(g,f){var d;this.stateful&&f.saveState();if((d=f._findTargetCorner(this.getPointer(g)))){this.onBeforeScaleRotate(f)}if(f!==this.getActiveGroup()&&f!==this.getActiveObject()){this.deactivateAll();this.setActiveObject(f,g)}},_clearSelection:function(f,d,g){this.deactivateAllWithDispatch(f);if(d&&d.selectable){this.setActiveObject(d,f)}else{if(this.selection){this._groupSelector={ex:g.x,ey:g.y,top:0,left:0}}}},_setOriginToCenter:function(e){this._previousOriginX=this._currentTransform.target.originX;this._previousOriginY=this._currentTransform.target.originY;var d=e.getCenterPoint();e.originX="center";e.originY="center";e.left=d.x;e.top=d.y;this._currentTransform.left=e.left;this._currentTransform.top=e.top},_setCenterToOrigin:function(e){var d=e.translateToOriginPoint(e.getCenterPoint(),this._previousOriginX,this._previousOriginY);e.originX=this._previousOriginX;e.originY=this._previousOriginY;e.left=d.x;e.top=d.y;this._previousOriginX=null;this._previousOriginY=null},__onMouseMove:function(g){var f,h;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(g);return}var d=this._groupSelector;if(d){h=this.getPointer(g,true);d.left=h.x-d.ex;d.top=h.y-d.ey;this.renderTop()}else{if(!this._currentTransform){f=this.findTarget(g);if(!f||f&&!f.selectable){this.setCursor(this.defaultCursor)}else{this._setCursorFromEvent(g,f)}}else{this._transformObject(g)}}this.fire("mouse:move",{target:f,e:g});f&&f.fire("mousemove",{e:g})},_transformObject:function(f){var g=this.getPointer(f),d=this._currentTransform;d.reset=false,d.target.isMoving=true;this._beforeScaleTransform(f,d);this._performTransformAction(f,d,g);this.renderAll()},_performTransformAction:function(i,f,j){var d=j.x,k=j.y,h=f.target,g=f.action;if(g==="rotate"){this._rotateObject(d,k);this._fire("rotating",h,i)}else{if(g==="scale"){this._onScale(i,f,d,k);this._fire("scaling",h,i)}else{if(g==="scaleX"){this._scaleObject(d,k,"x");this._fire("scaling",h,i)}else{if(g==="scaleY"){this._scaleObject(d,k,"y");this._fire("scaling",h,i)}else{this._translateObject(d,k);this._fire("moving",h,i);this.setCursor(this.moveCursor)}}}}},_fire:function(d,g,f){this.fire("object:"+d,{target:g,e:f});g.fire(d,{e:f})},_beforeScaleTransform:function(g,d){if(d.action==="scale"||d.action==="scaleX"||d.action==="scaleY"){var f=this._shouldCenterTransform(g,d.target);if((f&&(d.originX!=="center"||d.originY!=="center"))||(!f&&d.originX==="center"&&d.originY==="center")){this._resetCurrentTransform(g);d.reset=true}}},_onScale:function(g,f,d,h){if((g.shiftKey||this.uniScaleTransform)&&!f.target.get("lockUniScaling")){f.currentAction="scale";this._scaleObject(d,h)}else{if(!f.reset&&f.currentAction==="scale"){this._resetCurrentTransform(g,f.target)}f.currentAction="scaleEqually";this._scaleObject(d,h,"equally")}},_setCursorFromEvent:function(h,g){if(!g||!g.selectable){this.setCursor(this.defaultCursor);return false}else{var d=this.getActiveGroup(),f=g._findTargetCorner&&(!d||!d.contains(g))&&g._findTargetCorner(this.getPointer(h,true));if(!f){this.setCursor(g.hoverCursor||this.hoverCursor)}else{this._setCornerCursor(f,g)}}return true},_setCornerCursor:function(d,e){if(d in a){this.setCursor(this._getRotatedCornerCursor(d,e))}else{if(d==="mtr"&&e.hasRotatingPoint){this.setCursor(this.rotationCursor)}else{this.setCursor(this.defaultCursor);return false}}},_getRotatedCornerCursor:function(d,e){var f=Math.round((e.getAngle()%360)/45);if(f<0){f+=8}f+=a[d];f%=8;return this.cursorMap[f]}})})();(function(){var b=Math.min,a=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(f,d){var c=this.getActiveObject();return f.shiftKey&&(this.getActiveGroup()||(c&&c!==d))&&this.selection},_handleGrouping:function(d,c){if(c===this.getActiveGroup()){c=this.findTarget(d,true);if(!c||c.isType("group")){return}}if(this.getActiveGroup()){this._updateActiveGroup(c,d)}else{this._createActiveGroup(c,d)}if(this._activeGroup){this._activeGroup.saveCoords()}},_updateActiveGroup:function(f,d){var c=this.getActiveGroup();if(c.contains(f)){c.removeWithUpdate(f);this._resetObjectTransform(c);f.set("active",false);if(c.size()===1){this.discardActiveGroup(d);this.setActiveObject(c.item(0));return}}else{c.addWithUpdate(f);this._resetObjectTransform(c)}this.fire("selection:created",{target:c,e:d});c.set("active",true)},_createActiveGroup:function(f,d){if(this._activeObject&&f!==this._activeObject){var c=this._createGroup(f);c.addWithUpdate();this.setActiveGroup(c);this._activeObject=null;this.fire("selection:created",{target:c,e:d})}f.set("active",true)},_createGroup:function(f){var e=this.getObjects(),c=e.indexOf(this._activeObject)<e.indexOf(f),d=c?[this._activeObject,f]:[f,this._activeObject];return new fabric.Group(d,{originX:"center",originY:"center",canvas:this})},_groupSelectedObjects:function(d){var c=this._collectObjects();if(c.length===1){this.setActiveObject(c[0],d)}else{if(c.length>1){c=new fabric.Group(c.reverse(),{originX:"center",originY:"center",canvas:this});c.addWithUpdate();this.setActiveGroup(c,d);c.saveCoords();this.fire("selection:created",{target:c});this.renderAll()}}},_collectObjects:function(){var m=[],g,d=this._groupSelector.ex,k=this._groupSelector.ey,c=d+this._groupSelector.left,h=k+this._groupSelector.top,f=new fabric.Point(b(d,c),b(k,h)),j=new fabric.Point(a(d,c),a(k,h)),l=d===c&&k===h;for(var e=this._objects.length;e--;){g=this._objects[e];if(!g||!g.selectable||!g.visible){continue}if(g.intersectsWithRect(f,j)||g.isContainedWithinRect(f,j)||g.containsPoint(f)||g.containsPoint(j)){g.set("active",true);m.push(g);if(l){break}}}return m},_maybeGroupObjects:function(d){if(this.selection&&this._groupSelector){this._groupSelectedObjects(d)}var c=this.getActiveGroup();if(c){c.setObjectsCoords().setCoords();c.isMoving=false;this.setCursor(this.defaultCursor)}this._groupSelector=null;this._currentTransform=null}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var b=a.format||"png",e=a.quality||1,d=a.multiplier||1,c={left:a.left,top:a.top,width:a.width,height:a.height};if(d!==1){return this.__toDataURLWithMultiplier(b,e,c,d)}else{return this.__toDataURL(b,e,c)}},__toDataURL:function(d,f,e){this.renderAll(true);var b=this.upperCanvasEl||this.lowerCanvasEl,a=this.__getCroppedCanvas(b,e);if(d==="jpg"){d="jpeg"}var c=(fabric.StaticCanvas.supports("toDataURLWithQuality"))?(a||b).toDataURL("image/"+d,f):(a||b).toDataURL("image/"+d);this.contextTop&&this.clearContext(this.contextTop);this.renderAll();if(a){a=null}return c},__getCroppedCanvas:function(c,e){var b,d,a="left" in e||"top" in e||"width" in e||"height" in e;if(a){b=fabric.util.createCanvasElement();d=b.getContext("2d");b.width=e.width||this.width;b.height=e.height||this.height;d.drawImage(c,-e.left||0,-e.top||0)}return b},__toDataURLWithMultiplier:function(g,h,b,k){var i=this.getWidth(),l=this.getHeight(),e=i*k,f=l*k,a=this.getActiveObject(),c=this.getActiveGroup(),j=this.contextTop||this.contextContainer;if(k>1){this.setWidth(e).setHeight(f)}j.scale(k,k);if(b.left){b.left*=k}if(b.top){b.top*=k}if(b.width){b.width*=k}else{if(k<1){b.width=e}}if(b.height){b.height*=k}else{if(k<1){b.height=f}}if(c){this._tempRemoveBordersControlsFromGroup(c)}else{if(a&&this.deactivateAll){this.deactivateAll()}}this.renderAll(true);var d=this.__toDataURL(g,h,b);this.width=i;this.height=l;j.scale(1/k,1/k);this.setWidth(i).setHeight(l);if(c){this._restoreBordersControlsOnGroup(c)}else{if(a&&this.setActiveObject){this.setActiveObject(a)}}this.contextTop&&this.clearContext(this.contextTop);this.renderAll();return d},toDataURLWithMultiplier:function(a,c,b){return this.toDataURL({format:a,multiplier:c,quality:b})},_tempRemoveBordersControlsFromGroup:function(a){a.origHasControls=a.hasControls;a.origBorderColor=a.borderColor;a.hasControls=true;a.borderColor="rgba(0,0,0,0)";a.forEachObject(function(b){b.origBorderColor=b.borderColor;b.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(a){a.hideControls=a.origHideControls;a.borderColor=a.origBorderColor;a.forEachObject(function(b){b.borderColor=b.origBorderColor;delete b.origBorderColor})}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(b,c,a){return this.loadFromJSON(b,c,a)},loadFromJSON:function(b,e,a){if(!b){return}var c=(typeof b==="string")?JSON.parse(b):b;this.clear();var d=this;this._enlivenObjects(c.objects,function(){d._setBgOverlay(c,e)},a);return this},_setBgOverlay:function(c,e){var d=this,b={backgroundColor:false,overlayColor:false,backgroundImage:false,overlayImage:false};if(!c.backgroundImage&&!c.overlayImage&&!c.background&&!c.overlay){e&&e();return}var a=function(){if(b.backgroundImage&&b.overlayImage&&b.backgroundColor&&b.overlayColor){d.renderAll();e&&e()}};this.__setBgOverlay("backgroundImage",c.backgroundImage,b,a);this.__setBgOverlay("overlayImage",c.overlayImage,b,a);this.__setBgOverlay("backgroundColor",c.background,b,a);this.__setBgOverlay("overlayColor",c.overlay,b,a);a()},__setBgOverlay:function(c,b,a,e){var d=this;if(!b){a[c]=true;return}if(c==="backgroundImage"||c==="overlayImage"){fabric.Image.fromObject(b,function(f){d[c]=f;a[c]=true;e&&e()})}else{this["set"+fabric.util.string.capitalize(c,true)](b,function(){a[c]=true;e&&e()})}},_enlivenObjects:function(b,e,a){var d=this;if(!b||b.length===0){e&&e();return}var c=this.renderOnAddRemove;this.renderOnAddRemove=false;fabric.util.enlivenObjects(b,function(f){f.forEach(function(h,g){d.insertAt(h,g,true)});d.renderOnAddRemove=c;e&&e()},null,a)},_toDataURL:function(a,b){this.clone(function(c){b(c.toDataURL(a))})},_toDataURLWithMultiplier:function(a,c,b){this.clone(function(d){b(d.toDataURLWithMultiplier(a,c))})},clone:function(c,a){var b=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(d){d.loadFromJSON(b,function(){c&&c(d)})})},cloneWithoutData:function(c){var a=fabric.document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();var b=new fabric.Canvas(a);b.clipTo=this.clipTo;if(this.backgroundImage){b.setBackgroundImage(this.backgroundImage.src,function(){b.renderAll();c&&c(b)});b.backgroundImageOpacity=this.backgroundImageOpacity;b.backgroundImageStretch=this.backgroundImageStretch}else{c&&c(b)}}});(function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,a=e.util.toFixed,c=e.util.string.capitalize,b=e.util.degreesToRadians,f=e.StaticCanvas.supports("setLineDash");if(e.Object){return}e.Object=e.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:false,flipY:false,opacity:1,angle:0,cornerSize:12,transparentCorners:true,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:false,centeredRotation:true,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0.01,selectable:true,evented:true,visible:true,hasControls:true,hasBorders:true,hasRotatingPoint:true,rotatingPointOffset:40,perPixelTargetFind:false,includeDefaultValues:true,clipTo:null,lockMovementX:false,lockMovementY:false,lockRotation:false,lockScalingX:false,lockScalingY:false,lockUniScaling:false,stateProperties:("top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor").split(" "),initialize:function(h){if(h){this.setOptions(h)}},_initGradient:function(h){if(h.fill&&h.fill.colorStops&&!(h.fill instanceof e.Gradient)){this.set("fill",new e.Gradient(h.fill))}},_initPattern:function(h){if(h.fill&&h.fill.source&&!(h.fill instanceof e.Pattern)){this.set("fill",new e.Pattern(h.fill))}if(h.stroke&&h.stroke.source&&!(h.stroke instanceof e.Pattern)){this.set("stroke",new e.Pattern(h.stroke))}},_initClipping:function(h){if(!h.clipTo||typeof h.clipTo!=="string"){return}var i=e.util.getFunctionBody(h.clipTo);if(typeof i!=="undefined"){this.clipTo=new Function("ctx",i)}},setOptions:function(h){for(var i in h){this.set(i,h[i])}this._initGradient(h);this._initPattern(h);this._initClipping(h)},transform:function(i,j){if(this.group){this.group.transform(i,j)}i.globalAlpha=this.opacity;var h=j?this._getLeftTopCoords():this.getCenterPoint();i.translate(h.x,h.y);i.rotate(b(this.angle));i.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(j){var i=e.Object.NUM_FRACTION_DIGITS,h={type:this.type,originX:this.originX,originY:this.originY,left:a(this.left,i),top:a(this.top,i),width:a(this.width,i),height:a(this.height,i),fill:(this.fill&&this.fill.toObject)?this.fill.toObject():this.fill,stroke:(this.stroke&&this.stroke.toObject)?this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,i),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:a(this.strokeMiterLimit,i),scaleX:a(this.scaleX,i),scaleY:a(this.scaleY,i),angle:a(this.getAngle(),i),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,i),shadow:(this.shadow&&this.shadow.toObject)?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};if(!this.includeDefaultValues){h=this._removeDefaultValues(h)}e.util.populateWithProperties(this,h,j);return h},toDatalessObject:function(h){return this.toObject(h)},_removeDefaultValues:function(i){var h=e.util.getKlass(i.type).prototype,j=h.stateProperties;j.forEach(function(k){if(i[k]===h[k]){delete i[k]}});return i},toString:function(){return"#<fabric."+c(this.type)+">"},get:function(h){return this[h]},_setObject:function(h){for(var i in h){this._set(i,h[i])}},set:function(h,i){if(typeof h==="object"){this._setObject(h)}else{if(typeof i==="function"&&h!=="clipTo"){this._set(h,i(this.get(h)))}else{this._set(h,i)}}return this},_set:function(h,i){var j=(h==="scaleX"||h==="scaleY");if(j){i=this._constrainScale(i)}if(h==="scaleX"&&i<0){this.flipX=!this.flipX;i*=-1}else{if(h==="scaleY"&&i<0){this.flipY=!this.flipY;i*=-1}else{if(h==="width"||h==="height"){this.minScaleLimit=a(Math.min(0.1,1/Math.max(this.width,this.height)),2)}else{if(h==="shadow"&&i&&!(i instanceof e.Shadow)){i=new e.Shadow(i)}}}}this[h]=i;return this},toggle:function(i){var h=this.get(i);if(typeof h==="boolean"){this.set(i,!h)}return this},setSourcePath:function(h){this.sourcePath=h;return this},getViewportTransform:function(){if(this.canvas&&this.canvas.viewportTransform){return this.canvas.viewportTransform}return[1,0,0,1,0,0]},render:function(i,j){if(this.width===0||this.height===0||!this.visible){return}i.save();this._setupFillRule(i);this._transform(i,j);this._setStrokeStyles(i);this._setFillStyles(i);var h=this.transformMatrix;if(h&&this.group){i.translate(-this.group.width/2,-this.group.height/2);i.transform(h[0],h[1],h[2],h[3],h[4],h[5])}this._setShadow(i);this.clipTo&&e.util.clipContext(this,i);this._render(i,j);this.clipTo&&i.restore();this._removeShadow(i);this._restoreFillRule(i);i.restore()},_transform:function(i,j){var h=this.transformMatrix;if(h&&!this.group){i.setTransform(h[0],h[1],h[2],h[3],h[4],h[5])}if(!j){this.transform(i)}},_setStrokeStyles:function(h){if(this.stroke){h.lineWidth=this.strokeWidth;h.lineCap=this.strokeLineCap;h.lineJoin=this.strokeLineJoin;h.miterLimit=this.strokeMiterLimit;h.strokeStyle=this.stroke.toLive?this.stroke.toLive(h):this.stroke}},_setFillStyles:function(h){if(this.fill){h.fillStyle=this.fill.toLive?this.fill.toLive(h):this.fill}},_renderControls:function(i,k){var j=this.getViewportTransform();i.save();if(this.active&&!k){var h;if(this.group){h=e.util.transformPoint(this.group.getCenterPoint(),j);i.translate(h.x,h.y);i.rotate(b(this.group.angle))}h=e.util.transformPoint(this.getCenterPoint(),j,null!=this.group);if(this.group){h.x*=this.group.scaleX;h.y*=this.group.scaleY}i.translate(h.x,h.y);i.rotate(b(this.angle));this.drawBorders(i);this.drawControls(i)}i.restore()},_setShadow:function(h){if(!this.shadow){return}h.shadowColor=this.shadow.color;h.shadowBlur=this.shadow.blur;h.shadowOffsetX=this.shadow.offsetX;h.shadowOffsetY=this.shadow.offsetY},_removeShadow:function(h){if(!this.shadow){return}h.shadowColor="";h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_renderFill:function(h){if(!this.fill){return}if(this.fill.toLive){h.save();h.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)}if(this.fillRule==="destination-over"){h.fill("evenodd")}else{h.fill()}if(this.fill.toLive){h.restore()}if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(h)}},_renderStroke:function(h){if(!this.stroke||this.strokeWidth===0){return}h.save();if(this.strokeDashArray){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}if(f){h.setLineDash(this.strokeDashArray);this._stroke&&this._stroke(h)}else{this._renderDashedStroke&&this._renderDashedStroke(h)}h.stroke()}else{this._stroke?this._stroke(h):h.stroke()}this._removeShadow(h);h.restore()},clone:function(i,h){if(this.constructor.fromObject){return this.constructor.fromObject(this.toObject(h),i)}return new e.Object(this.toObject(h))},cloneAsImage:function(i){var h=this.toDataURL();e.util.loadImage(h,function(j){if(i){i(new e.Image(j))}});return this},toDataURL:function(j){j||(j={});var k=e.util.createCanvasElement(),i=this.getBoundingRect();k.width=i.width;k.height=i.height;e.util.wrapElement(k,"div");var h=new e.Canvas(k);if(j.format==="jpg"){j.format="jpeg"}if(j.format==="jpeg"){h.backgroundColor="#fff"}var m={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",false);this.setPositionByOrigin(new e.Point(k.width/2,k.height/2),"center","center");var n=this.canvas;h.add(this);var l=h.toDataURL(j);this.set(m).setCoords();this.canvas=n;h.dispose();h=null;return l},isType:function(h){return this.type===h},complexity:function(){return 0},toJSON:function(h){return this.toObject(h)},setGradient:function(k,j){j||(j={});var l={colorStops:[]};l.type=j.type||(j.r1||j.r2?"radial":"linear");l.coords={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2};if(j.r1||j.r2){l.coords.r1=j.r1;l.coords.r2=j.r2}for(var h in j.colorStops){var i=new e.Color(j.colorStops[h]);l.colorStops.push({offset:h,color:i.toRgb(),opacity:i.getAlpha()})}return this.set(k,e.Gradient.forObject(this,l))},setPatternFill:function(h){return this.set("fill",new e.Pattern(h))},setShadow:function(h){return this.set("shadow",h?new e.Shadow(h):null)},setColor:function(h){this.set("fill",h);return this},setAngle:function(i){var h=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;if(h){this._setOriginToCenter()}this.set("angle",i);if(h){this._resetOrigin()}return this},centerH:function(){this.canvas.centerObjectH(this);return this},centerV:function(){this.canvas.centerObjectV(this);return this},center:function(){this.canvas.centerObject(this);return this},remove:function(){this.canvas.remove(this);return this},getLocalPointer:function(h,i){i=i||this.canvas.getPointer(h);var j=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:i.x-j.x,y:i.y-j.y}},_setupFillRule:function(h){if(this.fillRule){this._prevFillRule=h.globalCompositeOperation;h.globalCompositeOperation=this.fillRule}},_restoreFillRule:function(h){if(this.fillRule&&this._prevFillRule){h.globalCompositeOperation=this._prevFillRule}}});e.util.createAccessors(e.Object);e.Object.prototype.rotate=e.Object.prototype.setAngle;g(e.Object.prototype,e.Observable);e.Object.NUM_FRACTION_DIGITS=2;e.Object.__uid=0})(typeof exports!=="undefined"?exports:this);(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(c,e,d){var b=c.x,g=c.y,f=this.stroke?this.strokeWidth:0;if(e==="left"){b=c.x+(this.getWidth()+f*this.scaleX)/2}else{if(e==="right"){b=c.x-(this.getWidth()+f*this.scaleX)/2}}if(d==="top"){g=c.y+(this.getHeight()+f*this.scaleY)/2}else{if(d==="bottom"){g=c.y-(this.getHeight()+f*this.scaleY)/2}}return fabric.util.rotatePoint(new fabric.Point(b,g),c,a(this.angle))},translateToOriginPoint:function(c,e,d){var b=c.x,g=c.y,f=this.stroke?this.strokeWidth:0;if(e==="left"){b=c.x-(this.getWidth()+f*this.scaleX)/2}else{if(e==="right"){b=c.x+(this.getWidth()+f*this.scaleX)/2}}if(d==="top"){g=c.y-(this.getHeight()+f*this.scaleY)/2}else{if(d==="bottom"){g=c.y+(this.getHeight()+f*this.scaleY)/2}}return fabric.util.rotatePoint(new fabric.Point(b,g),c,a(this.angle))},getCenterPoint:function(){var b=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(b,this.originX,this.originY)},getPointByOrigin:function(d,c){var b=this.getCenterPoint();return this.translateToOriginPoint(b,d,c)},toLocalPoint:function(d,f,e){var c=this.getCenterPoint(),h=this.stroke?this.strokeWidth:0,b,g;if(f&&e){if(f==="left"){b=c.x-(this.getWidth()+h*this.scaleX)/2}else{if(f==="right"){b=c.x+(this.getWidth()+h*this.scaleX)/2}else{b=c.x}}if(e==="top"){g=c.y-(this.getHeight()+h*this.scaleY)/2}else{if(e==="bottom"){g=c.y+(this.getHeight()+h*this.scaleY)/2}else{g=c.y}}}else{b=this.left;g=this.top}return fabric.util.rotatePoint(new fabric.Point(d.x,d.y),c,-a(this.angle)).subtractEquals(new fabric.Point(b,g))},setPositionByOrigin:function(f,e,d){var c=this.translateToCenterPoint(f,e,d),b=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",b.x);this.set("top",b.y)},adjustPosition:function(i){var g=a(this.angle),h=this.getWidth()/2,f=Math.cos(g)*h,c=Math.sin(g)*h,e=this.getWidth(),d=Math.cos(g)*e,b=Math.sin(g)*e;if(this.originX==="center"&&i==="left"||this.originX==="right"&&i==="center"){this.left-=f;this.top-=c}else{if(this.originX==="left"&&i==="center"||this.originX==="center"&&i==="right"){this.left+=f;this.top+=c}else{if(this.originX==="left"&&i==="right"){this.left+=d;this.top+=b}else{if(this.originX==="right"&&i==="left"){this.left-=d;this.top-=b}}}}this.setCoords();this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX;this._originalOriginY=this.originY;var b=this.getCenterPoint();this.originX="center";this.originY="center";this.left=b.x;this.top=b.y},_resetOrigin:function(){var b=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX;this.originY=this._originalOriginY;this.left=b.x;this.top=b.y;this._originalOriginX=null;this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})})();(function(){var a=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(c,e){var i=this.oCoords,b=new fabric.Point(i.tl.x,i.tl.y),f=new fabric.Point(i.tr.x,i.tr.y),h=new fabric.Point(i.bl.x,i.bl.y),d=new fabric.Point(i.br.x,i.br.y),g=fabric.Intersection.intersectPolygonRectangle([b,f,d,h],c,e);return g.status==="Intersection"},intersectsWithObject:function(b){function c(g){return{tl:new fabric.Point(g.tl.x,g.tl.y),tr:new fabric.Point(g.tr.x,g.tr.y),bl:new fabric.Point(g.bl.x,g.bl.y),br:new fabric.Point(g.br.x,g.br.y)}}var d=c(this.oCoords),f=c(b.oCoords),e=fabric.Intersection.intersectPolygonPolygon([d.tl,d.tr,d.br,d.bl],[f.tl,f.tr,f.br,f.bl]);return e.status==="Intersection"},isContainedWithinObject:function(b){var c=b.getBoundingRect(),e=new fabric.Point(c.left,c.top),d=new fabric.Point(c.left+c.width,c.top+c.height);return this.isContainedWithinRect(e,d)},isContainedWithinRect:function(b,d){var c=this.getBoundingRect();return(c.left>=b.x&&c.left+c.width<=d.x&&c.top>=b.y&&c.top+c.height<=d.y)},containsPoint:function(b){var d=this._getImageLines(this.oCoords),c=this._findCrossPoints(b,d);return(c!==0&&c%2===1)},_getImageLines:function(b){return{topline:{o:b.tl,d:b.tr},rightline:{o:b.tr,d:b.br},bottomline:{o:b.br,d:b.bl},leftline:{o:b.bl,d:b.tl}}},_findCrossPoints:function(k,b){var j,i,d,c,h,g,f=0,e;for(var l in b){e=b[l];if((e.o.y<k.y)&&(e.d.y<k.y)){continue}if((e.o.y>=k.y)&&(e.d.y>=k.y)){continue}if((e.o.x===e.d.x)&&(e.o.x>=k.x)){h=e.o.x;g=k.y}else{j=0;i=(e.d.y-e.o.y)/(e.d.x-e.o.x);d=k.y-j*k.x;c=e.o.y-i*e.o.x;h=-(d-c)/(j-i);g=d+j*h}if(h>=k.x){f+=1}if(f===2){break}}return f},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var d=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],c=fabric.util.array.min(d),h=fabric.util.array.max(d),f=Math.abs(c-h),e=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],i=fabric.util.array.min(e),g=fabric.util.array.max(e),b=Math.abs(i-g);return{left:c,top:i,width:f,height:b}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(b){if(Math.abs(b)<this.minScaleLimit){if(b<0){return -this.minScaleLimit}else{return this.minScaleLimit}}return b},scale:function(b){b=this._constrainScale(b);if(b<0){this.flipX=!this.flipX;this.flipY=!this.flipY;b*=-1}this.scaleX=b;this.scaleY=b;this.setCoords();return this},scaleToWidth:function(c){var b=this.getBoundingRectWidth()/this.getWidth();return this.scale(c/this.width/b)},scaleToHeight:function(c){var b=this.getBoundingRectHeight()/this.getHeight();return this.scale(c/this.height/b)},setCoords:function(){var u=this.strokeWidth>1?this.strokeWidth:0,k=a(this.angle),L=this.getViewportTransform(),G=function(f){return fabric.util.transformPoint(f,L)},n=this.width,C=this.height,F=this.strokeLineCap==="round"||this.strokeLineCap==="square",q=this.type==="line"&&this.width===1,J=this.type==="line"&&this.height===1,l=(F&&J)||this.type!=="line",z=(F&&q)||this.type!=="line";if(q){n=u}else{if(J){C=u}}if(l){n+=u}if(z){C+=u}this.currentWidth=n*this.scaleX;this.currentHeight=C*this.scaleY;if(this.currentWidth<0){this.currentWidth=Math.abs(this.currentWidth)}var r=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),m=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),I=Math.cos(m+k)*r,H=Math.sin(m+k)*r,E=Math.sin(k),v=Math.cos(k),B=this.getCenterPoint(),i=new fabric.Point(this.currentWidth,this.currentHeight),A=new fabric.Point(B.x-I,B.y-H),t=new fabric.Point(A.x+(i.x*v),A.y+(i.x*E)),s=new fabric.Point(A.x-(i.y*E),A.y+(i.y*v)),g=new fabric.Point(A.x+(i.x/2*v),A.y+(i.x/2*E)),e=G(A),d=G(t),K=G(new fabric.Point(t.x-(i.y*E),t.y+(i.y*v))),c=G(s),D=G(new fabric.Point(A.x-(i.y/2*E),A.y+(i.y/2*v))),x=G(g),y=G(new fabric.Point(t.x-(i.y/2*E),t.y+(i.y/2*v))),b=G(new fabric.Point(s.x+(i.x/2*v),s.y+(i.x/2*E))),j=G(new fabric.Point(g.x,g.y)),p=Math.cos(m+k)*this.padding*Math.sqrt(2),o=Math.sin(m+k)*this.padding*Math.sqrt(2);e=e.add(new fabric.Point(-p,-o));d=d.add(new fabric.Point(o,-p));K=K.add(new fabric.Point(p,o));c=c.add(new fabric.Point(-o,p));D=D.add(new fabric.Point((-p-o)/2,(-o+p)/2));x=x.add(new fabric.Point((o-p)/2,-(o+p)/2));y=y.add(new fabric.Point((o+p)/2,(o-p)/2));b=b.add(new fabric.Point((p-o)/2,(p+o)/2));j=j.add(new fabric.Point((o-p)/2,-(o+p)/2));this.oCoords={tl:e,tr:d,br:K,bl:c,ml:D,mt:x,mr:y,mb:b,mtr:j};this._setCornerCoords&&this._setCornerCoords();return this}})})();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){if(this.group){fabric.StaticCanvas.prototype.sendToBack.call(this.group,this)}else{this.canvas.sendToBack(this)}return this},bringToFront:function(){if(this.group){fabric.StaticCanvas.prototype.bringToFront.call(this.group,this)}else{this.canvas.bringToFront(this)}return this},sendBackwards:function(a){if(this.group){fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,a)}else{this.canvas.sendBackwards(this,a)}return this},bringForward:function(a){if(this.group){fabric.StaticCanvas.prototype.bringForward.call(this.group,this,a)}else{this.canvas.bringForward(this,a)}return this},moveTo:function(a){if(this.group){fabric.StaticCanvas.prototype.moveTo.call(this.group,this,a)}else{this.canvas.moveTo(this,a)}return this}});fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var h=this.fill?(this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill):"none",i=this.stroke?(this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke):"none",g=this.strokeWidth?this.strokeWidth:"0",f=this.strokeDashArray?this.strokeDashArray.join(" "):"",j=this.strokeLineCap?this.strokeLineCap:"butt",d=this.strokeLineJoin?this.strokeLineJoin:"miter",c=this.strokeMiterLimit?this.strokeMiterLimit:"4",e=typeof this.opacity!=="undefined"?this.opacity:"1",a=this.visible?"":" visibility: hidden;",b=this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",i,"; ","stroke-width: ",g,"; ","stroke-dasharray: ",f,"; ","stroke-linecap: ",j,"; ","stroke-linejoin: ",d,"; ","stroke-miterlimit: ",c,"; ","fill: ",h,"; ","opacity: ",e,";",b,a].join("")},getSvgTransform:function(){var b=fabric.util.toFixed,c=this.getAngle(),f=this.getViewportTransform(),a=fabric.util.transformPoint(this.getCenterPoint(),f),j=fabric.Object.NUM_FRACTION_DIGITS,d="translate("+b(a.x,j)+" "+b(a.y,j)+")",i=c!==0?(" rotate("+b(c,j)+")"):"",e=(this.scaleX===1&&this.scaleY===1&&f[0]===1&&f[3]===1)?"":(" scale("+b(this.scaleX*f[0],j)+" "+b(this.scaleY*f[3],j)+")"),h=this.flipX?"matrix(-1 0 0 1 0 0) ":"",g=this.flipY?"matrix(1 0 0 -1 0 0)":"";return[d,i,e,h,g].join("")},_createBaseSVGMarkup:function(){var a=[];if(this.fill&&this.fill.toLive){a.push(this.fill.toSVG(this,false))}if(this.stroke&&this.stroke.toLive){a.push(this.stroke.toSVG(this,false))}if(this.shadow){a.push(this.shadow.toSVG(this))}return a}});fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(a){return this.get(a)!==this.originalState[a]},this)},saveState:function(a){this.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this);if(a&&a.stateProperties){a.stateProperties.forEach(function(b){this.originalState[b]=this.get(b)},this)}return this},setupState:function(){this.originalState={};this.saveState();return this}});(function(){var a=fabric.util.degreesToRadians,b=function(){return typeof G_vmlCanvasManager!=="undefined"};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(h){if(!this.hasControls||!this.active){return false}var g=h.x,e=h.y,d,c;for(var f in this.oCoords){if(!this.isControlVisible(f)){continue}if(f==="mtr"&&!this.hasRotatingPoint){continue}if(this.get("lockUniScaling")&&(f==="mt"||f==="mr"||f==="mb"||f==="ml")){continue}c=this._getImageLines(this.oCoords[f].corner);d=this._findCrossPoints({x:g,y:e},c);if(d!==0&&d%2===1){this.__corner=f;return f}}return false},_setCornerCoords:function(){var i=this.oCoords,d=a(this.angle),f=a(45-this.angle),g=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,c=g*Math.cos(f),e=g*Math.sin(f),j=Math.sin(d),h=Math.cos(d);i.tl.corner={tl:{x:i.tl.x-e,y:i.tl.y-c},tr:{x:i.tl.x+c,y:i.tl.y-e},bl:{x:i.tl.x-c,y:i.tl.y+e},br:{x:i.tl.x+e,y:i.tl.y+c}};i.tr.corner={tl:{x:i.tr.x-e,y:i.tr.y-c},tr:{x:i.tr.x+c,y:i.tr.y-e},br:{x:i.tr.x+e,y:i.tr.y+c},bl:{x:i.tr.x-c,y:i.tr.y+e}};i.bl.corner={tl:{x:i.bl.x-e,y:i.bl.y-c},bl:{x:i.bl.x-c,y:i.bl.y+e},br:{x:i.bl.x+e,y:i.bl.y+c},tr:{x:i.bl.x+c,y:i.bl.y-e}};i.br.corner={tr:{x:i.br.x+c,y:i.br.y-e},bl:{x:i.br.x-c,y:i.br.y+e},br:{x:i.br.x+e,y:i.br.y+c},tl:{x:i.br.x-e,y:i.br.y-c}};i.ml.corner={tl:{x:i.ml.x-e,y:i.ml.y-c},tr:{x:i.ml.x+c,y:i.ml.y-e},bl:{x:i.ml.x-c,y:i.ml.y+e},br:{x:i.ml.x+e,y:i.ml.y+c}};i.mt.corner={tl:{x:i.mt.x-e,y:i.mt.y-c},tr:{x:i.mt.x+c,y:i.mt.y-e},bl:{x:i.mt.x-c,y:i.mt.y+e},br:{x:i.mt.x+e,y:i.mt.y+c}};i.mr.corner={tl:{x:i.mr.x-e,y:i.mr.y-c},tr:{x:i.mr.x+c,y:i.mr.y-e},bl:{x:i.mr.x-c,y:i.mr.y+e},br:{x:i.mr.x+e,y:i.mr.y+c}};i.mb.corner={tl:{x:i.mb.x-e,y:i.mb.y-c},tr:{x:i.mb.x+c,y:i.mb.y-e},bl:{x:i.mb.x-c,y:i.mb.y+e},br:{x:i.mb.x+e,y:i.mb.y+c}};i.mtr.corner={tl:{x:i.mtr.x-e+(j*this.rotatingPointOffset),y:i.mtr.y-c-(h*this.rotatingPointOffset)},tr:{x:i.mtr.x+c+(j*this.rotatingPointOffset),y:i.mtr.y-e-(h*this.rotatingPointOffset)},bl:{x:i.mtr.x-c+(j*this.rotatingPointOffset),y:i.mtr.y+e-(h*this.rotatingPointOffset)},br:{x:i.mtr.x+e+(j*this.rotatingPointOffset),y:i.mtr.y+c-(h*this.rotatingPointOffset)}}},drawBorders:function(m){if(!this.hasBorders){return this}var g=this.padding,i=g*2,u=this.getViewportTransform();m.save();m.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;m.strokeStyle=this.borderColor;var t=1/this._constrainScale(this.scaleX),s=1/this._constrainScale(this.scaleY);m.lineWidth=1/this.borderScaleFactor;var e=this.getWidth(),o=this.getHeight(),k=this.strokeWidth>1?this.strokeWidth:0,p=this.strokeLineCap==="round"||this.strokeLineCap==="square",f=this.type==="line"&&this.width===1,q=this.type==="line"&&this.height===1,d=(p&&q)||this.type!=="line",n=(p&&f)||this.type!=="line";if(f){e=k/t}else{if(q){o=k/s}}if(d){e+=k/t}if(n){o+=k/s}var c=fabric.util.transformPoint(new fabric.Point(e,o),u,true),l=c.x,j=c.y;if(this.group){l=l*this.group.scaleX;j=j*this.group.scaleY}m.strokeRect(~~(-(l/2)-g)-0.5,~~(-(j/2)-g)-0.5,~~(l+i)+1,~~(j+i)+1);if(this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var r=(this.flipY?j+(g*2):-j-(g*2))/2;m.beginPath();m.moveTo(0,r);m.lineTo(0,r+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset));m.closePath();m.stroke()}m.restore();return this},drawControls:function(r){if(!this.hasControls){return this}var n=this.cornerSize,f=n/2,y=this.getViewportTransform(),p=this.strokeWidth>1?this.strokeWidth:0,j=this.width,t=this.height,v=this.strokeLineCap==="round"||this.strokeLineCap==="square",k=this.type==="line"&&this.width===1,x=this.type==="line"&&this.height===1,g=(v&&x)||this.type!=="line",s=(v&&k)||this.type!=="line";if(k){j=p}else{if(x){t=p}}if(g){j+=p}if(s){t+=p}j*=this.scaleX;t*=this.scaleY;var e=fabric.util.transformPoint(new fabric.Point(j,t),y,true),q=e.x,o=e.y,c=-(q/2),m=-(o/2),l=this.padding,u=f,d=f-n,i=this.transparentCorners?"strokeRect":"fillRect";r.save();r.lineWidth=1;r.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1;r.strokeStyle=r.fillStyle=this.cornerColor;this._drawControl("tl",r,i,c-u-l,m-u-l);this._drawControl("tr",r,i,c+q-u+l,m-u-l);this._drawControl("bl",r,i,c-u-l,m+o+d+l);this._drawControl("br",r,i,c+q+d+l,m+o+d+l);if(!this.get("lockUniScaling")){this._drawControl("mt",r,i,c+q/2-u,m-u-l);this._drawControl("mb",r,i,c+q/2-u,m+o+d+l);this._drawControl("mr",r,i,c+q+d+l,m+o/2-u);this._drawControl("ml",r,i,c-u-l,m+o/2-u)}if(this.hasRotatingPoint){this._drawControl("mtr",r,i,c+q/2-u,this.flipY?(m+o+this.rotatingPointOffset-this.cornerSize/2+l):(m-this.rotatingPointOffset-this.cornerSize/2-l))}r.restore();return this},_drawControl:function(h,c,d,g,f){var e=this.cornerSize;if(this.isControlVisible(h)){b()||this.transparentCorners||c.clearRect(g,f,e,e);c[d](g,f,e,e)}},isControlVisible:function(c){return this._getControlsVisibility()[c]},setControlVisible:function(c,d){this._getControlsVisibility()[c]=d;return this},setControlsVisibility:function(c){c||(c={});for(var d in c){this.setControlVisible(d,c[d])}return this},_getControlsVisibility:function(){if(!this._controlsVisibility){this._controlsVisibility={tl:true,tr:true,br:true,bl:true,ml:true,mt:true,mr:true,mb:true,mtr:true}}return this._controlsVisibility}})})();fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(g){b.set("left",g);f.renderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxCenterObjectV:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(g){b.set("top",g);f.renderAll();a()},onComplete:function(){b.setCoords();e()}});return this},fxRemove:function(b,c){c=c||{};var d=function(){},e=c.onComplete||d,a=c.onChange||d,f=this;fabric.util.animate({startValue:b.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){b.set("active",false)},onChange:function(g){b.set("opacity",g);f.renderAll();a()},onComplete:function(){f.remove(b);e()}});return this}});fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]==="object"){var e=[],d,b;for(d in arguments[0]){e.push(d)}for(var c=0,a=e.length;c<a;c++){d=e[c];b=c!==a-1;this._animate(d,arguments[0][d],arguments[1],b)}}else{this._animate.apply(this,arguments)}return this},_animate:function(e,g,c,a){var f=this,b;g=g.toString();if(!c){c={}}else{c=fabric.util.object.clone(c)}if(~e.indexOf(".")){b=e.split(".")}var d=b?this.get(b[0])[b[1]]:this.get(e);if(!("from" in c)){c.from=d}if(~g.indexOf("=")){g=d+parseFloat(g.replace("=",""))}else{g=parseFloat(g)}fabric.util.animate({startValue:c.from,endValue:g,byValue:c.by,easing:c.easing,duration:c.duration,abort:c.abort&&function(){return c.abort.call(f)},onChange:function(h){if(b){f[b[0]][b[1]]=h}else{f.set(e,h)}if(a){return}c.onChange&&c.onChange()},onComplete:function(){if(a){return}f.setCoords();c.onComplete&&c.onComplete()}})}});(function(b){var c=b.fabric||(b.fabric={}),f=c.util.object.extend,a={x1:1,x2:1,y1:1,y2:1},d=c.StaticCanvas.supports("setLineDash");if(c.Line){c.warn("fabric.Line is already defined");return}c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(h,g){g=g||{};if(!h){h=[0,0,0,0]}this.callSuper("initialize",g);this.set("x1",h[0]);this.set("y1",h[1]);this.set("x2",h[2]);this.set("y2",h[3]);this._setWidthHeight(g)},_setWidthHeight:function(g){g||(g={});this.width=Math.abs(this.x2-this.x1)||1;this.height=Math.abs(this.y2-this.y1)||1;this.left="left" in g?g.left:this._getLeftToOriginX();this.top="top" in g?g.top:this._getTopToOriginY()},_set:function(g,h){this[g]=h;if(typeof a[g]!=="undefined"){this._setWidthHeight()}return this},_getLeftToOriginX:e({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:e({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(h){h.beginPath();var g=this.group&&this.group.type==="path-group";if(g){var j=this.getCenterPoint();h.translate(j.x,j.y);if(!this.transformMatrix){h.translate(-this.group.width/2,-this.group.height/2)}}if(!this.strokeDashArray||this.strokeDashArray&&d){var l=this.x1<=this.x2?-1:1,i=this.y1<=this.y2?-1:1;h.moveTo(this.width===1?0:(l*this.width/2),this.height===1?0:(i*this.height/2));h.lineTo(this.width===1?0:(l*-1*this.width/2),this.height===1?0:(i*-1*this.height/2))}h.lineWidth=this.strokeWidth;var k=h.strokeStyle;h.strokeStyle=this.stroke||h.fillStyle;this.stroke&&this._renderStroke(h);h.strokeStyle=k},_renderDashedStroke:function(h){var k=this.x1<=this.x2?-1:1,i=this.y1<=this.y2?-1:1,g=this.width===1?0:k*this.width/2,j=this.height===1?0:i*this.height/2;h.beginPath();c.util.drawDashedLine(h,g,j,-g,-j,this.strokeDashArray);h.closePath()},toObject:function(g){return f(this.callSuper("toObject",g),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(g){var h=this._createBaseSVGMarkup();h.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>');return g?g(h.join("")):h.join("")},complexity:function(){return 1}});c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" "));c.Line.fromElement=function(h,g){var j=c.parseAttributes(h,c.Line.ATTRIBUTE_NAMES),i=[j.x1||0,j.y1||0,j.x2||0,j.y2||0];return new c.Line(i,f(j,g))};c.Line.fromObject=function(g){var h=[g.x1,g.y1,g.x2,g.y2];return new c.Line(h,g)};function e(h,m){var k=h.origin,n=h.axis1,l=h.axis2,j=h.dimension,i=m.nearest,g=m.center,o=m.farthest;return function(){switch(this.get(k)){case i:return Math.min(this.get(n),this.get(l));case g:return Math.min(this.get(n),this.get(l))+(0.5*this.get(j));case o:return Math.max(this.get(n),this.get(l))}}}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),d=Math.PI*2,e=b.util.object.extend;if(b.Circle){b.warn("fabric.Circle is already defined.");return}b.Circle=b.util.createClass(b.Object,{type:"circle",radius:0,initialize:function(f){f=f||{};this.set("radius",f.radius||0);this.callSuper("initialize",f)},_set:function(f,g){this.callSuper("_set",f,g);if(f==="radius"){this.setRadius(g)}return this},toObject:function(f){return e(this.callSuper("toObject",f),{radius:this.get("radius")})},toSVG:function(f){var g=this._createBaseSVGMarkup();g.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return f?f(g.join("")):g.join("")},_render:function(f,g){f.beginPath();f.globalAlpha=this.group?(f.globalAlpha*this.opacity):this.opacity;f.arc(g?this.left:0,g?this.top:0,this.radius,0,d,false);this._renderFill(f);this.stroke&&this._renderStroke(f)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(f){this.radius=f;this.set("width",f*2).set("height",f*2)},complexity:function(){return 1}});b.Circle.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy r".split(" "));b.Circle.fromElement=function(g,f){f||(f={});var h=b.parseAttributes(g,b.Circle.ATTRIBUTE_NAMES);if(!c(h)){throw new Error("value of `r` attribute is required and can not be negative")}if(!("left" in h)){h.left=0}if(!("top" in h)){h.top=0}if(!("transformMatrix" in h)){h.left-=f.width?(f.width/2):0;h.top-=f.height?(f.height/2):0}var i=new b.Circle(e(h,f));i.cx=parseFloat(g.getAttribute("cx"))||0;i.cy=parseFloat(g.getAttribute("cy"))||0;return i};function c(f){return(("radius" in f)&&(f.radius>0))}b.Circle.fromObject=function(f){return new b.Circle(f)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});if(b.Triangle){b.warn("fabric.Triangle is already defined");return}b.Triangle=b.util.createClass(b.Object,{type:"triangle",initialize:function(c){c=c||{};this.callSuper("initialize",c);this.set("width",c.width||100).set("height",c.height||100)},_render:function(c){var d=this.width/2,e=this.height/2;c.beginPath();c.moveTo(-d,e);c.lineTo(0,-e);c.lineTo(d,e);c.closePath();this._renderFill(c);this._renderStroke(c)},_renderDashedStroke:function(c){var d=this.width/2,e=this.height/2;c.beginPath();b.util.drawDashedLine(c,-d,e,0,-e,this.strokeDashArray);b.util.drawDashedLine(c,0,-e,d,e,this.strokeDashArray);b.util.drawDashedLine(c,d,e,-d,e,this.strokeDashArray);c.closePath()},toSVG:function(c){var d=this._createBaseSVGMarkup(),e=this.width/2,f=this.height/2,g=[-e+" "+f,"0 "+-f,e+" "+f].join(",");d.push("<polygon ",'points="',g,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return c?c(d.join("")):d.join("")},complexity:function(){return 1}});b.Triangle.fromObject=function(c){return new b.Triangle(c)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=Math.PI*2,d=b.util.object.extend;if(b.Ellipse){b.warn("fabric.Ellipse is already defined.");return}b.Ellipse=b.util.createClass(b.Object,{type:"ellipse",rx:0,ry:0,initialize:function(e){e=e||{};this.callSuper("initialize",e);this.set("rx",e.rx||0);this.set("ry",e.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(e){return d(this.callSuper("toObject",e),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(e){var f=this._createBaseSVGMarkup();f.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return e?e(f.join("")):f.join("")},render:function(e,f){if(this.rx===0||this.ry===0){return}return this.callSuper("render",e,f)},_render:function(e,f){e.beginPath();e.globalAlpha=this.group?(e.globalAlpha*this.opacity):this.opacity;e.save();e.transform(1,0,0,this.ry/this.rx,0,0);e.arc(f?this.left:0,f?this.top*this.rx/this.ry:0,this.rx,0,c,false);e.restore();this._renderFill(e);this._renderStroke(e)},complexity:function(){return 1}});b.Ellipse.ATTRIBUTE_NAMES=b.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" "));b.Ellipse.fromElement=function(f,e){e||(e={});var h=b.parseAttributes(f,b.Ellipse.ATTRIBUTE_NAMES);if(!("left" in h)){h.left=0}if(!("top" in h)){h.top=0}if(!("transformMatrix" in h)){h.left-=e.width?(e.width/2):0;h.top-=e.height?(e.height/2):0}var g=new b.Ellipse(d(h,e));g.cx=parseFloat(f.getAttribute("cx"))||0;g.cy=parseFloat(f.getAttribute("cy"))||0;return g};b.Ellipse.fromObject=function(e){return new b.Ellipse(e)}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),e=c.util.object.extend;if(c.Rect){console.warn("fabric.Rect is already defined");return}var d=c.Object.prototype.stateProperties.concat();d.push("rx","ry","x","y");c.Rect=c.util.createClass(c.Object,{stateProperties:d,type:"rect",rx:0,ry:0,x:0,y:0,strokeDashArray:null,initialize:function(f){f=f||{};this.callSuper("initialize",f);this._initRxRy();this.x=f.x||0;this.y=f.y||0},_initRxRy:function(){if(this.rx&&!this.ry){this.ry=this.rx}else{if(this.ry&&!this.rx){this.rx=this.ry}}},_render:function(q){if(this.width===1&&this.height===1){q.fillRect(0,0,1,1);return}var g=this.rx?Math.min(this.rx,this.width/2):0,f=this.ry?Math.min(this.ry,this.height/2):0,p=this.width,l=this.height,o=-p/2,n=-l/2,i=this.group&&this.group.type==="path-group",m=g!==0||f!==0,j=1-0.5522847498;q.beginPath();q.globalAlpha=i?(q.globalAlpha*this.opacity):this.opacity;if(this.transformMatrix&&i){q.translate(this.width/2+this.x,this.height/2+this.y)}if(!this.transformMatrix&&i){q.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y)}q.moveTo(o+g,n);q.lineTo(o+p-g,n);m&&q.bezierCurveTo(o+p-j*g,n,o+p,n+j*f,o+p,n+f);q.lineTo(o+p,n+l-f);m&&q.bezierCurveTo(o+p,n+l-j*f,o+p-j*g,n+l,o+p-g,n+l);q.lineTo(o+g,n+l);m&&q.bezierCurveTo(o+j*g,n+l,o,n+l-j*f,o,n+l-f);q.lineTo(o,n+f);m&&q.bezierCurveTo(o,n+j*f,o+j*g,n,o+g,n);q.closePath();this._renderFill(q);this._renderStroke(q)},_renderDashedStroke:function(i){var f=-this.width/2,k=-this.height/2,g=this.width,j=this.height;i.beginPath();c.util.drawDashedLine(i,f,k,f+g,k,this.strokeDashArray);c.util.drawDashedLine(i,f+g,k,f+g,k+j,this.strokeDashArray);c.util.drawDashedLine(i,f+g,k+j,f,k+j,this.strokeDashArray);c.util.drawDashedLine(i,f,k+j,f,k,this.strokeDashArray);i.closePath()},_normalizeLeftTopProperties:function(f){if("left" in f){this.set("left",f.left+this.getWidth()/2)}this.set("x",f.left||0);if("top" in f){this.set("top",f.top+this.getHeight()/2)}this.set("y",f.top||0);return this},toObject:function(g){var f=e(this.callSuper("toObject",g),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")});if(!this.includeDefaultValues){this._removeDefaultValues(f)}return f},toSVG:function(f){var g=this._createBaseSVGMarkup();g.push("<rect ",'x="',(-1*this.width/2),'" y="',(-1*this.height/2),'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return f?f(g.join("")):g.join("")},complexity:function(){return 1}});c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" "));function a(f){f.left=f.left||0;f.top=f.top||0;return f}c.Rect.fromElement=function(g,f){if(!g){return null}var i=c.parseAttributes(g,c.Rect.ATTRIBUTE_NAMES);i=a(i);var h=new c.Rect(e((f?c.util.object.clone(f):{}),i));h._normalizeLeftTopProperties(i);return h};c.Rect.fromObject=function(f){return new c.Rect(f)}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),a=c.util.toFixed;if(c.Polyline){c.warn("fabric.Polyline is already defined");return}c.Polyline=c.util.createClass(c.Object,{type:"polyline",points:null,initialize:function(e,d,f){d=d||{};this.set("points",e);this.callSuper("initialize",d);this._calcDimensions(f)},_calcDimensions:function(d){return c.Polygon.prototype._calcDimensions.call(this,d)},toObject:function(d){return c.Polygon.prototype.toObject.call(this,d)},toSVG:function(e){var h=[],f=this._createBaseSVGMarkup();for(var g=0,d=this.points.length;g<d;g++){h.push(a(this.points[g].x,2),",",a(this.points[g].y,2)," ")}f.push("<polyline ",'points="',h.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return e?e(f.join("")):f.join("")},_render:function(f){var e;f.beginPath();f.moveTo(this.points[0].x,this.points[0].y);for(var g=0,d=this.points.length;g<d;g++){e=this.points[g];f.lineTo(e.x,e.y)}this._renderFill(f);this._renderStroke(f)},_renderDashedStroke:function(e){var h,g;e.beginPath();for(var f=0,d=this.points.length;f<d;f++){h=this.points[f];g=this.points[f+1]||h;c.util.drawDashedLine(e,h.x,h.y,g.x,g.y,this.strokeDashArray)}},complexity:function(){return this.get("points").length}});c.Polyline.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat();c.Polyline.fromElement=function(e,d){if(!e){return null}d||(d={});var f=c.parsePointsAttribute(e.getAttribute("points")),g=c.parseAttributes(e,c.Polyline.ATTRIBUTE_NAMES);if(!("transformMatrix" in g)){c.util.normalizePoints(f,d)}return new c.Polyline(f,c.util.object.extend(g,d),true)};c.Polyline.fromObject=function(d){var e=d.points;return new c.Polyline(e,d,true)}})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),f=e.util.object.extend,c=e.util.array.min,b=e.util.array.max,a=e.util.toFixed;if(e.Polygon){e.warn("fabric.Polygon is already defined");return}e.Polygon=e.util.createClass(e.Object,{type:"polygon",points:null,initialize:function(h,g,i){g=g||{};this.points=h;this.callSuper("initialize",g);this._calcDimensions(i)},_calcDimensions:function(l){var i=this.points,h=c(i,"x"),n=c(i,"y"),k=b(i,"x"),j=b(i,"y");this.width=(k-h)||1;this.height=(j-n)||1;this.minX=h;this.minY=n;if(l){return}var m=this.width/2+this.minX,g=this.height/2+this.minY;this.points.forEach(function(o){o.x-=m;o.y-=g},this)},toObject:function(g){return f(this.callSuper("toObject",g),{points:this.points.concat()})},toSVG:function(h){var l=[],j=this._createBaseSVGMarkup();for(var k=0,g=this.points.length;k<g;k++){l.push(a(this.points[k].x,2),",",a(this.points[k].y,2)," ")}j.push("<polygon ",'points="',l.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>');return h?h(j.join("")):j.join("")},_render:function(j){var h;j.beginPath();j.globalAlpha=this.group?(j.globalAlpha*this.opacity):this.opacity;j.moveTo(this.points[0].x,this.points[0].y);for(var k=0,g=this.points.length;k<g;k++){h=this.points[k];j.lineTo(h.x,h.y)}this._renderFill(j);if(this.stroke||this.strokeDashArray){j.closePath();this._renderStroke(j)}},_renderDashedStroke:function(h){var l,k;h.beginPath();for(var j=0,g=this.points.length;j<g;j++){l=this.points[j];k=this.points[j+1]||this.points[0];e.util.drawDashedLine(h,l.x,l.y,k.x,k.y,this.strokeDashArray)}h.closePath()},complexity:function(){return this.points.length}});e.Polygon.ATTRIBUTE_NAMES=e.SHARED_ATTRIBUTES.concat();e.Polygon.fromElement=function(h,g){if(!h){return null}g||(g={});var i=e.parsePointsAttribute(h.getAttribute("points")),j=e.parseAttributes(h,e.Polygon.ATTRIBUTE_NAMES);if(!("transformMatrix" in j)){e.util.normalizePoints(i,g)}return new e.Polygon(i,f(j,g),true)};e.Polygon.fromObject=function(g){return new e.Polygon(g.points,g,true)}})(typeof exports!=="undefined"?exports:this);(function(a){var c=a.fabric||(a.fabric={}),d=c.util.array.min,g=c.util.array.max,f=c.util.object.extend,b=Object.prototype.toString,h=c.util.drawArc,i={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},e={m:"l",M:"L"};if(c.Path){c.warn("fabric.Path is already defined");return}function k(l){if(l[0]==="H"){return l[1]}return l[l.length-2]}function j(l){if(l[0]==="V"){return l[1]}return l[l.length-1]}c.Path=c.util.createClass(c.Object,{type:"path",path:null,initialize:function(n,m){m=m||{};this.setOptions(m);if(!n){throw new Error("`path` argument is required")}var l=b.call(n)==="[object Array]";this.path=l?n:n.match&&n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path){return}if(!l){this.path=this._parsePath()}this._initializePath(m);if(m.sourcePath){this.setSourcePath(m.sourcePath)}},_initializePath:function(m){var l="width" in m&&m.width!=null,p="height" in m&&m.width!=null,n="left" in m,r="top" in m,o=n?this.left:0,q=r?this.top:0;if(!l||!p){f(this,this._parseDimensions());if(l){this.width=m.width}if(p){this.height=m.height}}else{if(!r){this.top=this.height/2}if(!n){this.left=this.width/2}}this.pathOffset=this.pathOffset||this._calculatePathOffset(o,q)},_calculatePathOffset:function(l,m){return{x:this.left-l-(this.width/2),y:this.top-m-(this.height/2)}},_render:function(z,n){var w,p=null,E=0,D=0,u=0,s=0,o=0,m=0,r,q,G,F,A=-((this.width/2)+this.pathOffset.x),v=-((this.height/2)+this.pathOffset.y);if(n){A+=this.width/2;v+=this.height/2}for(var B=0,C=this.path.length;B<C;++B){w=this.path[B];switch(w[0]){case"l":u+=w[1];s+=w[2];z.lineTo(u+A,s+v);break;case"L":u=w[1];s=w[2];z.lineTo(u+A,s+v);break;case"h":u+=w[1];z.lineTo(u+A,s+v);break;case"H":u=w[1];z.lineTo(u+A,s+v);break;case"v":s+=w[1];z.lineTo(u+A,s+v);break;case"V":s=w[1];z.lineTo(u+A,s+v);break;case"m":u+=w[1];s+=w[2];E=u;D=s;z.moveTo(u+A,s+v);break;case"M":u=w[1];s=w[2];E=u;D=s;z.moveTo(u+A,s+v);break;case"c":r=u+w[5];q=s+w[6];o=u+w[3];m=s+w[4];z.bezierCurveTo(u+w[1]+A,s+w[2]+v,o+A,m+v,r+A,q+v);u=r;s=q;break;case"C":u=w[5];s=w[6];o=w[3];m=w[4];z.bezierCurveTo(w[1]+A,w[2]+v,o+A,m+v,u+A,s+v);break;case"s":r=u+w[3];q=s+w[4];o=o?(2*u-o):u;m=m?(2*s-m):s;z.bezierCurveTo(o+A,m+v,u+w[1]+A,s+w[2]+v,r+A,q+v);o=u+w[1];m=s+w[2];u=r;s=q;break;case"S":r=w[3];q=w[4];o=2*u-o;m=2*s-m;z.bezierCurveTo(o+A,m+v,w[1]+A,w[2]+v,r+A,q+v);u=r;s=q;o=w[1];m=w[2];break;case"q":r=u+w[3];q=s+w[4];o=u+w[1];m=s+w[2];z.quadraticCurveTo(o+A,m+v,r+A,q+v);u=r;s=q;break;case"Q":r=w[3];q=w[4];z.quadraticCurveTo(w[1]+A,w[2]+v,r+A,q+v);u=r;s=q;o=w[1];m=w[2];break;case"t":r=u+w[1];q=s+w[2];if(p[0].match(/[QqTt]/)===null){o=u;m=s}else{if(p[0]==="t"){o=2*u-G;m=2*s-F}else{if(p[0]==="q"){o=2*u-o;m=2*s-m}}}G=o;F=m;z.quadraticCurveTo(o+A,m+v,r+A,q+v);u=r;s=q;o=u+w[1];m=s+w[2];break;case"T":r=w[1];q=w[2];o=2*u-o;m=2*s-m;z.quadraticCurveTo(o+A,m+v,r+A,q+v);u=r;s=q;break;case"a":h(z,u+A,s+v,[w[1],w[2],w[3],w[4],w[5],w[6]+u+A,w[7]+s+v]);u+=w[6];s+=w[7];break;case"A":h(z,u+A,s+v,[w[1],w[2],w[3],w[4],w[5],w[6]+A,w[7]+v]);u=w[6];s=w[7];break;case"z":case"Z":u=E;s=D;z.closePath();break}p=w}},render:function(n,o){if(!this.visible){return}n.save();if(o){n.translate(-this.width/2,-this.height/2)}var l=this.transformMatrix;if(l){n.transform(l[0],l[1],l[2],l[3],l[4],l[5])}if(!o){this.transform(n)}this._setStrokeStyles(n);this._setFillStyles(n);this._setShadow(n);this.clipTo&&c.util.clipContext(this,n);n.beginPath();n.globalAlpha=this.group?(n.globalAlpha*this.opacity):this.opacity;this._render(n,o);this._renderFill(n);this._renderStroke(n);this.clipTo&&n.restore();this._removeShadow(n);n.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(m){var l=f(this.callSuper("toObject",m),{path:this.path.map(function(n){return n.slice()}),pathOffset:this.pathOffset});if(this.sourcePath){l.sourcePath=this.sourcePath}if(this.transformMatrix){l.transformMatrix=this.transformMatrix}return l},toDatalessObject:function(m){var l=this.toObject(m);if(this.sourcePath){l.path=this.sourcePath}delete l.sourcePath;return l},toSVG:function(m){var q=[],n=this._createBaseSVGMarkup();for(var o=0,l=this.path.length;o<l;o++){q.push(this.path[o].join(" "))}var p=q.join(" ");n.push('<g transform="',(this.group?"":this.getSvgTransform()),'">',"<path ",'d="',p,'" style="',this.getSvgStyles(),'" transform="translate(',(-this.width/2)," ",(-this.height/2),")",'" stroke-linecap="round" ',"/>","</g>");return m?m(n.join("")):n.join("")},complexity:function(){return this.path.length},_parsePath:function(){var B=[],w=[],x,u,z=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,r,l;for(var p=0,v,s=this.path.length;p<s;p++){x=this.path[p];l=x.slice(1).trim();w.length=0;while((r=z.exec(l))){w.push(r[0])}v=[x.charAt(0)];for(var o=0,y=w.length;o<y;o++){u=parseFloat(w[o]);if(!isNaN(u)){v.push(u)}}var n=v[0],A=i[n.toLowerCase()],q=e[n]||n;if(v.length-1>A){for(var m=1,t=v.length;m<t;m+=A){B.push([n].concat(v.slice(m,m+A)));n=q}}else{B.push(v)}}return B},_parseDimensions:function(){var u=[],s=[],v={};this.path.forEach(function(w,o){this._getCoordsFromCommand(w,o,u,s,v)},this);var q=d(u),p=d(s),m=g(u),l=g(s),t=m-q,r=l-p,n={left:this.left+(q+t/2),top:this.top+(p+r/2),width:t,height:r};return n},_getCoordsFromCommand:function(p,l,o,m,n){var q=false;if(p[0]!=="H"){n.x=(l===0)?k(p):k(this.path[l-1])}if(p[0]!=="V"){n.y=(l===0)?j(p):j(this.path[l-1])}if(p[0]===p[0].toLowerCase()){q=true}var r=this._getXY(p,q,n),s;s=parseInt(r.x,10);if(!isNaN(s)){o.push(s)}s=parseInt(r.y,10);if(!isNaN(s)){m.push(s)}},_getXY:function(n,o,m){var l=o?m.x+k(n):n[0]==="V"?m.x:k(n),p=o?m.y+j(n):n[0]==="H"?m.y:j(n);return{x:l,y:p}}});c.Path.fromObject=function(l,m){if(typeof l.path==="string"){c.loadSVGFromURL(l.path,function(n){var o=n[0],p=l.path;delete l.path;c.util.object.extend(o,l);o.setSourcePath(p);m(o)})}else{m(new c.Path(l.path,l))}};c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]);c.Path.fromElement=function(m,o,l){var n=c.parseAttributes(m,c.Path.ATTRIBUTE_NAMES);o&&o(new c.Path(n.d,f(n,l)))};c.Path.async=true})(typeof exports!=="undefined"?exports:this);(function(c){var d=c.fabric||(c.fabric={}),e=d.util.object.extend,a=d.util.array.invoke,b=d.Object.prototype.toObject;if(d.PathGroup){d.warn("fabric.PathGroup is already defined");return}d.PathGroup=d.util.createClass(d.Path,{type:"path-group",fill:"",initialize:function(h,f){f=f||{};this.paths=h||[];for(var g=this.paths.length;g--;){this.paths[g].group=this}this.setOptions(f);if(f.widthAttr){this.scaleX=f.widthAttr/f.width}if(f.heightAttr){this.scaleY=f.heightAttr/f.height}this.setCoords();if(f.sourcePath){this.setSourcePath(f.sourcePath)}},render:function(h){if(!this.visible){return}h.save();var f=this.transformMatrix;if(f){h.transform(f[0],f[1],f[2],f[3],f[4],f[5])}this.transform(h);this._setShadow(h);this.clipTo&&d.util.clipContext(this,h);for(var j=0,g=this.paths.length;j<g;++j){this.paths[j].render(h,true)}this.clipTo&&h.restore();this._removeShadow(h);h.restore()},_set:function(h,g){if(h==="fill"&&g&&this.isSameColor()){var f=this.paths.length;while(f--){this.paths[f]._set(h,g)}}return this.callSuper("_set",h,g)},toObject:function(g){var f=e(b.call(this,g),{paths:a(this.getObjects(),"toObject",g)});if(this.sourcePath){f.sourcePath=this.sourcePath}return f},toDatalessObject:function(g){var f=this.toObject(g);if(this.sourcePath){f.paths=this.sourcePath}return f},toSVG:function(g){var k=this.getObjects(),h=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"];for(var j=0,f=k.length;j<f;j++){h.push(k[j].toSVG(g))}h.push("</g>");return g?g(h.join("")):h.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var f=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(g){return(g.get("fill")||"").toLowerCase()===f})},complexity:function(){return this.paths.reduce(function(f,g){return f+((g&&g.complexity)?g.complexity():0)},0)},getObjects:function(){return this.paths}});d.PathGroup.fromObject=function(f,g){if(typeof f.paths==="string"){d.loadSVGFromURL(f.paths,function(i){var j=f.paths;delete f.paths;var h=d.util.groupSVGElements(i,f,j);g(h)})}else{d.util.enlivenObjects(f.paths,function(h){delete f.paths;g(new d.PathGroup(h,f))})}};d.PathGroup.async=true})(typeof exports!=="undefined"?exports:this);(function(d){var e=d.fabric||(d.fabric={}),g=e.util.object.extend,c=e.util.array.min,a=e.util.array.max,b=e.util.array.invoke;if(e.Group){return}var f={lockMovementX:true,lockMovementY:true,lockRotation:true,lockScalingX:true,lockScalingY:true,lockUniScaling:true};e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",initialize:function(k,h){h=h||{};this._objects=k||[];for(var j=this._objects.length;j--;){this._objects[j].group=this}this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();if(h){g(this,h)}this._setOpacityIfSame();this.setCoords();this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(h){var i=h.getLeft(),j=h.getTop();h.set({originalLeft:i,originalTop:j,left:i-this.left,top:j-this.top});h.setCoords();h.__origHasControls=h.hasControls;h.hasControls=false},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(h){this._restoreObjectsState();if(h){this._objects.push(h);h.group=this}this.forEachObject(this._setObjectActive,this);this._calcBounds();this._updateObjectsCoords();return this},_setObjectActive:function(h){h.set("active",true);h.group=this},removeWithUpdate:function(h){this._moveFlippedObject(h);this._restoreObjectsState();this.forEachObject(this._setObjectActive,this);this.remove(h);this._calcBounds();this._updateObjectsCoords();return this},_onObjectAdded:function(h){h.group=this},_onObjectRemoved:function(h){delete h.group;h.set("active",false)},delegatedProperties:{fill:true,opacity:true,fontFamily:true,fontWeight:true,fontSize:true,fontStyle:true,lineHeight:true,textDecoration:true,textAlign:true,backgroundColor:true},_set:function(j,k){if(j in this.delegatedProperties){var h=this._objects.length;this[j]=k;while(h--){this._objects[h].set(j,k)}}else{this[j]=k}},toObject:function(h){return g(this.callSuper("toObject",h),{objects:b(this._objects,"toObject",h)})},render:function(j){if(!this.visible){return}j.save();this.clipTo&&e.util.clipContext(this,j);for(var k=0,h=this._objects.length;k<h;k++){this._renderObject(this._objects[k],j)}this.clipTo&&j.restore();j.restore()},_renderControls:function(j,l){this.callSuper("_renderControls",j,l);for(var k=0,h=this._objects.length;k<h;k++){this._objects[k]._renderControls(j)}},_renderObject:function(j,i){var h=j.hasRotatingPoint;if(!j.visible){return}j.hasRotatingPoint=false;j.render(i);j.hasRotatingPoint=h},_restoreObjectsState:function(){this._objects.forEach(this._restoreObjectState,this);return this},_moveFlippedObject:function(l){var j=l.get("originX"),i=l.get("originY"),h=l.getCenterPoint();l.set({originX:"center",originY:"center",left:h.x,top:h.y});this._toggleFlipping(l);var k=l.getPointByOrigin(j,i);l.set({originX:j,originY:i,left:k.x,top:k.y});return this},_toggleFlipping:function(h){if(this.flipX){h.toggle("flipX");h.set("left",-h.get("left"));h.setAngle(-h.getAngle())}if(this.flipY){h.toggle("flipY");h.set("top",-h.get("top"));h.setAngle(-h.getAngle())}},_restoreObjectState:function(h){this._setObjectPosition(h);h.setCoords();h.hasControls=h.__origHasControls;delete h.__origHasControls;h.set("active",false);h.setCoords();delete h.group;return this},_setObjectPosition:function(i){var j=this.getLeft(),k=this.getTop(),h=this._getRotatedLeftTop(i);i.set({angle:i.getAngle()+this.getAngle(),left:j+h.left,top:k+h.top,scaleX:i.get("scaleX")*this.get("scaleX"),scaleY:i.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(i){var h=this.getAngle()*(Math.PI/180);return{left:(-Math.sin(h)*i.getTop()*this.get("scaleY")+Math.cos(h)*i.getLeft()*this.get("scaleX")),top:(Math.cos(h)*i.getTop()*this.get("scaleY")+Math.sin(h)*i.getLeft()*this.get("scaleX"))}},destroy:function(){this._objects.forEach(this._moveFlippedObject,this);return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(h){h.setCoords()});return this},_setOpacityIfSame:function(){var j=this.getObjects(),i=j[0]?j[0].get("opacity"):1,h=j.every(function(k){return k.get("opacity")===i});if(h){this.opacity=i}},_calcBounds:function(p){var l=[],k=[],m;for(var j=0,h=this._objects.length;j<h;++j){m=this._objects[j];m.setCoords();for(var n in m.oCoords){l.push(m.oCoords[n].x);k.push(m.oCoords[n].y)}}this.set(this._getBounds(l,k,p))},_getBounds:function(j,i,n){var l=e.util.invertTransform(this.getViewportTransform()),k=e.util.transformPoint(new e.Point(c(j),c(i)),l),h=e.util.transformPoint(new e.Point(a(j),a(i)),l),m={width:(h.x-k.x)||0,height:(h.y-k.y)||0};if(!n){m.left=(k.x+h.x)/2||0;m.top=(k.y+h.y)/2||0}return m},toSVG:function(j){var k=["<g ",'transform="',this.getSvgTransform(),'">'];for(var l=0,h=this._objects.length;l<h;l++){k.push(this._objects[l].toSVG(j))}k.push("</g>");return j?j(k.join("")):k.join("")},get:function(k){if(k in f){if(this[k]){return this[k]}else{for(var j=0,h=this._objects.length;j<h;j++){if(this._objects[j][k]){return true}}return false}}else{if(k in this.delegatedProperties){return this._objects[0]&&this._objects[0].get(k)}return this[k]}}});e.Group.fromObject=function(h,i){e.util.enlivenObjects(h.objects,function(j){delete h.objects;i&&i(new e.Group(j,h))})};e.Group.async=true})(typeof exports!=="undefined"?exports:this);(function(a){var b=fabric.util.object.extend;if(!a.fabric){a.fabric={}}if(a.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(d,c){c||(c={});this.filters=[];this.callSuper("initialize",c);this._initElement(d,c);this._initConfig(c);if(c.filters){this.filters=c.filters;this.applyFilters()}},getElement:function(){return this._element},setElement:function(c,d){this._element=c;this._originalElement=c;this._initConfig();if(this.filters.length!==0){this.applyFilters(d)}return this},setCrossOrigin:function(c){this.crossOrigin=c;this._element.crossOrigin=c;return this},getOriginalSize:function(){var c=this.getElement();return{width:c.width,height:c.height}},render:function(e,f){if(!this.visible){return}e.save();var c=this.transformMatrix,d=this.group&&this.group.type==="path-group";if(d){e.translate(-this.group.width/2,-this.group.height/2)}if(c){e.transform(c[0],c[1],c[2],c[3],c[4],c[5])}if(!f){this.transform(e)}if(d){e.translate(this.width/2,this.height/2)}this._setShadow(e);this.clipTo&&fabric.util.clipContext(this,e);this._render(e);if(this.shadow&&!this.shadow.affectStroke){this._removeShadow(e)}this._renderStroke(e);this.clipTo&&e.restore();e.restore()},_stroke:function(c){c.save();this._setStrokeStyles(c);c.beginPath();c.strokeRect(-this.width/2,-this.height/2,this.width,this.height);c.closePath();c.restore()},_renderDashedStroke:function(e){var c=-this.width/2,g=-this.height/2,d=this.width,f=this.height;e.save();this._setStrokeStyles(e);e.beginPath();fabric.util.drawDashedLine(e,c,g,c+d,g,this.strokeDashArray);fabric.util.drawDashedLine(e,c+d,g,c+d,g+f,this.strokeDashArray);fabric.util.drawDashedLine(e,c+d,g+f,c,g+f,this.strokeDashArray);fabric.util.drawDashedLine(e,c,g+f,c,g,this.strokeDashArray);e.closePath();e.restore()},toObject:function(c){return b(this.callSuper("toObject",c),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(d){return d&&d.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(c){var d=[];d.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+(-this.width/2)+" "+(-this.height/2)+")",'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>");if(this.stroke||this.strokeDashArray){var e=this.fill;this.fill=null;d.push("<rect ",'x="',(-1*this.width/2),'" y="',(-1*this.height/2),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>');this.fill=e}d.push("</g>");return c?c(d.join("")):d.join("")},getSrc:function(){if(this.getElement()){return this.getElement().src||this.getElement()._src}},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(d,c){this.constructor.fromObject(this.toObject(c),d)},applyFilters:function(g){if(!this._originalElement){return}if(this.filters.length===0){this._element=this._originalElement;g&&g();return}var e=this._originalElement,c=fabric.util.createCanvasElement(),d=fabric.util.createImage(),f=this;c.width=e.width;c.height=e.height;c.getContext("2d").drawImage(e,0,0,e.width,e.height);this.filters.forEach(function(h){h&&h.applyTo(c)});d.width=e.width;d.height=e.height;if(fabric.isLikelyNode){d.src=c.toBuffer(undefined,fabric.Image.pngCompression);f._element=d;g&&g()}else{d.onload=function(){f._element=d;g&&g();d.onload=c=e=null};d.src=c.toDataURL("image/png")}return this},_render:function(c){this._element&&c.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var c=this.getElement();this.set("width",c.width);this.set("height",c.height)},_initElement:function(c){this.setElement(fabric.util.getById(c));fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(c){c||(c={});this.setOptions(c);this._setWidthHeight(c);if(this._element&&this.crossOrigin){this._element.crossOrigin=this.crossOrigin}},_initFilters:function(c,d){if(c.filters&&c.filters.length){fabric.util.enlivenObjects(c.filters,function(e){d&&d(e)},"fabric.Image.filters")}else{d&&d()}},_setWidthHeight:function(c){this.width="width" in c?c.width:(this.getElement()?this.getElement().width||0:0);this.height="height" in c?c.height:(this.getElement()?this.getElement().height||0:0)},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc;fabric.Image.fromObject=function(c,d){fabric.util.loadImage(c.src,function(e){fabric.Image.prototype._initFilters.call(c,c,function(g){c.filters=g||[];var f=new fabric.Image(e,c);d&&d(f)})},null,c.crossOrigin)};fabric.Image.fromURL=function(c,e,d){fabric.util.loadImage(c,function(f){e(new fabric.Image(f,d))},null,d&&d.crossOrigin)};fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" "));fabric.Image.fromElement=function(d,f,c){var e=fabric.parseAttributes(d,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(e["xlink:href"],f,b((c?fabric.util.object.clone(c):{}),e))};fabric.Image.async=true;fabric.Image.pngCompression=1})(typeof exports!=="undefined"?exports:this);fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.getAngle()%360;if(a>0){return Math.round((a-1)/90)*90}return Math.round(a/90)*90},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(b){b=b||{};var c=function(){},d=b.onComplete||c,a=b.onChange||c,e=this;fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(f){e.setAngle(f);a()},onComplete:function(){e.setCoords();d()},onStart:function(){e.set("active",false)}});return this}});fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(a){a.straighten();this.renderAll();return this},fxStraightenObject:function(a){a.fxStraighten({onChange:this.renderAll.bind(this)});return this}});fabric.Image.filters=fabric.Image.filters||{};fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}});(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Brightness=b.util.createClass(b.Image.filters.BaseFilter,{type:"Brightness",initialize:function(d){d=d||{};this.brightness=d.brightness||0},applyTo:function(g){var f=g.getContext("2d"),k=f.getImageData(0,0,g.width,g.height),h=k.data,j=this.brightness;for(var e=0,d=h.length;e<d;e+=4){h[e]+=j;h[e+1]+=j;h[e+2]+=j}f.putImageData(k,0,0)},toObject:function(){return c(this.callSuper("toObject"),{brightness:this.brightness})}});b.Image.filters.Brightness.fromObject=function(d){return new b.Image.filters.Brightness(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Convolute=b.util.createClass(b.Image.filters.BaseFilter,{type:"Convolute",initialize:function(d){d=d||{};this.opaque=d.opaque;this.matrix=d.matrix||[0,0,0,0,1,0,0,0,0];var e=b.util.createCanvasElement();this.tmpCtx=e.getContext("2d")},_createImageData:function(d,e){return this.tmpCtx.createImageData(d,e)},applyTo:function(l){var H=this.matrix,i=l.getContext("2d"),A=i.getImageData(0,0,l.width,l.height),e=Math.round(Math.sqrt(H.length)),k=Math.floor(e/2),m=A.data,B=A.width,K=A.height,s=B,F=K,n=this._createImageData(s,F),L=n.data,t=this.opaque?1:0;for(var o=0;o<F;o++){for(var p=0;p<s;p++){var v=o,z=p,C=(o*s+p)*4,u=0,G=0,I=0,J=0;for(var f=0;f<e;f++){for(var j=0;j<e;j++){var D=v+f-k,E=z+j-k;if(D<0||D>K||E<0||E>B){continue}var q=(D*B+E)*4,d=H[f*e+j];u+=m[q]*d;G+=m[q+1]*d;I+=m[q+2]*d;J+=m[q+3]*d}}L[C]=u;L[C+1]=G;L[C+2]=I;L[C+3]=J+t*(255-J)}}i.putImageData(n,0,0)},toObject:function(){return c(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}});b.Image.filters.Convolute.fromObject=function(d){return new b.Image.filters.Convolute(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.GradientTransparency=b.util.createClass(b.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(d){d=d||{};this.threshold=d.threshold||100},applyTo:function(h){var g=h.getContext("2d"),l=g.getImageData(0,0,h.width,h.height),k=l.data,e=this.threshold,j=k.length;for(var f=0,d=k.length;f<d;f+=4){k[f+3]=e+255*(j-f)/j}g.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold})}});b.Image.filters.GradientTransparency.fromObject=function(d){return new b.Image.filters.GradientTransparency(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Grayscale=b.util.createClass(b.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(f){var e=f.getContext("2d"),i=e.getImageData(0,0,f.width,f.height),h=i.data,c=i.width*i.height*4,d=0,g;while(d<c){g=(h[d]+h[d+1]+h[d+2])/3;h[d]=g;h[d+1]=g;h[d+2]=g;d+=4}e.putImageData(i,0,0)}});b.Image.filters.Grayscale.fromObject=function(){return new b.Image.filters.Grayscale()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Invert=b.util.createClass(b.Image.filters.BaseFilter,{type:"Invert",applyTo:function(f){var e=f.getContext("2d"),h=e.getImageData(0,0,f.width,f.height),g=h.data,c=g.length,d;for(d=0;d<c;d+=4){g[d]=255-g[d];g[d+1]=255-g[d+1];g[d+2]=255-g[d+2]}e.putImageData(h,0,0)}});b.Image.filters.Invert.fromObject=function(){return new b.Image.filters.Invert()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Mask=b.util.createClass(b.Image.filters.BaseFilter,{type:"Mask",initialize:function(d){d=d||{};this.mask=d.mask;this.channel=[0,1,2,3].indexOf(d.channel)>-1?d.channel:0},applyTo:function(h){if(!this.mask){return}var e=h.getContext("2d"),d=e.getImageData(0,0,h.width,h.height),j=d.data,l=this.mask.getElement(),n=b.util.createCanvasElement(),m=this.channel,k,g=d.width*d.height*4;n.width=l.width;n.height=l.height;n.getContext("2d").drawImage(l,0,0,l.width,l.height);var f=n.getContext("2d").getImageData(0,0,l.width,l.height),o=f.data;for(k=0;k<g;k+=4){j[k+3]=o[k+m]}e.putImageData(d,0,0)},toObject:function(){return c(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}});b.Image.filters.Mask.fromObject=function(d,e){b.util.loadImage(d.mask.src,function(f){d.mask=new b.Image(f,d.mask);e&&e(new b.Image.filters.Mask(d))})};b.Image.filters.Mask.async=true})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Noise=b.util.createClass(b.Image.filters.BaseFilter,{type:"Noise",initialize:function(d){d=d||{};this.noise=d.noise||0},applyTo:function(h){var g=h.getContext("2d"),l=g.getImageData(0,0,h.width,h.height),k=l.data,e=this.noise,j;for(var f=0,d=k.length;f<d;f+=4){j=(0.5-Math.random())*e;k[f]+=j;k[f+1]+=j;k[f+2]+=j}g.putImageData(l,0,0)},toObject:function(){return c(this.callSuper("toObject"),{noise:this.noise})}});b.Image.filters.Noise.fromObject=function(d){return new b.Image.filters.Noise(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Pixelate=b.util.createClass(b.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(d){d=d||{};this.blocksize=d.blocksize||4},applyTo:function(h){var f=h.getContext("2d"),e=f.getImageData(0,0,h.width,h.height),o=e.data,k=e.height,x=e.width,s,p,n,d,q,u,v;for(p=0;p<k;p+=this.blocksize){for(n=0;n<x;n+=this.blocksize){s=(p*4)*x+(n*4);d=o[s];q=o[s+1];u=o[s+2];v=o[s+3];for(var m=p,w=p+this.blocksize;m<w;m++){for(var l=n,t=n+this.blocksize;l<t;l++){s=(m*4)*x+(l*4);o[s]=d;o[s+1]=q;o[s+2]=u;o[s+3]=v}}}}f.putImageData(e,0,0)},toObject:function(){return c(this.callSuper("toObject"),{blocksize:this.blocksize})}});b.Image.filters.Pixelate.fromObject=function(d){return new b.Image.filters.Pixelate(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.RemoveWhite=b.util.createClass(b.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(d){d=d||{};this.threshold=d.threshold||30;this.distance=d.distance||20},applyTo:function(j){var h=j.getContext("2d"),e=h.getImageData(0,0,j.width,j.height),m=e.data,n=this.threshold,f=this.distance,k=255-n,s=Math.abs,d,o,q;for(var l=0,p=m.length;l<p;l+=4){d=m[l];o=m[l+1];q=m[l+2];if(d>k&&o>k&&q>k&&s(d-o)<f&&s(d-q)<f&&s(o-q)<f){m[l+3]=1}}h.putImageData(e,0,0)},toObject:function(){return c(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}});b.Image.filters.RemoveWhite.fromObject=function(d){return new b.Image.filters.RemoveWhite(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Sepia=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(f){var e=f.getContext("2d"),j=e.getImageData(0,0,f.width,f.height),g=j.data,c=g.length,d,h;for(d=0;d<c;d+=4){h=0.3*g[d]+0.59*g[d+1]+0.11*g[d+2];g[d]=h+100;g[d+1]=h+50;g[d+2]=h+255}e.putImageData(j,0,0)}});b.Image.filters.Sepia.fromObject=function(){return new b.Image.filters.Sepia()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={});b.Image.filters.Sepia2=b.util.createClass(b.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(f){var e=f.getContext("2d"),c=e.getImageData(0,0,f.width,f.height),j=c.data,h=j.length,k,d,l,m;for(k=0;k<h;k+=4){d=j[k];l=j[k+1];m=j[k+2];j[k]=(d*0.393+l*0.769+m*0.189)/1.351;j[k+1]=(d*0.349+l*0.686+m*0.168)/1.203;j[k+2]=(d*0.272+l*0.534+m*0.131)/2.14}e.putImageData(c,0,0)}});b.Image.filters.Sepia2.fromObject=function(){return new b.Image.filters.Sepia2()}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Tint=b.util.createClass(b.Image.filters.BaseFilter,{type:"Tint",initialize:function(d){d=d||{};this.color=d.color||"#000000";this.opacity=typeof d.opacity!=="undefined"?d.opacity:new b.Color(this.color).getAlpha()},applyTo:function(k){var h=k.getContext("2d"),f=h.getImageData(0,0,k.width,k.height),m=f.data,l=m.length,n,p,t,j,e,o,q,s,d;d=new b.Color(this.color).getSource();p=d[0]*this.opacity;t=d[1]*this.opacity;j=d[2]*this.opacity;s=1-this.opacity;for(n=0;n<l;n+=4){e=m[n];o=m[n+1];q=m[n+2];m[n]=p+e*s;m[n+1]=t+o*s;m[n+2]=j+q*s}h.putImageData(f,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}});b.Image.filters.Tint.fromObject=function(d){return new b.Image.filters.Tint(d)}})(typeof exports!=="undefined"?exports:this);(function(a){var b=a.fabric||(a.fabric={}),c=b.util.object.extend;b.Image.filters.Multiply=b.util.createClass(b.Image.filters.BaseFilter,{type:"Multiply",initialize:function(d){d=d||{};this.color=d.color||"#000000"},applyTo:function(g){var f=g.getContext("2d"),k=f.getImageData(0,0,g.width,g.height),j=k.data,d=j.length,e,h;h=new b.Color(this.color).getSource();for(e=0;e<d;e+=4){j[e]*=h[0]/255;j[e+1]*=h[1]/255;j[e+2]*=h[2]/255}f.putImageData(k,0,0)},toObject:function(){return c(this.callSuper("toObject"),{color:this.color})}});b.Image.filters.Multiply.fromObject=function(d){return new b.Image.filters.Multiply(d)}})(typeof exports!=="undefined"?exports:this);(function(b){var c=b.fabric||(b.fabric={}),g=c.util.object.extend,f=c.util.object.clone,a=c.util.toFixed,d=c.StaticCanvas.supports("setLineDash");if(c.Text){c.warn("fabric.Text is already defined");return}var e=c.Object.prototype.stateProperties.concat();e.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path");c.Text=c.util.createClass(c.Object,{_dimensionAffectingProps:{fontSize:true,fontWeight:true,fontFamily:true,textDecoration:true,fontStyle:true,lineHeight:true,stroke:true,strokeWidth:true,text:true},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:true,stateProperties:e,stroke:null,shadow:null,initialize:function(i,h){h=h||{};this.text=i;this.__skipDimension=true;this.setOptions(h);this.__skipDimension=false;this._initDimensions()},_initDimensions:function(){if(this.__skipDimension){return}var h=c.util.createCanvasElement();this._render(h.getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(h){if(typeof Cufon==="undefined"||this.useNative===true){this._renderViaNative(h)}else{this._renderViaCufon(h)}},_renderViaNative:function(h){var i=this.text.split(this._reNewline);this._setTextStyles(h);this.width=this._getTextWidth(h,i);this.height=this._getTextHeight(h,i);this.clipTo&&c.util.clipContext(this,h);this._renderTextBackground(h,i);this._translateForTextAlign(h);this._renderText(h,i);if(this.textAlign!=="left"&&this.textAlign!=="justify"){h.restore()}this._renderTextDecoration(h,i);this.clipTo&&h.restore();this._setBoundaries(h,i);this._totalLineHeight=0},_renderText:function(h,i){h.save();this._setShadow(h);this._renderTextFill(h,i);this._renderTextStroke(h,i);this._removeShadow(h);h.restore()},_translateForTextAlign:function(h){if(this.textAlign!=="left"&&this.textAlign!=="justify"){h.save();h.translate(this.textAlign==="center"?(this.width/2):this.width,0)}},_setBoundaries:function(k,m){this._boundaries=[];for(var l=0,j=m.length;l<j;l++){var h=this._getLineWidth(k,m[l]),n=this._getLineLeftOffset(h);this._boundaries.push({height:this.fontSize*this.lineHeight,width:h,left:n})}},_setTextStyles:function(h){this._setFillStyles(h);this._setStrokeStyles(h);h.textBaseline="alphabetic";if(!this.skipTextAlign){h.textAlign=this.textAlign}h.font=this._getFontDeclaration()},_getTextHeight:function(h,i){return this.fontSize*i.length*this.lineHeight},_getTextWidth:function(j,l){var m=j.measureText(l[0]||"|").width;for(var k=1,h=l.length;k<h;k++){var n=j.measureText(l[k]).width;if(n>m){m=n}}return m},_renderChars:function(l,h,i,k,j){h[l](i,k,j)},_renderTextLine:function(h,v,x,k,s,u){s-=this.fontSize/4;if(this.textAlign!=="justify"){this._renderChars(h,v,x,k,s,u);return}var p=v.measureText(x).width,o=this.width;if(o>p){var r=x.split(/\s+/),w=v.measureText(x.replace(/\s+/g,"")).width,n=o-w,m=r.length-1,t=n/m,j=0;for(var l=0,q=r.length;l<q;l++){this._renderChars(h,v,r[l],k+j,s,u);j+=v.measureText(r[l]).width+t}}else{this._renderChars(h,v,x,k,s,u)}},_getLeftOffset:function(){if(c.isLikelyNode){return 0}return -this.width/2},_getTopOffset:function(){return -this.height/2},_renderTextFill:function(j,m){if(!this.fill&&!this._skipFillStrokeCheck){return}this._boundaries=[];var n=0;for(var k=0,h=m.length;k<h;k++){var l=this._getHeightOfLine(j,k,m);n+=l;this._renderTextLine("fillText",j,m[k],this._getLeftOffset(),this._getTopOffset()+n,k)}},_renderTextStroke:function(j,m){if((!this.stroke||this.strokeWidth===0)&&!this._skipFillStrokeCheck){return}var n=0;j.save();if(this.strokeDashArray){if(1&this.strokeDashArray.length){this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray)}d&&j.setLineDash(this.strokeDashArray)}j.beginPath();for(var k=0,h=m.length;k<h;k++){var l=this._getHeightOfLine(j,k,m);n+=l;this._renderTextLine("strokeText",j,m[k],this._getLeftOffset(),this._getTopOffset()+n,k)}j.closePath();j.restore()},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(h,i){this._renderTextBoxBackground(h);this._renderTextLinesBackground(h,i)},_renderTextBoxBackground:function(h){if(!this.backgroundColor){return}h.save();h.fillStyle=this.backgroundColor;h.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height);h.restore()},_renderTextLinesBackground:function(k,m){if(!this.textBackgroundColor){return}k.save();k.fillStyle=this.textBackgroundColor;for(var l=0,j=m.length;l<j;l++){if(m[l]!==""){var h=this._getLineWidth(k,m[l]),n=this._getLineLeftOffset(h);k.fillRect(this._getLeftOffset()+n,this._getTopOffset()+(l*this.fontSize*this.lineHeight),h,this.fontSize*this.lineHeight)}}k.restore()},_getLineLeftOffset:function(h){if(this.textAlign==="center"){return(this.width-h)/2}if(this.textAlign==="right"){return this.width-h}return 0},_getLineWidth:function(i,h){return this.textAlign==="justify"?this.width:i.measureText(h).width},_renderTextDecoration:function(i,j){if(!this.textDecoration){return}var k=this._getTextHeight(i,j)/2,l=this;function h(q){for(var o=0,n=j.length;o<n;o++){var m=l._getLineWidth(i,j[o]),p=l._getLineLeftOffset(m);i.fillRect(l._getLeftOffset()+p,~~((q+(o*l._getHeightOfLine(i,o,j)))-k),m,1)}}if(this.textDecoration.indexOf("underline")>-1){h(this.fontSize*this.lineHeight)}if(this.textDecoration.indexOf("line-through")>-1){h(this.fontSize*this.lineHeight-this.fontSize/2)}if(this.textDecoration.indexOf("overline")>-1){h(this.fontSize*this.lineHeight-this.fontSize)}},_getFontDeclaration:function(){return[(c.isLikelyNode?this.fontWeight:this.fontStyle),(c.isLikelyNode?this.fontStyle:this.fontWeight),this.fontSize+"px",(c.isLikelyNode?('"'+this.fontFamily+'"'):this.fontFamily)].join(" ")},render:function(j,k){if(!this.visible){return}j.save();this._transform(j,k);var h=this.transformMatrix;var i=this.group&&this.group.type==="path-group";if(i){j.translate(-this.group.width/2,-this.group.height/2)}if(h){j.transform(h[0],h[1],h[2],h[3],h[4],h[5])}if(i){j.translate(this.left,this.top)}this._render(j);j.restore()},toObject:function(i){var h=g(this.callSuper("toObject",i),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});if(!this.includeDefaultValues){this._removeDefaultValues(h)}return h},toSVG:function(h){var i=[],k=this.text.split(this._reNewline),l=this._getSVGLeftTopOffsets(k),j=this._getSVGTextAndBg(l.lineTop,l.textLeft,k),m=this._getSVGShadows(l.lineTop,k);l.textTop+=(this._fontAscent?((this._fontAscent/5)*this.lineHeight):0);this._wrapSVGTextAndBg(i,j,m,l);return h?h(i.join("")):i.join("")},_getSVGLeftTopOffsets:function(k){var j=this.useNative?this.fontSize*this.lineHeight:(-this._fontAscent-((this._fontAscent/5)*this.lineHeight)),i=-(this.width/2),h=this.useNative?this.fontSize-1:(this.height/2)-(k.length*this.fontSize)-this._totalLineHeight;return{textLeft:i,textTop:h,lineTop:j}},_wrapSVGTextAndBg:function(h,i,k,j){h.push('<g transform="',this.getSvgTransform(),'">',i.textBgRects.join(""),"<text ",(this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':""),(this.fontSize?'font-size="'+this.fontSize+'" ':""),(this.fontStyle?'font-style="'+this.fontStyle+'" ':""),(this.fontWeight?'font-weight="'+this.fontWeight+'" ':""),(this.textDecoration?'text-decoration="'+this.textDecoration+'" ':""),'style="',this.getSvgStyles(),'" ','transform="translate(',a(j.textLeft,2)," ",a(j.textTop,2),')">',k.join(""),i.textSpans.join(""),"</text>","</g>")},_getSVGShadows:function(l,k){var o=[],j,h,n=1;if(!this.shadow||!this._boundaries){return o}for(j=0,h=k.length;j<h;j++){if(k[j]!==""){var m=(this._boundaries&&this._boundaries[j])?this._boundaries[j].left:0;o.push('<tspan x="',a((m+n)+this.shadow.offsetX,2),((j===0||this.useNative)?'" y':'" dy'),'="',a(this.useNative?((l*j)-this.height/2+this.shadow.offsetY):(l+(j===0?this.shadow.offsetY:0)),2),'" ',this._getFillAttributes(this.shadow.color),">",c.util.string.escapeXml(k[j]),"</tspan>");n=1}else{n++}}return o},_getSVGTextAndBg:function(m,j,l){var p=[],n=[],o=1;this._setSVGBg(n);for(var k=0,h=l.length;k<h;k++){if(l[k]!==""){this._setSVGTextLineText(l[k],k,p,m,o,n);o=1}else{o++}if(!this.textBackgroundColor||!this._boundaries){continue}this._setSVGTextLineBg(n,k,j,m)}return{textSpans:p,textBgRects:n}},_setSVGTextLineText:function(j,h,n,k,m){var l=(this._boundaries&&this._boundaries[h])?a(this._boundaries[h].left,2):0;n.push('<tspan x="',l,'" ',(h===0||this.useNative?"y":"dy"),'="',a(this.useNative?((k*h)-this.height/2):(k*m),2),'" ',this._getFillAttributes(this.fill),">",c.util.string.escapeXml(j),"</tspan>")},_setSVGTextLineBg:function(l,j,h,k){l.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',a(h+this._boundaries[j].left,2),'" y="',a((k*j)-this.height/2,2),'" width="',a(this._boundaries[j].width,2),'" height="',a(this._boundaries[j].height,2),'"></rect>')},_setSVGBg:function(h){if(this.backgroundColor&&this._boundaries){h.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,2),'" y="',a(-this.height/2,2),'" width="',a(this.width,2),'" height="',a(this.height,2),'"></rect>')}},_getFillAttributes:function(h){var i=(h&&typeof h==="string")?new c.Color(h):"";if(!i||!i.getSource()||i.getAlpha()===1){return'fill="'+h+'"'}return'opacity="'+i.getAlpha()+'" fill="'+i.setAlpha(1).toRgb()+'"'},_set:function(h,i){if(h==="fontFamily"&&this.path){this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+i+"$3")}this.callSuper("_set",h,i);if(h in this._dimensionAffectingProps){this._initDimensions();this.setCoords()}},complexity:function(){return 1}});c.Text.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" "));c.Text.DEFAULT_SVG_FONT_SIZE=16;c.Text.fromElement=function(j,i){if(!j){return null}var k=c.parseAttributes(j,c.Text.ATTRIBUTE_NAMES);i=c.util.object.extend((i?c.util.object.clone(i):{}),k);if("dx" in k){i.left+=k.dx}if("dy" in k){i.top+=k.dy}if(!("fontSize" in i)){i.fontSize=c.Text.DEFAULT_SVG_FONT_SIZE}if(!i.originX){i.originX="left"}var l=new c.Text(j.textContent,i);var h=0;if(l.originX==="left"){h=l.getWidth()/2}if(l.originX==="right"){h=-l.getWidth()/2}l.set({left:l.getLeft()+h,top:l.getTop()-l.getHeight()/2});return l};c.Text.fromObject=function(h){return new c.Text(h.text,f(h))};c.util.createAccessors(c.Text)})(typeof exports!=="undefined"?exports:this);(function(){var a=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:false,editable:true,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1000,cursorDuration:600,styles:null,caching:true,_skipFillStrokeCheck:true,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:false,_charWidthsCache:{},initialize:function(c,b){this.styles=b?(b.styles||{}):{};this.callSuper("initialize",c,b);this.initBehavior();fabric.IText.instances.push(this);this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles){return true}var d=this.styles;for(var e in d){for(var c in d[e]){for(var b in d[e][c]){return false}}}return true},setSelectionStart:function(b){if(this.selectionStart!==b){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}this.selectionStart=b;this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=b)},setSelectionEnd:function(b){if(this.selectionEnd!==b){this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})}this.selectionEnd=b;this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=b)},getSelectionStyles:function(f,d){if(arguments.length===2){var c=[];for(var b=f;b<d;b++){c.push(this.getSelectionStyles(b))}return c}var e=this.get2DCursorLocation(f);if(this.styles[e.lineIndex]){return this.styles[e.lineIndex][e.charIndex]||{}}return{}},setSelectionStyles:function(c){if(this.selectionStart===this.selectionEnd){this._extendStyles(this.selectionStart,c)}else{for(var b=this.selectionStart;b<this.selectionEnd;b++){this._extendStyles(b,c)}}return this},_extendStyles:function(b,c){var d=this.get2DCursorLocation(b);if(!this.styles[d.lineIndex]){this.styles[d.lineIndex]={}}if(!this.styles[d.lineIndex][d.charIndex]){this.styles[d.lineIndex][d.charIndex]={}}fabric.util.object.extend(this.styles[d.lineIndex][d.charIndex],c)},_render:function(b){this.callSuper("_render",b);this.ctx=b;this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(!this.active){return}var c=this.text.split(""),b;if(this.selectionStart===this.selectionEnd){b=this._getCursorBoundaries(c,"cursor");this.renderCursor(b)}else{b=this._getCursorBoundaries(c,"selection");this.renderSelection(c,b)}},get2DCursorLocation:function(c){if(typeof c==="undefined"){c=this.selectionStart}var d=this.text.slice(0,c),b=d.split(this._reNewline);return{lineIndex:b.length-1,charIndex:b[b.length-1].length}},getCurrentCharStyle:function(d,c){var b=this.styles[d]&&this.styles[d][c===0?0:(c-1)];return{fontSize:b&&b.fontSize||this.fontSize,fill:b&&b.fill||this.fill,textBackgroundColor:b&&b.textBackgroundColor||this.textBackgroundColor,textDecoration:b&&b.textDecoration||this.textDecoration,fontFamily:b&&b.fontFamily||this.fontFamily,fontWeight:b&&b.fontWeight||this.fontWeight,fontStyle:b&&b.fontStyle||this.fontStyle,stroke:b&&b.stroke||this.stroke,strokeWidth:b&&b.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(c,b){return(this.styles[c]&&this.styles[c][b===0?0:(b-1)]&&this.styles[c][b===0?0:(b-1)].fontSize)||this.fontSize},getCurrentCharColor:function(c,b){return(this.styles[c]&&this.styles[c][b===0?0:(b-1)]&&this.styles[c][b===0?0:(b-1)].fill)||this.cursorColor},_getCursorBoundaries:function(f,b){var c=this.get2DCursorLocation(),d=this.text.split(this._reNewline),h=Math.round(this._getLeftOffset()),g=-this.height/2,e=this._getCursorBoundariesOffsets(f,b,c,d);return{left:h,top:g,leftOffset:e.left+e.lineLeft,topOffset:e.top}},_getCursorBoundariesOffsets:function(j,l,k,g){var f=0,m=0,b=0,c=0,e=l==="cursor"?(this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(k.lineIndex,k.charIndex)):0;for(var d=0;d<this.selectionStart;d++){if(j[d]==="\n"){c=0;var h=m+(l==="cursor"?1:0);e+=this._getCachedLineHeight(h);m++;b=0}else{c+=this._getWidthOfChar(this.ctx,j[d],m,b);b++}f=this._getCachedLineOffset(m,g)}this._clearCache();return{top:e,left:c,lineLeft:f}},_clearCache:function(){this.__lineWidths={};this.__lineHeights={};this.__lineOffsets={}},_getCachedLineHeight:function(b){return this.__lineHeights[b]||(this.__lineHeights[b]=this._getHeightOfLine(this.ctx,b))},_getCachedLineWidth:function(c,b){return this.__lineWidths[c]||(this.__lineWidths[c]=this._getWidthOfLine(this.ctx,c,b))},_getCachedLineOffset:function(d,b){var c=this._getCachedLineWidth(d,b);return this.__lineOffsets[d]||(this.__lineOffsets[d]=this._getLineLeftOffset(c))},renderCursor:function(c){var b=this.ctx;b.save();var d=this.get2DCursorLocation(),h=d.lineIndex,g=d.charIndex,f=this.getCurrentCharFontSize(h,g),e=(h===0&&g===0)?this._getCachedLineOffset(h,this.text.split(this._reNewline)):c.leftOffset;b.fillStyle=this.getCurrentCharColor(h,g);b.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity;b.fillRect(c.left+e,c.top+c.topOffset,this.cursorWidth/this.scaleX,f);b.restore()},renderSelection:function(o,c){var s=this.ctx;s.save();s.fillStyle=this.selectionColor;var b=this.get2DCursorLocation(this.selectionStart),g=this.get2DCursorLocation(this.selectionEnd),q=b.lineIndex,d=g.lineIndex,m=this.text.split(this._reNewline);for(var k=q;k<=d;k++){var f=this._getCachedLineOffset(k,m)||0,p=this._getCachedLineHeight(k),l=0;if(k===q){for(var h=0,n=m[k].length;h<n;h++){if(h>=b.charIndex&&(k!==d||h<g.charIndex)){l+=this._getWidthOfChar(s,m[k][h],k,h)}if(h<b.charIndex){f+=this._getWidthOfChar(s,m[k][h],k,h)}}}else{if(k>q&&k<d){l+=this._getCachedLineWidth(k,m)||5}else{if(k===d){for(var r=0,e=g.charIndex;r<e;r++){l+=this._getWidthOfChar(s,m[k][r],k,r)}}}}s.fillRect(c.left+f,c.top+c.topOffset,l,p);c.topOffset+=p}s.restore()},_renderChars:function(b,q,r,c,m,p){if(this.isEmptyStyles()){return this._renderCharsFast(b,q,r,c,m)}this.skipTextAlign=true;c-=this.textAlign==="center"?(this.width/2):(this.textAlign==="right")?this.width:0;var g=this.text.split(this._reNewline),h=this._getWidthOfLine(q,p,g),o=this._getHeightOfLine(q,p,g),e=this._getLineLeftOffset(h),l=r.split(""),n,f="";c+=e||0;q.save();for(var d=0,k=l.length;d<=k;d++){n=n||this.getCurrentCharStyle(p,d);var j=this.getCurrentCharStyle(p,d+1);if(this._hasStyleChanged(n,j)||d===k){this._renderChar(b,q,p,d-1,f,c,m,o);f="";n=j}f+=l[d]}q.restore()},_renderCharsFast:function(f,c,b,e,d){this.skipTextAlign=false;if(f==="fillText"&&this.fill){this.callSuper("_renderChars",f,c,b,e,d)}if(f==="strokeText"&&this.stroke){this.callSuper("_renderChars",f,c,b,e,d)}},_renderChar:function(b,o,n,f,m,d,j,l){var h,g,c;if(this.styles&&this.styles[n]&&(h=this.styles[n][f])){var k=h.stroke||this.stroke,e=h.fill||this.fill;o.save();g=this._applyCharStylesGetWidth(o,m,n,f,h);c=this._getHeightOfChar(o,m,n,f);if(e){o.fillText(m,d,j)}if(k){o.strokeText(m,d,j)}this._renderCharDecoration(o,h,d,j,g,l,c);o.restore();o.translate(g,0)}else{if(b==="strokeText"&&this.stroke){o[b](m,d,j)}if(b==="fillText"&&this.fill){o[b](m,d,j)}g=this._applyCharStylesGetWidth(o,m,n,f);this._renderCharDecoration(o,null,d,j,g,l);o.translate(o.measureText(m).width,0)}},_hasStyleChanged:function(b,c){return(b.fill!==c.fill||b.fontSize!==c.fontSize||b.textBackgroundColor!==c.textBackgroundColor||b.textDecoration!==c.textDecoration||b.fontFamily!==c.fontFamily||b.fontWeight!==c.fontWeight||b.fontStyle!==c.fontStyle||b.stroke!==c.stroke||b.strokeWidth!==c.strokeWidth)},_renderCharDecoration:function(h,b,d,f,e,g,c){var j=b?(b.textDecoration||this.textDecoration):this.textDecoration,i=(b?b.fontSize:null)||this.fontSize;if(!j){return}if(j.indexOf("underline")>-1){this._renderCharDecorationAtOffset(h,d,f+(this.fontSize/this._fontSizeFraction),e,0,this.fontSize/20)}if(j.indexOf("line-through")>-1){this._renderCharDecorationAtOffset(h,d,f+(this.fontSize/this._fontSizeFraction),e,c/2,i/20)}if(j.indexOf("overline")>-1){this._renderCharDecorationAtOffset(h,d,f,e,g-(this.fontSize/this._fontSizeFraction),this.fontSize/20)}},_renderCharDecorationAtOffset:function(c,f,e,b,g,d){c.fillRect(f,e-g,b,d)},_renderTextLine:function(g,c,b,e,d,f){d+=this.fontSize/4;this.callSuper("_renderTextLine",g,c,b,e,d,f)},_renderTextDecoration:function(b,c){if(this.isEmptyStyles()){return this.callSuper("_renderTextDecoration",b,c)}},_renderTextLinesBackground:function(o,g){if(!this.textBackgroundColor&&!this.styles){return}o.save();if(this.textBackgroundColor){o.fillStyle=this.textBackgroundColor}var l=0,b=this.fontSize/this._fontSizeFraction;for(var e=0,k=g.length;e<k;e++){var c=this._getHeightOfLine(o,e,g);if(g[e]===""){l+=c;continue}var h=this._getWidthOfLine(o,e,g),f=this._getLineLeftOffset(h);if(this.textBackgroundColor){o.fillStyle=this.textBackgroundColor;o.fillRect(this._getLeftOffset()+f,this._getTopOffset()+l+b,h,c)}if(this.styles[e]){for(var d=0,n=g[e].length;d<n;d++){if(this.styles[e]&&this.styles[e][d]&&this.styles[e][d].textBackgroundColor){var m=g[e][d];o.fillStyle=this.styles[e][d].textBackgroundColor;o.fillRect(this._getLeftOffset()+f+this._getWidthOfCharsAt(o,e,d,g),this._getTopOffset()+l+b,this._getWidthOfChar(o,m,e,d,g)+1,c)}}}l+=c}o.restore()},_getCacheProp:function(b,c){return b+c.fontFamily+c.fontSize+c.fontWeight+c.fontStyle+c.shadow},_applyCharStylesGetWidth:function(c,d,i,h,b){var f=b||(this.styles[i]&&this.styles[i][h]);if(f){f=a(f)}else{f={}}this._applyFontStyles(f);var e=this._getCacheProp(d,f);if(this.isEmptyStyles()&&this._charWidthsCache[e]&&this.caching){return this._charWidthsCache[e]}if(typeof f.shadow==="string"){f.shadow=new fabric.Shadow(f.shadow)}var g=f.fill||this.fill;c.fillStyle=g.toLive?g.toLive(c):g;if(f.stroke){c.strokeStyle=(f.stroke&&f.stroke.toLive)?f.stroke.toLive(c):f.stroke}c.lineWidth=f.strokeWidth||this.strokeWidth;c.font=this._getFontDeclaration.call(f);this._setShadow.call(f,c);if(!this.caching){return c.measureText(d).width}if(!this._charWidthsCache[e]){this._charWidthsCache[e]=c.measureText(d).width}return this._charWidthsCache[e]},_applyFontStyles:function(b){if(!b.fontFamily){b.fontFamily=this.fontFamily}if(!b.fontSize){b.fontSize=this.fontSize}if(!b.fontWeight){b.fontWeight=this.fontWeight}if(!b.fontStyle){b.fontStyle=this.fontStyle}},_getStyleDeclaration:function(c,b){return(this.styles[c]&&this.styles[c][b])?a(this.styles[c][b]):{}},_getWidthOfChar:function(b,c,h,g){var f=this._getStyleDeclaration(h,g);this._applyFontStyles(f);var d=this._getCacheProp(c,f);if(this._charWidthsCache[d]&&this.caching){return this._charWidthsCache[d]}else{if(b){b.save();var e=this._applyCharStylesGetWidth(b,c,h,g);b.restore();return e}}},_getHeightOfChar:function(b,c,e,d){if(this.styles[e]&&this.styles[e][d]){return this.styles[e][d].fontSize||this.fontSize}return this.fontSize},_getWidthOfCharAt:function(c,f,e,b){b=b||this.text.split(this._reNewline);var d=b[f].split("")[e];return this._getWidthOfChar(c,d,f,e)},_getHeightOfCharAt:function(c,f,e,b){b=b||this.text.split(this._reNewline);var d=b[f].split("")[e];return this._getHeightOfChar(c,d,f,e)},_getWidthOfCharsAt:function(c,g,f,b){var e=0;for(var d=0;d<f;d++){e+=this._getWidthOfCharAt(c,g,d,b)}return e},_getWidthOfLine:function(b,d,c){return this._getWidthOfCharsAt(b,d,c[d].length,c)},_getTextWidth:function(c,e){if(this.isEmptyStyles()){return this.callSuper("_getTextWidth",c,e)}var f=this._getWidthOfLine(c,0,e);for(var d=1,b=e.length;d<b;d++){var g=this._getWidthOfLine(c,d,e);if(g>f){f=g}}return f},_getHeightOfLine:function(j,h,c){c=c||this.text.split(this._reNewline);var g=this._getHeightOfChar(j,c[h][0],h,0),k=c[h],f=k.split("");for(var b=1,e=f.length;b<e;b++){var d=this._getHeightOfChar(j,f[b],h,b);if(d>g){g=d}}return g*this.lineHeight},_getTextHeight:function(d,f){var c=0;for(var e=0,b=f.length;e<b;e++){c+=this._getHeightOfLine(d,e,f)}return c},_getTopOffset:function(){var b=fabric.Text.prototype._getTopOffset.call(this);return b-(this.fontSize/this._fontSizeFraction)},_renderTextBoxBackground:function(b){if(!this.backgroundColor){return}b.save();b.fillStyle=this.backgroundColor;b.fillRect(this._getLeftOffset(),this._getTopOffset()+(this.fontSize/this._fontSizeFraction),this.width,this.height);b.restore()},toObject:function(b){return fabric.util.object.extend(this.callSuper("toObject",b),{styles:a(this.styles)})}});fabric.IText.fromObject=function(b){return new fabric.IText(b.text,a(b))};fabric.IText.instances=[]})();(function(){var a=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler();this.initCursorSelectionHandlers();this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var b=this;setTimeout(function(){b.selected=true},100)})},initAddedHandler:function(){this.on("added",function(){if(this.canvas&&!this.canvas._hasITextHandlers){this.canvas._hasITextHandlers=true;this._initCanvasHandlers()}})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers.call()});this.canvas.on("mouse:up",function(){fabric.IText.instances.forEach(function(b){b.__isMousedown=false})});this.canvas.on("object:selected",function(b){fabric.IText.prototype.exitEditingOnOthers.call(b.target)})},_tick:function(){var b=this;if(this._abortCursorAnimation){return}this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){b._onTickComplete()},onChange:function(){b.canvas&&b.canvas.renderAll()},abort:function(){return b._abortCursorAnimation}})},_onTickComplete:function(){if(this._abortCursorAnimation){return}var b=this;if(this._cursorTimeout1){clearTimeout(this._cursorTimeout1)}this._cursorTimeout1=setTimeout(function(){b.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){b._tick()},onChange:function(){b.canvas&&b.canvas.renderAll()},abort:function(){return b._abortCursorAnimation}})},100)},initDelayedCursor:function(b){var d=this,c=b?0:this.cursorDelay;if(b){this._abortCursorAnimation=true;clearTimeout(this._cursorTimeout1);this._currentCursorOpacity=1;this.canvas&&this.canvas.renderAll()}if(this._cursorTimeout2){clearTimeout(this._cursorTimeout2)}this._cursorTimeout2=setTimeout(function(){d._abortCursorAnimation=false;d._tick()},c)},abortCursorAnimation:function(){this._abortCursorAnimation=true;clearTimeout(this._cursorTimeout1);clearTimeout(this._cursorTimeout2);this._currentCursorOpacity=0;this.canvas&&this.canvas.renderAll();var b=this;setTimeout(function(){b._abortCursorAnimation=false},10)},selectAll:function(){this.selectionStart=0;this.selectionEnd=this.text.length;this.fire("selection:changed");this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(c){var d=0,b=c-1;if(this._reSpace.test(this.text.charAt(b))){while(this._reSpace.test(this.text.charAt(b))){d++;b--}}while(/\S/.test(this.text.charAt(b))&&b>-1){d++;b--}return c-d},findWordBoundaryRight:function(c){var d=0,b=c;if(this._reSpace.test(this.text.charAt(b))){while(this._reSpace.test(this.text.charAt(b))){d++;b++}}while(/\S/.test(this.text.charAt(b))&&b<this.text.length){d++;b++}return c+d},findLineBoundaryLeft:function(c){var d=0,b=c-1;while(!/\n/.test(this.text.charAt(b))&&b>-1){d++;b--}return c-d},findLineBoundaryRight:function(c){var d=0,b=c;while(!/\n/.test(this.text.charAt(b))&&b<this.text.length){d++;b++}return c+d},getNumNewLinesInSelectedText:function(){var f=this.getSelectedText(),e=0;for(var c=0,d=f.split(""),b=d.length;c<b;c++){if(d[c]==="\n"){e++}}return e},searchWordBoundary:function(e,f){var d=this._reSpace.test(this.text.charAt(e))?e-1:e,c=this.text.charAt(d),b=/[ \n\.,;!\?\-]/;while(!b.test(c)&&d>0&&d<this.text.length){d+=f;c=this.text.charAt(d)}if(b.test(c)&&c!=="\n"){d+=f===1?0:1}return d},selectWord:function(d){var b=this.searchWordBoundary(d,-1),c=this.searchWordBoundary(d,1);this.setSelectionStart(b);this.setSelectionEnd(c);this.initDelayedCursor(true)},selectLine:function(d){var b=this.findLineBoundaryLeft(d),c=this.findLineBoundaryRight(d);this.setSelectionStart(b);this.setSelectionEnd(c);this.initDelayedCursor(true)},enterEditing:function(){if(this.isEditing||!this.editable){return}this.exitEditingOnOthers();this.isEditing=true;this.initHiddenTextarea();this._updateTextarea();this._saveEditingProps();this._setEditingProps();this._tick();this.canvas&&this.canvas.renderAll();this.fire("editing:entered");this.canvas&&this.canvas.fire("text:editing:entered",{target:this});return this},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(b){b.selected=false;if(b.isEditing){b.exitEditing()}},this)},_setEditingProps:function(){this.hoverCursor="text";if(this.canvas){this.canvas.defaultCursor=this.canvas.moveCursor="text"}this.borderColor=this.editingBorderColor;this.hasControls=this.selectable=false;this.lockMovementX=this.lockMovementY=true},_updateTextarea:function(){if(!this.hiddenTextarea){return}this.hiddenTextarea.value=this.text;this.hiddenTextarea.selectionStart=this.selectionStart},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps){return}this.hoverCursor=this._savedProps.overCursor;this.hasControls=this._savedProps.hasControls;this.borderColor=this._savedProps.borderColor;this.lockMovementX=this._savedProps.lockMovementX;this.lockMovementY=this._savedProps.lockMovementY;if(this.canvas){this.canvas.defaultCursor=this._savedProps.defaultCursor;this.canvas.moveCursor=this._savedProps.moveCursor}},exitEditing:function(){this.selected=false;this.isEditing=false;this.selectable=true;this.selectionEnd=this.selectionStart;this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);this.hiddenTextarea=null;this.abortCursorAnimation();this._restoreEditingProps();this._currentCursorOpacity=0;this.fire("editing:exited");this.canvas&&this.canvas.fire("text:editing:exited",{target:this});return this},_removeExtraneousStyles:function(){var b=this.text.split(this._reNewline);for(var c in this.styles){if(!b[c]){delete this.styles[c]}}},_removeCharsFromTo:function(g,b){var e=b;while(e!==g){var d=this.get2DCursorLocation(e).charIndex;e--;var c=this.get2DCursorLocation(e).charIndex,f=c>d;if(f){this.removeStyleObject(f,e+1)}else{this.removeStyleObject(this.get2DCursorLocation(e).charIndex===0,e)}}this.text=this.text.slice(0,g)+this.text.slice(b)},insertChars:function(b){var c=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+b+this.text.slice(this.selectionEnd);if(this.selectionStart===this.selectionEnd){this.insertStyleObjects(b,c,this.copiedStyles)}this.selectionStart+=b.length;this.selectionEnd=this.selectionStart;if(this.canvas){this.canvas.renderAll().renderAll()}this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(g,f,d){this.shiftLineStyles(g,+1);if(!this.styles[g+1]){this.styles[g+1]={}}var b=this.styles[g][f-1],e={};if(d){e[0]=a(b);this.styles[g+1]=e}else{for(var c in this.styles[g]){if(parseInt(c,10)>=f){e[parseInt(c,10)-f]=this.styles[g][c];delete this.styles[g][c]}}this.styles[g+1]=e}},insertCharStyleObject:function(h,g,e){var c=this.styles[h],f=a(c);if(g===0&&!e){g=1}for(var b in f){var d=parseInt(b,10);if(d>=g){c[d+1]=f[d]}}this.styles[h][g]=e||a(c[g-1])},insertStyleObjects:function(b,d,e){if(this.isEmptyStyles()){return}var c=this.get2DCursorLocation(),g=c.lineIndex,f=c.charIndex;if(!this.styles[g]){this.styles[g]={}}if(b==="\n"){this.insertNewlineStyleObject(g,f,d)}else{if(e){this._insertStyles(e)}else{this.insertCharStyleObject(g,f)}}},_insertStyles:function(e){for(var d=0,b=e.length;d<b;d++){var c=this.get2DCursorLocation(this.selectionStart+d),g=c.lineIndex,f=c.charIndex;this.insertCharStyleObject(g,f,e[d])}},shiftLineStyles:function(f,e){var d=a(this.styles);for(var b in this.styles){var c=parseInt(b,10);if(c>f){this.styles[c+e]=d[c]}}},removeStyleObject:function(d,l){var m=this.get2DCursorLocation(l),o=m.lineIndex,b=m.charIndex;if(d){var k=this.text.split(this._reNewline),h=k[o-1],n=h?h.length:0;if(!this.styles[o-1]){this.styles[o-1]={}}for(b in this.styles[o]){this.styles[o-1][parseInt(b,10)+n]=this.styles[o][b]}this.shiftLineStyles(o,-1)}else{var j=this.styles[o];if(j){var f=this.selectionStart===this.selectionEnd?-1:0;delete j[b+f]}var c=a(j);for(var g in c){var e=parseInt(g,10);if(e>=b&&e!==0){j[e-1]=c[e];delete j[e]}}}},insertNewline:function(){this.insertChars("\n")}})})();fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date();this.__lastLastClickTime=+new Date();this.__lastPointer={};this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(a){this.__newClickTime=+new Date();var b=this.canvas.getPointer(a.e);if(this.isTripleClick(b)){this.fire("tripleclick",a);this._stopEvent(a.e)}else{if(this.isDoubleClick(b)){this.fire("dblclick",a);this._stopEvent(a.e)}}this.__lastLastClickTime=this.__lastClickTime;this.__lastClickTime=this.__newClickTime;this.__lastPointer=b;this.__lastIsEditing=this.isEditing;this.__lastSelected=this.selected},isDoubleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y&&this.__lastIsEditing},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler();this.initMousedownHandler();this.initMousemoveHandler();this.initMouseupHandler();this.initClicks()},initClicks:function(){this.on("dblclick",function(a){this.selectWord(this.getSelectionStartFromPointer(a.e))});this.on("tripleclick",function(a){this.selectLine(this.getSelectionStartFromPointer(a.e))})},initMousedownHandler:function(){this.on("mousedown",function(a){var b=this.canvas.getPointer(a.e);this.__mousedownX=b.x;this.__mousedownY=b.y;this.__isMousedown=true;if(this.hiddenTextarea&&this.canvas){this.canvas.wrapperEl.appendChild(this.hiddenTextarea)}if(this.selected){this.setCursorByClick(a.e)}if(this.isEditing){this.__selectionStartOnMouseDown=this.selectionStart;this.initDelayedCursor(true)}})},initMousemoveHandler:function(){this.on("mousemove",function(b){if(!this.__isMousedown||!this.isEditing){return}var a=this.getSelectionStartFromPointer(b.e);if(a>=this.__selectionStartOnMouseDown){this.setSelectionStart(this.__selectionStartOnMouseDown);this.setSelectionEnd(a)}else{this.setSelectionStart(a);this.setSelectionEnd(this.__selectionStartOnMouseDown)}})},_isObjectMoved:function(a){var b=this.canvas.getPointer(a);return this.__mousedownX!==b.x||this.__mousedownY!==b.y},initMouseupHandler:function(){this.on("mouseup",function(a){this.__isMousedown=false;if(this._isObjectMoved(a.e)){return}if(this.__lastSelected){this.enterEditing();this.initDelayedCursor(true)}this.selected=true})},setCursorByClick:function(b){var a=this.getSelectionStartFromPointer(b);if(b.shiftKey){if(a<this.selectionStart){this.setSelectionEnd(this.selectionStart);this.setSelectionStart(a)}else{this.setSelectionEnd(a)}}else{this.setSelectionStart(a);this.setSelectionEnd(a)}},_getLocalRotatedPointer:function(d){var f=this.canvas.getPointer(d),c=new fabric.Point(f.x,f.y),a=new fabric.Point(this.left,this.top),b=fabric.util.rotatePoint(c,a,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(d,b)},getSelectionStartFromPointer:function(n){var h=this._getLocalRotatedPointer(n),l=this.text.split(this._reNewline),p=0,b=0,r=0,a=0,c;for(var g=0,m=l.length;g<m;g++){r+=this._getHeightOfLine(this.ctx,g)*this.scaleY;var f=this._getWidthOfLine(this.ctx,g,l),k=this._getLineLeftOffset(f);b=k*this.scaleX;if(this.flipX){l[g]=l[g].split("").reverse().join("")}for(var d=0,q=l[g].length;d<q;d++){var o=l[g][d];p=b;b+=this._getWidthOfChar(this.ctx,o,g,this.flipX?q-d:d)*this.scaleX;if(r<=h.y||b<=h.x){a++;continue}return this._getNewSelectionStartFromOffset(h,p,b,a+g,q)}if(h.y<r){return this._getNewSelectionStartFromOffset(h,p,b,a+g,q,d)}}if(typeof c==="undefined"){return this.text.length}},_getNewSelectionStartFromOffset:function(e,h,a,g,k,d){var f=e.x-h,i=a-e.x,c=i>f?0:1,b=g+c;if(this.flipX){b=k-b}if(b>this.text.length){b=this.text.length}if(d===k){b--}return b}});fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea");this.hiddenTextarea.setAttribute("autocapitalize","off");this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px";fabric.document.body.appendChild(this.hiddenTextarea);fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this));fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this));fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this));fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this));if(!this._clickHandlerInitialized&&this.canvas){fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this));this._clickHandlerInitialized=true}},_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(!this.isEditing){return}if(a.keyCode in this._keysMap){this[this._keysMap[a.keyCode]](a)}else{if((a.keyCode in this._ctrlKeysMap)&&(a.ctrlKey||a.metaKey)){this[this._ctrlKeysMap[a.keyCode]](a)}else{return}}a.stopPropagation();this.canvas&&this.canvas.renderAll()},forwardDelete:function(a){if(this.selectionStart===this.selectionEnd){this.moveCursorRight(a)}this.removeChars(a)},copy:function(a){var c=this.getSelectedText(),b=this._getClipboardData(a);if(b){b.setData("text",c)}this.copiedText=c;this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(b){var a=null,c=this._getClipboardData(b);if(c){a=c.getData("text")}else{a=this.copiedText}if(a){this.insertChars(a)}},cut:function(a){if(this.selectionStart===this.selectionEnd){return}this.copy();this.removeChars(a)},_getClipboardData:function(a){return a&&(a.clipboardData||fabric.window.clipboardData)},onKeyPress:function(a){if(!this.isEditing||a.metaKey||a.ctrlKey||a.keyCode===8||a.keyCode===13){return}this.insertChars(String.fromCharCode(a.which));a.stopPropagation()},getDownCursorOffset:function(s,a){var t=a?this.selectionEnd:this.selectionStart,l=this.text.split(this._reNewline),j,k,h=this.text.slice(0,t),g=this.text.slice(t),f=h.slice(h.lastIndexOf("\n")+1),c=g.match(/(.*)\n?/)[1],b=(g.match(/.*\n(.*)\n?/)||{})[1]||"",d=this.get2DCursorLocation(t);if(d.lineIndex===l.length-1||s.metaKey){return this.text.length-t}var n=this._getWidthOfLine(this.ctx,d.lineIndex,l);k=this._getLineLeftOffset(n);var r=k,o=d.lineIndex;for(var p=0,q=f.length;p<q;p++){j=f[p];r+=this._getWidthOfChar(this.ctx,j,o,p)}var m=this._getIndexOnNextLine(d,b,r,l);return c.length+1+m},_getIndexOnNextLine:function(e,b,r,k){var p=e.lineIndex+1,o=this._getWidthOfLine(this.ctx,p,k),h=this._getLineLeftOffset(o),a=h,m=0,d;for(var q=0,l=b.length;q<l;q++){var g=b[q],n=this._getWidthOfChar(this.ctx,g,p,q);a+=n;if(a>r){d=true;var i=a-n,s=a,c=Math.abs(i-r),f=Math.abs(s-r);m=f<c?q+1:q;break}}if(!d){m=b.length}return m},moveCursorDown:function(a){this.abortCursorAnimation();this._currentCursorOpacity=1;var b=this.getDownCursorOffset(a,this._selectionDirection==="right");if(a.shiftKey){this.moveCursorDownWithShift(b)}else{this.moveCursorDownWithoutShift(b)}this.initDelayedCursor()},moveCursorDownWithoutShift:function(a){this._selectionDirection="right";this.selectionStart+=a;if(this.selectionStart>this.text.length){this.selectionStart=this.text.length}this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(a){if(this._selectionDirection==="left"&&(this.selectionStart!==this.selectionEnd)){this.selectionStart+=a;this._selectionDirection="left";return}else{this._selectionDirection="right";this.selectionEnd+=a;if(this.selectionEnd>this.text.length){this.selectionEnd=this.text.length}}},getUpCursorOffset:function(l,p){var f=p?this.selectionEnd:this.selectionStart,o=this.get2DCursorLocation(f);if(o.lineIndex===0||l.metaKey){return f}var c=this.text.slice(0,f),m=c.slice(c.lastIndexOf("\n")+1),g=(c.match(/\n?(.*)\n.*$/)||{})[1]||"",j=this.text.split(this._reNewline),q,a=this._getWidthOfLine(this.ctx,o.lineIndex,j),h=this._getLineLeftOffset(a),b=h,r=o.lineIndex;for(var d=0,k=m.length;d<k;d++){q=m[d];b+=this._getWidthOfChar(this.ctx,q,r,d)}var n=this._getIndexOnPrevLine(o,g,b,j);return g.length-n+m.length},_getIndexOnPrevLine:function(f,g,r,m){var p=f.lineIndex-1,e=this._getWidthOfLine(this.ctx,p,m),k=this._getLineLeftOffset(e),c=k,a=0,d;for(var q=0,n=g.length;q<n;q++){var i=g[q],o=this._getWidthOfChar(this.ctx,i,p,q);c+=o;if(c>r){d=true;var l=c-o,s=c,b=Math.abs(l-r),h=Math.abs(s-r);a=h<b?q:(q-1);break}}if(!d){a=g.length-1}return a},moveCursorUp:function(a){this.abortCursorAnimation();this._currentCursorOpacity=1;var b=this.getUpCursorOffset(a,this._selectionDirection==="right");if(a.shiftKey){this.moveCursorUpWithShift(b)}else{this.moveCursorUpWithoutShift(b)}this.initDelayedCursor()},moveCursorUpWithShift:function(a){if(this.selectionStart===this.selectionEnd){this.selectionStart-=a}else{if(this._selectionDirection==="right"){this.selectionEnd-=a;this._selectionDirection="right";return}else{this.selectionStart-=a}}if(this.selectionStart<0){this.selectionStart=0}this._selectionDirection="left"},moveCursorUpWithoutShift:function(a){if(this.selectionStart===this.selectionEnd){this.selectionStart-=a}if(this.selectionStart<0){this.selectionStart=0}this.selectionEnd=this.selectionStart;this._selectionDirection="left"},moveCursorLeft:function(a){if(this.selectionStart===0&&this.selectionEnd===0){return}this.abortCursorAnimation();this._currentCursorOpacity=1;if(a.shiftKey){this.moveCursorLeftWithShift(a)}else{this.moveCursorLeftWithoutShift(a)}this.initDelayedCursor()},_move:function(b,c,a){if(b.altKey){this[c]=this["findWordBoundary"+a](this[c])}else{if(b.metaKey){this[c]=this["findLineBoundary"+a](this[c])}else{this[c]+=(a==="Left"?-1:1)}}},_moveLeft:function(a,b){this._move(a,b,"Left")},_moveRight:function(a,b){this._move(a,b,"Right")},moveCursorLeftWithoutShift:function(a){this._selectionDirection="left";if(this.selectionEnd===this.selectionStart){this._moveLeft(a,"selectionStart")}this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(a){if(this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd){this._moveLeft(a,"selectionEnd")}else{this._selectionDirection="left";this._moveLeft(a,"selectionStart");if(this.text.charAt(this.selectionStart)==="\n"){this.selectionStart--}if(this.selectionStart<0){this.selectionStart=0}}},moveCursorRight:function(a){if(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length){return}this.abortCursorAnimation();this._currentCursorOpacity=1;if(a.shiftKey){this.moveCursorRightWithShift(a)}else{this.moveCursorRightWithoutShift(a)}this.initDelayedCursor()},moveCursorRightWithShift:function(a){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd){this._moveRight(a,"selectionStart")}else{this._selectionDirection="right";this._moveRight(a,"selectionEnd");if(this.text.charAt(this.selectionEnd-1)==="\n"){this.selectionEnd++}if(this.selectionEnd>this.text.length){this.selectionEnd=this.text.length}}},moveCursorRightWithoutShift:function(a){this._selectionDirection="right";if(this.selectionStart===this.selectionEnd){this._moveRight(a,"selectionStart");this.selectionEnd=this.selectionStart}else{this.selectionEnd+=this.getNumNewLinesInSelectedText();if(this.selectionEnd>this.text.length){this.selectionEnd=this.text.length}this.selectionStart=this.selectionEnd}},removeChars:function(a){if(this.selectionStart===this.selectionEnd){this._removeCharsNearCursor(a)}else{this._removeCharsFromTo(this.selectionStart,this.selectionEnd)}this.selectionEnd=this.selectionStart;this._removeExtraneousStyles();if(this.canvas){this.canvas.renderAll().renderAll()}this.setCoords();this.fire("changed");this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(d){if(this.selectionStart!==0){if(d.metaKey){var a=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(a,this.selectionStart);this.selectionStart=a}else{if(d.altKey){var c=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(c,this.selectionStart);this.selectionStart=c}else{var b=this.text.slice(this.selectionStart-1,this.selectionStart)==="\n";this.removeStyleObject(b);this.selectionStart--;this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}}});fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(a,f,e,b,d,c){if(!this.styles[f]){this.callSuper("_setSVGTextLineText",a,f,e,b,d)}else{this._setSVGTextLineChars(a,f,e,b,d,c)}},_setSVGTextLineChars:function(a,q,b,n,c,f){var p=q===0||this.useNative?"y":"dy",m=a.split(""),l=0,h=this._getSVGLineLeftOffset(q),e=this._getSVGLineTopOffset(q),d=this._getHeightOfLine(this.ctx,q);for(var g=0,j=m.length;g<j;g++){var o=this.styles[q][g]||{};b.push(this._createTextCharSpan(m[g],o,h,e,p,l));var k=this._getWidthOfChar(this.ctx,m[g],q,g);if(o.textBackgroundColor){f.push(this._createTextCharBg(o,h,e,d,k,l))}l+=k}},_getSVGLineLeftOffset:function(a){return(this._boundaries&&this._boundaries[a])?fabric.util.toFixed(this._boundaries[a].left,2):0},_getSVGLineTopOffset:function(c){var b=0;for(var a=0;a<=c;a++){b+=this._getHeightOfLine(this.ctx,a)}return b-this.height/2},_createTextCharBg:function(b,f,e,c,a,d){return['<rect fill="',b.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+c,")",'" x="',f+d,'" y="',e+c,'" width="',a,'" height="',c,'"></rect>'].join("")},_createTextCharSpan:function(b,a,g,f,e,d){var c=this.getSvgStyles.call(fabric.util.object.extend({visible:true,fill:this.fill,stroke:this.stroke,type:"text"},a));return['<tspan x="',g+d,'" ',e,'="',f,'" ',(a.fontFamily?'font-family="'+a.fontFamily.replace(/"/g,"'")+'" ':""),(a.fontSize?'font-size="'+a.fontSize+'" ':""),(a.fontStyle?'font-style="'+a.fontStyle+'" ':""),(a.fontWeight?'font-weight="'+a.fontWeight+'" ':""),(a.textDecoration?'text-decoration="'+a.textDecoration+'" ':""),'style="',c,'">',fabric.util.string.escapeXml(b),"</tspan>"].join("")}});(function(){if(typeof document!=="undefined"&&typeof window!=="undefined"){return}var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;function request(url,encoding,callback){var oURL=URL.parse(url);if(!oURL.port){oURL.port=(oURL.protocol.indexOf("https:")===0)?443:80}var reqHandler=(oURL.port===443)?HTTPS:HTTP,req=reqHandler.request({hostname:oURL.hostname,port:oURL.port,path:oURL.path,method:"GET"},function(response){var body="";if(encoding){response.setEncoding(encoding)}response.on("end",function(){callback(body)});response.on("data",function(chunk){if(response.statusCode===200){body+=chunk}})});req.on("error",function(err){if(err.errno===process.ECONNREFUSED){fabric.log("ECONNREFUSED: connection refused to "+oURL.hostname+":"+oURL.port)}else{fabric.log(err.message)}});req.end()}function requestFs(path,callback){var fs=require("fs");fs.readFile(path,function(err,data){if(err){fabric.log(err);throw err}else{callback(data)}})}fabric.util.loadImage=function(url,callback,context){function createImageAndCallBack(data){img.src=new Buffer(data,"binary");img._src=url;callback&&callback.call(context,img)}var img=new Image();if(url&&(url instanceof Buffer||url.indexOf("data")===0)){img.src=img._src=url;callback&&callback.call(context,img)}else{if(url&&url.indexOf("http")!==0){requestFs(url,createImageAndCallBack)}else{if(url){request(url,"binary",createImageAndCallBack)}else{callback&&callback.call(context,url)}}}};fabric.loadSVGFromURL=function(url,callback,reviver){url=url.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();if(url.indexOf("http")!==0){requestFs(url,function(body){fabric.loadSVGFromString(body.toString(),callback,reviver)})}else{request(url,"",function(body){fabric.loadSVGFromString(body,callback,reviver)})}};fabric.loadSVGFromString=function(string,callback,reviver){var doc=new DOMParser().parseFromString(string);fabric.parseSVGDocument(doc.documentElement,function(results,options){callback&&callback(results,options)},reviver)};fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body);callback&&callback()})};fabric.Image.fromObject=function(object,callback){fabric.util.loadImage(object.src,function(img){var oImg=new fabric.Image(img);oImg._initConfig(object);oImg._initFilters(object,function(filters){oImg.filters=filters||[];callback&&callback(oImg)})})};fabric.createCanvasForNode=function(width,height,options,nodeCanvasOptions){nodeCanvasOptions=nodeCanvasOptions||options;var canvasEl=fabric.document.createElement("canvas"),nodeCanvas=new Canvas(width||600,height||600,nodeCanvasOptions);canvasEl.style={};canvasEl.width=nodeCanvas.width;canvasEl.height=nodeCanvas.height;var FabricCanvas=fabric.Canvas||fabric.StaticCanvas,fabricCanvas=new FabricCanvas(canvasEl,options);fabricCanvas.contextContainer=nodeCanvas.getContext("2d");fabricCanvas.nodeCanvas=nodeCanvas;fabricCanvas.Font=Canvas.Font;return fabricCanvas};fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()};fabric.StaticCanvas.prototype.createJPEGStream=function(opts){return this.nodeCanvas.createJPEGStream(opts)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(width){origSetWidth.call(this,width);this.nodeCanvas.width=width;return this};if(fabric.Canvas){fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth}var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(height){origSetHeight.call(this,height);this.nodeCanvas.height=height;return this};if(fabric.Canvas){fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight}})();window.fabric=fabric;var exports=exports||{};exports.fabric=fabric;if(typeof define==="function"&&define.amd){define([],function(){return fabric})};