/*! jQuery v2.1.1 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */

/*  SHA-1 implementation in JavaScript | (c) Chris Veness 2002-2013 | www.movable-type.co.uk      */

/**
 * Downward compatible, touchable dial
 *
 * Version: 1.2.8
 * Requires: jQuery v1.7+
 *
 * Copyright (c) 2012 Anthony Terrien
 * Under MIT License (http://www.opensource.org/licenses/mit-license.php)
 *
 * Thanks to vor, eskimoblood, spiffistan, FabrizioC
 */

/*
 * popcorn.js version 1.5.6
 * http://popcornjs.org
 *
 * Copyright 2011, Mozilla Foundation
 * Licensed under the MIT license
 */

/*! Fabric.js Copyright 2008-2014, Printio (Juriy Zaytsev, Maxim Chernyak) */

/*!
* @license EaselJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2013 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/

/*!
* @license TweenJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2013 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/

// three.js / threejs.org/license

/*
 *
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * TERMS OF USE - EASING EQUATIONS
 * 
 * Open source under the BSD License. 
 * 
 * Copyright Â© 2001 Robert Penner
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without modification, 
 * are permitted provided that the following conditions are met:
 * 
 * Redistributions of source code must retain the above copyright notice, this list of 
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list 
 * of conditions and the following disclaimer in the documentation and/or other materials 
 * provided with the distribution.
 * 
 * Neither the name of the author nor the names of contributors may be used to endorse 
 * or promote products derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY 
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED 
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED 
 * OF THE POSSIBILITY OF SUCH DAMAGE. 
 *
 */

!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(a,b){function s(e){var t=e.length,r=n.type(e);return"function"===r||n.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e}function x(e,t,r){if(n.isFunction(t))return n.grep(e,function(e,n){return!!t.call(e,n,e)!==r});if(t.nodeType)return n.grep(e,function(e){return e===t!==r});if("string"==typeof t){if(w.test(t))return n.filter(t,e,r);t=n.filter(t,e)}return n.grep(e,function(e){return g.call(t,e)>=0!==r})}function D(e,t){while((e=e[t])&&1!==e.nodeType);return e}function G(e){var t=F[e]={};return n.each(e.match(E)||[],function(e,n){t[n]=!0}),t}function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+Math.random()}function P(e,t,r){var i;if(void 0===r&&1===e.nodeType)if(i="data-"+t.replace(O,"-$1").toLowerCase(),r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:N.test(r)?n.parseJSON(r):r}catch(s){}M.set(e,t,r)}else r=void 0;return r}function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(e){}}function jb(e,t){return n.nodeName(e,"table")&&n.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function kb(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function lb(e){var t=gb.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function mb(e,t){for(var n=0,r=e.length;r>n;n++)L.set(e[n],"globalEval",!t||L.get(t[n],"globalEval"))}function nb(e,t){var r,i,s,o,u,a,f,l;if(1===t.nodeType){if(L.hasData(e)&&(o=L.access(e),u=L.set(t,o),l=o.events)){delete u.handle,u.events={};for(s in l)for(r=0,i=l[s].length;i>r;r++)n.event.add(t,s,l[s][r])}M.hasData(e)&&(a=M.access(e),f=n.extend({},a),M.set(t,f))}}function ob(e,t){var r=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&n.nodeName(e,t)?n.merge([e],r):r}function pb(e,t){var n=t.nodeName.toLowerCase();"input"===n&&T.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function sb(e,t){var r,i=n(t.createElement(e)).appendTo(t.body),s=a.getDefaultComputedStyle&&(r=a.getDefaultComputedStyle(i[0]))?r.display:n.css(i[0],"display");return i.detach(),s}function tb(e){var t=l,r=rb[e];return r||(r=sb(e,t),"none"!==r&&r||(qb=(qb||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=qb[0].contentDocument,t.write(),t.close(),r=sb(e,t),qb.detach()),rb[e]=r),r}function xb(e,t,r){var i,s,o,u,a=e.style;return r=r||wb(e),r&&(u=r.getPropertyValue(t)||r[t]),r&&(""!==u||n.contains(e.ownerDocument,e)||(u=n.style(e,t)),vb.test(u)&&ub.test(t)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=r.width,a.width=i,a.minWidth=s,a.maxWidth=o)),void 0!==u?u+"":u}function yb(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function Fb(e,t){if(t in e)return t;var n=t[0].toUpperCase()+t.slice(1),r=t,i=Eb.length;while(i--)if(t=Eb[i]+n,t in e)return t;return r}function Gb(e,t,n){var r=Ab.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Hb(e,t,r,i,s){for(var o=r===(i?"border":"content")?4:"width"===t?1:0,u=0;4>o;o+=2)"margin"===r&&(u+=n.css(e,r+R[o],!0,s)),i?("content"===r&&(u-=n.css(e,"padding"+R[o],!0,s)),"margin"!==r&&(u-=n.css(e,"border"+R[o]+"Width",!0,s))):(u+=n.css(e,"padding"+R[o],!0,s),"padding"!==r&&(u+=n.css(e,"border"+R[o]+"Width",!0,s)));return u}function Ib(e,t,r){var i=!0,s="width"===t?e.offsetWidth:e.offsetHeight,o=wb(e),u="border-box"===n.css(e,"boxSizing",!1,o);if(0>=s||null==s){if(s=xb(e,t,o),(0>s||null==s)&&(s=e.style[t]),vb.test(s))return s;i=u&&(k.boxSizingReliable()||s===e.style[t]),s=parseFloat(s)||0}return s+Hb(e,t,r||(u?"border":"content"),i,o)+"px"}function Jb(e,t){for(var r,i,s,o=[],u=0,a=e.length;a>u;u++)i=e[u],i.style&&(o[u]=L.get(i,"olddisplay"),r=i.style.display,t?(o[u]||"none"!==r||(i.style.display=""),""===i.style.display&&S(i)&&(o[u]=L.access(i,"olddisplay",tb(i.nodeName)))):(s=S(i),"none"===r&&s||L.set(i,"olddisplay",s?r:n.css(i,"display"))));for(u=0;a>u;u++)i=e[u],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?o[u]||"":"none"));return e}function Kb(e,t,n,r,i){return new Kb.prototype.init(e,t,n,r,i)}function Sb(){return setTimeout(function(){Lb=void 0}),Lb=n.now()}function Tb(e,t){var n,r=0,i={height:e};for(t=t?1:0;4>r;r+=2-t)n=R[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function Ub(e,t,n){for(var r,i=(Rb[t]||[]).concat(Rb["*"]),s=0,o=i.length;o>s;s++)if(r=i[s].call(n,t,e))return r}function Vb(e,t,r){var i,s,o,u,a,f,l,c,h=this,p={},d=e.style,v=e.nodeType&&S(e),m=L.get(e,"fxshow");r.queue||(a=n._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,f=a.empty.fire,a.empty.fire=function(){a.unqueued||f()}),a.unqueued++,h.always(function(){h.always(function(){a.unqueued--,n.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(r.overflow=[d.overflow,d.overflowX,d.overflowY],l=n.css(e,"display"),c="none"===l?L.get(e,"olddisplay")||tb(e.nodeName):l,"inline"===c&&"none"===n.css(e,"float")&&(d.display="inline-block")),r.overflow&&(d.overflow="hidden",h.always(function(){d.overflow=r.overflow[0],d.overflowX=r.overflow[1],d.overflowY=r.overflow[2]}));for(i in t)if(s=t[i],Nb.exec(s)){if(delete t[i],o=o||"toggle"===s,s===(v?"hide":"show")){if("show"!==s||!m||void 0===m[i])continue;v=!0}p[i]=m&&m[i]||n.style(e,i)}else l=void 0;if(n.isEmptyObject(p))"inline"===("none"===l?tb(e.nodeName):l)&&(d.display=l);else{m?"hidden"in m&&(v=m.hidden):m=L.access(e,"fxshow",{}),o&&(m.hidden=!v),v?n(e).show():h.done(function(){n(e).hide()}),h.done(function(){var t;L.remove(e,"fxshow");for(t in p)n.style(e,t,p[t])});for(i in p)u=Ub(v?m[i]:0,i,h),i in m||(m[i]=u.start,v&&(u.end=u.start,u.start="width"===i||"height"===i?1:0))}}function Wb(e,t){var r,i,s,o,u;for(r in e)if(i=n.camelCase(r),s=t[i],o=e[r],n.isArray(o)&&(s=o[1],o=e[r]=o[0]),r!==i&&(e[i]=o,delete e[r]),u=n.cssHooks[i],u&&"expand"in u){o=u.expand(o),delete e[i];for(r in o)r in e||(e[r]=o[r],t[r]=s)}else t[i]=s}function Xb(e,t,r){var i,s,o=0,u=Qb.length,a=n.Deferred().always(function(){delete f.elem}),f=function(){if(s)return!1;for(var t=Lb||Sb(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,i=1-r,o=0,u=l.tweens.length;u>o;o++)l.tweens[o].run(i);return a.notifyWith(e,[l,i,n]),1>i&&u?n:(a.resolveWith(e,[l]),!1)},l=a.promise({elem:e,props:n.extend({},t),opts:n.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:Lb||Sb(),duration:r.duration,tweens:[],createTween:function(t,r){var i=n.Tween(e,l.opts,t,r,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(i),i},stop:function(t){var n=0,r=t?l.tweens.length:0;if(s)return this;for(s=!0;r>n;n++)l.tweens[n].run(1);return t?a.resolveWith(e,[l,t]):a.rejectWith(e,[l,t]),this}}),c=l.props;for(Wb(c,l.opts.specialEasing);u>o;o++)if(i=Qb[o].call(l,e,c,l.opts))return i;return n.map(c,Ub,l),n.isFunction(l.opts.start)&&l.opts.start.call(e,l),n.fx.timer(n.extend(f,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function rc(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var i,s=0,o=t.toLowerCase().match(E)||[];if(n.isFunction(r))while(i=o[s++])"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(r)):(e[i]=e[i]||[]).push(r)}}function sc(e,t,r,i){function u(l){var h;return s[l]=!0,n.each(e[l]||[],function(e,n){var a=n(t,r,i);return"string"!=typeof a||o||s[a]?o?!(h=a):void 0:(t.dataTypes.unshift(a),u(a),!1)}),h}var s={},o=e===oc;return u(t.dataTypes[0])||!s["*"]&&u("*")}function tc(e,t){var r,i,s=n.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((s[r]?e:i||(i={}))[r]=t[r]);return i&&n.extend(!0,e,i),e}function uc(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while("*"===a[0])a.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}return s?(s!==a[0]&&a.unshift(s),n[s]):void 0}function vc(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f)if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}return{state:"success",data:t}}function Bc(e,t,r,i){var s;if(n.isArray(t))n.each(t,function(t,n){r||xc.test(e)?i(e,n):Bc(e+"["+("object"==typeof n?t:"")+"]",n,r,i)});else if(r||"object"!==n.type(t))i(e,t);else for(s in t)Bc(e+"["+s+"]",t[s],r,i)}function Kc(e){return n.isWindow(e)?e:9===e.nodeType&&e.defaultView}var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.1",n=function(e,t){return new n.fn.init(e,t)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(e,t){return t.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:d.call(this)},pushStack:function(e){var t=n.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return n.each(this,e,t)},map:function(e){return this.pushStack(n.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var e,t,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[a]||{},a++),"object"==typeof u||n.isFunction(u)||(u={}),a===f&&(u=this,a--);f>a;a++)if(null!=(e=arguments[a]))for(t in e)r=u[t],i=e[t],u!==i&&(l&&i&&(n.isPlainObject(i)||(s=n.isArray(i)))?(s?(s=!1,o=r&&n.isArray(r)?r:[]):o=r&&n.isPlainObject(r)?r:{},u[t]=n.extend(l,o,i)):void 0!==i&&(u[t]=i));return u},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===n.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!n.isArray(e)&&e-parseFloat(e)>=0},isPlainObject:function(e){return"object"!==n.type(e)||e.nodeType||n.isWindow(e)?!1:e.constructor&&!j.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[i.call(e)]||"object":typeof e},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(e){return e.replace(p,"ms-").replace(q,r)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,u=s(e);if(n){if(u){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(u){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(o,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(s(Object(e))?n.merge(r,"string"==typeof e?[e]:e):f.call(r,e)),r},inArray:function(e,t,n){return null==t?-1:g.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;n>r;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],s=0,o=e.length,u=!n;o>s;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(t,n,r){var i,o=0,u=t.length,a=s(t),f=[];if(a)for(;u>o;o++)i=n(t[o],o,r),null!=i&&f.push(i);else for(o in t)i=n(t[o],o,r),null!=i&&f.push(i);return e.apply([],f)},guid:1,proxy:function(e,t){var r,i,s;return"string"==typeof t&&(r=e[t],t=e,e=r),n.isFunction(e)?(i=d.call(arguments,2),s=function(){return e.apply(t||this,i.concat(d.call(arguments)))},s.guid=e.guid=e.guid||n.guid++,s):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){h["[object "+t+"]"]=t.toLowerCase()});var t=function(e){function st(e,t,r,i){var s,u,f,l,c,d,g,y,S,x;if((t?t.ownerDocument||t:E)!==p&&h(t),t=t||p,r=r||[],!e||"string"!=typeof e)return r;if(1!==(l=t.nodeType)&&9!==l)return[];if(v&&!i){if(s=Z.exec(e))if(f=s[1]){if(9===l){if(u=t.getElementById(f),!u||!u.parentNode)return r;if(u.id===f)return r.push(u),r}else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&b(t,u)&&u.id===f)return r.push(u),r}else{if(s[2])return P.apply(r,t.getElementsByTagName(e)),r;if((f=s[3])&&n.getElementsByClassName&&t.getElementsByClassName)return P.apply(r,t.getElementsByClassName(f)),r}if(n.qsa&&(!m||!m.test(e))){if(y=g=w,S=t,x=9===l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){d=o(e),(g=t.getAttribute("id"))?y=g.replace(tt,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",c=d.length;while(c--)d[c]=y+mt(d[c]);S=et.test(e)&&dt(t.parentNode)||t,x=d.join(",")}if(x)try{return P.apply(r,S.querySelectorAll(x)),r}catch(T){}finally{g||t.removeAttribute("id")}}}return a(e.replace(z,"$1"),t,r,i)}function ot(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function ut(e){return e[w]=!0,e}function at(e){var t=p.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ft(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function lt(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function pt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function dt(e){return e&&typeof e.getElementsByTagName!==L&&e}function vt(){}function mt(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function gt(e,t,n){var r=t.dir,i=n&&"parentNode"===r,s=x++;return t.first?function(t,n,s){while(t=t[r])if(1===t.nodeType||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[S,s];if(o){while(t=t[r])if((1===t.nodeType||i)&&e(t,n,o))return!0}else while(t=t[r])if(1===t.nodeType||i){if(a=t[w]||(t[w]={}),(u=a[r])&&u[0]===S&&u[1]===s)return f[2]=u[2];if(a[r]=f,f[2]=e(t,n,o))return!0}}}function yt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function bt(e,t,n){for(var r=0,i=t.length;i>r;r++)st(e,t[r],n);return n}function wt(e,t,n,r,i){for(var s,o=[],u=0,a=e.length,f=null!=t;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function Et(e,t,n,r,i,s){return r&&!r[w]&&(r=Et(r)),i&&!i[w]&&(i=Et(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||bt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:wt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=wt(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=wt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function St(e){for(var t,n,i,s=e.length,o=r.relative[e[0].type],u=o||r.relative[" "],a=o?1:0,l=gt(function(e){return e===t},u,!0),c=gt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];s>a;a++)if(n=r.relative[e[a].type])h=[gt(yt(h),n)];else{if(n=r.filter[e[a].type].apply(null,e[a].matches),n[w]){for(i=++a;s>i;i++)if(r.relative[e[i].type])break;return Et(a>1&&yt(h),a>1&&mt(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(z,"$1"),n,i>a&&St(e.slice(a,i)),s>i&&St(e=e.slice(i)),s>i&&mt(e))}h.push(n)}return yt(h)}function xt(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,u,a,l){var c,h,d,v=0,m="0",g=s&&[],y=[],b=f,w=s||i&&r.find.TAG("*",l),E=S+=null==b?1:Math.random()||.1,x=w.length;for(l&&(f=o!==p&&o);m!==x&&null!=(c=w[m]);m++){if(i&&c){h=0;while(d=e[h++])if(d(c,o,u)){a.push(c);break}l&&(S=E)}n&&((c=!d&&c)&&v--,s&&g.push(c))}if(v+=m,n&&m!==v){h=0;while(d=t[h++])d(g,y,o,u);if(s){if(v>0)while(m--)g[m]||y[m]||(y[m]=_.call(a));y=wt(y)}P.apply(a,y),l&&!s&&y.length>0&&v+t.length>1&&st.uniqueSort(a)}return l&&(S=E,f=b),g};return n?ut(s):s}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w="sizzle"+ -(new Date),E=e.document,S=0,x=0,T=ot(),N=ot(),C=ot(),k=function(e,t){return e===t&&(c=!0),0},L="undefined",A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",q=I.replace("w","w#"),R="\\["+F+"*("+I+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+q+"))|)"+F+"*\\]",U=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+R+")*)|.*)\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp("="+F+"*([^\\]'\"]*?)"+F+"*\\]","g"),$=new RegExp(U),J=new RegExp("^"+q+"$"),K={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/[+~]/,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)};try{P.apply(M=H.call(E.childNodes),E.childNodes),M[E.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=st.support={},s=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},h=st.setDocument=function(e){var t,i=e?e.ownerDocument||e:E,o=i.defaultView;return i!==p&&9===i.nodeType&&i.documentElement?(p=i,d=i.documentElement,v=!s(i),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",function(){h()},!1):o.attachEvent&&o.attachEvent("onunload",function(){h()})),n.attributes=at(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=at(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Y.test(i.getElementsByClassName)&&at(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),n.getById=at(function(e){return d.appendChild(e).id=w,!i.getElementsByName||!i.getElementsByName(w).length}),n.getById?(r.find.ID=function(e,t){if(typeof t.getElementById!==L&&v){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==L?t.getElementsByTagName(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==L&&v?t.getElementsByClassName(e):void 0},g=[],m=[],(n.qsa=Y.test(i.querySelectorAll))&&(at(function(e){e.innerHTML="<select msallowclip=''><option selected=''></option></select>",e.querySelectorAll("[msallowclip^='']").length&&m.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||m.push(":checked")}),at(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+F+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(n.matchesSelector=Y.test(y=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&at(function(e){n.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),g.push("!=",U)}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Y.test(d.compareDocumentPosition),b=t||Y.test(d.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=t?function(e,t){if(e===t)return c=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===E&&b(E,e)?-1:t===i||t.ownerDocument===E&&b(E,t)?1:l?B.call(l,e)-B.call(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return c=!0,0;var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:l?B.call(l,e)-B.call(l,t):0;if(s===o)return lt(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)a.unshift(n);while(u[r]===a[r])r++;return r?lt(u[r],a[r]):u[r]===E?-1:a[r]===E?1:0},i):p},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&h(e),t=t.replace(V,"='$1']"),!(!n.matchesSelector||!v||g&&g.test(t)||m&&m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return st(t,p,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==p&&h(e),b(e,t)},st.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var i=r.attrHandle[t.toLowerCase()],s=i&&O.call(r.attrHandle,t.toLowerCase())?i(e,t,!v):void 0;return void 0!==s?s:n.attributes||!v?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,r=[],i=0,s=0;if(c=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(k),c){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return l=null,e},i=st.getText=function(e){var t,n="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===s||4===s)return e.nodeValue}else while(t=e[r++])n+=i(t);return n},r=st.selectors={cacheLength:50,createPseudo:ut,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[3]||e[4]||e[5]||"").replace(nt,rt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&$.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&T(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[S,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[w]||(c[w]={}))[e]=[S,h]),c===t))break;return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return i[w]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=B.call(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:ut(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[w]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ut(function(e){return function(t){return st(e,t).length>0}}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:ut(function(e){return J.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[0>n?n+t:n]}),even:pt(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:pt(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ct(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=ht(t);return vt.prototype=r.filters=r.pseudos,r.setFilters=new vt,o=st.tokenize=function(e,t){var n,i,s,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){(!n||(i=W.exec(u)))&&(i&&(u=u.slice(i[0].length)||u),a.push(s=[])),n=!1,(i=X.exec(u))&&(n=i.shift(),s.push({value:n,type:i[0].replace(z," ")}),u=u.slice(n.length));for(o in r.filter)!(i=K[o].exec(u))||f[o]&&!(i=f[o](i))||(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?st.error(e):N(e,a).slice(0)},u=st.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=o(e)),n=t.length;while(n--)s=St(t[n]),s[w]?r.push(s):i.push(s);s=C(e,xt(i,r)),s.selector=e}return s},a=st.select=function(e,t,i,s){var a,f,l,c,h,p="function"==typeof e&&e,d=!s&&o(e=p.selector||e);if(i=i||[],1===d.length){if(f=d[0]=d[0].slice(0),f.length>2&&"ID"===(l=f[0]).type&&n.getById&&9===t.nodeType&&v&&r.relative[f[1].type]){if(t=(r.find.ID(l.matches[0].replace(nt,rt),t)||[])[0],!t)return i;p&&(t=t.parentNode),e=e.slice(f.shift().value.length)}a=K.needsContext.test(e)?0:f.length;while(a--){if(l=f[a],r.relative[c=l.type])break;if((h=r.find[c])&&(s=h(l.matches[0].replace(nt,rt),et.test(f[0].type)&&dt(t.parentNode)||t))){if(f.splice(a,1),e=s.length&&mt(f),!e)return P.apply(i,s),i;break}}}return(p||u(e,d))(s,t,!v,i,et.test(e)&&dt(t.parentNode)||t),i},n.sortStable=w.split("").sort(k).join("")===w,n.detectDuplicates=!!c,h(),n.sortDetached=at(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))}),at(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||ft("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&at(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||ft("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),at(function(e){return null==e.getAttribute("disabled")})||ft(j,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),st}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;n.filter=function(e,t,r){var i=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?n.find.matchesSelector(i,e)?[i]:[]:n.find.matches(e,n.grep(t,function(e){return 1===e.nodeType}))},n.fn.extend({find:function(e){var t,r=this.length,i=[],s=this;if("string"!=typeof e)return this.pushStack(n(e).filter(function(){for(t=0;r>t;t++)if(n.contains(s[t],this))return!0}));for(t=0;r>t;t++)n.find(e,s[t],i);return i=this.pushStack(r>1?n.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(x(this,e||[],!1))},not:function(e){return this.pushStack(x(this,e||[],!0))},is:function(e){return!!x(this,"string"==typeof e&&u.test(e)?n(e):e||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(e,t){var r,i;if(!e)return this;if("string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:z.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||y).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof n?t[0]:t,n.merge(this,n.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:l,!0)),v.test(r[1])&&n.isPlainObject(t))for(r in t)n.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=l.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=l,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):n.isFunction(e)?"undefined"!=typeof y.ready?y.ready(e):e(n):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),n.makeArray(e,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(e,t,r){var i=[],s=void 0!==r;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(s&&n(e).is(r))break;i.push(e)}return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),n.fn.extend({has:function(e){var t=n(e,this),r=t.length;return this.filter(function(){for(var e=0;r>e;e++)if(n.contains(this,t[e]))return!0})},closest:function(e,t){for(var r,i=0,s=this.length,o=[],a=u.test(e)||"string"!=typeof e?n(e,t||this.context):0;s>i;i++)for(r=this[i];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(a?a.index(r)>-1:1===r.nodeType&&n.find.matchesSelector(r,e))){o.push(r);break}return this.pushStack(o.length>1?n.unique(o):o)},index:function(e){return e?"string"==typeof e?g.call(n(e),this[0]):g.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(n.unique(n.merge(this.get(),n(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),n.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return n.dir(e,"parentNode")},parentsUntil:function(e,t,r){return n.dir(e,"parentNode",r)},next:function(e){return D(e,"nextSibling")},prev:function(e){return D(e,"previousSibling")},nextAll:function(e){return n.dir(e,"nextSibling")},prevAll:function(e){return n.dir(e,"previousSibling")},nextUntil:function(e,t,r){return n.dir(e,"nextSibling",r)},prevUntil:function(e,t,r){return n.dir(e,"previousSibling",r)},siblings:function(e){return n.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return n.sibling(e.firstChild)},contents:function(e){return e.contentDocument||n.merge([],e.childNodes)}},function(e,t){n.fn[e]=function(r,i){var s=n.map(this,t,r);return"Until"!==e.slice(-5)&&(i=r),i&&"string"==typeof i&&(s=n.filter(i,s)),this.length>1&&(C[e]||n.unique(s),B.test(e)&&s.reverse()),this.pushStack(s)}});var E=/\S+/g,F={};n.Callbacks=function(e){e="string"==typeof e?F[e]||G(e):n.extend({},e);var t,r,i,s,o,u,a=[],f=!e.once&&[],l=function(n){for(t=e.memory&&n,r=!0,u=s||0,s=0,o=a.length,i=!0;a&&o>u;u++)if(a[u].apply(n[0],n[1])===!1&&e.stopOnFalse){t=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):t?a=[]:c.disable())},c={add:function(){if(a){var r=a.length;!function u(t){n.each(t,function(t,r){var i=n.type(r);"function"===i?e.unique&&c.has(r)||a.push(r):r&&r.length&&"string"!==i&&u(r)})}(arguments),i?o=a.length:t&&(s=r,l(t))}return this},remove:function(){return a&&n.each(arguments,function(e,t){var r;while((r=n.inArray(t,a,r))>-1)a.splice(r,1),i&&(o>=r&&o--,u>=r&&u--)}),this},has:function(e){return e?n.inArray(e,a)>-1:!!a&&!!a.length},empty:function(){return a=[],o=0,this},disable:function(){return a=f=t=void 0,this},disabled:function(){return!a},lock:function(){return f=void 0,t||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return!a||r&&!f||(t=t||[],t=[e,t.slice?t.slice():t],i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},n.extend({Deferred:function(e){var t=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],r="pending",i={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var e=arguments;return n.Deferred(function(r){n.each(t,function(t,o){var u=n.isFunction(e[t])&&e[t];s[o[1]](function(){var e=u&&u.apply(this,arguments);e&&n.isFunction(e.promise)?e.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[o[0]+"With"](this===i?r.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?n.extend(e,i):i}},s={};return i.pipe=i.then,n.each(t,function(e,n){var o=n[2],u=n[3];i[n[1]]=o.add,u&&o.add(function(){r=u},t[1^e][2].disable,t[2][2].lock),s[n[0]]=function(){return s[n[0]+"With"](this===s?i:this,arguments),this},s[n[0]+"With"]=o.fireWith}),i.promise(s),e&&e.call(s,s),s},when:function(e){var t=0,r=d.call(arguments),i=r.length,s=1!==i||e&&n.isFunction(e.promise)?i:0,o=1===s?e:n.Deferred(),u=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1)for(a=new Array(i),f=new Array(i),l=new Array(i);i>t;t++)r[t]&&n.isFunction(r[t].promise)?r[t].promise().done(u(t,l,r)).fail(o.reject).progress(u(t,f,a)):--s;return s||o.resolveWith(l,r),o.promise()}});var H;n.fn.ready=function(e){return n.ready.promise().done(e),this},n.extend({isReady:!1,readyWait:1,holdReady:function(e){e?n.readyWait++:n.ready(!0)},ready:function(e){(e===!0?--n.readyWait:n.isReady)||(n.isReady=!0,e!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}}),n.ready.promise=function(e){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(e)},n.ready.promise();var J=n.access=function(e,t,r,i,s,o,u){var a=0,f=e.length,l=null==r;if("object"===n.type(r)){s=!0;for(a in r)n.access(e,t,a,r[a],!0,o,u)}else if(void 0!==i&&(s=!0,n.isFunction(i)||(u=!0),l&&(u?(t.call(e,i),t=null):(l=t,t=function(e,t,r){return l.call(n(e),r)})),t))for(;f>a;a++)t(e[a],r,u?i:i.call(e[a],a,t(e[a],r)));return s?e:l?t.call(e):f?t(e[0],r):o};n.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(e){if(!K.accepts(e))return 0;var t={},r=e[this.expando];if(!r){r=K.uid++;try{t[this.expando]={value:r},Object.defineProperties(e,t)}catch(i){t[this.expando]=r,n.extend(e,t)}}return this.cache[r]||(this.cache[r]={}),r},set:function(e,t,r){var i,s=this.key(e),o=this.cache[s];if("string"==typeof t)o[t]=r;else if(n.isEmptyObject(o))n.extend(this.cache[s],t);else for(i in t)o[i]=t[i];return o},get:function(e,t){var n=this.cache[this.key(e)];return void 0===t?n:n[t]},access:function(e,t,r){var i;return void 0===t||t&&"string"==typeof t&&void 0===r?(i=this.get(e,t),void 0!==i?i:this.get(e,n.camelCase(t))):(this.set(e,t,r),void 0!==r?r:t)},remove:function(e,t){var r,i,s,o=this.key(e),u=this.cache[o];if(void 0===t)this.cache[o]={};else{n.isArray(t)?i=t.concat(t.map(n.camelCase)):(s=n.camelCase(t),t in u?i=[t,s]:(i=s,i=i in u?[i]:i.match(E)||[])),r=i.length;while(r--)delete u[i[r]]}},hasData:function(e){return!n.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;n.extend({hasData:function(e){return M.hasData(e)||L.hasData(e)},data:function(e,t,n){return M.access(e,t,n)},removeData:function(e,t){M.remove(e,t)},_data:function(e,t,n){return L.access(e,t,n)},_removeData:function(e,t){L.remove(e,t)}}),n.fn.extend({data:function(e,t){var r,i,s,o=this[0],u=o&&o.attributes;if(void 0===e){if(this.length&&(s=M.get(o),1===o.nodeType&&!L.get(o,"hasDataAttrs"))){r=u.length;while(r--)u[r]&&(i=u[r].name,0===i.indexOf("data-")&&(i=n.camelCase(i.slice(5)),P(o,i,s[i])));L.set(o,"hasDataAttrs",!0)}return s}return"object"==typeof e?this.each(function(){M.set(this,e)}):J(this,function(t){var r,i=n.camelCase(e);if(o&&void 0===t){if(r=M.get(o,e),void 0!==r)return r;if(r=M.get(o,i),void 0!==r)return r;if(r=P(o,i,void 0),void 0!==r)return r}else this.each(function(){var n=M.get(this,i);M.set(this,i,t),-1!==e.indexOf("-")&&void 0!==n&&M.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){M.remove(this,e)})}}),n.extend({queue:function(e,t,r){var i;return e?(t=(t||"fx")+"queue",i=L.get(e,t),r&&(!i||n.isArray(r)?i=L.access(e,t,n.makeArray(r)):i.push(r)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var r=n.queue(e,t),i=r.length,s=r.shift(),o=n._queueHooks(e,t),u=function(){n.dequeue(e,t)};"inprogress"===s&&(s=r.shift(),i--),s&&("fx"===t&&r.unshift("inprogress"),delete o.stop,s.call(e,u,o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return L.get(e,r)||L.access(e,r,{empty:n.Callbacks("once memory").add(function(){L.remove(e,[t+"queue",r])})})}}),n.fn.extend({queue:function(e,t){var r=2;return"string"!=typeof e&&(t=e,e="fx",r--),arguments.length<r?n.queue(this[0],e):void 0===t?this:this.each(function(){var r=n.queue(this,e,t);n._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&n.dequeue(this,e)})},dequeue:function(e){return this.each(function(){n.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var r,i=1,s=n.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(u--)r=L.get(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(t)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(e,t){return e=t||e,"none"===n.css(e,"display")||!n.contains(e.ownerDocument,e)},T=/^(?:checkbox|radio)$/i;!function(){var e=l.createDocumentFragment(),t=e.appendChild(l.createElement("div")),n=l.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),k.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;n.event={global:{},add:function(e,t,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=L.get(e);if(g){r.handler&&(o=r,r=o.handler,s=o.selector),r.guid||(r.guid=n.guid++),(f=g.events)||(f=g.events={}),(u=g.handle)||(u=g.handle=function(t){return typeof n!==U&&n.event.triggered!==t.type?n.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(E)||[""],l=t.length;while(l--)a=Y.exec(t[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),d&&(h=n.event.special[d]||{},d=(s?h.delegateType:h.bindType)||d,h=n.event.special[d]||{},c=n.extend({type:d,origType:m,data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&n.expr.match.needsContext.test(s),namespace:v.join(".")},o),(p=f[d])||(p=f[d]=[],p.delegateCount=0,h.setup&&h.setup.call(e,i,v,u)!==!1||e.addEventListener&&e.addEventListener(d,u,!1)),h.add&&(h.add.call(e,c),c.handler.guid||(c.handler.guid=r.guid)),s?p.splice(p.delegateCount++,0,c):p.push(c),n.event.global[d]=!0)}},remove:function(e,t,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=L.hasData(e)&&L.get(e);if(g&&(f=g.events)){t=(t||"").match(E)||[""],l=t.length;while(l--)if(a=Y.exec(t[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),d){h=n.event.special[d]||{},d=(i?h.delegateType:h.bindType)||d,p=f[d]||[],a=a[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=p.length;while(o--)c=p[o],!s&&m!==c.origType||r&&r.guid!==c.guid||a&&!a.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,h.remove&&h.remove.call(e,c));u&&!p.length&&(h.teardown&&h.teardown.call(e,v,g.handle)!==!1||n.removeEvent(e,d,g.handle),delete f[d])}else for(d in f)n.event.remove(e,d+t[l],r,i,!0);n.isEmptyObject(f)&&(delete g.handle,L.remove(e,"events"))}},trigger:function(e,t,r,i){var s,o,u,f,c,h,p,d=[r||l],v=j.call(e,"type")?e.type:e,m=j.call(e,"namespace")?e.namespace.split("."):[];if(o=u=r=r||l,3!==r.nodeType&&8!==r.nodeType&&!X.test(v+n.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),c=v.indexOf(":")<0&&"on"+v,e=e[n.expando]?e:new n.Event(v,"object"==typeof e&&e),e.isTrigger=i?2:3,e.namespace=m.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:n.makeArray(t,[e]),p=n.event.special[v]||{},i||!p.trigger||p.trigger.apply(r,t)!==!1)){if(!i&&!p.noBubble&&!n.isWindow(r)){for(f=p.delegateType||v,X.test(f+v)||(o=o.parentNode);o;o=o.parentNode)d.push(o),u=o;u===(r.ownerDocument||l)&&d.push(u.defaultView||u.parentWindow||a)}s=0;while((o=d[s++])&&!e.isPropagationStopped())e.type=s>1?f:p.bindType||v,h=(L.get(o,"events")||{})[e.type]&&L.get(o,"handle"),h&&h.apply(o,t),h=c&&o[c],h&&h.apply&&n.acceptData(o)&&(e.result=h.apply(o,t),e.result===!1&&e.preventDefault());return e.type=v,i||e.isDefaultPrevented()||p._default&&p._default.apply(d.pop(),t)!==!1||!n.acceptData(r)||c&&n.isFunction(r[v])&&!n.isWindow(r)&&(u=r[c],u&&(r[c]=null),n.event.triggered=v,r[v](),n.event.triggered=void 0,u&&(r[c]=u)),e.result}},dispatch:function(e){e=n.event.fix(e);var t,r,i,s,o,u=[],a=d.call(arguments),f=(L.get(this,"events")||{})[e.type]||[],l=n.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=n.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,r=0;while((o=s.handlers[r++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,i=((n.event.special[o.origType]||{}).handle||o.handler).apply(s.elem,a),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var r,i,s,o,u=[],a=t.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||"click"!==e.type))for(;f!==this;f=f.parentNode||this)if(f.disabled!==!0||"click"!==e.type){for(i=[],r=0;a>r;r++)o=t[r],s=o.selector+" ",void 0===i[s]&&(i[s]=o.needsContext?n(s,this).index(f)>=0:n.find(s,this,null,[f]).length),i[s]&&i.push(o);i.length&&u.push({elem:f,handlers:i})}return a<t.length&&u.push({elem:this,handlers:t.slice(a)}),u},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||l,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e}},fix:function(e){if(e[n.expando])return e;var t,r,i,s=e.type,o=e,u=this.fixHooks[s];u||(this.fixHooks[s]=u=W.test(s)?this.mouseHooks:V.test(s)?this.keyHooks:{}),i=u.props?this.props.concat(u.props):this.props,e=new n.Event(o),t=i.length;while(t--)r=i[t],e[r]=o[r];return e.target||(e.target=l),3===e.target.nodeType&&(e.target=e.target.parentNode),u.filter?u.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return n.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,r,i){var s=n.extend(new n.Event,r,{type:e,isSimulated:!0,originalEvent:{}});i?n.event.trigger(s,null,t):n.event.dispatch.call(t,s),s.isDefaultPrevented()&&r.preventDefault()}},n.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},n.Event=function(e,t){return this instanceof n.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?Z:$):this.type=e,t&&n.extend(this,t),this.timeStamp=e&&e.timeStamp||n.now(),void (this[n.expando]=!0)):new n.Event(e,t)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Z,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Z,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Z,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){n.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,i=this,s=e.relatedTarget,o=e.handleObj;return(!s||s!==i&&!n.contains(i,s))&&(e.type=o.origType,r=o.handler.apply(this,arguments),e.type=t),r}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(e,t){var r=function(e){n.event.simulate(t,e.target,n.event.fix(e),!0)};n.event.special[t]={setup:function(){var n=this.ownerDocument||this,i=L.access(n,t);i||n.addEventListener(e,r,!0),L.access(n,t,(i||0)+1)},teardown:function(){var n=this.ownerDocument||this,i=L.access(n,t)-1;i?L.access(n,t,i):(n.removeEventListener(e,r,!0),L.remove(n,t))}}}),n.fn.extend({on:function(e,t,r,i,s){var o,u;if("object"==typeof e){"string"!=typeof t&&(r=r||t,t=void 0);for(u in e)this.on(u,t,r,e[u],s);return this}if(null==r&&null==i?(i=t,r=t=void 0):null==i&&("string"==typeof t?(i=r,r=void 0):(i=r,r=t,t=void 0)),i===!1)i=$;else if(!i)return this;return 1===s&&(o=i,i=function(e){return n().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=n.guid++)),this.each(function(){n.event.add(this,e,i,r,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,n(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(s in e)this.off(s,t,e[s]);return this}return(t===!1||"function"==typeof t)&&(r=t,t=void 0),r===!1&&(r=$),this.each(function(){n.event.remove(this,e,r,t)})},trigger:function(e,t){return this.each(function(){n.event.trigger(e,t,this)})},triggerHandler:function(e,t){var r=this[0];return r?n.event.trigger(e,t,r,!0):void 0}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td,n.extend({clone:function(e,t,r){var i,s,o,u,a=e.cloneNode(!0),f=n.contains(e.ownerDocument,e);if(!(k.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||n.isXMLDoc(e)))for(u=ob(a),o=ob(e),i=0,s=o.length;s>i;i++)pb(o[i],u[i]);if(t)if(r)for(o=o||ob(e),u=u||ob(a),i=0,s=o.length;s>i;i++)nb(o[i],u[i]);else nb(e,a);return u=ob(a,"script"),u.length>0&&mb(u,!f&&ob(e,"script")),a},buildFragment:function(e,t,r,i){for(var s,o,u,a,f,l,c=t.createDocumentFragment(),h=[],p=0,d=e.length;d>p;p++)if(s=e[p],s||0===s)if("object"===n.type(s))n.merge(h,s.nodeType?[s]:s);else if(cb.test(s)){o=o||c.appendChild(t.createElement("div")),u=(bb.exec(s)||["",""])[1].toLowerCase(),a=ib[u]||ib._default,o.innerHTML=a[1]+s.replace(ab,"<$1></$2>")+a[2],l=a[0];while(l--)o=o.lastChild;n.merge(h,o.childNodes),o=c.firstChild,o.textContent=""}else h.push(t.createTextNode(s));c.textContent="",p=0;while(s=h[p++])if((!i||-1===n.inArray(s,i))&&(f=n.contains(s.ownerDocument,s),o=ob(c.appendChild(s),"script"),f&&mb(o),r)){l=0;while(s=o[l++])fb.test(s.type||"")&&r.push(s)}return c},cleanData:function(e){for(var t,r,i,s,o=n.event.special,u=0;void 0!==(r=e[u]);u++){if(n.acceptData(r)&&(s=r[L.expando],s&&(t=L.cache[s]))){if(t.events)for(i in t.events)o[i]?n.event.remove(r,i):n.removeEvent(r,i,t.handle);L.cache[s]&&delete L.cache[s]}delete M.cache[r[M.expando]]}}}),n.fn.extend({text:function(e){return J(this,function(e){return void 0===e?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=jb(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=jb(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var r,i=e?n.filter(e,this):this,s=0;null!=(r=i[s]);s++)t||1!==r.nodeType||n.cleanData(ob(r)),r.parentNode&&(t&&n.contains(r.ownerDocument,r)&&mb(ob(r,"script")),r.parentNode.removeChild(r));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(n.cleanData(ob(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return n.clone(this,e,t)})},html:function(e){return J(this,function(e){var t=this[0]||{},r=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!db.test(e)&&!ib[(bb.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(ab,"<$1></$2>");try{for(;i>r;r++)t=this[r]||{},1===t.nodeType&&(n.cleanData(ob(t,!1)),t.innerHTML=e);t=0}catch(s){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,n.cleanData(ob(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(t,r){t=e.apply([],t);var i,s,o,u,a,f,l=0,c=this.length,h=this,p=c-1,d=t[0],v=n.isFunction(d);if(v||c>1&&"string"==typeof d&&!k.checkClone&&eb.test(d))return this.each(function(e){var n=h.eq(e);v&&(t[0]=d.call(this,e,n.html())),n.domManip(t,r)});if(c&&(i=n.buildFragment(t,this[0].ownerDocument,!1,this),s=i.firstChild,1===i.childNodes.length&&(i=s),s)){for(o=n.map(ob(i,"script"),kb),u=o.length;c>l;l++)a=i,l!==p&&(a=n.clone(a,!0,!0),u&&n.merge(o,ob(a,"script"))),r.call(this[l],a,l);if(u)for(f=o[o.length-1].ownerDocument,n.map(o,lb),l=0;u>l;l++)a=o[l],fb.test(a.type||"")&&!L.access(a,"globalEval")&&n.contains(f,a)&&(a.src?n._evalUrl&&n._evalUrl(a.src):n.globalEval(a.textContent.replace(hb,"")))}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){n.fn[e]=function(e){for(var r,i=[],s=n(e),o=s.length-1,u=0;o>=u;u++)r=u===o?this:this.clone(!0),n(s[u])[t](r),f.apply(i,r.get());return this.pushStack(i)}});var qb,rb={},ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)};!function(){var e,t,r=l.documentElement,i=l.createElement("div"),s=l.createElement("div");if(s.style){s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===s.style.backgroundClip,i.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",i.appendChild(s);function o(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",r.appendChild(i);var n=a.getComputedStyle(s,null);e="1%"!==n.top,t="4px"===n.width,r.removeChild(i)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return o(),e},boxSizingReliable:function(){return null==t&&o(),t},reliableMarginRight:function(){var e,t=s.appendChild(l.createElement("div"));return t.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",t.style.marginRight=t.style.width="0",s.style.width="1px",r.appendChild(i),e=!parseFloat(a.getComputedStyle(t,null).marginRight),r.removeChild(i),e}})}}(),n.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:"0",fontWeight:"400"},Eb=["Webkit","O","Moz","ms"];n.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=xb(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,u,a=n.camelCase(t),f=e.style;return t=n.cssProps[a]||(n.cssProps[a]=Fb(f,a)),u=n.cssHooks[t]||n.cssHooks[a],void 0===r?u&&"get"in u&&void 0!==(s=u.get(e,!1,i))?s:f[t]:(o=typeof r,"string"===o&&(s=Bb.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(n.css(e,t)),o="number"),null!=r&&r===r&&("number"!==o||n.cssNumber[a]||(r+="px"),k.clearCloneStyle||""!==r||0!==t.indexOf("background")||(f[t]="inherit"),u&&"set"in u&&void 0===(r=u.set(e,r,i))||(f[t]=r)),void 0)}},css:function(e,t,r,i){var s,o,u,a=n.camelCase(t);return t=n.cssProps[a]||(n.cssProps[a]=Fb(e.style,a)),u=n.cssHooks[t]||n.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,r)),void 0===s&&(s=xb(e,t,i)),"normal"===s&&t in Db&&(s=Db[t]),""===r||r?(o=parseFloat(s),r===!0||n.isNumeric(o)?o||0:s):s}}),n.each(["height","width"],function(e,t){n.cssHooks[t]={get:function(e,r,i){return r?zb.test(n.css(e,"display"))&&0===e.offsetWidth?n.swap(e,Cb,function(){return Ib(e,t,i)}):Ib(e,t,i):void 0},set:function(e,r,i){var s=i&&wb(e);return Gb(e,r,i?Hb(e,t,i,"border-box"===n.css(e,"boxSizing",!1,s),s):0)}}}),n.cssHooks.marginRight=yb(k.reliableMarginRight,function(e,t){return t?n.swap(e,{display:"inline-block"},xb,[e,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(e,t){n.cssHooks[e+t]={expand:function(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+R[r]+t]=s[r]||s[r-2]||s[0];return i}},ub.test(e)||(n.cssHooks[e+t].set=Gb)}),n.fn.extend({css:function(e,t){return J(this,function(e,t,r){var i,s,o={},u=0;if(n.isArray(t)){for(i=wb(e),s=t.length;s>u;u++)o[t[u]]=n.css(e,t[u],!1,i);return o}return void 0!==r?n.style(e,t,r):n.css(e,t)},e,t,arguments.length>1)},show:function(){return Jb(this,!0)},hide:function(){return Jb(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}}),n.Tween=Kb,Kb.prototype={constructor:Kb,init:function(e,t,r,i,s,o){this.elem=e,this.prop=r,this.easing=s||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(n.cssNumber[r]?"":"px")},cur:function(){var e=Kb.propHooks[this.prop];return e&&e.get?e.get(this):Kb.propHooks._default.get(this)},run:function(e){var t,r=Kb.propHooks[this.prop];return this.pos=t=this.options.duration?n.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):Kb.propHooks._default.set(this),this}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=n.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){n.fx.step[e.prop]?n.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[n.cssProps[e.prop]]||n.cssHooks[e.prop])?n.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},n.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},n.fx=Kb.prototype.init,n.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(e,t){var r=this.createTween(e,t),i=r.cur(),s=Ob.exec(t),o=s&&s[3]||(n.cssNumber[e]?"":"px"),u=(n.cssNumber[e]||"px"!==o&&+i)&&Ob.exec(n.css(r.elem,e)),a=1,f=20;if(u&&u[3]!==o){o=o||u[3],s=s||[],u=+i||1;do a=a||".5",u/=a,n.style(r.elem,e,u+o);while(a!==(a=r.cur()/i)&&1!==a&&--f)}return s&&(u=r.start=+u||+i||0,r.unit=o,r.end=s[1]?u+(s[1]+1)*s[2]:+s[2]),r}]};n.Animation=n.extend(Xb,{tweener:function(e,t){n.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var r,i=0,s=e.length;s>i;i++)r=e[i],Rb[r]=Rb[r]||[],Rb[r].unshift(t)},prefilter:function(e,t){t?Qb.unshift(e):Qb.push(e)}}),n.speed=function(e,t,r){var i=e&&"object"==typeof e?n.extend({},e):{complete:r||!r&&t||n.isFunction(e)&&e,duration:e,easing:r&&t||t&&!n.isFunction(t)&&t};return i.duration=n.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in n.fx.speeds?n.fx.speeds[i.duration]:n.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){n.isFunction(i.old)&&i.old.call(this),i.queue&&n.dequeue(this,i.queue)},i},n.fn.extend({fadeTo:function(e,t,n,r){return this.filter(S).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,r,i){var s=n.isEmptyObject(e),o=n.speed(t,r,i),u=function(){var t=Xb(this,n.extend({},e),o);(s||L.get(this,"finish"))&&t.stop(!0)};return u.finish=u,s||o.queue===!1?this.each(u):this.queue(o.queue,u)},stop:function(e,t,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,s=null!=e&&e+"queueHooks",o=n.timers,u=L.get(this);if(s)u[s]&&u[s].stop&&i(u[s]);else for(s in u)u[s]&&u[s].stop&&Pb.test(s)&&i(u[s]);for(s=o.length;s--;)o[s].elem!==this||null!=e&&o[s].queue!==e||(o[s].anim.stop(r),t=!1,o.splice(s,1));(t||!r)&&n.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,r=L.get(this),i=r[e+"queue"],s=r[e+"queueHooks"],o=n.timers,u=i?i.length:0;for(r.finish=!0,n.queue(this,e,[]),s&&s.stop&&s.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;u>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete r.finish})}}),n.each(["toggle","show","hide"],function(e,t){var r=n.fn[t];n.fn[t]=function(e,n,i){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(Tb(t,!0),e,n,i)}}),n.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){n.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),n.timers=[],n.fx.tick=function(){var e,t=0,r=n.timers;for(Lb=n.now();t<r.length;t++)e=r[t],e()||r[t]!==e||r.splice(t--,1);r.length||n.fx.stop(),Lb=void 0},n.fx.timer=function(e){n.timers.push(e),e()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Mb||(Mb=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Mb),Mb=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(e,t){return e=n.fx?n.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e=l.createElement("input"),t=l.createElement("select"),n=t.appendChild(l.createElement("option"));e.type="checkbox",k.checkOn=""!==e.value,k.optSelected=n.selected,t.disabled=!0,k.optDisabled=!n.disabled,e=l.createElement("input"),e.value="t",e.type="radio",k.radioValue="t"===e.value}();var Yb,Zb,$b=n.expr.attrHandle;n.fn.extend({attr:function(e,t){return J(this,n.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){n.removeAttr(this,e)})}}),n.extend({attr:function(e,t,r){var i,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===U?n.prop(e,t,r):(1===o&&n.isXMLDoc(e)||(t=t.toLowerCase(),i=n.attrHooks[t]||(n.expr.match.bool.test(t)?Zb:Yb)),void 0===r?i&&"get"in i&&null!==(s=i.get(e,t))?s:(s=n.find.attr(e,t),null==s?void 0:s):null!==r?i&&"set"in i&&void 0!==(s=i.set(e,r,t))?s:(e.setAttribute(t,r+""),r):void n.removeAttr(e,t))},removeAttr:function(e,t){var r,i,s=0,o=t&&t.match(E);if(o&&1===e.nodeType)while(r=o[s++])i=n.propFix[r]||r,n.expr.match.bool.test(r)&&(e[i]=!1),e.removeAttribute(r)},attrHooks:{type:{set:function(e,t){if(!k.radioValue&&"radio"===t&&n.nodeName(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}}}}),Zb={set:function(e,t,r){return t===!1?n.removeAttr(e,r):e.setAttribute(r,r),r}},n.each(n.expr.match.bool.source.match(/\w+/g),function(e,t){var r=$b[t]||n.find.attr;$b[t]=function(e,t,n){var i,s;return n||(s=$b[t],$b[t]=i,i=null!=r(e,t,n)?t.toLowerCase():null,$b[t]=s),i}});var _b=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(e,t){return J(this,n.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[n.propFix[e]||e]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,r){var i,s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return o=1!==u||!n.isXMLDoc(e),o&&(t=n.propFix[t]||t,s=n.propHooks[t]),void 0!==r?s&&"set"in s&&void 0!==(i=s.set(e,r,t))?i:e[t]=r:s&&"get"in s&&null!==(i=s.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||_b.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ac=/[\t\r\n\f]/g;n.fn.extend({addClass:function(e){var t,r,i,s,o,u,a="string"==typeof e&&e,f=0,l=this.length;if(n.isFunction(e))return this.each(function(t){n(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];l>f;f++)if(r=this[f],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(ac," "):" ")){o=0;while(s=t[o++])i.indexOf(" "+s+" ")<0&&(i+=s+" ");u=n.trim(i),r.className!==u&&(r.className=u)}return this},removeClass:function(e){var t,r,i,s,o,u,a=0===arguments.length||"string"==typeof e&&e,f=0,l=this.length;if(n.isFunction(e))return this.each(function(t){n(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];l>f;f++)if(r=this[f],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(ac," "):"")){o=0;while(s=t[o++])while(i.indexOf(" "+s+" ")>=0)i=i.replace(" "+s+" "," ");u=e?n.trim(i):"",r.className!==u&&(r.className=u)}return this},toggleClass:function(e,t){var r=typeof e;return"boolean"==typeof t&&"string"===r?t?this.addClass(e):this.removeClass(e):this.each(n.isFunction(e)?function(r){n(this).toggleClass(e.call(this,r,this.className,t),t)}:function(){if("string"===r){var t,i=0,s=n(this),o=e.match(E)||[];while(t=o[i++])s.hasClass(t)?s.removeClass(t):s.addClass(t)}else(r===U||"boolean"===r)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||e===!1?"":L.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(ac," ").indexOf(t)>=0)return!0;return!1}});var bc=/\r/g;n.fn.extend({val:function(e){var t,r,i,s=this[0];if(arguments.length)return i=n.isFunction(e),this.each(function(r){var s;1===this.nodeType&&(s=i?e.call(this,r,n(this).val()):e,null==s?s="":"number"==typeof s?s+="":n.isArray(s)&&(s=n.map(s,function(e){return null==e?"":e+""})),t=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,s,"value")||(this.value=s))});if(s)return t=n.valHooks[s.type]||n.valHooks[s.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(r=t.get(s,"value"))?r:(r=s.value,"string"==typeof r?r.replace(bc,""):null==r?"":r)}}),n.extend({valHooks:{option:{get:function(e){var t=n.find.attr(e,"value");return null!=t?t:n.trim(n.text(e))}},select:{get:function(e){for(var t,r,i=e.options,s=e.selectedIndex,o="select-one"===e.type||0>s,u=o?null:[],a=o?s+1:i.length,f=0>s?a:o?s:0;a>f;f++)if(r=i[f],!(!r.selected&&f!==s||(k.optDisabled?r.disabled:null!==r.getAttribute("disabled"))||r.parentNode.disabled&&n.nodeName(r.parentNode,"optgroup"))){if(t=n(r).val(),o)return t;u.push(t)}return u},set:function(e,t){var r,i,s=e.options,o=n.makeArray(t),u=s.length;while(u--)i=s[u],(i.selected=n.inArray(i.value,o)>=0)&&(r=!0);return r||(e.selectedIndex=-1),o}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(e,t){return n.isArray(t)?e.checked=n.inArray(n(e).val(),t)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){n.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),n.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var cc=n.now(),dc=/\?/;n.parseJSON=function(e){return JSON.parse(e+"")},n.parseXML=function(e){var t,r;if(!e||"string"!=typeof e)return null;try{r=new DOMParser,t=r.parseFromString(e,"text/xml")}catch(i){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+e),t};var ec,fc,gc=/#.*$/,hc=/([?&])_=[^&]*/,ic=/^(.*?):[ \t]*([^\r\n]*)$/gm,jc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,kc=/^(?:GET|HEAD)$/,lc=/^\/\//,mc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,nc={},oc={},pc="*/".concat("*");try{fc=location.href}catch(qc){fc=l.createElement("a"),fc.href="",fc=fc.href}ec=mc.exec(fc.toLowerCase())||[],n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:jc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":pc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?tc(tc(e,n.ajaxSettings),t):tc(n.ajaxSettings,e)},ajaxPrefilter:rc(nc),ajaxTransport:rc(oc),ajax:function(e,t){function T(e,t,o,a){var l,g,y,w,E,x=t;2!==b&&(b=2,u&&clearTimeout(u),r=void 0,s=a||"",S.readyState=e>0?4:0,l=e>=200&&300>e||304===e,o&&(w=uc(c,S,o)),w=vc(c,w,S,l),l?(c.ifModified&&(E=S.getResponseHeader("Last-Modified"),E&&(n.lastModified[i]=E),E=S.getResponseHeader("etag"),E&&(n.etag[i]=E)),204===e||"HEAD"===c.type?x="nocontent":304===e?x="notmodified":(x=w.state,g=w.data,y=w.error,l=!y)):(y=x,(e||!x)&&(x="error",0>e&&(e=0))),S.status=e,S.statusText=(t||x)+"",l?d.resolveWith(h,[g,x,S]):d.rejectWith(h,[S,x,y]),S.statusCode(m),m=void 0,f&&p.trigger(l?"ajaxSuccess":"ajaxError",[S,c,l?g:y]),v.fireWith(h,[S,x]),f&&(p.trigger("ajaxComplete",[S,c]),--n.active||n.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,i,s,o,u,a,f,l,c=n.ajaxSetup({},t),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?n(h):n.event,d=n.Deferred(),v=n.Callbacks("once memory"),m=c.statusCode||{},g={},y={},b=0,w="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!o){o={};while(t=ic.exec(s))o[t[1].toLowerCase()]=t[2]}t=o[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else S.always(e[S.status]);return this},abort:function(e){var t=e||w;return r&&r.abort(t),T(0,t),this}};if(d.promise(S).complete=v.add,S.success=S.done,S.error=S.fail,c.url=((e||c.url||fc)+"").replace(gc,"").replace(lc,ec[1]+"//"),c.type=t.method||t.type||c.method||c.type,c.dataTypes=n.trim(c.dataType||"*").toLowerCase().match(E)||[""],null==c.crossDomain&&(a=mc.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ec[1]&&a[2]===ec[2]&&(a[3]||("http:"===a[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=n.param(c.data,c.traditional)),sc(nc,c,t,S),2===b)return S;f=c.global,f&&0===n.active++&&n.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!kc.test(c.type),i=c.url,c.hasContent||(c.data&&(i=c.url+=(dc.test(i)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=hc.test(i)?i.replace(hc,"$1_="+cc++):i+(dc.test(i)?"&":"?")+"_="+cc++)),c.ifModified&&(n.lastModified[i]&&S.setRequestHeader("If-Modified-Since",n.lastModified[i]),n.etag[i]&&S.setRequestHeader("If-None-Match",n.etag[i])),(c.data&&c.hasContent&&c.contentType!==!1||t.contentType)&&S.setRequestHeader("Content-Type",c.contentType),S.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+pc+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)S.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,S,c)!==!1&&2!==b){w="abort";for(l in{success:1,error:1,complete:1})S[l](c[l]);if(r=sc(oc,c,t,S)){S.readyState=1,f&&p.trigger("ajaxSend",[S,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){S.abort("timeout")},c.timeout));try{b=1,r.send(g,T)}catch(x){if(!(2>b))throw x;T(-1,x)}}else T(-1,"No Transport");return S}return S.abort()},getJSON:function(e,t,r){return n.get(e,t,r,"json")},getScript:function(e,t){return n.get(e,void 0,t,"script")}}),n.each(["get","post"],function(e,t){n[t]=function(e,r,i,s){return n.isFunction(r)&&(s=s||i,i=r,r=void 0),n.ajax({url:e,type:t,dataType:s,data:r,success:i})}}),n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){n.fn[t]=function(e){return this.on(t,e)}}),n._evalUrl=function(e){return n.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(e){var t;return n.isFunction(e)?this.each(function(t){n(this).wrapAll(e.call(this,t))}):(this[0]&&(t=n(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(n.isFunction(e)?function(t){n(this).wrapInner(e.call(this,t))}:function(){var t=n(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)})},wrap:function(e){var t=n.isFunction(e);return this.each(function(r){n(this).wrapAll(t?e.call(this,r):e)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},n.expr.filters.visible=function(e){return!n.expr.filters.hidden(e)};var wc=/%20/g,xc=/\[\]$/,yc=/\r?\n/g,zc=/^(?:submit|button|image|reset|file)$/i,Ac=/^(?:input|select|textarea|keygen)/i;n.param=function(e,t){var r,i=[],s=function(e,t){t=n.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(e)||e.jquery&&!n.isPlainObject(e))n.each(e,function(){s(this.name,this.value)});else for(r in e)Bc(r,e[r],t,s);return i.join("&").replace(wc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=n.prop(this,"elements");return e?n.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!n(this).is(":disabled")&&Ac.test(this.nodeName)&&!zc.test(e)&&(this.checked||!T.test(e))}).map(function(e,t){var r=n(this).val();return null==r?null:n.isArray(r)?n.map(r,function(e){return{name:t.name,value:e.replace(yc,"\r\n")}}):{name:t.name,value:r.replace(yc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Cc=0,Dc={},Ec={0:200,1223:204},Fc=n.ajaxSettings.xhr();a.ActiveXObject&&n(a).on("unload",function(){for(var e in Dc)Dc[e]()}),k.cors=!!Fc&&"withCredentials"in Fc,k.ajax=Fc=!!Fc,n.ajaxTransport(function(e){var t;return k.cors||Fc&&!e.crossDomain?{send:function(n,r){var i,s=e.xhr(),o=++Cc;if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)s.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete Dc[o],t=s.onload=s.onerror=null,"abort"===e?s.abort():"error"===e?r(s.status,s.statusText):r(Ec[s.status]||s.status,s.statusText,"string"==typeof s.responseText?{text:s.responseText}:void 0,s.getAllResponseHeaders()))}},s.onload=t(),s.onerror=t("error"),t=Dc[o]=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(u){if(t)throw u}},abort:function(){t&&t()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return n.globalEval(e),e}}}),n.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),n.ajaxTransport("script",function(e){if(e.crossDomain){var t,r;return{send:function(i,s){t=n("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",r=function(e){t.remove(),r=null,e&&s("error"===e.type?404:200,e.type)}),l.head.appendChild(t[0])},abort:function(){r&&r()}}}});var Gc=[],Hc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Gc.pop()||n.expando+"_"+cc++;return this[e]=!0,e}}),n.ajaxPrefilter("json jsonp",function(e,t,r){var i,s,o,u=e.jsonp!==!1&&(Hc.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hc.test(e.data)&&"data");return u||"jsonp"===e.dataTypes[0]?(i=e.jsonpCallback=n.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,u?e[u]=e[u].replace(Hc,"$1"+i):e.jsonp!==!1&&(e.url+=(dc.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return o||n.error(i+" was not called"),o[0]},e.dataTypes[0]="json",s=a[i],a[i]=function(){o=arguments},r.always(function(){a[i]=s,e[i]&&(e.jsonpCallback=t.jsonpCallback,Gc.push(i)),o&&n.isFunction(s)&&s(o[0]),o=s=void 0}),"script"):void 0}),n.parseHTML=function(e,t,r){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(r=t,t=!1),t=t||l;var i=v.exec(e),s=!r&&[];return i?[t.createElement(i[1])]:(i=n.buildFragment([e],t,s),s&&s.length&&n(s).remove(),n.merge([],i.childNodes))};var Ic=n.fn.load;n.fn.load=function(e,t,r){if("string"!=typeof e&&Ic)return Ic.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=n.trim(e.slice(a)),e=e.slice(0,a)),n.isFunction(t)?(r=t,t=void 0):t&&"object"==typeof t&&(s="POST"),u.length>0&&n.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){o=arguments,u.html(i?n("<div>").append(n.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,o||[e.responseText,t,e])}),this},n.expr.filters.animated=function(e){return n.grep(n.timers,function(t){return e===t.elem}).length};var Jc=a.document.documentElement;n.offset={setOffset:function(e,t,r){var i,s,o,u,a,f,l,c=n.css(e,"position"),h=n(e),p={};"static"===c&&(e.style.position="relative"),a=h.offset(),o=n.css(e,"top"),f=n.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(o+f).indexOf("auto")>-1,l?(i=h.position(),u=i.top,s=i.left):(u=parseFloat(o)||0,s=parseFloat(f)||0),n.isFunction(t)&&(t=t.call(e,r,a)),null!=t.top&&(p.top=t.top-a.top+u),null!=t.left&&(p.left=t.left-a.left+s),"using"in t?t.using.call(e,p):h.css(p)}},n.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){n.offset.setOffset(this,e,t)});var t,r,i=this[0],s={top:0,left:0},o=i&&i.ownerDocument;if(o)return t=o.documentElement,n.contains(t,i)?(typeof i.getBoundingClientRect!==U&&(s=i.getBoundingClientRect()),r=Kc(o),{top:s.top+r.pageYOffset-t.clientTop,left:s.left+r.pageXOffset-t.clientLeft}):s},position:function(){if(this[0]){var e,t,r=this[0],i={top:0,left:0};return"fixed"===n.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),n.nodeName(e[0],"html")||(i=e.offset()),i.top+=n.css(e[0],"borderTopWidth",!0),i.left+=n.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-n.css(r,"marginTop",!0),left:t.left-i.left-n.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||Jc;while(e&&!n.nodeName(e,"html")&&"static"===n.css(e,"position"))e=e.offsetParent;return e||Jc})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var r="pageYOffset"===t;n.fn[e]=function(n){return J(this,function(e,n,i){var s=Kc(e);return void 0===i?s?s[t]:e[n]:void (s?s.scrollTo(r?a.pageXOffset:i,r?i:a.pageYOffset):e[n]=i)},e,n,arguments.length,null)}}),n.each(["top","left"],function(e,t){n.cssHooks[t]=yb(k.pixelPosition,function(e,r){return r?(r=xb(e,t),vb.test(r)?n(e).position()[t]+"px":r):void 0})}),n.each({Height:"height",Width:"width"},function(e,t){n.each({padding:"inner"+e,content:t,"":"outer"+e},function(r,i){n.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),u=r||(i===!0||s===!0?"margin":"border");return J(this,function(t,r,i){var s;return n.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===i?n.css(t,r,u):n.style(t,r,i,u)},t,o?i:void 0,o,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Lc=a.jQuery,Mc=a.$;return n.noConflict=function(e){return a.$===n&&(a.$=Mc),e&&a.jQuery===n&&(a.jQuery=Lc),n},typeof b===U&&(a.jQuery=a.$=n),n}),define("core/config",{"dom-host":"#game-frame",liveq:{socket_url:"wss://test4theory.cern.ch/vas/labsocket/"},db:{url:"http://test4theory.cern.ch/vas/db",databases:{tunables:"tunables",observables:"observables",levels:"levels"}},css:{"nav-mini":"nav-mini",screen:"screen",overlay:"overlay",backdrop:"backdrop",foreground:"foreground","error-screen":"error-screen"},"chi2-bounds":{min:.1,good:1,average:4,max:500},voiceapi:{baseURL:"//test4theory.cern.ch/voiceapi",api_key:"9b7b04b2ebc87af8723d09b4123f1c8fe62dad75"}}),define("core/util/event_base",[],function(){var e=function(){this.__eventCallbacks={},this.__eventForwarders=[]};return e.prototype.on=function(e,t){this.__eventCallbacks[e]==undefined&&(this.__eventCallbacks[e]=[]),this.__eventCallbacks[e].push(t)},e.prototype.off=function(e,t){if(this.__eventCallbacks[e]==undefined)return;var n=this.__eventCallbacks[e].indexOf(t);this.__eventCallbacks[e].splice(n,1),this.__eventCallbacks[e].length==0&&delete this.__eventCallbacks[e]},e.prototype.trigger=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();for(var n=0;n<this.__eventForwarders.length;n++)this.__eventForwarders[n].trigger.apply(this.__eventForwarders[n],arguments);if(this.__eventCallbacks[t]==undefined)return;for(var n=0;n<this.__eventCallbacks[t].length;n++)this.__eventCallbacks[t][n].apply(this,e)},e.prototype.forwardAllEventsTo=function(e){this.__eventForwarders.push(e)},e}),define("core/base/component",["core/util/event_base","core/config"],function(e,t){var n=function(t){e.call(this),this.hostDOM=t,this.width=0,this.height=0,this.left=0,this.top=0,this.anchor={left:0,top:0},this.__forwardVisualEventsComponents=[],this.__forwardEventsMap={}};return n.prototype=Object.create(e.prototype),n.prototype.onWillHide=function(e){e()},n.prototype.onWillShow=function(e){e()},n.prototype.onHidden=function(){},n.prototype.onShown=function(){},n.prototype.onResize=function(e,t){this.width=e,this.height=t},n.prototype.onMove=function(e,t){this.left=e,this.top=t},n.prototype.onAnchorUpdate=function(e,t){this.anchor.left=e,this.anchor.top=t},n.prototype.getPreferredSize=function(){return undefined},n.prototype.show=function(e){this.onWillShow(function(){this.onShown(),e&&(e(),this.trigger("shown"))}.bind(this))},n.prototype.hide=function(e){this.onWillHide(function(){this.onHidden(),e&&(e(),this.trigger("hidden"))}.bind(this))},n.prototype.adoptEvents=function(e,t){t&&!(t instanceof Array)&&(t=[t]),e instanceof Array||(e=[e]);for(var n=0;n<e.length;n++){var r=e[n];if(!r)continue;if(!t)r.forwardAllEventsTo(this);else for(var i=0;i<t.length;i++)r.on(t[i],function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),this.trigger.apply(this,t)}.bind(this)}.bind(this)(t[i]))}},n.prototype.forwardEvents=function(e,t,n){t instanceof Array||(t=[t]),e instanceof Array||(e=[e]);var r=function(e,t,n){return n};for(var i=0;i<e.length;i++){var s=e[i];if(!s)continue;for(var o=0;o<t.length;o++){var u=t[o];if(this.__forwardEventsMap[u]==undefined){this.__forwardEventsMap[u]=[[s,n||r]];var a=this[u].bind(this);this[u]=function(e,t){return function(){var n=Array.prototype.slice.call(arguments),r=this.__forwardEventsMap[e];for(var i=0;i<r.length;i++){var s=r[i][0],o=r[i][1];s[e]&&s[e].apply(s,o(r[i],e,n))}t.apply(this,n)}}.bind(this)(u,a)}else this.__forwardEventsMap[u].push([s,n||r])}}},n.prototype.forwardVisualEvents=function(e,t){e instanceof Array||(e=[e]);if(t)if(t instanceof Array){if(t.length!=e.length){console.error("Mismatching array dimentions between components and size information!");return}}else{var n=t;t=[];for(var r=0;r<e.length;r++)t.push(n)}var i=function(e,t,n){return e?e.indexOf("%")<0?parseInt(e):parseInt(e)*t/100:n},s=function(e,t,n,r,s){var o=e[n]==undefined?!1:i(e[n],t,0),u=e[r]==undefined?!1:i(e[r],t,0),a=e[s]==undefined?!1:i(e[s],t,0);if(o===!1&&u===!1&&a===!1)return[0,t];if(o!==!1&&u===!1&&a===!1)return[o,t-o];if(o===!1&&u!==!1&&a===!1)return[0,t-u];if(o===!1&&u===!1&&a!==!1)return[0,a];if(o!==!1&&u!==!1&&a===!1)return[o,t-o-u];if(o!==!1&&u===!1&&a!==!1)return[o,a];if(o===!1&&u!==!1&&a!==!1)return[t-a-u,a]};for(var o=0;o<e.length;o++){if(!e[o])continue;t?this.__forwardVisualEventsComponents.push({com:e[o],sz:t[o]}):this.__forwardVisualEventsComponents.push({com:e[o],sz:null});if(this.__forwardVisualEventsComponents.length==1){var u=this,a=this.onShown.bind(this),f=this.onHidden.bind(this),l=this.onWillShow.bind(this),c=this.onWillHide.bind(this),h=this.onResize.bind(this),p=this.onMove.bind(this);this.onShown=function(){for(var e=0;e<u.__forwardVisualEventsComponents.length;e++)u.__forwardVisualEventsComponents[e].com.onShown();a()},this.onHidden=function(){for(var e=0;e<u.__forwardVisualEventsComponents.length;e++)u.__forwardVisualEventsComponents[e].com.onHidden();f()},this.onWillShow=function(e){var t=u.__forwardVisualEventsComponents.length;for(var n=0;n<u.__forwardVisualEventsComponents.length;n++)u.__forwardVisualEventsComponents[n].com.onWillShow(function(){--t==0&&l(e)})},this.onWillHide=function(e){var t=u.__forwardVisualEventsComponents.length;for(var n=0;n<u.__forwardVisualEventsComponents.length;n++)u.__forwardVisualEventsComponents[n].com.onWillHide(function(){--t==0&&c(e)})},this.onResize=function(e,t){this.width=e,this.height=t,h(e,t);var n=u.__forwardVisualEventsComponents.length;for(var r=0;r<u.__forwardVisualEventsComponents.length;r++){var i=u.__forwardVisualEventsComponents[r];if(i.sz){var o=s(i.sz,this.width,"left","right","width"),a=s(i.sz,this.height,"top","bottom","height");i.com.onMove(o[0],a[0]),i.com.onResize(o[1],a[1])}}},this.onMove=function(e,t){this.left=e,this.top=t,p(e,t);var n=u.__forwardVisualEventsComponents.length;for(var r=0;r<u.__forwardVisualEventsComponents.length;r++){var i=u.__forwardVisualEventsComponents[r];if(i.sz){var o=s(i.sz,this.width,"left","right","width"),a=s(i.sz,this.height,"top","bottom","height");i.com.onMove(o[0],a[0]),i.com.onResize(o[1],a[1])}}}}}},n}),define("core/registry",["core/config","core/base/component"],function(e,t){var n={};return n.components={},n.data={},n.visualAids={},n.registerComponent=function(e,t,r){var i=r||5;if(n.components[e]!=undefined&&n.components[e].__weight>=i)return;t.__weight=i,n.components[e]=t},n.registerVisualAid=function(e,r,i){var s=i||{};s.classes=s.classes||"",s.screen=s.screen||"",s.onBeforeFocus=s.onBeforeFocus||function(e){e()},s.onFocus=s.onFocus||function(){},s.onBeforeBlur=s.onBeforeBlur||function(e){e()},s.onBlur=s.onBlur||function(){},r instanceof t?(s.element=r.hostDOM,s.component=r):(s.element=r,s.component=!1),n.visualAids[e]=s},n.getVisualAid=function(e){return n.visualAids[e]?n.visualAids[e].element:(console.warn("Registry: No visual aid with name '"+e+"' was registered!"),undefined)},n.getVisualAidMeta=function(e){return n.visualAids[e]?n.visualAids[e]:(console.warn("Registry: No visual aid with name '"+e+"' was registered!"),undefined)},n.instanceComponent=function(e,t){var r=n.components[e];if(r==undefined)return console.error("Registry: Could not instantiate component '"+e+"'. Not in registry!"),undefined;var i=undefined;i=new r(t);var s=$(t).offset();return i.onResize($(t).width(),$(t).height()),i.onMove(s.left,s.top),i.hide(),i},n.setData=function(e,t,r,i){var s=i||5;n.data[e]==undefined&&(n.data[e]={});if(n.data[e][t]!=undefined&&n.data[e][t].w>=s)return;n.data[e][t]={w:s,o:r}},n.getData=function(e,t,r){return n.data[e]==undefined?r:n.data[e][t]==undefined?r:n.data[e][t].o},n}),define("sha1",[],function(){var e={};return e.hash=function(t){var n=[1518500249,1859775393,2400959708,3395469782];t+=String.fromCharCode(128);var r=t.length/4+2,i=Math.ceil(r/16),s=new Array(i);for(var o=0;o<i;o++){s[o]=new Array(16);for(var u=0;u<16;u++)s[o][u]=t.charCodeAt(o*64+u*4)<<24|t.charCodeAt(o*64+u*4+1)<<16|t.charCodeAt(o*64+u*4+2)<<8|t.charCodeAt(o*64+u*4+3)}s[i-1][14]=(t.length-1)*8/Math.pow(2,32),s[i-1][14]=Math.floor(s[i-1][14]),s[i-1][15]=(t.length-1)*8&4294967295;var a=1732584193,f=4023233417,l=2562383102,c=271733878,h=3285377520,p=new Array(80),d,v,m,g,y;for(var o=0;o<i;o++){for(var b=0;b<16;b++)p[b]=s[o][b];for(var b=16;b<80;b++)p[b]=e.ROTL(p[b-3]^p[b-8]^p[b-14]^p[b-16],1);d=a,v=f,m=l,g=c,y=h;for(var b=0;b<80;b++){var w=Math.floor(b/20),E=e.ROTL(d,5)+e.f(w,v,m,g)+y+n[w]+p[b]&4294967295;y=g,g=m,m=e.ROTL(v,30),v=d,d=E}a=a+d&4294967295,f=f+v&4294967295,l=l+m&4294967295,c=c+g&4294967295,h=h+y&4294967295}return e.toHexStr(a)+e.toHexStr(f)+e.toHexStr(l)+e.toHexStr(c)+e.toHexStr(h)},e.f=function(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}},e.ROTL=function(e,t){return e<<t|e>>>32-t},e.toHexStr=function(e){var t="",n;for(var r=7;r>=0;r--)n=e>>>r*4&15,t+=n.toString(16);return t},e}),define("core/db",["jquery","sha1","core/config"],function(e,t,n){function i(e){return function(t){e(t)}}function s(e){return function(t){t||e(t);var n=t.total_rows,r=t.rows;r.length<n&&console.warn("DB: Incomplete data arrived!");var i=[];for(var s=0;s<r.length;s++)i.push(r[s].doc);e(i)}}function o(t,n,r){e.ajax({url:t,method:"GET",dataType:r||"json",success:function(e,t){n(e)},error:function(e,t,r){n(null,r),console.warn("DB: CouchDB Error:",r,"("+t+")")}})}function u(t,n,r,i){e.ajax({url:t,data:n,type:"POST",dataType:i||"json",success:function(e,t){r(e)},error:function(e,t,n){r(null,n),console.warn("DB: CouchDB Error:",n,"("+t+")")}})}function a(t,n,r,i){e.ajax({url:t,data:n,type:"PUT",dataType:i||"json",contentType:"application/json",success:function(e,t){r(e)},error:function(e,t,n){r(null,n),console.warn("DB: CouchDB Error:",n,"("+t+")")}})}var r=0,f=function(e,t){this.db=e};f.prototype.get=function(e,t,r){typeof t=="function"&&(r=t,t=!1);var s=n.db.url+"/"+this.db+"/"+e;t!=0&&t&&(s+="?rev="+t),o(s,i(r))},f.prototype.put=function(e,t,r){typeof rev=="function"&&(r=rev,rev=!1);var i=n.db.url+"/"+this.db+"/"+e,s=function(n){n&&(t._rev=n),console.log("Saving",t),a(i,JSON.stringify(t),function(n){if(!n){r(!1);return}n.ok?r(t._id||e,n.rev):r(!1)})};o(i+"?revs_info=true",function(e,t){!e&&t=="Object Not Found"?s(""):!e||e["_revs_info"]==undefined?r(!1,"Could not list revisions"):s(e._revs_info[0].rev)})},f.prototype.all=function(e){var t=n.db.url+"/"+this.db+"/_all_docs?include_docs=true";o(t,s(e))},f.prototype.view=function(e,t){var r=n.db.url+"/"+this.db+"/_design/"+e+"/all";o(r,s(t))},f.prototype.getAttachment=function(e,t,r){typeof t=="function"&&(r=t,t=!1);var s=n.db.url+"/"+this.db+"/"+e+"/attachment";t&&(s+="?rev="+t),o(s,i(r),"text")};var l={};return l.cache={},l.userRecord=null,l.createUser=function(e,r){var i="",s="0123456789+abcdefghijklmnopqrstuvwxyz-ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var o=0;o<64;o++)i+=s[parseInt(Math.random()*s.length)];var u="",s="0123456789abcdef";for(var o=0;o<32;o++)u+=s[parseInt(Math.random()*s.length)];var f=e.username||"",c=e.password||"",h={name:f,uuid:i,password_sha:t.hash(c+u),salt:u,roles:[],type:"user",email:e.email||"",displayName:e.displayName||"",data:l.cache.definitions["new-user"]};a(n.db.url+"/_users/org.couchdb.user:"+f,JSON.stringify(h),function(e,t){e&&e.ok?(l.userRecord=h,r&&r(!0,h)):(console.error("DB: Could not authenticate user!",t),r&&r(!1,t))})},l.authenticateUser=function(e,t,r){u(n.db.url+"/_session",{name:e,password:t},function(t,n){if(t&&t.ok){var i=new f("_users");i.get("org.couchdb.user:"+e,function(e){e?(l.userRecord=e,r&&r(t.name,e)):(console.error("DB: Could not fetch record entry!"),r&&r(!1,"Could not fetch record entry"))})}else console.error("DB: Could not authenticate user!",n),r&&r(!1,n)}.bind(this))},l.commitUserRecord=function(e){if(!l.userRecord)return;var t=n.db.url+"/_users/"+this.userRecord._id;a(t,JSON.stringify(this.userRecord),function(t){if(!t){e&&e(!1);return}t.ok?(this.userRecord._rev=t.rev,e&&e(!0)):e&&e(!1)}.bind(this))},l.openDatabase=function(e){return new f(e)},l}),define("core/base/components",["core/config","core/base/component"],function(e,t){var n=function(e){t.call(this,e)};n.prototype=Object.create(t.prototype),n.prototype.onTunablesDefined=function(e){},n.prototype.onObservablesDefined=function(e){},n.prototype.onLevelsDefined=function(e){},n.prototype.onStartTask=function(e){};var r=function(e){t.call(this,e)};r.prototype=Object.create(t.prototype),r.prototype.onLoginStatus=function(e,t){};var i=function(e){t.call(this,e)};i.prototype=Object.create(t.prototype),i.prototype.onTunablesDefined=function(e){},i.prototype.onObservablesDefined=function(e){},i.prototype.onMachineAdded=function(e){},i.prototype.onMachineRemoved=function(e){};var s=function(e){t.call(this,e)};s.prototype=Object.create(t.prototype),s.prototype.onTunablesDefined=function(e){},s.prototype.onObservablesDefined=function(e){},s.prototype.onScenesDefined=function(e){},s.prototype.onMachineLayoutDefined=function(e){},s.prototype.onParameterFocus=function(e){},s.prototype.onTopicUpdated=function(e){};var o=function(e){t.call(this,e)};o.prototype=Object.create(t.prototype),o.prototype.onUserStatistics=function(e){},o.prototype.onTopicTreeUpdated=function(e){};var u=function(e){t.call(this,e)};u.prototype=Object.create(t.prototype);var a=function(e){t.call(this,e)};a.prototype=Object.create(t.prototype);var f=function(e){t.call(this,e)};f.prototype=Object.create(t.prototype),f.prototype.onProgress=function(e,t){},f.prototype.onProgressCompleted=function(){},f.prototype.onProgressError=function(){};var l=function(e){t.call(this,e)};l.prototype=Object.create(t.prototype),l.prototype.onPageWillChange=function(e,t){},l.prototype.onPageChanged=function(e,t){};var c=function(e){t.call(this,e)};c.prototype=Object.create(t.prototype);var h=function(e){t.call(this,e)};h.prototype=Object.create(t.prototype),h.prototype.onPopupConfig=function(e,t){};var p={TuningScreen:n,RunningScreen:i,ExplainScreen:s,HomeScreen:o,ProgressScreen:f,ResultsScreen:u,Nav:l,Backdrop:c,LoginScreen:r,Popup:h};return p}),define("core/user",["core/config","core/db"],function(e,t){var n={};return n.login=function(e,n){t.authenticateUser(e.username,e.password,function(e,t){if(!e){n&&n(!1,t);return}this.initialize(),n&&n(!0)}.bind(this))},n.register=function(e,n){t.createUser(e,function(e,t){if(!e){n&&n(!1,t);return}this.initialize(),n&&n(!0)}.bind(this))},n.initialize=function(){t.userRecord.data.enabled_topics||(t.userRecord.data.enabled_topics={}),t.userRecord.data.task_details||(t.userRecord.data.task_details={}),t.userRecord.data.first_time||(t.userRecord.data.first_time={})},n.getTaskDetails=function(e){var n=t.cache.tasks[e],r=t.userRecord.data.task_details[e];return n?(r||(t.userRecord.data.task_details[e]=r={enabled:!1,seen_intro:!1,save:[null,null,null,null]}),n.enabled=r.enabled,n.seen_intro=r.seen_intro,n.save=r.save,n):null},n.getTopicDetails=function(e){var r=t.cache.topic_index[e];if(!r)return;var i=[];for(var s=0;s<r.tasks.length;s++)i.push(n.getTaskDetails(r.tasks[s])),s==0&&(i[0].enabled=!0);return r.taskDetails=i,r},n.getTopicTree=function(){var e=[],n=[],r={},i=function(s,o){if(o!=null&&!t.userRecord.data.enabled_topics[s._id])return;var u=e.length;r[s._id]=u,e.push(s);if(o!=null){var a=r[o._id];n.push({source:u,target:a})}for(var f=0;f<s.children.length;f++)i(s.children[f],s)};return i(t.cache.topic_root,null),{nodes:e,links:n}},n.enableTopic=function(e){t.userRecord.data.enabled_topics[e]=1,t.commitUserRecord()},n.getTaskSaveSlots=function(e){return t.userRecord.data.task_details[task_id]||(t.userRecord.data.task_details[task_id]={}),t.userRecord.data.task_details[task_id].save||(t.userRecord.data.task_details[task_id].save=[null,null,null,null]),t.userRecord.data.task_details[task_id].save},n.setTaskSaveSlot=function(e,n,r){t.userRecord.data.task_details[e]||(t.userRecord.data.task_details[e]={}),t.userRecord.data.task_details[e].save||(t.userRecord.data.task_details[e].save=[null,null,null,null]),n<0&&(n=0),n>3&&(n=3),t.userRecord.data.task_details[e].save[n]=r,t.commitUserRecord()},n.setTaskAnimationAsSeen=function(e){t.userRecord.data.task_details[e]||(t.userRecord.data.task_details[e]={}),t.userRecord.data.task_details[e].save||(t.userRecord.data.task_details[e].save=[null,null,null,null]),t.userRecord.data.task_details[e].seen_intro=1,t.commitUserRecord()},n.enableTask=function(e){t.userRecord.data.task_details[e]||(t.userRecord.data.task_details[e]={}),t.userRecord.data.task_details[e].save||(t.userRecord.data.task_details[e].save=[null,null,null,null]),t.userRecord.data.task_details[e].enabled=1,t.commitUserRecord()},n.getFirstTimeDetails=function(){if(!t.cache.first_time)return[];var e={};for(var n in t.cache.first_time){var r=t.cache.first_time[n];t.userRecord.data.first_time[n]?r.shown=t.userRecord.data.first_time[n]:r.shown=!1,e[n]=r}return e},n.markFirstTimeAsSeen=function(e){t.userRecord.data.first_time[e]=1,t.commitUserRecord()},n}),define("core/ui",["jquery","core/config","core/registry","core/db","core/base/components","core/user"],function(e,t,n,r,i,s){function o(){var e=window.getComputedStyle(document.documentElement,""),t=(Array.prototype.slice.call(e).join("").match(/-(moz|webkit|ms)-/)||e.OLink===""&&["","o"])[1];return t}function u(e){var t=o();return t?t+e[0].toUpperCase()+e.substr(1):e}function f(t){for(var n=0;n<4;n++){var r=e('<div class="mask-part">');t.append(r),a.push(r)}var r=e('<div class="mask-ring"></div>');t.append(r),a.push(r)}function l(e,t,n,r){var i=3;e===!1||e===undefined?(a[0].addClass("fullscreen").attr("style",""),a[1].hide(),a[2].hide(),a[3].hide(),a[4].hide()):(a[0].removeClass("fullscreen").css({left:0,top:0,width:e,bottom:0}),a[1].show().css({left:e+n,top:0,right:0,bottom:0}),a[2].show().css({left:e,top:0,width:n,height:t}),a[3].show().css({left:e,top:t+r,width:n,bottom:0}),a[4].show().css({left:e-i,top:t-i,width:n-i,height:r-i}))}function c(t){if(!t)l(!1);else{var n=e(t).offset(),r=e(t).width(),i=e(t).height();l(n.left,n.top,r,i)}}var a=[],h=!1,p=0,d=!1,v="",m="",g=!1,y=!1,b=!1,w={};return w.vendorSuffix=o(),w.activeScreen="",w.mininav="",w.previousScreen="",w.screens={},w.popupWidgets={},w.Transitions={ZOOM_IN:["pt-page-scaleDown","pt-page-scaleUpDown pt-page-delay300"],ZOOM_OUT:["pt-page-scaleDownUp","pt-page-scaleUp pt-page-delay300"],DIFF_RIGHT:["pt-page-moveToLeftEasing pt-page-ontop","pt-page-moveFromRight"],DIFF_LEFT:["pt-page-moveToRightEasing pt-page-ontop","pt-page-moveFromLeft"],DIFF_BOTTOM:["pt-page-moveToTopEasing pt-page-ontop","pt-page-moveFromBottom"],DIFF_TOP:["pt-page-moveToBottomEasing pt-page-ontop","pt-page-moveFromTop"],FLIP_RIGHT:["pt-page-flipOutRight","pt-page-flipInLeft pt-page-delay500"],FLIP_LEFT:["pt-page-flipOutLeft","pt-page-flipInRight pt-page-delay500"],FLIP_TOP:["pt-page-flipOutTop","pt-page-flipInBottom pt-page-delay500"],FLIP_BOTTOM:["pt-page-flipOutBottom","pt-page-flipInTop pt-page-delay500"]},w.initAndPlaceScreen=function(r,i){var s=e('<div class="'+t.css.screen+'"></div>');w.host.append(s);var o=n.instanceComponent(r,s),u=!0;return o!==undefined?(i!==undefined&&(o instanceof i||(s.empty(),s.addClass(t.css["error-screen"]),s.html("Could not validate <strong>"+r+"</strong>"),u=!1)),u&&(o.onResize(s.width(),s.height()),w.screens[r]=o)):(s.addClass(t.css["error-screen"]),s.html("Could load <strong>"+r+"</strong>")),s.data("originalClasses",s.attr("class")),w.activeScreen||(w.activeScreen=r,o.onShown(),s.addClass("pt-current"),s.addClass("pt-page-ontop")),o},w.initialize=function(){w.host=e(t["dom-host"]),w.host.addClass("pt-main pt-perspective"),w.overlayDOM=e('<div class="'+t.css.overlay+'"></div>'),w.overlayDOM.hide(),w.host.append(w.overlayDOM),f(w.overlayDOM),l(!1),w.visualAgentDOM=e('<div class="visual-agent"></div>'),w.overlayDOM.append(w.visualAgentDOM),w.visualAgent=n.instanceComponent("tutorial.agent",w.visualAgentDOM),w.visualAgent||console.warn("UI: Could not initialize tutorial agent!"),w.popupDOM=e('<div class="fullscreen popups"></div>'),w.host.append(w.popupDOM),w.visualAgent.onResize(w.host.width(),w.host.height()),w.visualAgent.on("focusVisualAid",function(e,t,n){w.focusVisualAid(e,t,n)}),w.visualAgent.on("blurVisualAid",function(){w.blurVisualAid()}),w.visualAgent.on("completed",function(){w.hideTutorial(),g&&g()}),e(window).resize(function(){e("body").removeClass("layout-compact layout-wide layout-vertical layout-mobile");var t=e(window).width(),n=e(window).height();t>n?t<=1024?e("body").addClass("layout-compact"):e("body").addClass("layout-wide"):e("body").addClass("layout-vertical");var r=w.screens[w.activeScreen];if(r==undefined)return;var t=r.hostDOM.width(),n=r.hostDOM.height();r.onResize(t,n),b&&b.onResize(t,n),w.visualAgent.onResize(t,n),c(h)}),e(window).resize(),e(window).keydown(function(e){e.keyCode==27&&y&&(e.preventDefault(),e.stopPropagation(),w.hideTutorial())}),w.firstTimeAids=[],w.firstTimeAidsPending=[],window.ui=w},w.showOverlay=function(e,t){},w.hideAllfirstTimeAids=function(){for(var e=0;e<w.firstTimeAids.length;e++)w.firstTimeAids[e].fadeOut(function(e){return function(){e.remove()}}(w.firstTimeAids[e]));for(var e=0;e<w.firstTimeAidsPending.length;e++)w.firstTimeAidsPending[e].remove();w.firstTimeAids=[],w.firstTimeAidsPending=[]},w.testCollidingFirstTimeAids=function(e){function t(e,t,n,r,i,s,o,u){return e>=i&&e<=i+o&&t>=s&&t<=s+u||e+n>=i&&e+n<=i+o&&t>=s&&t<=s+u||e>=i&&e<=i+o&&t+r>=s&&t+r<=s+u||e+n>=i&&e+n<=i+o&&t+r>=s&&t+r<=s+u}for(var n=0;n<w.firstTimeAidsPending.length;n++){var r=w.firstTimeAidsPending[n],i=!1;for(var s=0;s<w.firstTimeAids.length;s++){var o=w.firstTimeAids[s],u=r.width(),a=r.height(),f=parseInt(r.css("left")),l=parseInt(r.css("top")),c=o.width(),h=o.height(),p=parseInt(o.css("left")),d=parseInt(o.css("top"));if(t(f,l,u,a,p,d,c,h)||t(p,d,c,h,f,l,u,a)){i=!0;break}}i||(w.firstTimeAids.push(r),setTimeout(function(){r.fadeIn()},1e3*Math.random()),w.firstTimeAidsPending.splice(n,1),n=0)}},w.showFirstTimeAid=function(t){var r=e('<div class="newitem-popup"></div>'),i=n.getVisualAidMeta(t),o=s.getFirstTimeDetails();if(!i)return;if(!o[t])return;if(o[t].shown)return;if(i.screen!=""&&i.screen!=w.activeScreen)return;var r=e('<div class="newitem-popup"></div>'),u=e('<div class="text"></div>').appendTo(r);w.host.append(r);var a=e(i.element),f=a.offset(),l=parseInt(a.attr("width"))||a.width(),c=parseInt(a.attr("height"))||a.height(),h=f.left+l*2/3+5,p=f.top+c/2-r.height();h+r.width()>w.host.width()&&(h=f.left+l/3-r.width()-5,r.addClass("flip-x")),p<0&&(p=f.top+c/2,r.addClass("flip-y")),u.html(o[t].text),r.css({left:h,top:p}),r.click(function(){r.fadeOut(function(){r.remove()});var e=w.firstTimeAids.indexOf(r);w.firstTimeAids.splice(e,1),s.markFirstTimeAsSeen(t),w.testCollidingFirstTimeAids()}),r.hide(),w.firstTimeAidsPending.push(r),w.testCollidingFirstTimeAids()},w.showPopup=function(t,r,s,o,u){if(r instanceof e||r instanceof Element){u=o,o=s;var a=e(r),f=a.offset(),l=parseInt(a.attr("width"))||a.width(),c=parseInt(a.attr("height"))||a.height();r=f.left+l/2,s=f.top+c/2}var h=o;o instanceof e||o instanceof Element?h=function(t){return function(n){n.append(e(t))}}(o):typeof o=="string"&&(h=function(t){return function(n){n.append(e("<span>"+t+"</span>"))}}(o));var p=w.popupWidgets[t];if(!p){p=w.popupWidgets[t]=n.instanceComponent(t,w.popupDOM,i.Popup);if(!p){console.error("UI: Unable to instantiate pop-up widget '"+t+"'");return}}var d=function(){p.onResize(w.host.width(),w.host.height());var e=u||{};e.left=r,e.top=s,p.onPopupConfig(e,h),p.onAnchorUpdate(r,s),p.show()};b?b.hide(d):d(),b=p},w.hidePopup=function(){b&&b.hide(),b=!1},w.focusVisualAid=function(t,r,i,s){if(typeof t!="string"){console.error("UI: Invalid visual aid ID!");return}var o=n.getVisualAidMeta(t);if(!o){console.error("UI: Missing visual aid '"+t+"'");return}typeof i=="function"?(s=i,i=""):typeof r=="function"&&(s=r,r=0,i="");var u=e(o.element);h&&blurVisualAid();var a=(i||"")+" "+(o.classes||""),f=function(){d=u.css("display")!="none",v=u.attr("class"),d||u.show(),a&&u.addClass(a),h=u.addClass("visualaid-focus"),c(h),r&&(p=setTimeout(function(){w.blurVisualAid()},r*1e3)),s&&s()};o.screen&&w.activeScreen!=o["screen"]?w.selectScreen(o.screen,w.Transitions.ZOOM_OUT,f):f()},w.blurVisualAid=function(){clearTimeout(p);if(h){var t=e(h);t.removeClass("visualaid-focus"),d||t.hide(),t.attr("class",v),c(!1)}h=!1},w.showTutorial=function(e,t){var n=function(){w.overlayDOM.removeClass("loading"),w.visualAgent.onStart(),t&&t()},i=function(e){y=!0,m=w.activeScreen,w.overlayDOM.addClass("loading"),w.visualAgent.show(function(){var t=2;w.overlayDOM.fadeIn(500,function(){--t==0&&n()}),w.visualAgent.onSequenceDefined(e,function(){--t==0&&n()})})},s=function(e){y?w.hideTutorial(i):i(e)},o=function(e){var t=r.openDatabase("tutorials");t.get(e,function(t){e?t.sequence?s(t.sequence):console.error("UI: Invalid database structure for tutorial '"+e+"': Could not find 'sequence' field!"):console.error("UI: Could not find tutorial '"+e+"' in the database!")})};typeof e=="string"?o(e):s(e)},w.hideTutorial=function(e){if(!y)return;w.visualAgent.onStop(),w.blurVisualAid();var t=function(){w.visualAgent.hide(function(){w.overlayDOM.fadeOut(500,function(){e&&e(),y=!1})})};w.activeScreen!=m?w.selectScreen(m,w.Transitions.FLIP_LEFT,t):t()},w.selectPreviousScreen=function(e){if(!w.previousScreen)return;w.selectScreen(w.previousScreen,w.Transitions.ZOOM_OUT,e)},w.selectScreen=function(e,t,n){if(w.activeScreen==e)return;w.previousScreen=w.activeScreen;var r=w.activeScreen;w.activeScreen=e,t==undefined?t=w.Transitions.ZOOM_IN:typeof t=="function"&&(n=t,t=w.Transitions.ZOOM_IN),w.hideAllfirstTimeAids();var i=w.screens[r],s=w.screens[e];console.log(r," -> ",e);var o=function(e){var n={webkitAnimation:"webkitAnimationEnd",oAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"},r=n[u("animation")];i.hostDOM.addClass(t[0]),s.hostDOM.addClass(t[1]+" pt-page-ontop pt-current");var o=function(){s.hostDOM.attr("class",s.hostDOM.data("originalClasses")+" pt-current"),i.hostDOM.attr("class",i.hostDOM.data("originalClasses")),e()},a=0;i.hostDOM.on(r,function(){i.hostDOM.off(r),++a==2&&o()}),s.hostDOM.on(r,function(){s.hostDOM.off(r),++a==2&&o()})},a=function(e){i==undefined?e():i.onWillHide(e)},f=function(e){s==undefined?e():(s.onResize(s.hostDOM.width(),s.hostDOM.height()),s.onWillShow(e))};return a(function(){f(function(){w.mininav&&w.mininav.onPageWillChange(r,e),o(function(){i!==undefined&&i.onHidden(),s!==undefined&&s.onShown(),w.mininav&&w.mininav.onPageChanged(r,e);var t=s.hostDOM.width(),o=s.hostDOM.height();w.visualAgent.onResize(t,o),c(h),n&&n()})})}),s},w}),define("core/util/progress_aggregator",["core/util/event_base","core/config"],function(e,t){var n=function(t,n){e.call(this),this._parent=t,this._children=[],this._value=0,this.max=n||0,this.value=0};return n.prototype=Object.create(e.prototype),n.prototype._updateValue=function(){this._value=0;for(var e=0;e<this._children.length;e++)this._children[e]._updateValue(),this._value+=this._children[e]._value;this.max?(this._value+=Math.min(this.value,this.max)/this.max,this._value/=this._children.length+1):this._value/=this._children.length},n.prototype._notifyUpdate=function(e){this._parent?this._parent._notifyUpdate(e):(this._updateValue(),this.trigger("progress",this._value,e),Math.floor(this._value)==1&&this.trigger("completed"))},n.prototype._notifyError=function(e){this._parent?this._parent._notifyUpdate(e):this.trigger("error",e)},n.prototype.begin=function(e){var t=new n(this,e||1);return this._children.push(t),t},n.prototype.ok=function(e){this.value<this.max&&(this.value++,this._notifyUpdate(e))},n.prototype.fail=function(e){this._notifyError(e)},n.prototype.complete=function(e){this.value=this.max,this._notifyUpdate(e)},n}),define("liveq/LiveQ",{version:"2.0"}),define("liveq/HistogramData",[],function(){var e=function(e,t){this.bins=e==undefined?0:e,this.id=t||"",this.values=[],this.nevts=0,this.interpolated=!1,this._updateCallbacks=[],this.empty=!0;if(this.bins>0){var n=0;for(var r=0;r<this.bins;r++)this.values.push([0,0,0,0,0,0]),n+=48}};return e.fromReader=function(t){var n=new e;return n.updateFromReader(t),n},e.prototype.updateFromReader=function(e,t,n,r){var i=t==undefined?!1:t,s=n;s==undefined&&(s=e.getString());var o=e.getUint32(),u=e.getUint32();this.nevts=u,this.interpolated=r||!1;if(i){if(s!=this.id)return console.error("Mismatched histogram ID while copy-update of histogram ",this.id),!1;if(o!=this.bins)return console.error("Mismatched bins while copy-update of histogram",this.id),!1}else this.id=s,this.bins=o;for(var a=0;a<this.bins;a++)this.values[a]=e.getFloat64Array(6);this.empty=!1;for(var a=0;a<this._updateCallbacks.length;a++)this._updateCallbacks[a](this)},e.prototype.onUpdate=function(e){this._updateCallbacks.push(e)},e.prototype.offUpdate=function(e){var t=this._updateCallbacks.indexOf(e);this._updateCallbacks.splice(t,1)},e.prototype.getBounds=function(e){var t,n,r=null,i=null,s=null,o=null,u=null;if(this.empty)return null;for(var a=0;a<this.bins;a++){if(this.values[a]==null)continue;n=Math.min(this.values[a][0]/10,this.values[a][0]+this.values[a][1]),this.values[a][0]>=0&&(n=Math.min(this.values[a][0]*10,this.values[a][0]+this.values[a][1]));if(n>o||o==null)o=n;t=Math.max(this.values[a][0]*10,this.values[a][0]-this.values[a][2]),this.values[a][0]>=0&&(t=Math.max(this.values[a][0]/10,this.values[a][0]-this.values[a][2]));if(t<i||i==null)i=t;this.values[a][0]>0&&this.values[a][0]<u&&(u=this.values[a][0]),t>0&&t<u&&(u=t),n=this.values[a][3]+this.values[a][4],t=this.values[a][3]-this.values[a][5];if(n>s||s==null)s=n;if(t<r||r==null)r=t}return(e==1||e==undefined)&&i<=0&&(i=1e-6),[r,s,i,o,u]},e}),define("liveq/ReferenceData",["liveq/HistogramData"],function(e){var t=function(){this.id="",this.title="",this.shortdesc="",this.leftdesc="",this.rightdesc="",this.observable="",this.group="",this.url="",this.imgTitle="",this.imgXLabel="",this.imgYLabel="",this.data=null};return t.fromReader=function(n){var r=new t,i=n.getJSON();return r.id=i.id,r.title=i.title,r.short=i["short"],r.observable=i.observable,r.group=i.group,r.beam=i.beam,r.energy=i.energy,r.process=i.process,r.params=i.params,r.shortdesc=i.shortdesc,r.leftdesc=i.leftdesc,r.rightdesc=i.rightdesc,r.url=i.urldesc,r.imgTitle=n.getData("image/png"),r.imgXLabel=n.getData("image/png"),r.imgYLabel=n.getData("image/png"),r.data=e.fromReader(n),r},t}),define("liveq/LabProtocol",["core/util/event_base","liveq/ReferenceData","liveq/HistogramData"],function(e,t,n){var r=function(){e.call(this),this.reference={},this.data={},this.initialized=!1};return r.prototype=Object.create(e.prototype),r.prototype.handleConfigFrame=function(e){for(var r in this.data){var i=this.data[r];i!=undefined&&typeof i!="function"&&this.trigger("histogramRemoved",this.data[r],this.reference[r])}this.reference={},this.data={};var s=e.getUint8();if(s==1){var o=e.getUint8(),u=e.getUint16(),a=e.getUint32(),f=e.getJSON(),l=e.getJSON();f&&this.trigger("tunablesUpdated",f,l);for(var c=0;c<a;c++){var i=t.fromReader(e);this.reference[i.id]=i,this.data[i.id]=new n(i.data.bins,i.id),this.trigger("histogramAdded",this.data[i.id],this.reference[i.id])}this.initialized||(this.initialized=!0,this.trigger("ready",{protocol:1,flags:o,targetEvents:u*1e3}))}else console.error("Unknown configuration frame protocol v",s)},r.prototype.handleFrame=function(e){var t=e.getUint8(),n=0;if(t==1){var r=e.getUint8(),i=e.getUint16(),s=e.getUint32(),o=(r&1)!=0,u=[];for(var a=0;a<s;a++){var f=e.getString();if(this.data[f]!=undefined){var l=this.data[f];l.updateFromReader(e,!0,f,o),l.nevts>0&&(n=l.nevts),this.trigger("histogramUpdated",l,this.reference[f]),u.push({id:f,data:l,ref:this.reference[f]})}else console.error("Histogram ",f," was not defined in configuration!")}this.trigger("metadataUpdated",{nevts:n,interpolation:o}),this.trigger("dataArrived",o),this.trigger("histogramsUpdated",u,o)}else console.error("Unknown configuration frame protocol v",t)},r}),define("liveq/BufferReader",[],function(){var e=function(e){this.buffer=e,this.position=0};return e.prototype.getUint8=function(){var e=new Uint8Array(this.buffer,this.position,1);return this.position+=1,e[0]},e.prototype.getUint16=function(){var e=new Uint16Array(this.buffer,this.position,1);return this.position+=2,e[0]},e.prototype.getUint32=function(){var e=new Uint32Array(this.buffer,this.position,1);return this.position+=4,e[0]},e.prototype.getUint8Array=function(e){var t=new Uint8Array(this.buffer,this.position,e);return this.position+=e,t},e.prototype.getUint16Array=function(e){var t=new Uint16Array(this.buffer,this.position,e);return this.position+=e*2,t},e.prototype.getUint32Array=function(e){var t=new Uint32Array(this.buffer,this.position,e);return this.position+=e*4,t},e.prototype.getFloat32Array=function(e){var t=new Float32Array(this.buffer,this.position,e);return this.position+=e*4,t},e.prototype.getFloat64Array=function(e){var t=new Float64Array(this.buffer,this.position,e);return this.position+=e*8,t},e.prototype.getString=function(){var e=this.getUint16(),t=(e+2)%8;t>0?t=8-t:t=0;var n=this.getUint8Array(e);this.position+=t;var r="";for(var i=0;i<e;i++)r+=String.fromCharCode(n[i]);return r},e.prototype.getData=function(e){var t=this.getUint32(),n=(t+4)%8;n>0?n=8-n:n=0;var r=this.getUint8Array(t);this.position+=n;var i="";for(var s=0;s<t;s++)i+=String.fromCharCode(r[s]);return"data:"+e+";base64,"+btoa(i)},e.prototype.getJSON=function(){var e=this.getString();return e?JSON.parse(e):!1},e}),define("liveq/LabSocket",["liveq/LabProtocol","liveq/LiveQ","liveq/BufferReader","core/config"],function(e,t,n,r){var i=function(t){e.call(this),this.id=t,this.running=!1,this.connected=!1,this.url=r.liveq.socket_url+t,this._pingTimer=null,String(window.location).substr(0,5)=="https"&&(this.url=this.url.replace("ws:","wss:"))};return i.prototype=Object.create(e.prototype),i.prototype.connect=function(e,r){e&&(this.url=e);var i=this,s=r||{};try{this.socket=new WebSocket(this.url),this.socket.onmessage=function(e){if(e.data instanceof Blob){var t=new FileReader;t.onload=function(){var e=new n(this.result),t=e.getUint32(),r=e.getUint32();i.handleDataFrame(t,e)},t.readAsArrayBuffer(e.data)}else{var r=JSON.parse(e.data),s=r.param||{};i.handleActionFrame(r.action,s)}},this.socket.onopen=function(){console.log("Connection open");var e={version:t.version};s.tunables&&(e.tunables=s.tunables),s.observables&&(e.observables=s.observables),i.send("handshake",e),i.connected=!0,i.trigger("connected",i),i._pingTimer&&clearInterval(i._pingTimer),i._pingTimer=setInterval(function(){i.send("ping",{})},3e4)},this.socket.onclose=function(){console.log("Connection closed"),i.connected=!1,i.trigger("disconnected",i),i._pingTimer&&clearInterval(i._pingTimer)}.bind(this),this.socket.onerror=function(e,t){console.error(t),i.connected&&(i.connected=!1,this.trigger("error","Socket Error",!0),this.trigger("disconnected",i))}.bind(this)}catch(o){console.error("Socket exception",o),this.trigger("error","Socket exception",!0)}},i.prototype.handleActionFrame=function(e,t){e=="status"?(console.log(t.message),this.trigger("log",t.message,t.vars)):e=="error"?(console.error("I/O Error:",t.message),this.trigger("error",t.message,!1)):e=="sim_completed"?(console.log("Job completed"),this.trigger("runCompleted"),this.running=!1):e=="sim_failed"?(console.error("Simulation error:",t.message),this.trigger("runError",t.message),this.running=!1):e=="pong"},i.prototype.handleDataFrame=function(e,t){e==1?this.handleConfigFrame(t):e==2&&this.handleFrame(t)},i.prototype.close=function(){if(!this.connected)return;console.log("Connection closed"),this.socket.onclose=function(){},this.socket.close(),this.connected=!1,this.trigger("disconnected",this),this._pingTimer&&clearInterval(this._pingTimer)},i.prototype.send=function(e,t){var n=t||{};this.socket.send(JSON.stringify({action:e,param:n}))},i.prototype.beginSimulation=function(e,t){t?this.send("sim_estimate",e):this.send("sim_start",e),this.running=!0},i.prototype.abortSimulation=function(e){this.send("sim_abort"),this.running=!1},i}),define("liveq/core",["liveq/LiveQ","liveq/LabSocket"],function(e,t){var n={__cbIpolOk:null,__cbIpolError:null,__pendingIpol:!1,__cbSimOk:null,__cbSimData:null,__cbSimError:null,__cbSimLog:null,__pendingSim:!1,__lastLabID:null,__lastSimHist:[],__simSocket:null,__simSocketDel:!1,socket:null};return n.openSocket=function(e,n,r){if(this.__lastLabID==e){n&&n();return}this.__lastLabID=e,this.socket&&(this.__pendingSim?this.__simSocketDel=!0:this.socket.close()),this.socket=new t(e);var i=function(e){this.__pendingIpol&&(this.__cbIpolError&&this.__cbIpolError(e),this.__pendingIpol=!1,this.__cbIpolError=null,this.__cbIpolOk=null),this.__pendingSim&&(this.__cbIpolError&&this.__cbIpolError(e),this.__pendingSim=!1,this.__cbSimError=null,this.__cbSimData=null,this.__cbSimOk=null,this.__cbSimLog=null,this.__simSocketDel&&(this.__simSocketDel=!1,this.__simSocket.close(),this.__simSocket=null))}.bind(this);this.socket.on("connected",function(){}.bind(this)),this.socket.on("ready",function(e){n&&n()}.bind(this)),this.socket.on("log",function(e,t){this.__cbSimLog&&this.__cbSimLog(e,t)}.bind(this)),this.socket.on("error",function(e){r&&r(e),i("Socket error: "+e)}.bind(this)),this.socket.on("histogramsUpdated",function(e,t){t?(this.__cbIpolOk&&this.__cbIpolOk(e),this.__pendingIpol=!1,this.__cbIpolOk=null,this.__cbIpolError=null):(this.__lastSimHist=e,this.__cbSimData&&this.__cbSimData(e))}.bind(this)),this.socket.on("runCompleted",function(){this.__cbSimOk(this.__lastSimHist),this.__pendingSim=!1,this.__cbSimError=null,this.__cbSimData=null,this.__cbSimOk=null,this.__cbSimLog=null,this.__simSocketDel&&(this.__simSocketDel=!1,this.__simSocket.close(),this.__simSocket=null)}.bind(this)),this.socket.on("runError",i),this.socket.connect()},n.requestInterpolation=function(e,t,n){this.__pendingIpol&&this.__cbIpolError&&this.__cbIpolError("Aborted");if(!this.socket||!this.socket.connected){n&&n("Lab socket not initialized!");return}this.__cbIpolOk=t,this.__cbIpolError=n,this.__pendingIpol=!0,this.socket.beginSimulation(e,!0)},n.requestRun=function(e,t,n,r,i){this.__pendingSim&&this.__cbSimError&&this.__cbSimError("Aborted");if(!this.socket||!this.socket.connected){r&&r("Lab socket not initialized!");return}this.__cbSimData=t,this.__cbSimOk=n,this.__cbSimError=r,this.__cbSimLog=i,this.__pendingSim=!0,this.__simSocket=this.socket,this.socket.beginSimulation(e,!1)},n.abortRun=function(){if(!this.__pendingSim)return;this.__cbSimError&&this.__cbSimError("Aborted"),this.socket.abortSimulation(),this.__pendingSim=!1,this.__cbSimError=null,this.__cbSimData=null,this.__cbSimOk=null,this.__cbSimLog=null,this.__simSocketDel&&(this.__simSocketDel=!1,this.__simSocket.close(),this.__simSocket=null)},n}),define("core/main",["jquery","core/config","core/registry","core/ui","core/db","core/user","core/base/components","core/util/progress_aggregator","liveq/core"],function(e,t,n,r,i,s,o,u,a){var f={},l=function(){this.onUpdate=null,this.onCompleted=null,this.progress=0,this.started=!1,this.data=null,this.step=function(){this.progress+=.01,this.progress>=1?(this.progress=1,this.onCompleted&&this.onCompleted()):setTimeout(this.step.bind(this),100),this.onUpdate&&this.onUpdate(this.data,this.progress)},this.start=function(){if(this.started)return;this.started=!0,this.step()}};return f.initialize=function(l){r.initialize(),f.alertUnload=!1,f.referenceHistograms=null;var c=r.initAndPlaceScreen("screen.progress",o.ProgressScreen);if(!c){console.error("Core: Unable to initialize progress screen!");return}var h=new u;h.on("progress",function(e,t){c.onProgress(e,t)}),h.on("error",function(e){c.onProgressError(e)}),h.on("completed",function(){c.onProgressCompleted(),l&&l()});var p=e('<div class="'+t.css["nav-mini"]+'"></div>');r.host.append(p),r.mininav=n.instanceComponent("nav.mini",p);if(r.mininav!==undefined){var d=r.mininav.getPreferredSize();d!=undefined?(p,css({width:d[0],height:d[1]}),r.mininav.onResize(d[0],d[1])):r.mininav.onResize(p.width(),p.height()),r.mininav.on("changeScreen",function(e){e=="screen.home"?f.displayHome(!0):r.selectScreen(e,r.Transitions.ZOOM_OUT)})}var v=h.begin(6),m=function(e){var t=[function(e){var t=i.openDatabase("tunables").all(function(t){v.ok("Fetched tunable configuration"),i.cache.tunables=t,e()})},function(e){var t=i.openDatabase("observables").all(function(t){v.ok("Fetched observable configuration"),i.cache.observables=t,e()})},function(e){var t=i.openDatabase("topic_map").all(function(t){v.ok("Fetched topic map"),i.cache.topics=t,i.cache.topic_root=null,i.cache.topic_index={};for(var n=0;n<t.length;n++){var r=t[n];r.children=[],i.cache.topic_index[r._id]=r,r.parent||(i.cache.topic_root=r)}for(var n=0;n<t.length;n++){var r=t[n];r.parent&&i.cache.topic_index[r.parent].children.push(r)}e()})},function(e){var t=i.openDatabase("tasks").all(function(t){v.ok("Fetched tasks"),i.cache.tasks={};for(var n=0;n<t.length;n++)i.cache.tasks[t[n]._id]=t[n];e()})},function(e){var t=i.openDatabase("first_time").all(function(t){v.ok("Fetched first-time definitions");var n={};for(var r=0;r<t.length;r++)n[t[r]._id]=t[r];i.cache.first_time=n,e()})},function(e){var t=i.openDatabase("definitions").all(function(t){v.ok("Fetched definitions");var n={};for(var r=0;r<t.length;r++)n[t[r]._id]=t[r];i.cache.definitions=n,e()})}],n=0,r=function(){n>=t.length?e():(t[n](r),n+=1)};r()},g=h.begin(1),y=function(e){var t=r.initAndPlaceScreen("screen.login");if(!t){console.error("Core: Unable to initialize login screen!");return}t.on("login",function(e,t){s.login({username:e,password:t},function(e,t){e?f.displayHome():alert("Could not log-in! "+t)})}),t.on("register",function(e,t){s.register({username:e,password:t},function(e,t){e?f.displayHome():alert("Could not register the user! "+t)})}),g.ok("Home screen ready"),e()},b=h.begin(1),w=function(e){var t=f.scrResults=r.initAndPlaceScreen("screen.results");if(!t){console.error("Core: Unable to initialize results screen!");return}t.on("hideResults",function(){r.selectPreviousScreen()}),b.ok("Results screen ready"),e()},E=h.begin(1),S=function(e){var t=f.scrHome=r.initAndPlaceScreen("screen.home");if(!t){console.error("Core: Unable to initialize home screen!");return}t.on("changeScreen",function(e){r.selectScreen(e)}),t.on("explainTopic",function(e){f.displayExplainTopic(e)}),E.ok("Home screen ready"),e()},x=h.begin(1),T=function(e){var t=f.scrRunning=r.initAndPlaceScreen("screen.running");if(!t){console.error("Core: Unable to initialize run screen!");return}t.on("abortRun",function(){a.abortRun(),r.selectScreen("screen.tuning")}),x.ok("Run screen ready"),e()},N=h.begin(1),C=function(e){var t=f.scrExplain=r.initAndPlaceScreen("screen.explain",o.ExplainScreen);if(!t){console.error("Core: Unable to initialize explaination screen!");return}t.onTunablesDefined(i.cache.tunables),t.onObservablesDefined(i.cache.observables),t.onScenesDefined(i.cache.scenes);var n=i.cache.definitions["machine-diagram"]||{layout:[]};t.onMachineLayoutDefined(n.layout),t.on("hideExplain",function(){f.displayHome(!0)}),t.on("startTask",function(e){f.displayTuningScreen(e)}),N.ok("Explaination screen ready"),e()},k=h.begin(1),L=function(e){var t=f.scrTuning=r.initAndPlaceScreen("screen.tuning",o.TuningScreen);if(!t){console.error("Core: Unable to initialize explaination screen!");return}t.onTunablesDefined(i.cache.tunables),t.onObservablesDefined(i.cache.observables),t.on("explainParameter",function(e){r.selectScreen("screen.explain").onParameterFocus(e)}),t.on("submitParameters",function(e){f.displayRunningScreen(e,f.referenceHistograms)}),t.on("interpolateParameters",function(e){a.requestInterpolation(e,function(e){t.onUpdate(e),f.referenceHistograms=e},function(e){alert("Could not request interpolation! "+e)})}),k.ok("Tuning screen ready"),e()};setTimeout(function(){var t=[m,S,y,C,L,T,w],n=function(e,r){var i=r||0;console.log("---",i);if(i>=t.length){e();return}t[i](function(){n(e,i+1)})};n(function(){e(window).bind("beforeunload",function(){if(f.alertUnload)return"Navigating away will stop your current game session."})})},500)},f.displayHome=function(e){f.scrHome.onTopicTreeUpdated(s.getTopicTree()),r.selectScreen("screen.home",e?r.Transitions.ZOOM_OUT:r.Transitions.ZOOM_IN)},f.displayExplainTopic=function(e){if(!e)return;f.scrExplain.onTopicUpdated(s.getTopicDetails(e)),r.selectScreen("screen.explain")},f.displayTuningScreen=function(e){f.scrTuning.onStartTask(s.getTaskDetails(e)),r.selectScreen("screen.tuning")},f.displayRunningScreen=function(e,t){f.scrRunning.onStartRun(e,t);var n=new l;n.onUpdate=f.scrRunning.onUpdate.bind(f.scrRunning);var i=function(e){var t=0;for(var n=0;n<e.length;n++)t+=LiveQCalc.chi2WithError(e[n].data,e[n].ref.data);t/=e.length,r.displayResultsScreen(t)};a.requestRun(e,function(e){n.data=e,n.start()},function(e){f.scrRunning.onUpdate(e)},function(e){if(e=="Aborted")return;alert("Simulation Error: "+e),f.displayHome()},function(e,t){t.agent_added?f.scrRunning.onWorkerAdded(t.agent_added,{lat:Math.random()*180-90,lng:Math.random()*180}):t.agent_removed&&f.scrRunning.onWorkerRemoved(t.agent_removed),console.log(">>> ",e,t)}),r.selectScreen("screen.running")},f.displayResultsScreen=function(e){f.scrResults.onUpdate(e),r.selectScreen("screen.results"),e<=Config["chi2-bounds"].good||e<=Config["chi2-bounds"].average},f.run=function(){r.selectScreen("screen.login")},f}),!function(){function e(e,t){return t>e?-1:e>t?1:e>=t?0:0/0}function t(e){return null!=e&&!isNaN(e)}function n(e){return{left:function(t,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var s=r+i>>>1;e(t[s],n)<0?r=s+1:i=s}return r},right:function(t,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var s=r+i>>>1;e(t[s],n)>0?i=s:r=s+1}return r}}}function r(e){return e.length}function i(e){for(var t=1;e*t%1;)t*=10;return t}function s(e,t){try{for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}catch(r){e.prototype=t}}function o(){}function u(e){return lu+e in this}function a(e){return e=lu+e,e in this&&delete this[e]}function f(){var e=[];return this.forEach(function(t){e.push(t)}),e}function l(){var e=0;for(var t in this)t.charCodeAt(0)===cu&&++e;return e}function c(){for(var e in this)if(e.charCodeAt(0)===cu)return!1;return!0}function h(){}function p(e,t,n){return function(){var r=n.apply(t,arguments);return r===t?e:r}}function d(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.substring(1);for(var n=0,r=hu.length;r>n;++n){var i=hu[n]+t;if(i in e)return i}}function v(){}function m(){}function g(e){function t(){for(var t,r=n,i=-1,s=r.length;++i<s;)(t=r[i].on)&&t.apply(this,arguments);return e}var n=[],r=new o;return t.on=function(t,i){var s,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,s=n.indexOf(o)).concat(n.slice(s+1)),r.remove(t)),i&&n.push(r.set(t,{on:i})),e)},t}function y(){Ko.event.preventDefault()}function b(){for(var e,t=Ko.event;e=t.sourceEvent;)t=e;return t}function w(e){for(var t=new m,n=0,r=arguments.length;++n<r;)t[arguments[n]]=g(t);return t.of=function(n,r){return function(i){try{var s=i.sourceEvent=Ko.event;i.target=e,Ko.event=i,t[i.type].apply(n,r)}finally{Ko.event=s}}},t}function E(e){return du(e,bu),e}function S(e){return"function"==typeof e?e:function(){return vu(e,this)}}function x(e){return"function"==typeof e?e:function(){return mu(e,this)}}function T(e,t){function n(){this.removeAttribute(e)}function r(){this.removeAttributeNS(e.space,e.local)}function i(){this.setAttribute(e,t)}function s(){this.setAttributeNS(e.space,e.local,t)}function o(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}function u(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}return e=Ko.ns.qualify(e),null==t?e.local?r:n:"function"==typeof t?e.local?u:o:e.local?s:i}function N(e){return e.trim().replace(/\s+/g," ")}function C(e){return new RegExp("(?:^|\\s+)"+Ko.requote(e)+"(?:\\s+|$)","g")}function k(e){return e.trim().split(/^|\s+/)}function L(e,t){function n(){for(var n=-1;++n<i;)e[n](this,t)}function r(){for(var n=-1,r=t.apply(this,arguments);++n<i;)e[n](this,r)}e=k(e).map(A);var i=e.length;return"function"==typeof t?r:n}function A(e){var t=C(e);return function(n,r){if(i=n.classList)return r?i.add(e):i.remove(e);var i=n.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||n.setAttribute("class",N(i+" "+e))):n.setAttribute("class",N(i.replace(t," ")))}}function O(e,t,n){function r(){this.style.removeProperty(e)}function i(){this.style.setProperty(e,t,n)}function s(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}return null==t?r:"function"==typeof t?s:i}function M(e,t){function n(){delete this[e]}function r(){this[e]=t}function i(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}return null==t?n:"function"==typeof t?i:r}function _(e){return"function"==typeof e?e:(e=Ko.ns.qualify(e)).local?function(){return this.ownerDocument.createElementNS(e.space,e.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,e)}}function D(e){return{__data__:e}}function P(e){return function(){return yu(this,e)}}function H(t){return arguments.length||(t=e),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}function B(e,t){for(var n=0,r=e.length;r>n;n++)for(var i,s=e[n],o=0,u=s.length;u>o;o++)(i=s[o])&&t(i,o,n);return e}function j(e){return du(e,Eu),e}function F(e){var t,n;return function(r,i,s){var o,u=e[s].update,a=u.length;for(s!=n&&(n=s,t=0),i>=t&&(t=i+1);!(o=u[t])&&++t<a;);return o}}function I(){var e=this.__transition__;e&&++e.active}function q(e,t,n){function r(){var t=this[o];t&&(this.removeEventListener(e,t,t.$),delete this[o])}function i(){var i=a(t,Go(arguments));r.call(this),this.addEventListener(e,this[o]=i,i.$=n),i._=t}function s(){var t,n=new RegExp("^__on([^.]+)"+Ko.requote(e)+"$");for(var r in this)if(t=r.match(n)){var i=this[r];this.removeEventListener(t[1],i,i.$),delete this[r]}}var o="__on"+e,u=e.indexOf("."),a=R;u>0&&(e=e.substring(0,u));var f=xu.get(e);return f&&(e=f,a=U),u?t?i:r:t?v:s}function R(e,t){return function(n){var r=Ko.event;Ko.event=n,t[0]=this.__data__;try{e.apply(this,t)}finally{Ko.event=r}}}function U(e,t){var n=R(e,t);return function(e){var t=this,r=e.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||n.call(t,e)}}function z(){var e=".dragsuppress-"+ ++Nu,t="click"+e,n=Ko.select(eu).on("touchmove"+e,y).on("dragstart"+e,y).on("selectstart"+e,y);if(Tu){var r=Zo.style,i=r[Tu];r[Tu]="none"}return function(s){function o(){n.on(t,null)}n.on(e,null),Tu&&(r[Tu]=i),s&&(n.on(t,function(){y(),o()},!0),setTimeout(o,0))}}function W(e,t){t.changedTouches&&(t=t.changedTouches[0]);var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=t.clientX,r.y=t.clientY,r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var i=e.getBoundingClientRect();return[t.clientX-i.left-e.clientLeft,t.clientY-i.top-e.clientTop]}function X(){return Ko.event.changedTouches[0].identifier}function V(){return Ko.event.target}function $(){return eu}function J(e){return e>0?1:0>e?-1:0}function K(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function Q(e){return e>1?0:-1>e?Cu:Math.acos(e)}function G(e){return e>1?Lu:-1>e?-Lu:Math.asin(e)}function Y(e){return((e=Math.exp(e))-1/e)/2}function Z(e){return((e=Math.exp(e))+1/e)/2}function et(e){return((e=Math.exp(2*e))-1)/(e+1)}function tt(e){return(e=Math.sin(e/2))*e}function nt(){}function rt(e,t,n){return new it(e,t,n)}function it(e,t,n){this.h=e,this.s=t,this.l=n}function st(e,t,n){function r(e){return e>360?e-=360:0>e&&(e+=360),60>e?s+(o-s)*e/60:180>e?o:240>e?s+(o-s)*(240-e)/60:s}function i(e){return Math.round(255*r(e))}var s,o;return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:0>t?0:t>1?1:t,n=0>n?0:n>1?1:n,o=.5>=n?n*(1+t):n+t-n*t,s=2*n-o,yt(i(e+120),i(e),i(e-120))}function ot(e,t,n){return new ut(e,t,n)}function ut(e,t,n){this.h=e,this.c=t,this.l=n}function at(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),ft(n,Math.cos(e*=Mu)*t,Math.sin(e)*t)}function ft(e,t,n){return new lt(e,t,n)}function lt(e,t,n){this.l=e,this.a=t,this.b=n}function ct(e,t,n){var r=(e+16)/116,i=r+t/500,s=r-n/200;return i=pt(i)*Uu,r=pt(r)*zu,s=pt(s)*Wu,yt(vt(3.2404542*i-1.5371385*r-.4985314*s),vt(-0.969266*i+1.8760108*r+.041556*s),vt(.0556434*i-.2040259*r+1.0572252*s))}function ht(e,t,n){return e>0?ot(Math.atan2(n,t)*_u,Math.sqrt(t*t+n*n),e):ot(0/0,0/0,e)}function pt(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function dt(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function vt(e){return Math.round(255*(.00304>=e?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function mt(e){return yt(e>>16,255&e>>8,255&e)}function gt(e){return mt(e)+""}function yt(e,t,n){return new bt(e,t,n)}function bt(e,t,n){this.r=e,this.g=t,this.b=n}function wt(e){return 16>e?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function Et(e,t,n){var r,i,s,o=0,u=0,a=0;if(r=/([a-z]+)\((.*)\)/i.exec(e))switch(i=r[2].split(","),r[1]){case"hsl":return n(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(Nt(i[0]),Nt(i[1]),Nt(i[2]))}return(s=$u.get(e))?t(s.r,s.g,s.b):(null==e||"#"!==e.charAt(0)||isNaN(s=parseInt(e.substring(1),16))||(4===e.length?(o=(3840&s)>>4,o=o>>4|o,u=240&s,u=u>>4|u,a=15&s,a=a<<4|a):7===e.length&&(o=(16711680&s)>>16,u=(65280&s)>>8,a=255&s)),t(o,u,a))}function St(e,t,n){var r,i,s=Math.min(e/=255,t/=255,n/=255),o=Math.max(e,t,n),u=o-s,a=(o+s)/2;return u?(i=.5>a?u/(o+s):u/(2-o-s),r=e==o?(t-n)/u+(n>t?6:0):t==o?(n-e)/u+2:(e-t)/u+4,r*=60):(r=0/0,i=a>0&&1>a?0:r),rt(r,i,a)}function xt(e,t,n){e=Tt(e),t=Tt(t),n=Tt(n);var r=dt((.4124564*e+.3575761*t+.1804375*n)/Uu),i=dt((.2126729*e+.7151522*t+.072175*n)/zu),s=dt((.0193339*e+.119192*t+.9503041*n)/Wu);return ft(116*i-16,500*(r-i),200*(i-s))}function Tt(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Nt(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}function Ct(e){return"function"==typeof e?e:function(){return e}}function kt(e){return e}function Lt(e){return function(t,n,r){return 2===arguments.length&&"function"==typeof n&&(r=n,n=null),At(t,n,e,r)}}function At(e,t,n,r){function i(){var e,t=a.status;if(!t&&a.responseText||t>=200&&300>t||304===t){try{e=n.call(s,a)}catch(r){return o.error.call(s,r),void 0}o.load.call(s,e)}else o.error.call(s,a)}var s={},o=Ko.dispatch("beforesend","progress","load","error"),u={},a=new XMLHttpRequest,f=null;return!eu.XDomainRequest||"withCredentials"in a||!/^(http(s)?:)?\/\//.test(e)||(a=new XDomainRequest),"onload"in a?a.onload=a.onerror=i:a.onreadystatechange=function(){a.readyState>3&&i()},a.onprogress=function(e){var t=Ko.event;Ko.event=e;try{o.progress.call(s,a)}finally{Ko.event=t}},s.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?u[e]:(null==t?delete u[e]:u[e]=t+"",s)},s.mimeType=function(e){return arguments.length?(t=null==e?null:e+"",s):t},s.responseType=function(e){return arguments.length?(f=e,s):f},s.response=function(e){return n=e,s},["get","post"].forEach(function(e){s[e]=function(){return s.send.apply(s,[e].concat(Go(arguments)))}}),s.send=function(n,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),a.open(n,e,!0),null==t||"accept"in u||(u.accept=t+",*/*"),a.setRequestHeader)for(var l in u)a.setRequestHeader(l,u[l]);return null!=t&&a.overrideMimeType&&a.overrideMimeType(t),null!=f&&(a.responseType=f),null!=i&&s.on("error",i).on("load",function(e){i(null,e)}),o.beforesend.call(s,a),a.send(null==r?null:r),s},s.abort=function(){return a.abort(),s},Ko.rebind(s,o,"on"),null==r?s:s.get(Ot(r))}function Ot(e){return 1===e.length?function(t,n){e(null==t?n:null)}:e}function Mt(){var e=_t(),t=Dt()-e;t>24?(isFinite(t)&&(clearTimeout(Gu),Gu=setTimeout(Mt,t)),Qu=0):(Qu=1,Zu(Mt))}function _t(){var e=Date.now();for(Yu=Ju;Yu;)e>=Yu.t&&(Yu.f=Yu.c(e-Yu.t)),Yu=Yu.n;return e}function Dt(){for(var e,t=Ju,n=1/0;t;)t.f?t=e?e.n=t.n:Ju=t.n:(t.t<n&&(n=t.t),t=(e=t).n);return Ku=e,n}function Pt(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}function Ht(e,t){var n=Math.pow(10,3*fu(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function Bt(e){var t=e.decimal,n=e.thousands,r=e.grouping,i=e.currency,s=r?function(e){for(var t=e.length,i=[],s=0,o=r[0];t>0&&o>0;)i.push(e.substring(t-=o,t+o)),o=r[s=(s+1)%r.length];return i.reverse().join(n)}:kt;return function(e){var n=ta.exec(e),r=n[1]||" ",o=n[2]||">",u=n[3]||"",a=n[4]||"",f=n[5],l=+n[6],c=n[7],h=n[8],p=n[9],d=1,v="",m="",g=!1;switch(h&&(h=+h.substring(1)),(f||"0"===r&&"="===o)&&(f=r="0",o="=",c&&(l-=Math.floor((l-1)/4))),p){case"n":c=!0,p="g";break;case"%":d=100,m="%",p="f";break;case"p":d=100,m="%",p="r";break;case"b":case"o":case"x":case"X":"#"===a&&(v="0"+p.toLowerCase());case"c":case"d":g=!0,h=0;break;case"s":d=-1,p="r"}"$"===a&&(v=i[0],m=i[1]),"r"!=p||h||(p="g"),null!=h&&("g"==p?h=Math.max(1,Math.min(21,h)):("e"==p||"f"==p)&&(h=Math.max(0,Math.min(20,h)))),p=na.get(p)||jt;var y=f&&c;return function(e){var n=m;if(g&&e%1)return"";var i=0>e||0===e&&0>1/e?(e=-e,"-"):u;if(0>d){var a=Ko.formatPrefix(e,h);e=a.scale(e),n=a.symbol+m}else e*=d;e=p(e,h);var b=e.lastIndexOf("."),w=0>b?e:e.substring(0,b),E=0>b?"":t+e.substring(b+1);!f&&c&&(w=s(w));var S=v.length+w.length+E.length+(y?0:i.length),x=l>S?(new Array(S=l-S+1)).join(r):"";return y&&(w=s(x+w)),i+=v,e=w+E,("<"===o?i+e+x:">"===o?x+i+e:"^"===o?x.substring(0,S>>=1)+i+e+x.substring(S):i+(y?e:x+e))+n}}}function jt(e){return e+""}function Ft(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function It(e,t,n){function r(t){var n=e(t),r=s(n,1);return r-t>t-n?n:r}function i(n){return t(n=e(new ia(n-1)),1),n}function s(e,n){return t(e=new ia(+e),n),e}function o(e,r,s){var o=i(e),u=[];if(s>1)for(;r>o;)n(o)%s||u.push(new Date(+o)),t(o,1);else for(;r>o;)u.push(new Date(+o)),t(o,1);return u}function u(e,t,n){try{ia=Ft;var r=new Ft;return r._=e,o(r,t,n)}finally{ia=Date}}e.floor=e,e.round=r,e.ceil=i,e.offset=s,e.range=o;var a=e.utc=qt(e);return a.floor=a,a.round=qt(r),a.ceil=qt(i),a.offset=qt(s),a.range=u,e}function qt(e){return function(t,n){try{ia=Ft;var r=new Ft;return r._=t,e(r,n)._}finally{ia=Date}}}function Rt(e){function t(e){function t(t){for(var n,i,s,o=[],u=-1,a=0;++u<r;)37===e.charCodeAt(u)&&(o.push(e.substring(a,u)),null!=(i=oa[n=e.charAt(++u)])&&(n=e.charAt(++u)),(s=L[n])&&(n=s(t,null==i?"e"===n?" ":"0":i)),o.push(n),a=u+1);return o.push(e.substring(a,u)),o.join("")}var r=e.length;return t.parse=function(t){var r={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},i=n(r,e,t,0);if(i!=t.length)return null;"p"in r&&(r.H=r.H%12+12*r.p);var s=null!=r.Z&&ia!==Ft,o=new(s?Ft:ia);return"j"in r?o.setFullYear(r.y,0,r.j):"w"in r&&("W"in r||"U"in r)?(o.setFullYear(r.y,0,1),o.setFullYear(r.y,0,"W"in r?(r.w+6)%7+7*r.W-(o.getDay()+5)%7:r.w+7*r.U-(o.getDay()+6)%7)):o.setFullYear(r.y,r.m,r.d),o.setHours(r.H+Math.floor(r.Z/100),r.M+r.Z%100,r.S,r.L),s?o._:o},t.toString=function(){return e},t}function n(e,t,n,r){for(var i,s,o,u=0,a=t.length,f=n.length;a>u;){if(r>=f)return-1;if(i=t.charCodeAt(u++),37===i){if(o=t.charAt(u++),s=A[o in oa?t.charAt(u++):o],!s||(r=s(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function r(e,t,n){S.lastIndex=0;var r=S.exec(t.substring(n));return r?(e.w=x.get(r[0].toLowerCase()),n+r[0].length):-1}function i(e,t,n){w.lastIndex=0;var r=w.exec(t.substring(n));return r?(e.w=E.get(r[0].toLowerCase()),n+r[0].length):-1}function s(e,t,n){C.lastIndex=0;var r=C.exec(t.substring(n));return r?(e.m=k.get(r[0].toLowerCase()),n+r[0].length):-1}function o(e,t,n){T.lastIndex=0;var r=T.exec(t.substring(n));return r?(e.m=N.get(r[0].toLowerCase()),n+r[0].length):-1}function u(e,t,r){return n(e,L.c.toString(),t,r)}function a(e,t,r){return n(e,L.x.toString(),t,r)}function f(e,t,r){return n(e,L.X.toString(),t,r)}function l(e,t,n){var r=b.get(t.substring(n,n+=2).toLowerCase());return null==r?-1:(e.p=r,n)}var c=e.dateTime,h=e.date,p=e.time,d=e.periods,v=e.days,m=e.shortDays,g=e.months,y=e.shortMonths;t.utc=function(e){function n(e){try{ia=Ft;var t=new ia;return t._=e,r(t)}finally{ia=Date}}var r=t(e);return n.parse=function(e){try{ia=Ft;var t=r.parse(e);return t&&t._}finally{ia=Date}},n.toString=r.toString,n},t.multi=t.utc.multi=an;var b=Ko.map(),w=zt(v),E=Wt(v),S=zt(m),x=Wt(m),T=zt(g),N=Wt(g),C=zt(y),k=Wt(y);d.forEach(function(e,t){b.set(e.toLowerCase(),t)});var L={a:function(e){return m[e.getDay()]},A:function(e){return v[e.getDay()]},b:function(e){return y[e.getMonth()]},B:function(e){return g[e.getMonth()]},c:t(c),d:function(e,t){return Ut(e.getDate(),t,2)},e:function(e,t){return Ut(e.getDate(),t,2)},H:function(e,t){return Ut(e.getHours(),t,2)},I:function(e,t){return Ut(e.getHours()%12||12,t,2)},j:function(e,t){return Ut(1+ra.dayOfYear(e),t,3)},L:function(e,t){return Ut(e.getMilliseconds(),t,3)},m:function(e,t){return Ut(e.getMonth()+1,t,2)},M:function(e,t){return Ut(e.getMinutes(),t,2)},p:function(e){return d[+(e.getHours()>=12)]},S:function(e,t){return Ut(e.getSeconds(),t,2)},U:function(e,t){return Ut(ra.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return Ut(ra.mondayOfYear(e),t,2)},x:t(h),X:t(p),y:function(e,t){return Ut(e.getFullYear()%100,t,2)},Y:function(e,t){return Ut(e.getFullYear()%1e4,t,4)},Z:on,"%":function(){return"%"}},A={a:r,A:i,b:s,B:o,c:u,d:Zt,e:Zt,H:tn,I:tn,j:en,L:sn,m:Yt,M:nn,p:l,S:rn,U:Vt,w:Xt,W:$t,x:a,X:f,y:Kt,Y:Jt,Z:Qt,"%":un};return t}function Ut(e,t,n){var r=0>e?"-":"",i=(r?-e:e)+"",s=i.length;return r+(n>s?(new Array(n-s+1)).join(t)+i:i)}function zt(e){return new RegExp("^(?:"+e.map(Ko.requote).join("|")+")","i")}function Wt(e){for(var t=new o,n=-1,r=e.length;++n<r;)t.set(e[n].toLowerCase(),n);return t}function Xt(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Vt(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n));return r?(e.U=+r[0],n+r[0].length):-1}function $t(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n));return r?(e.W=+r[0],n+r[0].length):-1}function Jt(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Kt(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n,n+2));return r?(e.y=Gt(+r[0]),n+r[0].length):-1}function Qt(e,t,n){return/^[+-]\d{4}$/.test(t=t.substring(n,n+5))?(e.Z=-t,n+5):-1}function Gt(e){return e+(e>68?1900:2e3)}function Yt(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Zt(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function en(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n,n+3));return r?(e.j=+r[0],n+r[0].length):-1}function tn(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function nn(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function rn(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function sn(e,t,n){ua.lastIndex=0;var r=ua.exec(t.substring(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function on(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=~~(fu(t)/60),i=fu(t)%60;return n+Ut(r,"0",2)+Ut(i,"0",2)}function un(e,t,n){aa.lastIndex=0;var r=aa.exec(t.substring(n,n+1));return r?n+r[0].length:-1}function an(e){for(var t=e.length,n=-1;++n<t;)e[n][0]=this(e[n][0]);return function(t){for(var n=0,r=e[n];!r[1](t);)r=e[++n];return r[0](t)}}function fn(){}function ln(e,t,n){var r=n.s=e+t,i=r-e,s=r-i;n.t=e-s+(t-i)}function cn(e,t){e&&ha.hasOwnProperty(e.type)&&ha[e.type](e,t)}function hn(e,t,n){var r,i=-1,s=e.length-n;for(t.lineStart();++i<s;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function pn(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)hn(e[n],t,1);t.polygonEnd()}function dn(){function e(e,t){e*=Mu,t=t*Mu/2+Cu/4;var n=e-r,o=n>=0?1:-1,u=o*n,a=Math.cos(t),f=Math.sin(t),l=s*f,c=i*a+l*Math.cos(u),h=l*o*Math.sin(u);da.add(Math.atan2(h,c)),r=e,i=a,s=f}var t,n,r,i,s;va.point=function(o,u){va.point=e,r=(t=o)*Mu,i=Math.cos(u=(n=u)*Mu/2+Cu/4),s=Math.sin(u)},va.lineEnd=function(){e(t,n)}}function vn(e){var t=e[0],n=e[1],r=Math.cos(n);return[r*Math.cos(t),r*Math.sin(t),Math.sin(n)]}function mn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function gn(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function yn(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function bn(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function wn(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function En(e){return[Math.atan2(e[1],e[0]),G(e[2])]}function Sn(e,t){return fu(e[0]-t[0])<Au&&fu(e[1]-t[1])<Au}function xn(e,t){e*=Mu;var n=Math.cos(t*=Mu);Tn(n*Math.cos(e),n*Math.sin(e),Math.sin(t))}function Tn(e,t,n){++ma,ya+=(e-ya)/ma,ba+=(t-ba)/ma,wa+=(n-wa)/ma}function Nn(){function e(e,i){e*=Mu;var s=Math.cos(i*=Mu),o=s*Math.cos(e),u=s*Math.sin(e),a=Math.sin(i),f=Math.atan2(Math.sqrt((f=n*a-r*u)*f+(f=r*o-t*a)*f+(f=t*u-n*o)*f),t*o+n*u+r*a);ga+=f,Ea+=f*(t+(t=o)),Sa+=f*(n+(n=u)),xa+=f*(r+(r=a)),Tn(t,n,r)}var t,n,r;ka.point=function(i,s){i*=Mu;var o=Math.cos(s*=Mu);t=o*Math.cos(i),n=o*Math.sin(i),r=Math.sin(s),ka.point=e,Tn(t,n,r)}}function Cn(){ka.point=xn}function kn(){function e(e,t){e*=Mu;var n=Math.cos(t*=Mu),o=n*Math.cos(e),u=n*Math.sin(e),a=Math.sin(t),f=i*a-s*u,l=s*o-r*a,c=r*u-i*o,h=Math.sqrt(f*f+l*l+c*c),p=r*o+i*u+s*a,d=h&&-Q(p)/h,v=Math.atan2(h,p);Ta+=d*f,Na+=d*l,Ca+=d*c,ga+=v,Ea+=v*(r+(r=o)),Sa+=v*(i+(i=u)),xa+=v*(s+(s=a)),Tn(r,i,s)}var t,n,r,i,s;ka.point=function(o,u){t=o,n=u,ka.point=e,o*=Mu;var a=Math.cos(u*=Mu);r=a*Math.cos(o),i=a*Math.sin(o),s=Math.sin(u),Tn(r,i,s)},ka.lineEnd=function(){e(t,n),ka.lineEnd=Cn,ka.point=xn}}function Ln(){return!0}function An(e,t,n,r,i){var s=[],o=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n=e[0],r=e[t];if(Sn(n,r)){i.lineStart();for(var u=0;t>u;++u)i.point((n=e[u])[0],n[1]);return i.lineEnd(),void 0}var a=new Mn(n,e,null,!0),f=new Mn(n,null,a,!1);a.o=f,s.push(a),o.push(f),a=new Mn(r,e,null,!1),f=new Mn(r,null,a,!0),a.o=f,s.push(a),o.push(f)}}),o.sort(t),On(s),On(o),s.length){for(var u=0,a=n,f=o.length;f>u;++u)o[u].e=a=!a;for(var l,c,h=s[0];;){for(var p=h,d=!0;p.v;)if((p=p.n)===h)return;l=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(d)for(var u=0,f=l.length;f>u;++u)i.point((c=l[u])[0],c[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(d){l=p.p.z;for(var u=l.length-1;u>=0;--u)i.point((c=l[u])[0],c[1])}else r(p.x,p.p.x,-1,i);p=p.p}p=p.o,l=p.z,d=!d}while(!p.v);i.lineEnd()}}}function On(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function Mn(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function _n(e,t,n,r){return function(i,s){function o(t,n){var r=i(t,n);e(t=r[0],n=r[1])&&s.point(t,n)}function u(e,t){var n=i(e,t);m.point(n[0],n[1])}function a(){y.point=u,m.lineStart()}function f(){y.point=o,m.lineEnd()}function l(e,t){v.push([e,t]);var n=i(e,t);w.point(n[0],n[1])}function c(){w.lineStart(),v=[]}function h(){l(v[0][0],v[0][1]),w.lineEnd();var e,t=w.clean(),n=b.buffer(),r=n.length;if(v.pop(),d.push(v),v=null,r)if(1&t){e=n[0];var i,r=e.length-1,o=-1;if(r>0){for(E||(s.polygonStart(),E=!0),s.lineStart();++o<r;)s.point((i=e[o])[0],i[1]);s.lineEnd()}}else r>1&&2&t&&n.push(n.pop().concat(n.shift())),p.push(n.filter(Dn))}var p,d,v,m=t(s),g=i.invert(r[0],r[1]),y={point:o,lineStart:a,lineEnd:f,polygonStart:function(){y.point=l,y.lineStart=c,y.lineEnd=h,p=[],d=[]},polygonEnd:function(){y.point=o,y.lineStart=a,y.lineEnd=f,p=Ko.merge(p);var e=Bn(g,d);p.length?(E||(s.polygonStart(),E=!0),An(p,Hn,e,n,s)):e&&(E||(s.polygonStart(),E=!0),s.lineStart(),n(null,null,1,s),s.lineEnd()),E&&(s.polygonEnd(),E=!1),p=d=null},sphere:function(){s.polygonStart(),s.lineStart(),n(null,null,1,s),s.lineEnd(),s.polygonEnd()}},b=Pn(),w=t(b),E=!1;return y}}function Dn(e){return e.length>1}function Pn(){var e,t=[];return{lineStart:function(){t.push(e=[])},point:function(t,n){e.push([t,n])},lineEnd:v,buffer:function(){var n=t;return t=[],e=null,n},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Hn(e,t){return((e=e.x)[0]<0?e[1]-Lu-Au:Lu-e[1])-((t=t.x)[0]<0?t[1]-Lu-Au:Lu-t[1])}function Bn(e,t){var n=e[0],r=e[1],i=[Math.sin(n),-Math.cos(n),0],s=0,o=0;da.reset();for(var u=0,a=t.length;a>u;++u){var f=t[u],l=f.length;if(l)for(var c=f[0],h=c[0],p=c[1]/2+Cu/4,d=Math.sin(p),v=Math.cos(p),m=1;;){m===l&&(m=0),e=f[m];var g=e[0],y=e[1]/2+Cu/4,b=Math.sin(y),w=Math.cos(y),E=g-h,S=E>=0?1:-1,x=S*E,T=x>Cu,N=d*b;if(da.add(Math.atan2(N*S*Math.sin(x),v*w+N*Math.cos(x))),s+=T?E+S*ku:E,T^h>=n^g>=n){var C=gn(vn(c),vn(e));wn(C);var k=gn(i,C);wn(k);var L=(T^E>=0?-1:1)*G(k[2]);(r>L||r===L&&(C[0]||C[1]))&&(o+=T^E>=0?1:-1)}if(!(m++))break;h=g,d=b,v=w,c=e}}return(-Au>s||Au>s&&0>da)^1&o}function jn(e){var t,n=0/0,r=0/0,i=0/0;return{lineStart:function(){e.lineStart(),t=1},point:function(s,o){var u=s>0?Cu:-Cu,a=fu(s-n);fu(a-Cu)<Au?(e.point(n,r=(r+o)/2>0?Lu:-Lu),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(u,r),e.point(s,r),t=0):i!==u&&a>=Cu&&(fu(n-i)<Au&&(n-=i*Au),fu(s-u)<Au&&(s-=u*Au),r=Fn(n,r,s,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(u,r),t=0),e.point(n=s,r=o),i=u},lineEnd:function(){e.lineEnd(),n=r=0/0},clean:function(){return 2-t}}}function Fn(e,t,n,r){var i,s,o=Math.sin(e-n);return fu(o)>Au?Math.atan((Math.sin(t)*(s=Math.cos(r))*Math.sin(n)-Math.sin(r)*(i=Math.cos(t))*Math.sin(e))/(i*s*o)):(t+r)/2}function In(e,t,n,r){var i;if(null==e)i=n*Lu,r.point(-Cu,i),r.point(0,i),r.point(Cu,i),r.point(Cu,0),r.point(Cu,-i),r.point(0,-i),r.point(-Cu,-i),r.point(-Cu,0),r.point(-Cu,i);else if(fu(e[0]-t[0])>Au){var s=e[0]<t[0]?Cu:-Cu;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function qn(e){function t(e,t){return Math.cos(e)*Math.cos(t)>s}function n(e){var n,s,a,f,l;return{lineStart:function(){f=a=!1,l=1},point:function(c,h){var p,d=[c,h],v=t(c,h),m=o?v?0:i(c,h):v?i(c+(0>c?Cu:-Cu),h):0;if(!n&&(f=a=v)&&e.lineStart(),v!==a&&(p=r(n,d),(Sn(n,p)||Sn(d,p))&&(d[0]+=Au,d[1]+=Au,v=t(d[0],d[1]))),v!==a)l=0,v?(e.lineStart(),p=r(d,n),e.point(p[0],p[1])):(p=r(n,d),e.point(p[0],p[1]),e.lineEnd()),n=p;else if(u&&n&&o^v){var g;m&s||!(g=r(d,n,!0))||(l=0,o?(e.lineStart(),e.point(g[0][0],g[0][1]),e.point(g[1][0],g[1][1]),e.lineEnd()):(e.point(g[1][0],g[1][1]),e.lineEnd(),e.lineStart(),e.point(g[0][0],g[0][1])))}!v||n&&Sn(n,d)||e.point(d[0],d[1]),n=d,a=v,s=m},lineEnd:function(){a&&e.lineEnd(),n=null},clean:function(){return l|(f&&a)<<1}}}function r(e,t,n){var r=vn(e),i=vn(t),o=[1,0,0],u=gn(r,i),a=mn(u,u),f=u[0],l=a-f*f;if(!l)return!n&&e;var c=s*a/l,h=-s*f/l,p=gn(o,u),d=bn(o,c),v=bn(u,h);yn(d,v);var m=p,g=mn(d,m),y=mn(m,m),b=g*g-y*(mn(d,d)-1);if(!(0>b)){var w=Math.sqrt(b),E=bn(m,(-g-w)/y);if(yn(E,d),E=En(E),!n)return E;var S,x=e[0],T=t[0],N=e[1],C=t[1];x>T&&(S=x,x=T,T=S);var k=T-x,L=fu(k-Cu)<Au,A=L||Au>k;if(!L&&N>C&&(S=N,N=C,C=S),A?L?N+C>0^E[1]<(fu(E[0]-x)<Au?N:C):N<=E[1]&&E[1]<=C:k>Cu^(x<=E[0]&&E[0]<=T)){var O=bn(m,(-g+w)/y);return yn(O,d),[E,En(O)]}}}function i(t,n){var r=o?e:Cu-e,i=0;return-r>t?i|=1:t>r&&(i|=2),-r>n?i|=4:n>r&&(i|=8),i}var s=Math.cos(e),o=s>0,u=fu(s)>Au,a=dr(e,6*Mu);return _n(t,n,a,o?[0,-e]:[-Cu,e-Cu])}function Rn(e,t,n,r){return function(i){var s,o=i.a,u=i.b,a=o.x,f=o.y,l=u.x,c=u.y,h=0,p=1,d=l-a,v=c-f;if(s=e-a,d||!(s>0)){if(s/=d,0>d){if(h>s)return;p>s&&(p=s)}else if(d>0){if(s>p)return;s>h&&(h=s)}if(s=n-a,d||!(0>s)){if(s/=d,0>d){if(s>p)return;s>h&&(h=s)}else if(d>0){if(h>s)return;p>s&&(p=s)}if(s=t-f,v||!(s>0)){if(s/=v,0>v){if(h>s)return;p>s&&(p=s)}else if(v>0){if(s>p)return;s>h&&(h=s)}if(s=r-f,v||!(0>s)){if(s/=v,0>v){if(s>p)return;s>h&&(h=s)}else if(v>0){if(h>s)return;p>s&&(p=s)}return h>0&&(i.a={x:a+h*d,y:f+h*v}),1>p&&(i.b={x:a+p*d,y:f+p*v}),i}}}}}}function Un(e,t,n,r){function i(r,i){return fu(r[0]-e)<Au?i>0?0:3:fu(r[0]-n)<Au?i>0?2:1:fu(r[1]-t)<Au?i>0?1:0:i>0?3:2}function s(e,t){return o(e.x,t.x)}function o(e,t){var n=i(e,1),r=i(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(u){function a(e){for(var t=0,n=m.length,r=e[1],i=0;n>i;++i)for(var s,o=1,u=m[i],a=u.length,f=u[0];a>o;++o)s=u[o],f[1]<=r?s[1]>r&&K(f,s,e)>0&&++t:s[1]<=r&&K(f,s,e)<0&&--t,f=s;return 0!==t}function f(s,u,a,f){var l=0,c=0;if(null==s||(l=i(s,a))!==(c=i(u,a))||o(s,u)<0^a>0){do f.point(0===l||3===l?e:n,l>1?r:t);while((l=(l+a+4)%4)!==c)}else f.point(u[0],u[1])}function l(i,s){return i>=e&&n>=i&&s>=t&&r>=s}function c(e,t){l(e,t)&&u.point(e,t)}function h(){A.point=d,m&&m.push(g=[]),T=!0,x=!1,E=S=0/0}function p(){v&&(d(y,b),w&&x&&k.rejoin(),v.push(k.buffer())),A.point=c,x&&u.lineEnd()}function d(e,t){e=Math.max(-Aa,Math.min(Aa,e)),t=Math.max(-Aa,Math.min(Aa,t));var n=l(e,t);if(m&&g.push([e,t]),T)y=e,b=t,w=n,T=!1,n&&(u.lineStart(),u.point(e,t));else if(n&&x)u.point(e,t);else{var r={a:{x:E,y:S},b:{x:e,y:t}};L(r)?(x||(u.lineStart(),u.point(r.a.x,r.a.y)),u.point(r.b.x,r.b.y),n||u.lineEnd(),N=!1):n&&(u.lineStart(),u.point(e,t),N=!1)}E=e,S=t,x=n}var v,m,g,y,b,w,E,S,x,T,N,C=u,k=Pn(),L=Rn(e,t,n,r),A={point:c,lineStart:h,lineEnd:p,polygonStart:function(){u=k,v=[],m=[],N=!0},polygonEnd:function(){u=C,v=Ko.merge(v);var t=a([e,r]),n=N&&t,i=v.length;(n||i)&&(u.polygonStart(),n&&(u.lineStart(),f(null,null,1,u),u.lineEnd()),i&&An(v,s,t,f,u),u.polygonEnd()),v=m=g=null}};return A}}function zn(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return n=t.invert(n,r),n&&e.invert(n[0],n[1])}),n}function Wn(e){var t=0,n=Cu/3,r=or(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*Cu/180,n=e[1]*Cu/180):[180*(t/Cu),180*(n/Cu)]},i}function Xn(e,t){function n(e,t){var n=Math.sqrt(s-2*i*Math.sin(t))/i;return[n*Math.sin(e*=i),o-n*Math.cos(e)]}var r=Math.sin(e),i=(r+Math.sin(t))/2,s=1+r*(2*i-r),o=Math.sqrt(s)/i;return n.invert=function(e,t){var n=o-t;return[Math.atan2(e,n)/i,G((s-(e*e+n*n)*i*i)/(2*i))]},n}function Vn(){function e(e,t){Ma+=i*e-r*t,r=e,i=t}var t,n,r,i;Ba.point=function(s,o){Ba.point=e,t=r=s,n=i=o},Ba.lineEnd=function(){e(t,n)}}function $n(e,t){_a>e&&(_a=e),e>Pa&&(Pa=e),Da>t&&(Da=t),t>Ha&&(Ha=t)}function Jn(){function e(e,t){o.push("M",e,",",t,s)}function t(e,t){o.push("M",e,",",t),u.point=n}function n(e,t){o.push("L",e,",",t)}function r(){u.point=e}function i(){o.push("Z")}var s=Kn(4.5),o=[],u={point:e,lineStart:function(){u.point=t},lineEnd:r,polygonStart:function(){u.lineEnd=i},polygonEnd:function(){u.lineEnd=r,u.point=e},pointRadius:function(e){return s=Kn(e),u},result:function(){if(o.length){var e=o.join("");return o=[],e}}};return u}function Kn(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+ -2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function Qn(e,t){ya+=e,ba+=t,++wa}function Gn(){function e(e,r){var i=e-t,s=r-n,o=Math.sqrt(i*i+s*s);Ea+=o*(t+e)/2,Sa+=o*(n+r)/2,xa+=o,Qn(t=e,n=r)}var t,n;Fa.point=function(r,i){Fa.point=e,Qn(t=r,n=i)}}function Yn(){Fa.point=Qn}function Zn(){function e(e,t){var n=e-r,s=t-i,o=Math.sqrt(n*n+s*s);Ea+=o*(r+e)/2,Sa+=o*(i+t)/2,xa+=o,o=i*e-r*t,Ta+=o*(r+e),Na+=o*(i+t),Ca+=3*o,Qn(r=e,i=t)}var t,n,r,i;Fa.point=function(s,o){Fa.point=e,Qn(t=r=s,n=i=o)},Fa.lineEnd=function(){e(t,n)}}function er(e){function t(t,n){e.moveTo(t,n),e.arc(t,n,o,0,ku)}function n(t,n){e.moveTo(t,n),u.point=r}function r(t,n){e.lineTo(t,n)}function i(){u.point=t}function s(){e.closePath()}var o=4.5,u={point:t,lineStart:function(){u.point=n},lineEnd:i,polygonStart:function(){u.lineEnd=s},polygonEnd:function(){u.lineEnd=i,u.point=t},pointRadius:function(e){return o=e,u},result:v};return u}function tr(e){function t(e){return(u?r:n)(e)}function n(t){return ir(t,function(n,r){n=e(n,r),t.point(n[0],n[1])})}function r(t){function n(n,r){n=e(n,r),t.point(n[0],n[1])}function r(){b=0/0,T.point=s,t.lineStart()}function s(n,r){var s=vn([n,r]),o=e(n,r);i(b,w,y,E,S,x,b=o[0],w=o[1],y=n,E=s[0],S=s[1],x=s[2],u,t),t.point(b,w)}function o(){T.point=n,t.lineEnd()}function a(){r(),T.point=f,T.lineEnd=l}function f(e,t){s(c=e,h=t),p=b,d=w,v=E,m=S,g=x,T.point=s}function l(){i(b,w,y,E,S,x,p,d,c,v,m,g,u,t),T.lineEnd=o,o()}var c,h,p,d,v,m,g,y,b,w,E,S,x,T={point:n,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),T.lineStart=a},polygonEnd:function(){t.polygonEnd(),T.lineStart=r}};return T}function i(t,n,r,u,a,f,l,c,h,p,d,v,m,g){var y=l-t,b=c-n,w=y*y+b*b;if(w>4*s&&m--){var E=u+p,S=a+d,x=f+v,T=Math.sqrt(E*E+S*S+x*x),N=Math.asin(x/=T),C=fu(fu(x)-1)<Au||fu(r-h)<Au?(r+h)/2:Math.atan2(S,E),k=e(C,N),L=k[0],A=k[1],O=L-t,M=A-n,_=b*O-y*M;(_*_/w>s||fu((y*O+b*M)/w-.5)>.3||o>u*p+a*d+f*v)&&(i(t,n,r,u,a,f,L,A,C,E/=T,S/=T,x,m,g),g.point(L,A),i(L,A,C,E,S,x,l,c,h,p,d,v,m,g))}}var s=.5,o=Math.cos(30*Mu),u=16;return t.precision=function(e){return arguments.length?(u=(s=e*e)>0&&16,t):Math.sqrt(s)},t}function nr(e){var t=tr(function(t,n){return e([t*_u,n*_u])});return function(e){return ur(t(e))}}function rr(e){this.stream=e}function ir(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function sr(e){return or(function(){return e})()}function or(e){function t(e){return e=u(e[0]*Mu,e[1]*Mu),[e[0]*h+a,f-e[1]*h]}function n(e){return e=u.invert((e[0]-a)/h,(f-e[1])/h),e&&[e[0]*_u,e[1]*_u]}function r(){u=zn(o=lr(g,y,b),s);var e=s(v,m);return a=p-e[0]*h,f=d+e[1]*h,i()}function i(){return l&&(l.valid=!1,l=null),t}var s,o,u,a,f,l,c=tr(function(e,t){return e=s(e,t),[e[0]*h+a,f-e[1]*h]}),h=150,p=480,d=250,v=0,m=0,g=0,y=0,b=0,w=La,E=kt,S=null,x=null;return t.stream=function(e){return l&&(l.valid=!1),l=ur(w(o,c(E(e)))),l.valid=!0,l},t.clipAngle=function(e){return arguments.length?(w=null==e?(S=e,La):qn((S=+e)*Mu),i()):S},t.clipExtent=function(e){return arguments.length?(x=e,E=e?Un(e[0][0],e[0][1],e[1][0],e[1][1]):kt,i()):x},t.scale=function(e){return arguments.length?(h=+e,r()):h},t.translate=function(e){return arguments.length?(p=+e[0],d=+e[1],r()):[p,d]},t.center=function(e){return arguments.length?(v=e[0]%360*Mu,m=e[1]%360*Mu,r()):[v*_u,m*_u]},t.rotate=function(e){return arguments.length?(g=e[0]%360*Mu,y=e[1]%360*Mu,b=e.length>2?e[2]%360*Mu:0,r()):[g*_u,y*_u,b*_u]},Ko.rebind(t,c,"precision"),function(){return s=e.apply(this,arguments),t.invert=s.invert&&n,r()}}function ur(e){return ir(e,function(t,n){e.point(t*Mu,n*Mu)})}function ar(e,t){return[e,t]}function fr(e,t){return[e>Cu?e-ku:-Cu>e?e+ku:e,t]}function lr(e,t,n){return e?t||n?zn(hr(e),pr(t,n)):hr(e):t||n?pr(t,n):fr}function cr(e){return function(t,n){return t+=e,[t>Cu?t-ku:-Cu>t?t+ku:t,n]}}function hr(e){var t=cr(e);return t.invert=cr(-e),t}function pr(e,t){function n(e,t){var n=Math.cos(t),u=Math.cos(e)*n,a=Math.sin(e)*n,f=Math.sin(t),l=f*r+u*i;return[Math.atan2(a*s-l*o,u*r-f*i),G(l*s+a*o)]}var r=Math.cos(e),i=Math.sin(e),s=Math.cos(t),o=Math.sin(t);return n.invert=function(e,t){var n=Math.cos(t),u=Math.cos(e)*n,a=Math.sin(e)*n,f=Math.sin(t),l=f*s-a*o;return[Math.atan2(a*s+f*o,u*r+l*i),G(l*r-u*i)]},n}function dr(e,t){var n=Math.cos(e),r=Math.sin(e);return function(i,s,o,u){var a=o*t;null!=i?(i=vr(n,i),s=vr(n,s),(o>0?s>i:i>s)&&(i+=o*ku)):(i=e+o*ku,s=e-.5*a);for(var f,l=i;o>0?l>s:s>l;l-=a)u.point((f=En([n,-r*Math.cos(l),-r*Math.sin(l)]))[0],f[1])}}function vr(e,t){var n=vn(t);n[0]-=e,wn(n);var r=Q(-n[1]);return((-n[2]<0?-r:r)+2*Math.PI-Au)%(2*Math.PI)}function mr(e,t,n){var r=Ko.range(e,t-Au,n).concat(t);return function(e){return r.map(function(t){return[e,t]})}}function gr(e,t,n){var r=Ko.range(e,t-Au,n).concat(t);return function(e){return r.map(function(t){return[t,e]})}}function yr(e){return e.source}function br(e){return e.target}function wr(e,t,n,r){var i=Math.cos(t),s=Math.sin(t),o=Math.cos(r),u=Math.sin(r),a=i*Math.cos(e),f=i*Math.sin(e),l=o*Math.cos(n),c=o*Math.sin(n),h=2*Math.asin(Math.sqrt(tt(r-t)+i*o*tt(n-e))),p=1/Math.sin(h),d=h?function(e){var t=Math.sin(e*=h)*p,n=Math.sin(h-e)*p,r=n*a+t*l,i=n*f+t*c,o=n*s+t*u;return[Math.atan2(i,r)*_u,Math.atan2(o,Math.sqrt(r*r+i*i))*_u]}:function(){return[e*_u,t*_u]};return d.distance=h,d}function Er(){function e(e,i){var s=Math.sin(i*=Mu),o=Math.cos(i),u=fu((e*=Mu)-t),a=Math.cos(u);Ia+=Math.atan2(Math.sqrt((u=o*Math.sin(u))*u+(u=r*s-n*o*a)*u),n*s+r*o*a),t=e,n=s,r=o}var t,n,r;qa.point=function(i,s){t=i*Mu,n=Math.sin(s*=Mu),r=Math.cos(s),qa.point=e},qa.lineEnd=function(){qa.point=qa.lineEnd=v}}function Sr(e,t){function n(t,n){var r=Math.cos(t),i=Math.cos(n),s=e(r*i);return[s*i*Math.sin(t),s*Math.sin(n)]}return n.invert=function(e,n){var r=Math.sqrt(e*e+n*n),i=t(r),s=Math.sin(i),o=Math.cos(i);return[Math.atan2(e*s,r*o),Math.asin(r&&n*s/r)]},n}function xr(e,t){function n(e,t){o>0?-Lu+Au>t&&(t=-Lu+Au):t>Lu-Au&&(t=Lu-Au);var n=o/Math.pow(i(t),s);return[n*Math.sin(s*e),o-n*Math.cos(s*e)]}var r=Math.cos(e),i=function(e){return Math.tan(Cu/4+e/2)},s=e===t?Math.sin(e):Math.log(r/Math.cos(t))/Math.log(i(t)/i(e)),o=r*Math.pow(i(e),s)/s;return s?(n.invert=function(e,t){var n=o-t,r=J(s)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/s,2*Math.atan(Math.pow(o/r,1/s))-Lu]},n):Nr}function Tr(e,t){function n(e,t){var n=s-t;return[n*Math.sin(i*e),s-n*Math.cos(i*e)]}var r=Math.cos(e),i=e===t?Math.sin(e):(r-Math.cos(t))/(t-e),s=r/i+e;return fu(i)<Au?ar:(n.invert=function(e,t){var n=s-t;return[Math.atan2(e,n)/i,s-J(i)*Math.sqrt(e*e+n*n)]},n)}function Nr(e,t){return[e,Math.log(Math.tan(Cu/4+t/2))]}function Cr(e){var t,n=sr(e),r=n.scale,i=n.translate,s=n.clipExtent;return n.scale=function(){var e=r.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.translate=function(){var e=i.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.clipExtent=function(e){var o=s.apply(n,arguments);if(o===n){if(t=null==e){var u=Cu*r(),a=i();s([[a[0]-u,a[1]-u],[a[0]+u,a[1]+u]])}}else t&&(o=null);return o},n.clipExtent(null)}function kr(e,t){return[Math.log(Math.tan(Cu/4+t/2)),-e]}function Lr(e){return e[0]}function Ar(e){return e[1]}function Or(e){for(var t=e.length,n=[0,1],r=2,i=2;t>i;i++){for(;r>1&&K(e[n[r-2]],e[n[r-1]],e[i])<=0;)--r;n[r++]=i}return n.slice(0,r)}function Mr(e,t){return e[0]-t[0]||e[1]-t[1]}function _r(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function Dr(e,t,n,r){var i=e[0],s=n[0],o=t[0]-i,u=r[0]-s,a=e[1],f=n[1],l=t[1]-a,c=r[1]-f,h=(u*(a-f)-c*(i-s))/(c*o-u*l);return[i+h*o,a+h*l]}function Pr(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1])}function Hr(){ni(this),this.edge=this.site=this.circle=null}function Br(e){var t=Ya.pop()||new Hr;return t.site=e,t}function jr(e){$r(e),Ka.remove(e),Ya.push(e),ni(e)}function Fr(e){var t=e.circle,n=t.x,r=t.cy,i={x:n,y:r},s=e.P,o=e.N,u=[e];jr(e);for(var a=s;a.circle&&fu(n-a.circle.x)<Au&&fu(r-a.circle.cy)<Au;)s=a.P,u.unshift(a),jr(a),a=s;u.unshift(a),$r(a);for(var f=o;f.circle&&fu(n-f.circle.x)<Au&&fu(r-f.circle.cy)<Au;)o=f.N,u.push(f),jr(f),f=o;u.push(f),$r(f);var l,c=u.length;for(l=1;c>l;++l)f=u[l],a=u[l-1],Zr(f.edge,a.site,f.site,i);a=u[0],f=u[c-1],f.edge=Gr(a.site,f.site,null,i),Vr(a),Vr(f)}function Ir(e){for(var t,n,r,i,s=e.x,o=e.y,u=Ka._;u;)if(r=qr(u,o)-s,r>Au)u=u.L;else{if(i=s-Rr(u,o),!(i>Au)){r>-Au?(t=u.P,n=u):i>-Au?(t=u,n=u.N):t=n=u;break}if(!u.R){t=u;break}u=u.R}var a=Br(e);if(Ka.insert(t,a),t||n){if(t===n)return $r(t),n=Br(t.site),Ka.insert(a,n),a.edge=n.edge=Gr(t.site,a.site),Vr(t),Vr(n),void 0;if(!n)return a.edge=Gr(t.site,a.site),void 0;$r(t),$r(n);var f=t.site,l=f.x,c=f.y,h=e.x-l,p=e.y-c,d=n.site,v=d.x-l,m=d.y-c,g=2*(h*m-p*v),y=h*h+p*p,b=v*v+m*m,w={x:(m*y-p*b)/g+l,y:(h*b-v*y)/g+c};Zr(n.edge,f,d,w),a.edge=Gr(f,e,null,w),n.edge=Gr(e,d,null,w),Vr(t),Vr(n)}}function qr(e,t){var n=e.site,r=n.x,i=n.y,s=i-t;if(!s)return r;var o=e.P;if(!o)return-1/0;n=o.site;var u=n.x,a=n.y,f=a-t;if(!f)return u;var l=u-r,c=1/s-1/f,h=l/f;return c?(-h+Math.sqrt(h*h-2*c*(l*l/(-2*f)-a+f/2+i-s/2)))/c+r:(r+u)/2}function Rr(e,t){var n=e.N;if(n)return qr(n,t);var r=e.site;return r.y===t?r.x:1/0}function Ur(e){this.site=e,this.edges=[]}function zr(e){for(var t,n,r,i,s,o,u,a,f,l,c=e[0][0],h=e[1][0],p=e[0][1],d=e[1][1],v=Ja,m=v.length;m--;)if(s=v[m],s&&s.prepare())for(u=s.edges,a=u.length,o=0;a>o;)l=u[o].end(),r=l.x,i=l.y,f=u[++o%a].start(),t=f.x,n=f.y,(fu(r-t)>Au||fu(i-n)>Au)&&(u.splice(o,0,new ei(Yr(s.site,l,fu(r-c)<Au&&d-i>Au?{x:c,y:fu(t-c)<Au?n:d}:fu(i-d)<Au&&h-r>Au?{x:fu(n-d)<Au?t:h,y:d}:fu(r-h)<Au&&i-p>Au?{x:h,y:fu(t-h)<Au?n:p}:fu(i-p)<Au&&r-c>Au?{x:fu(n-p)<Au?t:c,y:p}:null),s.site,null)),++a)}function Wr(e,t){return t.angle-e.angle}function Xr(){ni(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vr(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,i=e.site,s=n.site;if(r!==s){var o=i.x,u=i.y,a=r.x-o,f=r.y-u,l=s.x-o,c=s.y-u,h=2*(a*c-f*l);if(!(h>=-Ou)){var p=a*a+f*f,d=l*l+c*c,v=(c*p-f*d)/h,m=(a*d-l*p)/h,c=m+u,g=Za.pop()||new Xr;g.arc=e,g.site=i,g.x=v+o,g.y=c+Math.sqrt(v*v+m*m),g.cy=c,e.circle=g;for(var y=null,b=Ga._;b;)if(g.y<b.y||g.y===b.y&&g.x<=b.x){if(!b.L){y=b.P;break}b=b.L}else{if(!b.R){y=b;break}b=b.R}Ga.insert(y,g),y||(Qa=g)}}}}function $r(e){var t=e.circle;t&&(t.P||(Qa=t.N),Ga.remove(t),Za.push(t),ni(t),e.circle=null)}function Jr(e){for(var t,n=$a,r=Rn(e[0][0],e[0][1],e[1][0],e[1][1]),i=n.length;i--;)t=n[i],(!Kr(t,e)||!r(t)||fu(t.a.x-t.b.x)<Au&&fu(t.a.y-t.b.y)<Au)&&(t.a=t.b=null,n.splice(i,1))}function Kr(e,t){var n=e.b;if(n)return!0;var r,i,s=e.a,o=t[0][0],u=t[1][0],a=t[0][1],f=t[1][1],l=e.l,c=e.r,h=l.x,p=l.y,d=c.x,v=c.y,m=(h+d)/2,g=(p+v)/2;if(v===p){if(o>m||m>=u)return;if(h>d){if(s){if(s.y>=f)return}else s={x:m,y:a};n={x:m,y:f}}else{if(s){if(s.y<a)return}else s={x:m,y:f};n={x:m,y:a}}}else if(r=(h-d)/(v-p),i=g-r*m,-1>r||r>1)if(h>d){if(s){if(s.y>=f)return}else s={x:(a-i)/r,y:a};n={x:(f-i)/r,y:f}}else{if(s){if(s.y<a)return}else s={x:(f-i)/r,y:f};n={x:(a-i)/r,y:a}}else if(v>p){if(s){if(s.x>=u)return}else s={x:o,y:r*o+i};n={x:u,y:r*u+i}}else{if(s){if(s.x<o)return}else s={x:u,y:r*u+i};n={x:o,y:r*o+i}}return e.a=s,e.b=n,!0}function Qr(e,t){this.l=e,this.r=t,this.a=this.b=null}function Gr(e,t,n,r){var i=new Qr(e,t);return $a.push(i),n&&Zr(i,e,t,n),r&&Zr(i,t,e,r),Ja[e.i].edges.push(new ei(i,e,t)),Ja[t.i].edges.push(new ei(i,t,e)),i}function Yr(e,t,n){var r=new Qr(e,null);return r.a=t,r.b=n,$a.push(r),r}function Zr(e,t,n,r){e.a||e.b?e.l===n?e.b=r:e.a=r:(e.a=r,e.l=t,e.r=n)}function ei(e,t,n){var r=e.a,i=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function ti(){this._=null}function ni(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function ri(e,t){var n=t,r=t.R,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function ii(e,t){var n=t,r=t.L,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function si(e){for(;e.L;)e=e.L;return e}function oi(e,t){var n,r,i,s=e.sort(ui).pop();for($a=[],Ja=new Array(e.length),Ka=new ti,Ga=new ti;;)if(i=Qa,s&&(!i||s.y<i.y||s.y===i.y&&s.x<i.x))(s.x!==n||s.y!==r)&&(Ja[s.i]=new Ur(s),Ir(s),n=s.x,r=s.y),s=e.pop();else{if(!i)break;Fr(i.arc)}t&&(Jr(t),zr(t));var o={cells:Ja,edges:$a};return Ka=Ga=$a=Ja=null,o}function ui(e,t){return t.y-e.y||t.x-e.x}function ai(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function fi(e){return e.x}function li(e){return e.y}function ci(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function hi(e,t,n,r,i,s){if(!e(t,n,r,i,s)){var o=.5*(n+i),u=.5*(r+s),a=t.nodes;a[0]&&hi(e,a[0],n,r,o,u),a[1]&&hi(e,a[1],o,r,i,u),a[2]&&hi(e,a[2],n,u,o,s),a[3]&&hi(e,a[3],o,u,i,s)}}function pi(e,t){e=Ko.rgb(e),t=Ko.rgb(t);var n=e.r,r=e.g,i=e.b,s=t.r-n,o=t.g-r,u=t.b-i;return function(e){return"#"+wt(Math.round(n+s*e))+wt(Math.round(r+o*e))+wt(Math.round(i+u*e))}}function di(e,t){var n,r={},i={};for(n in e)n in t?r[n]=gi(e[n],t[n]):i[n]=e[n];for(n in t)n in e||(i[n]=t[n]);return function(e){for(n in r)i[n]=r[n](e);return i}}function vi(e,t){return t-=e=+e,function(n){return e+t*n}}function mi(e,t){var n,r,i,s=tf.lastIndex=nf.lastIndex=0,o=-1,u=[],a=[];for(e+="",t+="";(n=tf.exec(e))&&(r=nf.exec(t));)(i=r.index)>s&&(i=t.substring(s,i),u[o]?u[o]+=i:u[++o]=i),(n=n[0])===(r=r[0])?u[o]?u[o]+=r:u[++o]=r:(u[++o]=null,a.push({i:o,x:vi(n,r)})),s=nf.lastIndex;return s<t.length&&(i=t.substring(s),u[o]?u[o]+=i:u[++o]=i),u.length<2?a[0]?(t=a[0].x,function(e){return t(e)+""}):function(){return t}:(t=a.length,function(e){for(var n,r=0;t>r;++r)u[(n=a[r]).i]=n.x(e);return u.join("")})}function gi(e,t){for(var n,r=Ko.interpolators.length;--r>=0&&!(n=Ko.interpolators[r](e,t)););return n}function yi(e,t){var n,r=[],i=[],s=e.length,o=t.length,u=Math.min(e.length,t.length);for(n=0;u>n;++n)r.push(gi(e[n],t[n]));for(;s>n;++n)i[n]=e[n];for(;o>n;++n)i[n]=t[n];return function(e){for(n=0;u>n;++n)i[n]=r[n](e);return i}}function bi(e){return function(t){return 0>=t?0:t>=1?1:e(t)}}function wi(e){return function(t){return 1-e(1-t)}}function Ei(e){return function(t){return.5*(.5>t?e(2*t):2-e(2-2*t))}}function Si(e){return e*e}function xi(e){return e*e*e}function Ti(e){if(0>=e)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(.5>e?n:3*(e-t)+n-.75)}function Ni(e){return function(t){return Math.pow(t,e)}}function Ci(e){return 1-Math.cos(e*Lu)}function ki(e){return Math.pow(2,10*(e-1))}function Li(e){return 1-Math.sqrt(1-e*e)}function Ai(e,t){var n;return arguments.length<2&&(t=.45),arguments.length?n=t/ku*Math.asin(1/e):(e=1,n=t/4),function(r){return 1+e*Math.pow(2,-10*r)*Math.sin((r-n)*ku/t)}}function Oi(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function Mi(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function _i(e,t){e=Ko.hcl(e),t=Ko.hcl(t);var n=e.h,r=e.c,i=e.l,s=t.h-n,o=t.c-r,u=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(s)?(s=0,n=isNaN(n)?t.h:n):s>180?s-=360:-180>s&&(s+=360),function(e){return at(n+s*e,r+o*e,i+u*e)+""}}function Di(e,t){e=Ko.hsl(e),t=Ko.hsl(t);var n=e.h,r=e.s,i=e.l,s=t.h-n,o=t.s-r,u=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(s)?(s=0,n=isNaN(n)?t.h:n):s>180?s-=360:-180>s&&(s+=360),function(e){return st(n+s*e,r+o*e,i+u*e)+""}}function Pi(e,t){e=Ko.lab(e),t=Ko.lab(t);var n=e.l,r=e.a,i=e.b,s=t.l-n,o=t.a-r,u=t.b-i;return function(e){return ct(n+s*e,r+o*e,i+u*e)+""}}function Hi(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function Bi(e){var t=[e.a,e.b],n=[e.c,e.d],r=Fi(t),i=ji(t,n),s=Fi(Ii(n,t,-i))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*_u,this.translate=[e.e,e.f],this.scale=[r,s],this.skew=s?Math.atan2(i,s)*_u:0}function ji(e,t){return e[0]*t[0]+e[1]*t[1]}function Fi(e){var t=Math.sqrt(ji(e,e));return t&&(e[0]/=t,e[1]/=t),t}function Ii(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function qi(e,t){var n,r=[],i=[],s=Ko.transform(e),o=Ko.transform(t),u=s.translate,a=o.translate,f=s.rotate,l=o.rotate,c=s.skew,h=o.skew,p=s.scale,d=o.scale;return u[0]!=a[0]||u[1]!=a[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:vi(u[0],a[0])},{i:3,x:vi(u[1],a[1])})):a[0]||a[1]?r.push("translate("+a+")"):r.push(""),f!=l?(f-l>180?l+=360:l-f>180&&(f+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:vi(f,l)})):l&&r.push(r.pop()+"rotate("+l+")"),c!=h?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:vi(c,h)}):h&&r.push(r.pop()+"skewX("+h+")"),p[0]!=d[0]||p[1]!=d[1]?(n=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:n-4,x:vi(p[0],d[0])},{i:n-2,x:vi(p[1],d[1])})):(1!=d[0]||1!=d[1])&&r.push(r.pop()+"scale("+d+")"),n=i.length,function(e){for(var t,s=-1;++s<n;)r[(t=i[s]).i]=t.x(e);return r.join("")}}function Ri(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return(n-e)*t}}function Ui(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function zi(e){for(var t=e.source,n=e.target,r=Xi(t,n),i=[t];t!==r;)t=t.parent,i.push(t);for(var s=i.length;n!==r;)i.splice(s,0,n),n=n.parent;return i}function Wi(e){for(var t=[],n=e.parent;null!=n;)t.push(e),e=n,n=n.parent;return t.push(e),t}function Xi(e,t){if(e===t)return e;for(var n=Wi(e),r=Wi(t),i=n.pop(),s=r.pop(),o=null;i===s;)o=i,i=n.pop(),s=r.pop();return o}function Vi(e){e.fixed|=2}function $i(e){e.fixed&=-7}function Ji(e){e.fixed|=4,e.px=e.x,e.py=e.y}function Ki(e){e.fixed&=-5}function Qi(e,t,n){var r=0,i=0;if(e.charge=0,!e.leaf)for(var s,o=e.nodes,u=o.length,a=-1;++a<u;)s=o[a],null!=s&&(Qi(s,t,n),e.charge+=s.charge,r+=s.charge*s.cx,i+=s.charge*s.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var f=t*n[e.point.index];e.charge+=e.pointCharge=f,r+=f*e.point.x,i+=f*e.point.y}e.cx=r/e.charge,e.cy=i/e.charge}function Gi(e,t){return Ko.rebind(e,t,"sort","children","value"),e.nodes=e,e.links=rs,e}function Yi(e,t){for(var n=[e];null!=(e=n.pop());)if(t(e),(i=e.children)&&(r=i.length))for(var r,i;--r>=0;)n.push(i[r])}function Zi(e,t){for(var n=[e],r=[];null!=(e=n.pop());)if(r.push(e),(s=e.children)&&(i=s.length))for(var i,s,o=-1;++o<i;)n.push(s[o]);for(;null!=(e=r.pop());)t(e)}function es(e){return e.children}function ts(e){return e.value}function ns(e,t){return t.value-e.value}function rs(e){return Ko.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function is(e){return e.x}function ss(e){return e.y}function os(e,t,n){e.y0=t,e.y=n}function us(e){return Ko.range(e.length)}function as(e){for(var t=-1,n=e[0].length,r=[];++t<n;)r[t]=0;return r}function fs(e){for(var t,n=1,r=0,i=e[0][1],s=e.length;s>n;++n)(t=e[n][1])>i&&(r=n,i=t);return r}function ls(e){return e.reduce(cs,0)}function cs(e,t){return e+t[1]}function hs(e,t){return ps(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function ps(e,t){for(var n=-1,r=+e[0],i=(e[1]-r)/t,s=[];++n<=t;)s[n]=i*n+r;return s}function ds(e){return[Ko.min(e),Ko.max(e)]}function vs(e,t){return e.value-t.value}function ms(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function gs(e,t){e._pack_next=t,t._pack_prev=e}function ys(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return.999*i*i>n*n+r*r}function bs(e){function t(e){l=Math.min(e.x-e.r,l),c=Math.max(e.x+e.r,c),h=Math.min(e.y-e.r,h),p=Math.max(e.y+e.r,p)}if((n=e.children)&&(f=n.length)){var n,r,i,s,o,u,a,f,l=1/0,c=-1/0,h=1/0,p=-1/0;if(n.forEach(ws),r=n[0],r.x=-r.r,r.y=0,t(r),f>1&&(i=n[1],i.x=i.r,i.y=0,t(i),f>2))for(s=n[2],xs(r,i,s),t(s),ms(r,s),r._pack_prev=s,ms(s,i),i=r._pack_next,o=3;f>o;o++){xs(r,i,s=n[o]);var d=0,v=1,m=1;for(u=i._pack_next;u!==i;u=u._pack_next,v++)if(ys(u,s)){d=1;break}if(1==d)for(a=r._pack_prev;a!==u._pack_prev&&!ys(a,s);a=a._pack_prev,m++);d?(m>v||v==m&&i.r<r.r?gs(r,i=u):gs(r=a,i),o--):(ms(r,s),i=s,t(s))}var g=(l+c)/2,y=(h+p)/2,b=0;for(o=0;f>o;o++)s=n[o],s.x-=g,s.y-=y,b=Math.max(b,s.r+Math.sqrt(s.x*s.x+s.y*s.y));e.r=b,n.forEach(Es)}}function ws(e){e._pack_next=e._pack_prev=e}function Es(e){delete e._pack_next,delete e._pack_prev}function Ss(e,t,n,r){var i=e.children;if(e.x=t+=r*e.x,e.y=n+=r*e.y,e.r*=r,i)for(var s=-1,o=i.length;++s<o;)Ss(i[s],t,n,r)}function xs(e,t,n){var r=e.r+n.r,i=t.x-e.x,s=t.y-e.y;if(r&&(i||s)){var o=t.r+n.r,u=i*i+s*s;o*=o,r*=r;var a=.5+(r-o)/(2*u),f=Math.sqrt(Math.max(0,2*o*(r+u)-(r-=u)*r-o*o))/(2*u);n.x=e.x+a*i+f*s,n.y=e.y+a*s-f*i}else n.x=e.x+r,n.y=e.y}function Ts(e,t){return e.parent==t.parent?1:2}function Ns(e){var t=e.children;return t.length?t[0]:e.t}function Cs(e){var t,n=e.children;return(t=n.length)?n[t-1]:e.t}function ks(e,t,n){var r=n/(t.i-e.i);t.c-=r,t.s+=n,e.c+=r,t.z+=n,t.m+=n}function Ls(e){for(var t,n=0,r=0,i=e.children,s=i.length;--s>=0;)t=i[s],t.z+=n,t.m+=n,n+=t.s+(r+=t.c)}function As(e,t,n){return e.a.parent===t.parent?e.a:n}function Os(e){return 1+Ko.max(e,function(e){return e.y})}function Ms(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function _s(e){var t=e.children;return t&&t.length?_s(t[0]):e}function Ds(e){var t,n=e.children;return n&&(t=n.length)?Ds(n[t-1]):e}function Ps(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function Hs(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],s=e.dy-t[0]-t[2];return 0>i&&(n+=i/2,i=0),0>s&&(r+=s/2,s=0),{x:n,y:r,dx:i,dy:s}}function Bs(e){var t=e[0],n=e[e.length-1];return n>t?[t,n]:[n,t]}function js(e){return e.rangeExtent?e.rangeExtent():Bs(e.range())}function Fs(e,t,n,r){var i=n(e[0],e[1]),s=r(t[0],t[1]);return function(e){return s(i(e))}}function Is(e,t){var n,r=0,i=e.length-1,s=e[r],o=e[i];return s>o&&(n=r,r=i,i=n,n=s,s=o,o=n),e[r]=t.floor(s),e[i]=t.ceil(o),e}function qs(e){return e?{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}:df}function Rs(e,t,n,r){var i=[],s=[],o=0,u=Math.min(e.length,t.length)-1;for(e[u]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<=u;)i.push(n(e[o-1],e[o])),s.push(r(t[o-1],t[o]));return function(t){var n=Ko.bisect(e,t,1,u)-1;return s[n](i[n](t))}}function Us(e,t,n,r){function i(){var i=Math.min(e.length,t.length)>2?Rs:Fs,a=r?Ui:Ri;return o=i(e,t,a,n),u=i(t,e,a,gi),s}function s(e){return o(e)}var o,u;return s.invert=function(e){return u(e)},s.domain=function(t){return arguments.length?(e=t.map(Number),i()):e},s.range=function(e){return arguments.length?(t=e,i()):t},s.rangeRound=function(e){return s.range(e).interpolate(Hi)},s.clamp=function(e){return arguments.length?(r=e,i()):r},s.interpolate=function(e){return arguments.length?(n=e,i()):n},s.ticks=function(t){return Vs(e,t)},s.tickFormat=function(t,n){return $s(e,t,n)},s.nice=function(t){return Ws(e,t),i()},s.copy=function(){return Us(e,t,n,r)},i()}function zs(e,t){return Ko.rebind(e,t,"range","rangeRound","interpolate","clamp")}function Ws(e,t){return Is(e,qs(Xs(e,t)[2]))}function Xs(e,t){null==t&&(t=10);var n=Bs(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),s=t/r*i;return.15>=s?i*=10:.35>=s?i*=5:.75>=s&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+.5*i,n[2]=i,n}function Vs(e,t){return Ko.range.apply(Ko,Xs(e,t))}function $s(e,t,n){var r=Xs(e,t);if(n){var i=ta.exec(n);if(i.shift(),"s"===i[8]){var s=Ko.formatPrefix(Math.max(fu(r[0]),fu(r[1])));return i[7]||(i[7]="."+Js(s.scale(r[2]))),i[8]="f",n=Ko.format(i.join("")),function(e){return n(s.scale(e))+s.symbol}}i[7]||(i[7]="."+Ks(i[8],r)),n=i.join("")}else n=",."+Js(r[2])+"f";return Ko.format(n)}function Js(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}function Ks(e,t){var n=Js(t[2]);return e in vf?Math.abs(n-Js(Math.max(fu(t[0]),fu(t[1]))))+ +("e"!==e):n-2*("%"===e)}function Qs(e,t,n,r){function i(e){return(n?Math.log(0>e?0:e):-Math.log(e>0?0:-e))/Math.log(t)}function s(e){return n?Math.pow(t,e):-Math.pow(t,-e)}function o(t){return e(i(t))}return o.invert=function(t){return s(e.invert(t))},o.domain=function(t){return arguments.length?(n=t[0]>=0,e.domain((r=t.map(Number)).map(i)),o):r},o.base=function(n){return arguments.length?(t=+n,e.domain(r.map(i)),o):t},o.nice=function(){var t=Is(r.map(i),n?Math:gf);return e.domain(t),r=t.map(s),o},o.ticks=function(){var e=Bs(r),o=[],u=e[0],a=e[1],f=Math.floor(i(u)),l=Math.ceil(i(a)),c=t%1?2:t;if(isFinite(l-f)){if(n){for(;l>f;f++)for(var h=1;c>h;h++)o.push(s(f)*h);o.push(s(f))}else for(o.push(s(f));f++<l;)for(var h=c-1;h>0;h--)o.push(s(f)*h);for(f=0;o[f]<u;f++);for(l=o.length;o[l-1]>a;l--);o=o.slice(f,l)}return o},o.tickFormat=function(e,t){if(!arguments.length)return mf;arguments.length<2?t=mf:"function"!=typeof t&&(t=Ko.format(t));var r,u=Math.max(.1,e/o.ticks().length),a=n?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(e){return e/s(a(i(e)+r))<=u?t(e):""}},o.copy=function(){return Qs(e.copy(),t,n,r)},zs(o,e)}function Gs(e,t,n){function r(t){return e(i(t))}var i=Ys(t),s=Ys(1/t);return r.invert=function(t){return s(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(i)),r):n},r.ticks=function(e){return Vs(n,e)},r.tickFormat=function(e,t){return $s(n,e,t)},r.nice=function(e){return r.domain(Ws(n,e))},r.exponent=function(o){return arguments.length?(i=Ys(t=o),s=Ys(1/t),e.domain(n.map(i)),r):t},r.copy=function(){return Gs(e.copy(),t,n)},zs(r,e)}function Ys(e){return function(t){return 0>t?-Math.pow(-t,e):Math.pow(t,e)}}function Zs(e,t){function n(n){return s[((i.get(n)||("range"===t.t?i.set(n,e.push(n)):0/0))-1)%s.length]}function r(t,n){return Ko.range(e.length).map(function(e){return t+n*e})}var i,s,u;return n.domain=function(r){if(!arguments.length)return e;e=[],i=new o;for(var s,u=-1,a=r.length;++u<a;)i.has(s=r[u])||i.set(s,e.push(s));return n[t.t].apply(n,t.a)},n.range=function(e){return arguments.length?(s=e,u=0,t={t:"range",a:arguments},n):s},n.rangePoints=function(i,o){arguments.length<2&&(o=0);var a=i[0],f=i[1],l=(f-a)/(Math.max(1,e.length-1)+o);return s=r(e.length<2?(a+f)/2:a+l*o/2,l),u=0,t={t:"rangePoints",a:arguments},n},n.rangeBands=function(i,o,a){arguments.length<2&&(o=0),arguments.length<3&&(a=o);var f=i[1]<i[0],l=i[f-0],c=i[1-f],h=(c-l)/(e.length-o+2*a);return s=r(l+h*a,h),f&&s.reverse(),u=h*(1-o),t={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(i,o,a){arguments.length<2&&(o=0),arguments.length<3&&(a=o);var f=i[1]<i[0],l=i[f-0],c=i[1-f],h=Math.floor((c-l)/(e.length-o+2*a)),p=c-l-(e.length-o)*h;return s=r(l+Math.round(p/2),h),f&&s.reverse(),u=Math.round(h*(1-o)),t={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return u},n.rangeExtent=function(){return Bs(t.a[0])},n.copy=function(){return Zs(e,t)},n.domain(e)}function eo(n,r){function i(){var e=0,t=r.length;for(o=[];++e<t;)o[e-1]=Ko.quantile(n,e/t);return s}function s(e){return isNaN(e=+e)?void 0:r[Ko.bisect(o,e)]}var o;return s.domain=function(r){return arguments.length?(n=r.filter(t).sort(e),i()):n},s.range=function(e){return arguments.length?(r=e,i()):r},s.quantiles=function(){return o},s.invertExtent=function(e){return e=r.indexOf(e),0>e?[0/0,0/0]:[e>0?o[e-1]:n[0],e<o.length?o[e]:n[n.length-1]]},s.copy=function(){return eo(n,r)},i()}function to(e,t,n){function r(t){return n[Math.max(0,Math.min(o,Math.floor(s*(t-e))))]}function i(){return s=n.length/(t-e),o=n.length-1,r}var s,o;return r.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],i()):[e,t]},r.range=function(e){return arguments.length?(n=e,i()):n},r.invertExtent=function(t){return t=n.indexOf(t),t=0>t?0/0:t/s+e,[t,t+1/s]},r.copy=function(){return to(e,t,n)},i()}function no(e,t){function n(n){return n>=n?t[Ko.bisect(e,n)]:void 0}return n.domain=function(t){return arguments.length?(e=t,n):e},n.range=function(e){return arguments.length?(t=e,n):t},n.invertExtent=function(n){return n=t.indexOf(n),[e[n-1],e[n]]},n.copy=function(){return no(e,t)},n}function ro(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return Vs(e,t)},t.tickFormat=function(t,n){return $s(e,t,n)},t.copy=function(){return ro(e)},t}function io(e){return e.innerRadius}function so(e){return e.outerRadius}function oo(e){return e.startAngle}function uo(e){return e.endAngle}function ao(e){function t(t){function o(){f.push("M",s(e(l),u))}for(var a,f=[],l=[],c=-1,h=t.length,p=Ct(n),d=Ct(r);++c<h;)i.call(this,a=t[c],c)?l.push([+p.call(this,a,c),+d.call(this,a,c)]):l.length&&(o(),l=[]);return l.length&&o(),f.length?f.join(""):null}var n=Lr,r=Ar,i=Ln,s=fo,o=s.key,u=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t.defined=function(e){return arguments.length?(i=e,t):i},t.interpolate=function(e){return arguments.length?(o="function"==typeof e?s=e:(s=Tf.get(e)||fo).key,t):o},t.tension=function(e){return arguments.length?(u=e,t):u},t}function fo(e){return e.join("L")}function lo(e){return fo(e)+"Z"}function co(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("H",(r[0]+(r=e[t])[0])/2,"V",r[1]);return n>1&&i.push("H",r[0]),i.join("")}function ho(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("V",(r=e[t])[1],"H",r[0]);return i.join("")}function po(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("H",(r=e[t])[0],"V",r[1]);return i.join("")}function vo(e,t){return e.length<4?fo(e):e[1]+yo(e.slice(1,e.length-1),bo(e,t))}function mo(e,t){return e.length<3?fo(e):e[0]+yo((e.push(e[0]),e),bo([e[e.length-2]].concat(e,[e[1]]),t))}function go(e,t){return e.length<3?fo(e):e[0]+yo(e,bo(e,t))}function yo(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return fo(e);var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;if(n&&(r+="Q"+(s[0]-2*o[0]/3)+","+(s[1]-2*o[1]/3)+","+s[0]+","+s[1],i=e[1],a=2),t.length>1){u=t[1],s=e[a],a++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1];for(var f=2;f<t.length;f++,a++)s=e[a],u=t[f],r+="S"+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1]}if(n){var l=e[a];r+="Q"+(s[0]+2*u[0]/3)+","+(s[1]+2*u[1]/3)+","+l[0]+","+l[1]}return r}function bo(e,t){for(var n,r=[],i=(1-t)/2,s=e[0],o=e[1],u=1,a=e.length;++u<a;)n=s,s=o,o=e[u],r.push([i*(o[0]-n[0]),i*(o[1]-n[1])]);return r}function wo(e){if(e.length<3)return fo(e);var t=1,n=e.length,r=e[0],i=r[0],s=r[1],o=[i,i,i,(r=e[1])[0]],u=[s,s,s,r[1]],a=[i,",",s,"L",To(kf,o),",",To(kf,u)];for(e.push(e[n-1]);++t<=n;)r=e[t],o.shift(),o.push(r[0]),u.shift(),u.push(r[1]),No(a,o,u);return e.pop(),a.push("L",r),a.join("")}function Eo(e){if(e.length<4)return fo(e);for(var t,n=[],r=-1,i=e.length,s=[0],o=[0];++r<3;)t=e[r],s.push(t[0]),o.push(t[1]);for(n.push(To(kf,s)+","+To(kf,o)),--r;++r<i;)t=e[r],s.shift(),s.push(t[0]),o.shift(),o.push(t[1]),No(n,s,o);return n.join("")}function So(e){for(var t,n,r=-1,i=e.length,s=i+4,o=[],u=[];++r<4;)n=e[r%i],o.push(n[0]),u.push(n[1]);for(t=[To(kf,o),",",To(kf,u)],--r;++r<s;)n=e[r%i],o.shift(),o.push(n[0]),u.shift(),u.push(n[1]),No(t,o,u);return t.join("")}function xo(e,t){var n=e.length-1;if(n)for(var r,i,s=e[0][0],o=e[0][1],u=e[n][0]-s,a=e[n][1]-o,f=-1;++f<=n;)r=e[f],i=f/n,r[0]=t*r[0]+(1-t)*(s+i*u),r[1]=t*r[1]+(1-t)*(o+i*a);return wo(e)}function To(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function No(e,t,n){e.push("C",To(Nf,t),",",To(Nf,n),",",To(Cf,t),",",To(Cf,n),",",To(kf,t),",",To(kf,n))}function Co(e,t){return(t[1]-e[1])/(t[0]-e[0])}function ko(e){for(var t=0,n=e.length-1,r=[],i=e[0],s=e[1],o=r[0]=Co(i,s);++t<n;)r[t]=(o+(o=Co(i=s,s=e[t+1])))/2;return r[t]=o,r}function Lo(e){for(var t,n,r,i,s=[],o=ko(e),u=-1,a=e.length-1;++u<a;)t=Co(e[u],e[u+1]),fu(t)<Au?o[u]=o[u+1]=0:(n=o[u]/t,r=o[u+1]/t,i=n*n+r*r,i>9&&(i=3*t/Math.sqrt(i),o[u]=i*n,o[u+1]=i*r));for(u=-1;++u<=a;)i=(e[Math.min(a,u+1)][0]-e[Math.max(0,u-1)][0])/(6*(1+o[u]*o[u])),s.push([i||0,o[u]*i||0]);return s}function Ao(e){return e.length<3?fo(e):e[0]+yo(e,Lo(e))}function Oo(e){for(var t,n,r,i=-1,s=e.length;++i<s;)t=e[i],n=t[0],r=t[1]+Sf,t[0]=n*Math.cos(r),t[1]=n*Math.sin(r);return e}function Mo(e){function t(t){function a(){v.push("M",u(e(g),c),l,f(e(m.reverse()),c),"Z")}for(var h,p,d,v=[],m=[],g=[],y=-1,b=t.length,w=Ct(n),E=Ct(i),S=n===r?function(){return p}:Ct(r),x=i===s?function(){return d}:Ct(s);++y<b;)o.call(this,h=t[y],y)?(m.push([p=+w.call(this,h,y),d=+E.call(this,h,y)]),g.push([+S.call(this,h,y),+x.call(this,h,y)])):m.length&&(a(),m=[],g=[]);return m.length&&a(),v.length?v.join(""):null}var n=Lr,r=Lr,i=0,s=Ar,o=Ln,u=fo,a=u.key,f=u,l="L",c=.7;return t.x=function(e){return arguments.length?(n=r=e,t):r},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(r=e,t):r},t.y=function(e){return arguments.length?(i=s=e,t):s},t.y0=function(e){return arguments.length?(i=e,t):i},t.y1=function(e){return arguments.length?(s=e,t):s},t.defined=function(e){return arguments.length?(o=e,t):o},t.interpolate=function(e){return arguments.length?(a="function"==typeof e?u=e:(u=Tf.get(e)||fo).key,f=u.reverse||u,l=u.closed?"M":"L",t):a},t.tension=function(e){return arguments.length?(c=e,t):c},t}function _o(e){return e.radius}function Do(e){return[e.x,e.y]}function Po(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+Sf;return[n*Math.cos(r),n*Math.sin(r)]}}function Ho(){return 64}function Bo(){return"circle"}function jo(e){var t=Math.sqrt(e/Cu);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+ -t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function Fo(e,t){return du(e,Df),e.id=t,e}function Io(e,t,n,r){var i=e.id;return B(e,"function"==typeof n?function(e,s,o){e.__transition__[i].tween.set(t,r(n.call(e,e.__data__,s,o)))}:(n=r(n),function(e){e.__transition__[i].tween.set(t,n)}))}function qo(e){return null==e&&(e=""),function(){this.textContent=e}}function Ro(e,t,n,r){var i=e.__transition__||(e.__transition__={active:0,count:0}),s=i[n];if(!s){var u=r.time;s=i[n]={tween:new o,time:u,ease:r.ease,delay:r.delay,duration:r.duration},++i.count,Ko.timer(function(r){function o(r){return i.active>n?f():(i.active=n,s.event&&s.event.start.call(e,l,t),s.tween.forEach(function(n,r){(r=r.call(e,l,t))&&v.push(r)}),Ko.timer(function(){return d.c=a(r||1)?Ln:a,1},0,u),void 0)}function a(r){if(i.active!==n)return f();for(var o=r/p,u=c(o),a=v.length;a>0;)v[--a].call(e,u);return o>=1?(s.event&&s.event.end.call(e,l,t),f()):void 0}function f(){return--i.count?delete i[n]:delete e.__transition__,1}var l=e.__data__,c=s.ease,h=s.delay,p=s.duration,d=Yu,v=[];return d.t=h+u,r>=h?o(r-h):(d.c=o,void 0)},0,u)}}function Uo(e,t){e.attr("transform",function(e){return"translate("+t(e)+",0)"})}function zo(e,t){e.attr("transform",function(e){return"translate(0,"+t(e)+")"})}function Wo(e){return e.toISOString()}function Xo(e,t,n){function r(t){return e(t)}function i(e,n){var r=e[1]-e[0],i=r/n,s=Ko.bisect(Uf,i);return s==Uf.length?[t.year,Xs(e.map(function(e){return e/31536e6}),n)[2]]:s?t[i/Uf[s-1]<Uf[s]/i?s-1:s]:[Xf,Xs(e,n)[2]]}return r.invert=function(t){return Vo(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain().map(Vo)},r.nice=function(e,t){function n(n){return!isNaN(n)&&!e.range(n,Vo(+n+1),t).length}var s=r.domain(),o=Bs(s),u=null==e?i(o,10):"number"==typeof e&&i(o,e);return u&&(e=u[0],t=u[1]),r.domain(Is(s,t>1?{floor:function(t){for(;n(t=e.floor(t));)t=Vo(t-1);return t},ceil:function(t){for(;n(t=e.ceil(t));)t=Vo(+t+1);return t}}:e))},r.ticks=function(e,t){var n=Bs(r.domain()),s=null==e?i(n,10):"number"==typeof e?i(n,e):!e.range&&[{range:e},t];return s&&(e=s[0],t=s[1]),e.range(n[0],Vo(+n[1]+1),1>t?1:t)},r.tickFormat=function(){return n},r.copy=function(){return Xo(e.copy(),t,n)},zs(r,e)}function Vo(e){return new Date(e)}function $o(e){return JSON.parse(e.responseText)}function Jo(e){var t=Yo.createRange();return t.selectNode(Yo.body),t.createContextualFragment(e.responseText)}var Ko={version:"3.4.8"};Date.now||(Date.now=function(){return+(new Date)});var Qo=[].slice,Go=function(e){return Qo.call(e)},Yo=document,Zo=Yo.documentElement,eu=window;try{Go(Zo.childNodes)[0].nodeType}catch(tu){Go=function(e){for(var t=e.length,n=new Array(t);t--;)n[t]=e[t];return n}}try{Yo.createElement("div").style.setProperty("opacity",0,"")}catch(nu){var ru=eu.Element.prototype,iu=ru.setAttribute,su=ru.setAttributeNS,ou=eu.CSSStyleDeclaration.prototype,uu=ou.setProperty;ru.setAttribute=function(e,t){iu.call(this,e,t+"")},ru.setAttributeNS=function(e,t,n){su.call(this,e,t,n+"")},ou.setProperty=function(e,t,n){uu.call(this,e,t+"",n)}}Ko.ascending=e,Ko.descending=function(e,t){return e>t?-1:t>e?1:t>=e?0:0/0},Ko.min=function(e,t){var n,r,i=-1,s=e.length;if(1===arguments.length){for(;++i<s&&!(null!=(n=e[i])&&n>=n);)n=void 0;for(;++i<s;)null!=(r=e[i])&&n>r&&(n=r)}else{for(;++i<s&&!(null!=(n=t.call(e,e[i],i))&&n>=n);)n=void 0;for(;++i<s;)null!=(r=t.call(e,e[i],i))&&n>r&&(n=r)}return n},Ko.max=function(e,t){var n,r,i=-1,s=e.length;if(1===arguments.length){for(;++i<s&&!(null!=(n=e[i])&&n>=n);)n=void 0;for(;++i<s;)null!=(r=e[i])&&r>n&&(n=r)}else{for(;++i<s&&!(null!=(n=t.call(e,e[i],i))&&n>=n);)n=void 0;for(;++i<s;)null!=(r=t.call(e,e[i],i))&&r>n&&(n=r)}return n},Ko.extent=function(e,t){var n,r,i,s=-1,o=e.length;if(1===arguments.length){for(;++s<o&&!(null!=(n=i=e[s])&&n>=n);)n=i=void 0;for(;++s<o;)null!=(r=e[s])&&(n>r&&(n=r),r>i&&(i=r))}else{for(;++s<o&&!(null!=(n=i=t.call(e,e[s],s))&&n>=n);)n=void 0;for(;++s<o;)null!=(r=t.call(e,e[s],s))&&(n>r&&(n=r),r>i&&(i=r))}return[n,i]},Ko.sum=function(e,t){var n,r=0,i=e.length,s=-1;if(1===arguments.length)for(;++s<i;)isNaN(n=+e[s])||(r+=n);else for(;++s<i;)isNaN(n=+t.call(e,e[s],s))||(r+=n);return r},Ko.mean=function(e,n){var r,i=0,s=e.length,o=-1,u=s;if(1===arguments.length)for(;++o<s;)t(r=e[o])?i+=r:--u;else for(;++o<s;)t(r=n.call(e,e[o],o))?i+=r:--u;return u?i/u:void 0},Ko.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=+e[r-1],s=n-r;return s?i+s*(e[r]-i):i},Ko.median=function(n,r){return arguments.length>1&&(n=n.map(r)),n=n.filter(t),n.length?Ko.quantile(n.sort(e),.5):void 0};var au=n(e);Ko.bisectLeft=au.left,Ko.bisect=Ko.bisectRight=au.right,Ko.bisector=function(t){return n(1===t.length?function(n,r){return e(t(n),r)}:t)},Ko.shuffle=function(e){for(var t,n,r=e.length;r;)n=0|Math.random()*r--,t=e[r],e[r]=e[n],e[n]=t;return e},Ko.permute=function(e,t){for(var n=t.length,r=new Array(n);n--;)r[n]=e[t[n]];return r},Ko.pairs=function(e){for(var t,n=0,r=e.length-1,i=e[0],s=new Array(0>r?0:r);r>n;)s[n]=[t=i,i=e[++n]];return s},Ko.zip=function(){if(!(i=arguments.length))return[];for(var e=-1,t=Ko.min(arguments,r),n=new Array(t);++e<t;)for(var i,s=-1,o=n[e]=new Array(i);++s<i;)o[s]=arguments[s][e];return n},Ko.transpose=function(e){return Ko.zip.apply(Ko,e)},Ko.keys=function(e){var t=[];for(var n in e)t.push(n);return t},Ko.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},Ko.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},Ko.merge=function(e){for(var t,n,r,i=e.length,s=-1,o=0;++s<i;)o+=e[s].length;for(n=new Array(o);--i>=0;)for(r=e[i],t=r.length;--t>=0;)n[--o]=r[t];return n};var fu=Math.abs;Ko.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),1/0===(t-e)/n)throw new Error("infinite range");var r,s=[],o=i(fu(n)),u=-1;if(e*=o,t*=o,n*=o,0>n)for(;(r=e+n*++u)>t;)s.push(r/o);else for(;(r=e+n*++u)<t;)s.push(r/o);return s},Ko.map=function(e){var t=new o;if(e instanceof o)e.forEach(function(e,n){t.set(e,n)});else for(var n in e)t.set(n,e[n]);return t},s(o,{has:u,get:function(e){return this[lu+e]},set:function(e,t){return this[lu+e]=t},remove:a,keys:f,values:function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},entries:function(){var e=[];return this.forEach(function(t,n){e.push({key:t,value:n})}),e},size:l,empty:c,forEach:function(e){for(var t in this)t.charCodeAt(0)===cu&&e.call(this,t.substring(1),this[t])}});var lu="\0",cu=lu.charCodeAt(0);Ko.nest=function(){function e(t,u,a){if(a>=s.length)return r?r.call(i,u):n?u.sort(n):u;for(var f,l,c,h,p=-1,d=u.length,v=s[a++],m=new o;++p<d;)(h=m.get(f=v(l=u[p])))?h.push(l):m.set(f,[l]);return t?(l=t(),c=function(n,r){l.set(n,e(t,r,a))}):(l={},c=function(n,r){l[n]=e(t,r,a)}),m.forEach(c),l}function t(e,n){if(n>=s.length)return e;var r=[],i=u[n++];return e.forEach(function(e,i){r.push({key:e,values:t(i,n)})}),i?r.sort(function(e,t){return i(e.key,t.key)}):r}var n,r,i={},s=[],u=[];return i.map=function(t,n){return e(n,t,0)},i.entries=function(n){return t(e(Ko.map,n,0),0)},i.key=function(e){return s.push(e),i},i.sortKeys=function(e){return u[s.length-1]=e,i},i.sortValues=function(e){return n=e,i},i.rollup=function(e){return r=e,i},i},Ko.set=function(e){var t=new h;if(e)for(var n=0,r=e.length;r>n;++n)t.add(e[n]);return t},s(h,{has:u,add:function(e){return this[lu+e]=!0,e},remove:function(e){return e=lu+e,e in this&&delete this[e]},values:f,size:l,empty:c,forEach:function(e){for(var t in this)t.charCodeAt(0)===cu&&e.call(this,t.substring(1))}}),Ko.behavior={},Ko.rebind=function(e,t){for(var n,r=1,i=arguments.length;++r<i;)e[n=arguments[r]]=p(e,t,t[n]);return e};var hu=["webkit","ms","moz","Moz","o","O"];Ko.dispatch=function(){for(var e=new m,t=-1,n=arguments.length;++t<n;)e[arguments[t]]=g(e);return e},m.prototype.on=function(e,t){var n=e.indexOf("."),r="";if(n>=0&&(r=e.substring(n+1),e=e.substring(0,n)),e)return arguments.length<2?this[e].on(r):this[e].on(r,t);if(2===arguments.length){if(null==t)for(e in this)this.hasOwnProperty(e)&&this[e].on(r,null);return this}},Ko.event=null,Ko.requote=function(e){return e.replace(pu,"\\$&")};var pu=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,du={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]},vu=function(e,t){return t.querySelector(e)},mu=function(e,t){return t.querySelectorAll(e)},gu=Zo[d(Zo,"matchesSelector")],yu=function(e,t){return gu.call(e,t)};"function"==typeof Sizzle&&(vu=function(e,t){return Sizzle(e,t)[0]||null},mu=Sizzle,yu=Sizzle.matchesSelector),Ko.selection=function(){return Su};var bu=Ko.selection.prototype=[];bu.select=function(e){var t,n,r,i,s=[];e=S(e);for(var o=-1,u=this.length;++o<u;){s.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var a=-1,f=r.length;++a<f;)(i=r[a])?(t.push(n=e.call(i,i.__data__,a,o)),n&&"__data__"in i&&(n.__data__=i.__data__)):t.push(null)}return E(s)},bu.selectAll=function(e){var t,n,r=[];e=x(e);for(var i=-1,s=this.length;++i<s;)for(var o=this[i],u=-1,a=o.length;++u<a;)(n=o[u])&&(r.push(t=Go(e.call(n,n.__data__,u,i))),t.parentNode=n);return E(r)};var wu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};Ko.ns={prefix:wu,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.substring(0,t),e=e.substring(t+1)),wu.hasOwnProperty(n)?{space:wu[n],local:e}:e}},bu.attr=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node();return e=Ko.ns.qualify(e),e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}for(t in e)this.each(T(t,e[t]));return this}return this.each(T(e,t))},bu.classed=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node(),r=(e=k(e)).length,i=-1;if(t=n.classList){for(;++i<r;)if(!t.contains(e[i]))return!1}else for(t=n.getAttribute("class");++i<r;)if(!C(e[i]).test(t))return!1;return!0}for(t in e)this.each(L(t,e[t]));return this}return this.each(L(e,t))},bu.style=function(e,t,n){var r=arguments.length;if(3>r){if("string"!=typeof e){2>r&&(t="");for(n in e)this.each(O(n,e[n],t));return this}if(2>r)return eu.getComputedStyle(this.node(),null).getPropertyValue(e);n=""}return this.each(O(e,t,n))},bu.property=function(e,t){if(arguments.length<2){if("string"==typeof e)return this.node()[e];for(t in e)this.each(M(t,e[t]));return this}return this.each(M(e,t))},bu.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},bu.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},bu.append=function(e){return e=_(e),this.select(function(){return this.appendChild(e.apply(this,arguments))})},bu.insert=function(e,t){return e=_(e),t=S(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)})},bu.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this)})},bu.data=function(e,t){function n(e,n){var r,i,s,u=e.length,c=n.length,h=Math.min(u,c),p=new Array(c),d=new Array(c),v=new Array(u);if(t){var m,g=new o,y=new o,b=[];for(r=-1;++r<u;)m=t.call(i=e[r],i.__data__,r),g.has(m)?v[r]=i:g.set(m,i),b.push(m);for(r=-1;++r<c;)m=t.call(n,s=n[r],r),(i=g.get(m))?(p[r]=i,i.__data__=s):y.has(m)||(d[r]=D(s)),y.set(m,s),g.remove(m);for(r=-1;++r<u;)g.has(b[r])&&(v[r]=e[r])}else{for(r=-1;++r<h;)i=e[r],s=n[r],i?(i.__data__=s,p[r]=i):d[r]=D(s);for(;c>r;++r)d[r]=D(n[r]);for(;u>r;++r)v[r]=e[r]}d.update=p,d.parentNode=p.parentNode=v.parentNode=e.parentNode,a.push(d),f.push(p),l.push(v)}var r,i,s=-1,u=this.length;if(!arguments.length){for(e=new Array(u=(r=this[0]).length);++s<u;)(i=r[s])&&(e[s]=i.__data__);return e}var a=j([]),f=E([]),l=E([]);if("function"==typeof e)for(;++s<u;)n(r=this[s],e.call(r,r.parentNode.__data__,s));else for(;++s<u;)n(r=this[s],e);return f.enter=function(){return a},f.exit=function(){return l},f},bu.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},bu.filter=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=P(e));for(var s=0,o=this.length;o>s;s++){i.push(t=[]),t.parentNode=(n=this[s]).parentNode;for(var u=0,a=n.length;a>u;u++)(r=n[u])&&e.call(r,r.__data__,u,s)&&t.push(r)}return E(i)},bu.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n,r=this[e],i=r.length-1,s=r[i];--i>=0;)(n=r[i])&&(s&&s!==n.nextSibling&&s.parentNode.insertBefore(n,s),s=n);return this},bu.sort=function(e){e=H.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},bu.each=function(e){return B(this,function(t,n,r){e.call(t,t.__data__,n,r)})},bu.call=function(e){var t=Go(arguments);return e.apply(t[0]=this,t),this},bu.empty=function(){return!this.node()},bu.node=function(){for(var e=0,t=this.length;t>e;e++)for(var n=this[e],r=0,i=n.length;i>r;r++){var s=n[r];if(s)return s}return null},bu.size=function(){var e=0;return this.each(function(){++e}),e};var Eu=[];Ko.selection.enter=j,Ko.selection.enter.prototype=Eu,Eu.append=bu.append,Eu.empty=bu.empty,Eu.node=bu.node,Eu.call=bu.call,Eu.size=bu.size,Eu.select=function(e){for(var t,n,r,i,s,o=[],u=-1,a=this.length;++u<a;){r=(i=this[u]).update,o.push(t=[]),t.parentNode=i.parentNode;for(var f=-1,l=i.length;++f<l;)(s=i[f])?(t.push(r[f]=n=e.call(i.parentNode,s.__data__,f,u)),n.__data__=s.__data__):t.push(null)}return E(o)},Eu.insert=function(e,t){return arguments.length<2&&(t=F(this)),bu.insert.call(this,e,t)},bu.transition=function(){for(var e,t,n=Af||++Pf,r=[],i=Of||{time:Date.now(),ease:Ti,delay:0,duration:250},s=-1,o=this.length;++s<o;){r.push(e=[]);for(var u=this[s],a=-1,f=u.length;++a<f;)(t=u[a])&&Ro(t,a,n,i),e.push(t)}return Fo(r,n)},bu.interrupt=function(){return this.each(I)},Ko.select=function(e){var t=["string"==typeof e?vu(e,Yo):e];return t.parentNode=Zo,E([t])},Ko.selectAll=function(e){var t=Go("string"==typeof e?mu(e,Yo):e);return t.parentNode=Zo,E([t])};var Su=Ko.select(Zo);bu.on=function(e,t,n){var r=arguments.length;if(3>r){if("string"!=typeof e){2>r&&(t=!1);for(n in e)this.each(q(n,e[n],t));return this}if(2>r)return(r=this.node()["__on"+e])&&r._;n=!1}return this.each(q(e,t,n))};var xu=Ko.map({mouseenter:"mouseover",mouseleave:"mouseout"});xu.forEach(function(e){"on"+e in Yo&&xu.remove(e)});var Tu="onselectstart"in Yo?null:d(Zo.style,"userSelect"),Nu=0;Ko.mouse=function(e){return W(e,b())},Ko.touches=function(e,t){return arguments.length<2&&(t=b().touches),t?Go(t).map(function(t){var n=W(e,t);return n.identifier=t.identifier,n}):[]},Ko.behavior.drag=function(){function e(){this.on("mousedown.drag",i).on("touchstart.drag",s)}function t(e,t,i,s,o){return function(){function u(){var e,n,r=t(h,v);r&&(e=r[0]-b[0],n=r[1]-b[1],d|=e|n,b=r,p({type:"drag",x:r[0]+f[0],y:r[1]+f[1],dx:e,dy:n}))}function a(){t(h,v)&&(g.on(s+m,null).on(o+m,null),y(d&&Ko.event.target===c),p({type:"dragend"}))}var f,l=this,c=Ko.event.target,h=l.parentNode,p=n.of(l,arguments),d=0,v=e(),m=".drag"+(null==v?"":"-"+v),g=Ko.select(i()).on(s+m,u).on(o+m,a),y=z(),b=t(h,v);r?(f=r.apply(l,arguments),f=[f.x-b[0],f.y-b[1]]):f=[0,0],p({type:"dragstart"})}}var n=w(e,"drag","dragstart","dragend"),r=null,i=t(v,Ko.mouse,$,"mousemove","mouseup"),s=t(X,Ko.touch,V,"touchmove","touchend");return e.origin=function(t){return arguments.length?(r=t,e):r},Ko.rebind(e,n,"on")};var Cu=Math.PI,ku=2*Cu,Lu=Cu/2,Au=1e-6,Ou=Au*Au,Mu=Cu/180,_u=180/Cu,Du=Math.SQRT2,Pu=2,Hu=4;Ko.interpolateZoom=function(e,t){function n(e){var t=e*y;if(g){var n=Z(v),o=s/(Pu*h)*(n*et(Du*t+v)-Y(v));return[r+o*f,i+o*l,s*n/Z(Du*t+v)]}return[r+e*f,i+e*l,s*Math.exp(Du*t)]}var r=e[0],i=e[1],s=e[2],o=t[0],u=t[1],a=t[2],f=o-r,l=u-i,c=f*f+l*l,h=Math.sqrt(c),p=(a*a-s*s+Hu*c)/(2*s*Pu*h),d=(a*a-s*s-Hu*c)/(2*a*Pu*h),v=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(d*d+1)-d),g=m-v,y=(g||Math.log(a/s))/Du;return n.duration=1e3*y,n},Ko.behavior.zoom=function(){function e(e){e.on(k,f).on(Fu+".zoom",c).on(L,h).on("dblclick.zoom",p).on(O,l)}function t(e){return[(e[0]-T.x)/T.k,(e[1]-T.y)/T.k]}function n(e){return[e[0]*T.k+T.x,e[1]*T.k+T.y]}function r(e){T.k=Math.max(C[0],Math.min(C[1],e))}function i(e,t){t=n(t),T.x+=e[0]-t[0],T.y+=e[1]-t[1]}function s(){E&&E.domain(b.range().map(function(e){return(e-T.x)/T.k}).map(b.invert)),x&&x.domain(S.range().map(function(e){return(e-T.y)/T.k}).map(S.invert))}function o(e){e({type:"zoomstart"})}function u(e){s(),e({type:"zoom",scale:T.k,translate:[T.x,T.y]})}function a(e){e({type:"zoomend"})}function f(){function e(){l=1,i(Ko.mouse(r),p),u(f)}function n(){c.on(L,eu===r?h:null).on(A,null),d(l&&Ko.event.target===s),a(f)}var r=this,s=Ko.event.target,f=M.of(r,arguments),l=0,c=Ko.select(eu).on(L,e).on(A,n),p=t(Ko.mouse(r)),d=z();I.call(r),o(f)}function l(){function e(){var e=Ko.touches(p);return h=T.k,e.forEach(function(e){e.identifier in v&&(v[e.identifier]=t(e))}),e}function n(){var t=Ko.event.target;Ko.select(t).on(w,s).on(E,c),S.push(t);for(var n=Ko.event.changedTouches,o=0,a=n.length;a>o;++o)v[n[o].identifier]=null;var f=e(),l=Date.now();if(1===f.length){if(500>l-g){var h=f[0],p=v[h.identifier];r(2*T.k),i(h,p),y(),u(d)}g=l}else if(f.length>1){var h=f[0],b=f[1],x=h[0]-b[0],N=h[1]-b[1];m=x*x+N*N}}function s(){for(var e,t,n,s,o=Ko.touches(p),a=0,f=o.length;f>a;++a,s=null)if(n=o[a],s=v[n.identifier]){if(t)break;e=n,t=s}if(s){var l=(l=n[0]-e[0])*l+(l=n[1]-e[1])*l,c=m&&Math.sqrt(l/m);e=[(e[0]+n[0])/2,(e[1]+n[1])/2],t=[(t[0]+s[0])/2,(t[1]+s[1])/2],r(c*h)}g=null,i(e,t),u(d)}function c(){if(Ko.event.touches.length){for(var t=Ko.event.changedTouches,n=0,r=t.length;r>n;++n)delete v[t[n].identifier];for(var i in v)return void e()}Ko.selectAll(S).on(b,null),x.on(k,f).on(O,l),N(),a(d)}var h,p=this,d=M.of(p,arguments),v={},m=0,b=".zoom-"+Ko.event.changedTouches[0].identifier,w="touchmove"+b,E="touchend"+b,S=[],x=Ko.select(p).on(k,null).on(O,n),N=z();I.call(p),n(),o(d)}function c(){var e=M.of(this,arguments);m?clearTimeout(m):(I.call(this),o(e)),m=setTimeout(function(){m=null,a(e)},50),y();var n=v||Ko.mouse(this);d||(d=t(n)),r(Math.pow(2,.002*Bu())*T.k),i(n,d),u(e)}function h(){d=null}function p(){var e=M.of(this,arguments),n=Ko.mouse(this),s=t(n),f=Math.log(T.k)/Math.LN2;o(e),r(Math.pow(2,Ko.event.shiftKey?Math.ceil(f)-1:Math.floor(f)+1)),i(n,s),u(e),a(e)}var d,v,m,g,b,E,S,x,T={x:0,y:0,k:1},N=[960,500],C=ju,k="mousedown.zoom",L="mousemove.zoom",A="mouseup.zoom",O="touchstart.zoom",M=w(e,"zoomstart","zoom","zoomend");return e.event=function(e){e.each(function(){var e=M.of(this,arguments),t=T;Af?Ko.select(this).transition().each("start.zoom",function(){T=this.__chart__||{x:0,y:0,k:1},o(e)}).tween("zoom:zoom",function(){var n=N[0],r=N[1],i=n/2,s=r/2,o=Ko.interpolateZoom([(i-T.x)/T.k,(s-T.y)/T.k,n/T.k],[(i-t.x)/t.k,(s-t.y)/t.k,n/t.k]);return function(t){var r=o(t),a=n/r[2];this.__chart__=T={x:i-r[0]*a,y:s-r[1]*a,k:a},u(e)}}).each("end.zoom",function(){a(e)}):(this.__chart__=T,o(e),u(e),a(e))})},e.translate=function(t){return arguments.length?(T={x:+t[0],y:+t[1],k:T.k},s(),e):[T.x,T.y]},e.scale=function(t){return arguments.length?(T={x:T.x,y:T.y,k:+t},s(),e):T.k},e.scaleExtent=function(t){return arguments.length?(C=null==t?ju:[+t[0],+t[1]],e):C},e.center=function(t){return arguments.length?(v=t&&[+t[0],+t[1]],e):v},e.size=function(t){return arguments.length?(N=t&&[+t[0],+t[1]],e):N},e.x=function(t){return arguments.length?(E=t,b=t.copy(),T={x:0,y:0,k:1},e):E},e.y=function(t){return arguments.length?(x=t,S=t.copy(),T={x:0,y:0,k:1},e):x},Ko.rebind(e,M,"on")};var Bu,ju=[0,1/0],Fu="onwheel"in Yo?(Bu=function(){return-Ko.event.deltaY*(Ko.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Yo?(Bu=function(){return Ko.event.wheelDelta},"mousewheel"):(Bu=function(){return-Ko.event.detail},"MozMousePixelScroll");nt.prototype.toString=function(){return this.rgb()+""},Ko.hsl=function(e,t,n){return 1===arguments.length?e instanceof it?rt(e.h,e.s,e.l):Et(""+e,St,rt):rt(+e,+t,+n)};var Iu=it.prototype=new nt;Iu.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),rt(this.h,this.s,this.l/e)},Iu.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),rt(this.h,this.s,e*this.l)},Iu.rgb=function(){return st(this.h,this.s,this.l)},Ko.hcl=function(e,t,n){return 1===arguments.length?e instanceof ut?ot(e.h,e.c,e.l):e instanceof lt?ht(e.l,e.a,e.b):ht((e=xt((e=Ko.rgb(e)).r,e.g,e.b)).l,e.a,e.b):ot(+e,+t,+n)};var qu=ut.prototype=new nt;qu.brighter=function(e){return ot(this.h,this.c,Math.min(100,this.l+Ru*(arguments.length?e:1)))},qu.darker=function(e){return ot(this.h,this.c,Math.max(0,this.l-Ru*(arguments.length?e:1)))},qu.rgb=function(){return at(this.h,this.c,this.l).rgb()},Ko.lab=function(e,t,n){return 1===arguments.length?e instanceof lt?ft(e.l,e.a,e.b):e instanceof ut?at(e.l,e.c,e.h):xt((e=Ko.rgb(e)).r,e.g,e.b):ft(+e,+t,+n)};var Ru=18,Uu=.95047,zu=1,Wu=1.08883,Xu=lt.prototype=new nt;Xu.brighter=function(e){return ft(Math.min(100,this.l+Ru*(arguments.length?e:1)),this.a,this.b)},Xu.darker=function(e){return ft(Math.max(0,this.l-Ru*(arguments.length?e:1)),this.a,this.b)},Xu.rgb=function(){return ct(this.l,this.a,this.b)},Ko.rgb=function(e,t,n){return 1===arguments.length?e instanceof bt?yt(e.r,e.g,e.b):Et(""+e,yt,st):yt(~~e,~~t,~~n)};var Vu=bt.prototype=new nt;Vu.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return t||n||r?(t&&i>t&&(t=i),n&&i>n&&(n=i),r&&i>r&&(r=i),yt(Math.min(255,~~(t/e)),Math.min(255,~~(n/e)),Math.min(255,~~(r/e)))):yt(i,i,i)},Vu.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),yt(~~(e*this.r),~~(e*this.g),~~(e*this.b))},Vu.hsl=function(){return St(this.r,this.g,this.b)},Vu.toString=function(){return"#"+wt(this.r)+wt(this.g)+wt(this.b)};var $u=Ko.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});$u.forEach(function(e,t){$u.set(e,mt(t))}),Ko.functor=Ct,Ko.xhr=Lt(kt),Ko.dsv=function(e,t){function n(e,n,s){arguments.length<3&&(s=n,n=null);var o=At(e,t,null==n?r:i(n),s);return o.row=function(e){return arguments.length?o.response(null==(n=e)?r:i(e)):n},o}function r(e){return n.parse(e.responseText)}function i(e){return function(t){return n.parse(t.responseText,e)}}function s(t){return t.map(o).join(e)}function o(e){return u.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var u=new RegExp('["'+e+"\n]"),a=e.charCodeAt(0);return n.parse=function(e,t){var r;return n.parseRows(e,function(e,n){if(r)return r(e,n-1);var i=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");r=t?function(e,n){return t(i(e),n)}:i})},n.parseRows=function(e,t){function n(){if(l>=f)return o;if(i)return i=!1,s;var t=l;if(34===e.charCodeAt(t)){for(var n=t;n++<f;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}l=n+2;var r=e.charCodeAt(n+1);return 13===r?(i=!0,10===e.charCodeAt(n+2)&&++l):10===r&&(i=!0),e.substring(t+1,n).replace(/""/g,'"')}for(;f>l;){var r=e.charCodeAt(l++),u=1;if(10===r)i=!0;else if(13===r)i=!0,10===e.charCodeAt(l)&&(++l,++u);else if(r!==a)continue;return e.substring(t,l-u)}return e.substring(t)}for(var r,i,s={},o={},u=[],f=e.length,l=0,c=0;(r=n())!==o;){for(var h=[];r!==s&&r!==o;)h.push(r),r=n();(!t||(h=t(h,c++)))&&u.push(h)}return u},n.format=function(t){if(Array.isArray(t[0]))return n.formatRows(t);var r=new h,i=[];return t.forEach(function(e){for(var t in e)r.has(t)||i.push(r.add(t))}),[i.map(o).join(e)].concat(t.map(function(t){return i.map(function(e){return o(t[e])}).join(e)})).join("\n")},n.formatRows=function(e){return e.map(s).join("\n")},n},Ko.csv=Ko.dsv(",","text/csv"),Ko.tsv=Ko.dsv("	","text/tab-separated-values"),Ko.touch=function(e,t,n){if(arguments.length<3&&(n=t,t=b().changedTouches),t)for(var r,i=0,s=t.length;s>i;++i)if((r=t[i]).identifier===n)return W(e,r)};var Ju,Ku,Qu,Gu,Yu,Zu=eu[d(eu,"requestAnimationFrame")]||function(e){setTimeout(e,17)};Ko.timer=function(e,t,n){var r=arguments.length;2>r&&(t=0),3>r&&(n=Date.now());var i=n+t,s={c:e,t:i,f:!1,n:null};Ku?Ku.n=s:Ju=s,Ku=s,Qu||(Gu=clearTimeout(Gu),Qu=1,Zu(Mt))},Ko.timer.flush=function(){_t(),Dt()},Ko.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)};var ea=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(Ht);Ko.formatPrefix=function(e,t){var n=0;return e&&(0>e&&(e*=-1),t&&(e=Ko.round(e,Pt(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),ea[8+n/3]};var ta=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,na=Ko.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return(e=Ko.round(e,Pt(e,t))).toFixed(Math.max(0,Math.min(20,Pt(e*(1+1e-15),t))))}}),ra=Ko.time={},ia=Date;Ft.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){sa.setUTCDate.apply(this._,arguments)},setDay:function(){sa.setUTCDay.apply(this._,arguments)},setFullYear:function(){sa.setUTCFullYear.apply(this._,arguments)},setHours:function(){sa.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){sa.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){sa.setUTCMinutes.apply(this._,arguments)},setMonth:function(){sa.setUTCMonth.apply(this._,arguments)},setSeconds:function(){sa.setUTCSeconds.apply(this._,arguments)},setTime:function(){sa.setTime.apply(this._,arguments)}};var sa=Date.prototype;ra.year=It(function(e){return e=ra.day(e),e.setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),ra.years=ra.year.range,ra.years.utc=ra.year.utc.range,ra.day=It(function(e){var t=new ia(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),ra.days=ra.day.range,ra.days.utc=ra.day.utc.range,ra.dayOfYear=function(e){var t=ra.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(e,t){t=7-t;var n=ra[e]=It(function(e){return(e=ra.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+7*Math.floor(t))},function(e){var n=ra.year(e).getDay();return Math.floor((ra.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});ra[e+"s"]=n.range,ra[e+"s"].utc=n.utc.range,ra[e+"OfYear"]=function(e){var n=ra.year(e).getDay();return Math.floor((ra.dayOfYear(e)+(n+t)%7)/7)}}),ra.week=ra.sunday,ra.weeks=ra.sunday.range,ra.weeks.utc=ra.sunday.utc.range,ra.weekOfYear=ra.sundayOfYear;var oa={"-":"",_:" ",0:"0"},ua=/^\s*\d+/,aa=/^%/;Ko.locale=function(e){return{numberFormat:Bt(e),timeFormat:Rt(e)}};var fa=Ko.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Ko.format=fa.numberFormat,Ko.geo={},fn.prototype={s:0,t:0,add:function(e){ln(e,this.t,la),ln(la.s,this.s,this),this.s?this.t+=la.t:this.s=la.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var la=new fn;Ko.geo.stream=function(e,t){e&&ca.hasOwnProperty(e.type)?ca[e.type](e,t):cn(e,t)};var ca={Feature:function(e,t){cn(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)cn(n[r].geometry,t)}},ha={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){hn(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)hn(n[r],t,0)},Polygon:function(e,t){pn(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)pn(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)cn(n[r],t)}};Ko.geo.area=function(e){return pa=0,Ko.geo.stream(e,va),pa};var pa,da=new fn,va={sphere:function(){pa+=4*Cu},point:v,lineStart:v,lineEnd:v,polygonStart:function(){da.reset(),va.lineStart=dn},polygonEnd:function(){var e=2*da;pa+=0>e?4*Cu+e:e,va.lineStart=va.lineEnd=va.point=v}};Ko.geo.bounds=function(){function e(e,t){b.push(w=[l=e,h=e]),c>t&&(c=t),t>p&&(p=t)}function t(t,n){var r=vn([t*Mu,n*Mu]);if(g){var i=gn(g,r),s=[i[1],-i[0],0],o=gn(s,i);wn(o),o=En(o);var a=t-d,f=a>0?1:-1,v=o[0]*_u*f,m=fu(a)>180;if(m^(v>f*d&&f*t>v)){var y=o[1]*_u;y>p&&(p=y)}else if(v=(v+360)%360-180,m^(v>f*d&&f*t>v)){var y=-o[1]*_u;c>y&&(c=y)}else c>n&&(c=n),n>p&&(p=n);m?d>t?u(l,t)>u(l,h)&&(h=t):u(t,h)>u(l,h)&&(l=t):h>=l?(l>t&&(l=t),t>h&&(h=t)):t>d?u(l,t)>u(l,h)&&(h=t):u(t,h)>u(l,h)&&(l=t)}else e(t,n);g=r,d=t}function n(){E.point=t}function r(){w[0]=l,w[1]=h,E.point=e,g=null}function i(e,n){if(g){var r=e-d;y+=fu(r)>180?r+(r>0?360:-360):r}else v=e,m=n;va.point(e,n),t(e,n)}function s(){va.lineStart()}function o(){i(v,m),va.lineEnd(),fu(y)>Au&&(l=-(h=180)),w[0]=l,w[1]=h,g=null}function u(e,t){return(t-=e)<0?t+360:t}function a(e,t){return e[0]-t[0]}function f(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var l,c,h,p,d,v,m,g,y,b,w,E={point:e,lineStart:n,lineEnd:r,polygonStart:function(){E.point=i,E.lineStart=s,E.lineEnd=o,y=0,va.polygonStart()},polygonEnd:function(){va.polygonEnd(),E.point=e,E.lineStart=n,E.lineEnd=r,0>da?(l=-(h=180),c=-(p=90)):y>Au?p=90:-Au>y&&(c=-90),w[0]=l,w[1]=h}};return function(e){p=h=-(l=c=1/0),b=[],Ko.geo.stream(e,E);var t=b.length;if(t){b.sort(a);for(var n,r=1,i=b[0],s=[i];t>r;++r)n=b[r],f(n[0],i)||f(n[1],i)?(u(i[0],n[1])>u(i[0],i[1])&&(i[1]=n[1]),u(n[0],i[1])>u(i[0],i[1])&&(i[0]=n[0])):s.push(i=n);for(var o,n,d=-1/0,t=s.length-1,r=0,i=s[t];t>=r;i=n,++r)n=s[r],(o=u(i[1],n[0]))>d&&(d=o,l=n[0],h=i[1])}return b=w=null,1/0===l||1/0===c?[[0/0,0/0],[0/0,0/0]]:[[l,c],[h,p]]}}(),Ko.geo.centroid=function(e){ma=ga=ya=ba=wa=Ea=Sa=xa=Ta=Na=Ca=0,Ko.geo.stream(e,ka);var t=Ta,n=Na,r=Ca,i=t*t+n*n+r*r;return Ou>i&&(t=Ea,n=Sa,r=xa,Au>ga&&(t=ya,n=ba,r=wa),i=t*t+n*n+r*r,Ou>i)?[0/0,0/0]:[Math.atan2(n,t)*_u,G(r/Math.sqrt(i))*_u]};var ma,ga,ya,ba,wa,Ea,Sa,xa,Ta,Na,Ca,ka={sphere:v,point:xn,lineStart:Nn,lineEnd:Cn,polygonStart:function(){ka.lineStart=kn},polygonEnd:function(){ka.lineStart=Nn}},La=_n(Ln,jn,In,[-Cu,-Cu/2]),Aa=1e9;Ko.geo.clipExtent=function(){var e,t,n,r,i,s,o={stream:function(e){return i&&(i.valid=!1),i=s(e),i.valid=!0,i},extent:function(u){return arguments.length?(s=Un(e=+u[0][0],t=+u[0][1],n=+u[1][0],r=+u[1][1]),i&&(i.valid=!1,i=null),o):[[e,t],[n,r]]}};return o.extent([[0,0],[960,500]])},(Ko.geo.conicEqualArea=function(){return Wn(Xn)}).raw=Xn,Ko.geo.albers=function(){return Ko.geo.conicEqualArea().rotate([96,0]).center([-0.6,38.7]).parallels([29.5,45.5]).scale(1070)},Ko.geo.albersUsa=function(){function e(e){var s=e[0],o=e[1];return t=null,n(s,o),t||(r(s,o),t)||i(s,o),t}var t,n,r,i,s=Ko.geo.albers(),o=Ko.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=Ko.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a={point:function(e,n){t=[e,n]}};return e.invert=function(e){var t=s.scale(),n=s.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&.234>i&&r>=-0.425&&-0.214>r?o:i>=.166&&.234>i&&r>=-0.214&&-0.115>r?u:s).invert(e)},e.stream=function(e){var t=s.stream(e),n=o.stream(e),r=u.stream(e);return{point:function(e,i){t.point(e,i),n.point(e,i),r.point(e,i)},sphere:function(){t.sphere(),n.sphere(),r.sphere()},lineStart:function(){t.lineStart(),n.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),n.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),n.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),n.polygonEnd(),r.polygonEnd()}}},e.precision=function(t){return arguments.length?(s.precision(t),o.precision(t),u.precision(t),e):s.precision()},e.scale=function(t){return arguments.length?(s.scale(t),o.scale(.35*t),u.scale(t),e.translate(s.translate())):s.scale()},e.translate=function(t){if(!arguments.length)return s.translate();var f=s.scale(),l=+t[0],c=+t[1];return n=s.translate(t).clipExtent([[l-.455*f,c-.238*f],[l+.455*f,c+.238*f]]).stream(a).point,r=o.translate([l-.307*f,c+.201*f]).clipExtent([[l-.425*f+Au,c+.12*f+Au],[l-.214*f-Au,c+.234*f-Au]]).stream(a).point,i=u.translate([l-.205*f,c+.212*f]).clipExtent([[l-.214*f+Au,c+.166*f+Au],[l-.115*f-Au,c+.234*f-Au]]).stream(a).point,e},e.scale(1070)};var Oa,Ma,_a,Da,Pa,Ha,Ba={point:v,lineStart:v,lineEnd:v,polygonStart:function(){Ma=0,Ba.lineStart=Vn},polygonEnd:function(){Ba.lineStart=Ba.lineEnd=Ba.point=v,Oa+=fu(Ma/2)}},ja={point:$n,lineStart:v,lineEnd:v,polygonStart:v,polygonEnd:v},Fa={point:Qn,lineStart:Gn,lineEnd:Yn,polygonStart:function(){Fa.lineStart=Zn},polygonEnd:function(){Fa.point=Qn,Fa.lineStart=Gn,Fa.lineEnd=Yn}};Ko.geo.path=function(){function e(e){return e&&("function"==typeof u&&s.pointRadius(+u.apply(this,arguments)),o&&o.valid||(o=i(s)),Ko.geo.stream(e,o)),s.result()}function t(){return o=null,e}var n,r,i,s,o,u=4.5;return e.area=function(e){return Oa=0,Ko.geo.stream(e,i(Ba)),Oa},e.centroid=function(e){return ya=ba=wa=Ea=Sa=xa=Ta=Na=Ca=0,Ko.geo.stream(e,i(Fa)),Ca?[Ta/Ca,Na/Ca]:xa?[Ea/xa,Sa/xa]:wa?[ya/wa,ba/wa]:[0/0,0/0]},e.bounds=function(e){return Pa=Ha=-(_a=Da=1/0),Ko.geo.stream(e,i(ja)),[[_a,Da],[Pa,Ha]]},e.projection=function(e){return arguments.length?(i=(n=e)?e.stream||nr(e):kt,t()):n},e.context=function(e){return arguments.length?(s=null==(r=e)?new Jn:new er(e),"function"!=typeof u&&s.pointRadius(u),t()):r},e.pointRadius=function(t){return arguments.length?(u="function"==typeof t?t:(s.pointRadius(+t),+t),e):u},e.projection(Ko.geo.albersUsa()).context(null)},Ko.geo.transform=function(e){return{stream:function(t){var n=new rr(t);for(var r in e)n[r]=e[r];return n}}},rr.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Ko.geo.projection=sr,Ko.geo.projectionMutator=or,(Ko.geo.equirectangular=function(){return sr(ar)}).raw=ar.invert=ar,Ko.geo.rotation=function(e){function t(t){return t=e(t[0]*Mu,t[1]*Mu),t[0]*=_u,t[1]*=_u,t}return e=lr(e[0]%360*Mu,e[1]*Mu,e.length>2?e[2]*Mu:0),t.invert=function(t){return t=e.invert(t[0]*Mu,t[1]*Mu),t[0]*=_u,t[1]*=_u,t},t},fr.invert=ar,Ko.geo.circle=function(){function e(){var e="function"==typeof r?r.apply(this,arguments):r,t=lr(-e[0]*Mu,-e[1]*Mu,0).invert,i=[];return n(null,null,1,{point:function(e,n){i.push(e=t(e,n)),e[0]*=_u,e[1]*=_u}}),{type:"Polygon",coordinates:[i]}}var t,n,r=[0,0],i=6;return e.origin=function(t){return arguments.length?(r=t,e):r},e.angle=function(r){return arguments.length?(n=dr((t=+r)*Mu,i*Mu),e):t},e.precision=function(r){return arguments.length?(n=dr(t*Mu,(i=+r)*Mu),e):i},e.angle(90)},Ko.geo.distance=function(e,t){var n,r=(t[0]-e[0])*Mu,i=e[1]*Mu,s=t[1]*Mu,o=Math.sin(r),u=Math.cos(r),a=Math.sin(i),f=Math.cos(i),l=Math.sin(s),c=Math.cos(s);return Math.atan2(Math.sqrt((n=c*o)*n+(n=f*l-a*c*u)*n),a*l+f*c*u)},Ko.geo.graticule=function(){function e(){return{type:"MultiLineString",coordinates:t()}}function t(){return Ko.range(Math.ceil(s/m)*m,i,m).map(h).concat(Ko.range(Math.ceil(f/g)*g,a,g).map(p)).concat(Ko.range(Math.ceil(r/d)*d,n,d).filter(function(e){return fu(e%m)>Au}).map(l)).concat(Ko.range(Math.ceil(u/v)*v,o,v).filter(function(e){return fu(e%g)>Au}).map(c))}var n,r,i,s,o,u,a,f,l,c,h,p,d=10,v=d,m=90,g=360,y=2.5;return e.lines=function(){return t().map(function(e){return{type:"LineString",coordinates:e}})},e.outline=function(){return{type:"Polygon",coordinates:[h(s).concat(p(a).slice(1),h(i).reverse().slice(1),p(f).reverse().slice(1))]}},e.extent=function(t){return arguments.length?e.majorExtent(t).minorExtent(t):e.minorExtent()},e.majorExtent=function(t){return arguments.length?(s=+t[0][0],i=+t[1][0],f=+t[0][1],a=+t[1][1],s>i&&(t=s,s=i,i=t),f>a&&(t=f,f=a,a=t),e.precision(y)):[[s,f],[i,a]]},e.minorExtent=function(t){return arguments.length?(r=+t[0][0],n=+t[1][0],u=+t[0][1],o=+t[1][1],r>n&&(t=r,r=n,n=t),u>o&&(t=u,u=o,o=t),e.precision(y)):[[r,u],[n,o]]},e.step=function(t){return arguments.length?e.majorStep(t).minorStep(t):e.minorStep()},e.majorStep=function(t){return arguments.length?(m=+t[0],g=+t[1],e):[m,g]},e.minorStep=function(t){return arguments.length?(d=+t[0],v=+t[1],e):[d,v]},e.precision=function(t){return arguments.length?(y=+t,l=mr(u,o,90),c=gr(r,n,y),h=mr(f,a,90),p=gr(s,i,y),e):y},e.majorExtent([[-180,-90+Au],[180,90-Au]]).minorExtent([[-180,-80-Au],[180,80+Au]])},Ko.geo.greatArc=function(){function e(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),n||i.apply(this,arguments)]}}var t,n,r=yr,i=br;return e.distance=function(){return Ko.geo.distance(t||r.apply(this,arguments),n||i.apply(this,arguments))},e.source=function(n){return arguments.length?(r=n,t="function"==typeof n?null:n,e):r},e.target=function(t){return arguments.length?(i=t,n="function"==typeof t?null:t,e):i},e.precision=function(){return arguments.length?e:0},e},Ko.geo.interpolate=function(e,t){return wr(e[0]*Mu,e[1]*Mu,t[0]*Mu,t[1]*Mu)},Ko.geo.length=function(e){return Ia=0,Ko.geo.stream(e,qa),Ia};var Ia,qa={sphere:v,point:v,lineStart:Er,lineEnd:v,polygonStart:v,polygonEnd:v},Ra=Sr(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)});(Ko.geo.azimuthalEqualArea=function(){return sr(Ra)}).raw=Ra;var Ua=Sr(function(e){var t=Math.acos(e);return t&&t/Math.sin(t)},kt);(Ko.geo.azimuthalEquidistant=function(){return sr(Ua)}).raw=Ua,(Ko.geo.conicConformal=function(){return Wn(xr)}).raw=xr,(Ko.geo.conicEquidistant=function(){return Wn(Tr)}).raw=Tr;var za=Sr(function(e){return 1/e},Math.atan);(Ko.geo.gnomonic=function(){return sr(za)}).raw=za,Nr.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-Lu]},(Ko.geo.mercator=function(){return Cr(Nr)}).raw=Nr;var Wa=Sr(function(){return 1},Math.asin);(Ko.geo.orthographic=function(){return sr(Wa)}).raw=Wa;var Xa=Sr(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)});(Ko.geo.stereographic=function(){return sr(Xa)}).raw=Xa,kr.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-Lu]},(Ko.geo.transverseMercator=function(){var e=Cr(kr),t=e.center,n=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):(e=t(),[-e[1],e[0]])},e.rotate=function(e){return e?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90])},e.rotate([0,0])}).raw=kr,Ko.geom={},Ko.geom.hull=function(e){function t(e){if(e.length<3)return[];var t,i=Ct(n),s=Ct(r),o=e.length,u=[],a=[];for(t=0;o>t;t++)u.push([+i.call(this,e[t],t),+s.call(this,e[t],t),t]);for(u.sort(Mr),t=0;o>t;t++)a.push([u[t][0],-u[t][1]]);var f=Or(u),l=Or(a),c=l[0]===f[0],h=l[l.length-1]===f[f.length-1],p=[];for(t=f.length-1;t>=0;--t)p.push(e[u[f[t]][2]]);for(t=+c;t<l.length-h;++t)p.push(e[u[l[t]][2]]);return p}var n=Lr,r=Ar;return arguments.length?t(e):(t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t)},Ko.geom.polygon=function(e){return du(e,Va),e};var Va=Ko.geom.polygon.prototype=[];Va.area=function(){for(var e,t=-1,n=this.length,r=this[n-1],i=0;++t<n;)e=r,r=this[t],i+=e[1]*r[0]-e[0]*r[1];return.5*i},Va.centroid=function(e){var t,n,r=-1,i=this.length,s=0,o=0,u=this[i-1];for(arguments.length||(e=-1/(6*this.area()));++r<i;)t=u,u=this[r],n=t[0]*u[1]-u[0]*t[1],s+=(t[0]+u[0])*n,o+=(t[1]+u[1])*n;return[s*e,o*e]},Va.clip=function(e){for(var t,n,r,i,s,o,u=Pr(e),a=-1,f=this.length-Pr(this),l=this[f-1];++a<f;){for(t=e.slice(),e.length=0,i=this[a],s=t[(r=t.length-u)-1],n=-1;++n<r;)o=t[n],_r(o,l,i)?(_r(s,l,i)||e.push(Dr(s,o,l,i)),e.push(o)):_r(s,l,i)&&e.push(Dr(s,o,l,i)),s=o;u&&e.push(e[0]),l=i}return e};var $a,Ja,Ka,Qa,Ga,Ya=[],Za=[];Ur.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(Wr),t.length},ei.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},ti.prototype={insert:function(e,t){var n,r,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=si(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)r=n.U,n===r.L?(i=r.R,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.R&&(ri(this,n),e=n,n=e.U),n.C=!1,r.C=!0,ii(this,r))):(i=r.L,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.L&&(ii(this,n),e=n,n=e.U),n.C=!1,r.C=!0,ri(this,r))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,r,i=e.U,s=e.L,o=e.R;if(n=s?o?si(o):s:o,i?i.L===e?i.L=n:i.R=n:this._=n,s&&o?(r=n.C,n.C=e.C,n.L=s,s.U=n,n!==o?(i=n.U,n.U=e.U,e=n.R,i.L=e,n.R=o,o.U=n):(n.U=i,i=n,e=n.R)):(r=e.C,e=n),e&&(e.U=i),!r){if(e&&e.C)return e.C=!1,void 0;do{if(e===this._)break;if(e===i.L){if(t=i.R,t.C&&(t.C=!1,i.C=!0,ri(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,ii(this,t),t=i.R),t.C=i.C,i.C=t.R.C=!1,ri(this,i),e=this._;break}}else if(t=i.L,t.C&&(t.C=!1,i.C=!0,ii(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,ri(this,t),t=i.L),t.C=i.C,i.C=t.L.C=!1,ii(this,i),e=this._;break}t.C=!0,e=i,i=i.U}while(!e.C);e&&(e.C=!1)}}},Ko.geom.voronoi=function(e){function t(e){var t=new Array(e.length),r=u[0][0],i=u[0][1],s=u[1][0],o=u[1][1];return oi(n(e),u).cells.forEach(function(n,u){var a=n.edges,f=n.site,l=t[u]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):f.x>=r&&f.x<=s&&f.y>=i&&f.y<=o?[[r,o],[s,o],[s,i],[r,i]]:[];l.point=e[u]}),t}function n(e){return e.map(function(e,t){return{x:Math.round(s(e,t)/Au)*Au,y:Math.round(o(e,t)/Au)*Au,i:t}})}var r=Lr,i=Ar,s=r,o=i,u=ef;return e?t(e):(t.links=function(e){return oi(n(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},t.triangles=function(e){var t=[];return oi(n(e)).cells.forEach(function(n,r){for(var i,s,o=n.site,u=n.edges.sort(Wr),a=-1,f=u.length,l=u[f-1].edge,c=l.l===o?l.r:l.l;++a<f;)i=l,s=c,l=u[a].edge,c=l.l===o?l.r:l.l,r<s.i&&r<c.i&&ai(o,s,c)<0&&t.push([e[r],e[s.i],e[c.i]])}),t},t.x=function(e){return arguments.length?(s=Ct(r=e),t):r},t.y=function(e){return arguments.length?(o=Ct(i=e),t):i},t.clipExtent=function(e){return arguments.length?(u=null==e?ef:e,t):u===ef?null:u},t.size=function(e){return arguments.length?t.clipExtent(e&&[[0,0],e]):u===ef?null:u&&u[1]},t)};var ef=[[-1e6,-1e6],[1e6,1e6]];Ko.geom.delaunay=function(e){return Ko.geom.voronoi().triangles(e)},Ko.geom.quadtree=function(e,t,n,r,i){function s(e){function s(e,t,n,r,i,s,o,u){if(!isNaN(n)&&!isNaN(r))if(e.leaf){var a=e.x,l=e.y;if(null!=a)if(fu(a-n)+fu(l-r)<.01)f(e,t,n,r,i,s,o,u);else{var c=e.point;e.x=e.y=e.point=null,f(e,c,a,l,i,s,o,u),f(e,t,n,r,i,s,o,u)}else e.x=n,e.y=r,e.point=t}else f(e,t,n,r,i,s,o,u)}function f(e,t,n,r,i,o,u,a){var f=.5*(i+u),l=.5*(o+a),c=n>=f,h=r>=l,p=(h<<1)+c;e.leaf=!1,e=e.nodes[p]||(e.nodes[p]=ci()),c?i=f:u=f,h?o=l:a=l,s(e,t,n,r,i,o,u,a)}var l,c,h,p,d,v,m,g,y,b=Ct(u),w=Ct(a);if(null!=t)v=t,m=n,g=r,y=i;else if(g=y=-(v=m=1/0),c=[],h=[],d=e.length,o)for(p=0;d>p;++p)l=e[p],l.x<v&&(v=l.x),l.y<m&&(m=l.y),l.x>g&&(g=l.x),l.y>y&&(y=l.y),c.push(l.x),h.push(l.y);else for(p=0;d>p;++p){var E=+b(l=e[p],p),S=+w(l,p);v>E&&(v=E),m>S&&(m=S),E>g&&(g=E),S>y&&(y=S),c.push(E),h.push(S)}var x=g-v,T=y-m;x>T?y=m+x:g=v+T;var N=ci();if(N.add=function(e){s(N,e,+b(e,++p),+w(e,p),v,m,g,y)},N.visit=function(e){hi(e,N,v,m,g,y)},p=-1,null==t){for(;++p<d;)s(N,e[p],c[p],h[p],v,m,g,y);--p}else e.forEach(N.add);return c=h=e=l=null,N}var o,u=Lr,a=Ar;return(o=arguments.length)?(u=fi,a=li,3===o&&(i=n,r=t,n=t=0),s(e)):(s.x=function(e){return arguments.length?(u=e,s):u},s.y=function(e){return arguments.length?(a=e,s):a},s.extent=function(e){return arguments.length?(null==e?t=n=r=i=null:(t=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),s):null==t?null:[[t,n],[r,i]]},s.size=function(e){return arguments.length?(null==e?t=n=r=i=null:(t=n=0,r=+e[0],i=+e[1]),s):null==t?null:[r-t,i-n]},s)},Ko.interpolateRgb=pi,Ko.interpolateObject=di,Ko.interpolateNumber=vi,Ko.interpolateString=mi;var tf=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,nf=new RegExp(tf.source,"g");Ko.interpolate=gi,Ko.interpolators=[function(e,t){var n=typeof t;return("string"===n?$u.has(t)||/^(#|rgb\(|hsl\()/.test(t)?pi:mi:t instanceof nt?pi:Array.isArray(t)?yi:"object"===n&&isNaN(t)?di:vi)(e,t)}],Ko.interpolateArray=yi;var rf=function(){return kt},sf=Ko.map({linear:rf,poly:Ni,quad:function(){return Si},cubic:function(){return xi},sin:function(){return Ci},exp:function(){return ki},circle:function(){return Li},elastic:Ai,back:Oi,bounce:function(){return Mi}}),of=Ko.map({"in":kt,out:wi,"in-out":Ei,"out-in":function(e){return Ei(wi(e))}});Ko.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.substring(0,t):e,r=t>=0?e.substring(t+1):"in";return n=sf.get(n)||rf,r=of.get(r)||kt,bi(r(n.apply(null,Qo.call(arguments,1))))},Ko.interpolateHcl=_i,Ko.interpolateHsl=Di,Ko.interpolateLab=Pi,Ko.interpolateRound=Hi,Ko.transform=function(e){var t=Yo.createElementNS(Ko.ns.prefix.svg,"g");return(Ko.transform=function(e){if(null!=e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate()}return new Bi(n?n.matrix:uf)})(e)},Bi.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var uf={a:1,b:0,c:0,d:1,e:0,f:0};Ko.interpolateTransform=qi,Ko.layout={},Ko.layout.bundle=function(){return function(e){for(var t=[],n=-1,r=e.length;++n<r;)t.push(zi(e[n]));return t}},Ko.layout.chord=function(){function e(){var e,f,c,h,p,d={},v=[],m=Ko.range(s),g=[];for(n=[],r=[],e=0,h=-1;++h<s;){for(f=0,p=-1;++p<s;)f+=i[h][p];v.push(f),g.push(Ko.range(s)),e+=f}for(o&&m.sort(function(e,t){return o(v[e],v[t])}),u&&g.forEach(function(e,t){e.sort(function(e,n){return u(i[t][e],i[t][n])})}),e=(ku-l*s)/e,f=0,h=-1;++h<s;){for(c=f,p=-1;++p<s;){var y=m[h],b=g[y][p],w=i[y][b],E=f,S=f+=w*e;d[y+"-"+b]={index:y,subindex:b,startAngle:E,endAngle:S,value:w}}r[y]={index:y,startAngle:c,endAngle:f,value:(f-c)/e},f+=l}for(h=-1;++h<s;)for(p=h-1;++p<s;){var x=d[h+"-"+p],T=d[p+"-"+h];(x.value||T.value)&&n.push(x.value<T.value?{source:T,target:x}:{source:x,target:T})}a&&t()}function t(){n.sort(function(e,t){return a((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n,r,i,s,o,u,a,f={},l=0;return f.matrix=function(e){return arguments.length?(s=(i=e)&&i.length,n=r=null,f):i},f.padding=function(e){return arguments.length?(l=e,n=r=null,f):l},f.sortGroups=function(e){return arguments.length?(o=e,n=r=null,f):o},f.sortSubgroups=function(e){return arguments.length?(u=e,n=null,f):u},f.sortChords=function(e){return arguments.length?(a=e,n&&t(),f):a},f.chords=function(){return n||e(),n},f.groups=function(){return r||e(),r},f},Ko.layout.force=function(){function e(e){return function(t,n,r,i){if(t.point!==e){var s=t.cx-e.x,o=t.cy-e.y,u=i-n,a=s*s+o*o;if(a>u*u/m){if(d>a){var f=t.charge/a;e.px-=s*f,e.py-=o*f}return!0}if(t.point&&a&&d>a){var f=t.pointCharge/a;e.px-=s*f,e.py-=o*f}}return!t.charge}}function t(e){e.px=Ko.event.x,e.py=Ko.event.y,u.resume()}var n,r,i,s,o,u={},a=Ko.dispatch("start","tick","end"),f=[1,1],l=.9,c=af,h=ff,p=-30,d=lf,v=.1,m=.64,g=[],y=[];return u.tick=function(){if((r*=.99)<.005)return a.end({type:"end",alpha:r=0}),!0;var t,n,u,c,h,d,m,b,w,E=g.length,S=y.length;for(n=0;S>n;++n)u=y[n],c=u.source,h=u.target,b=h.x-c.x,w=h.y-c.y,(d=b*b+w*w)&&(d=r*s[n]*((d=Math.sqrt(d))-i[n])/d,b*=d,w*=d,h.x-=b*(m=c.weight/(h.weight+c.weight)),h.y-=w*m,c.x+=b*(m=1-m),c.y+=w*m);if((m=r*v)&&(b=f[0]/2,w=f[1]/2,n=-1,m))for(;++n<E;)u=g[n],u.x+=(b-u.x)*m,u.y+=(w-u.y)*m;if(p)for(Qi(t=Ko.geom.quadtree(g),r,o),n=-1;++n<E;)(u=g[n]).fixed||t.visit(e(u));for(n=-1;++n<E;)u=g[n],u.fixed?(u.x=u.px,u.y=u.py):(u.x-=(u.px-(u.px=u.x))*l,u.y-=(u.py-(u.py=u.y))*l);a.tick({type:"tick",alpha:r})},u.nodes=function(e){return arguments.length?(g=e,u):g},u.links=function(e){return arguments.length?(y=e,u):y},u.size=function(e){return arguments.length?(f=e,u):f},u.linkDistance=function(e){return arguments.length?(c="function"==typeof e?e:+e,u):c},u.distance=u.linkDistance,u.linkStrength=function(e){return arguments.length?(h="function"==typeof e?e:+e,u):h},u.friction=function(e){return arguments.length?(l=+e,u):l},u.charge=function(e){return arguments.length?(p="function"==typeof e?e:+e,u):p},u.chargeDistance=function(e){return arguments.length?(d=e*e,u):Math.sqrt(d)},u.gravity=function(e){return arguments.length?(v=+e,u):v},u.theta=function(e){return arguments.length?(m=e*e,u):Math.sqrt(m)},u.alpha=function(e){return arguments.length?(e=+e,r?r=e>0?e:0:e>0&&(a.start({type:"start",alpha:r=e}),Ko.timer(u.tick)),u):r},u.start=function(){function e(e,r){if(!n){for(n=new Array(a),u=0;a>u;++u)n[u]=[];for(u=0;f>u;++u){var i=y[u];n[i.source.index].push(i.target),n[i.target.index].push(i.source)}}for(var s,o=n[t],u=-1,f=o.length;++u<f;)if(!isNaN(s=o[u][e]))return s;return Math.random()*r}var t,n,r,a=g.length,l=y.length,d=f[0],v=f[1];for(t=0;a>t;++t)(r=g[t]).index=t,r.weight=0;for(t=0;l>t;++t)r=y[t],"number"==typeof r.source&&(r.source=g[r.source]),"number"==typeof r.target&&(r.target=g[r.target]),++r.source.weight,++r.target.weight;for(t=0;a>t;++t)r=g[t],isNaN(r.x)&&(r.x=e("x",d)),isNaN(r.y)&&(r.y=e("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(i=[],"function"==typeof c)for(t=0;l>t;++t)i[t]=+c.call(this,y[t],t);else for(t=0;l>t;++t)i[t]=c;if(s=[],"function"==typeof h)for(t=0;l>t;++t)s[t]=+h.call(this,y[t],t);else for(t=0;l>t;++t)s[t]=h;if(o=[],"function"==typeof p)for(t=0;a>t;++t)o[t]=+p.call(this,g[t],t);else for(t=0;a>t;++t)o[t]=p;return u.resume()},u.resume=function(){return u.alpha(.1)},u.stop=function(){return u.alpha(0)},u.drag=function(){return n||(n=Ko.behavior.drag().origin(kt).on("dragstart.force",Vi).on("drag.force",t).on("dragend.force",$i)),arguments.length?(this.on("mouseover.force",Ji).on("mouseout.force",Ki).call(n),void 0):n},Ko.rebind(u,a,"on")};var af=20,ff=1,lf=1/0;Ko.layout.hierarchy=function(){function e(i){var s,o=[i],u=[];for(i.depth=0;null!=(s=o.pop());)if(u.push(s),(f=n.call(e,s,s.depth))&&(a=f.length)){for(var a,f,l;--a>=0;)o.push(l=f[a]),l.parent=s,l.depth=s.depth+1;r&&(s.value=0),s.children=f}else r&&(s.value=+r.call(e,s,s.depth)||0),delete s.children;return Zi(i,function(e){var n,i;t&&(n=e.children)&&n.sort(t),r&&(i=e.parent)&&(i.value+=e.value)}),u}var t=ns,n=es,r=ts;return e.sort=function(n){return arguments.length?(t=n,e):t},e.children=function(t){return arguments.length?(n=t,e):n},e.value=function(t){return arguments.length?(r=t,e):r},e.revalue=function(t){return r&&(Yi(t,function(e){e.children&&(e.value=0)}),Zi(t,function(t){var n;t.children||(t.value=+r.call(e,t,t.depth)||0),(n=t.parent)&&(n.value+=t.value)})),t},e},Ko.layout.partition=function(){function e(t,n,r,i){var s=t.children;if(t.x=n,t.y=t.depth*i,t.dx=r,t.dy=i,s&&(o=s.length)){var o,u,a,f=-1;for(r=t.value?r/t.value:0;++f<o;)e(u=s[f],n,a=u.value*r,i),n+=a}}function t(e){var n=e.children,r=0;if(n&&(i=n.length))for(var i,s=-1;++s<i;)r=Math.max(r,t(n[s]));return 1+r}function n(n,s){var o=r.call(this,n,s);return e(o[0],0,i[0],i[1]/t(o[0])),o}var r=Ko.layout.hierarchy(),i=[1,1];return n.size=function(e){return arguments.length?(i=e,n):i},Gi(n,r)},Ko.layout.pie=function(){function e(s){var o=s.map(function(n,r){return+t.call(e,n,r)}),u=+("function"==typeof r?r.apply(this,arguments):r),a=(("function"==typeof i?i.apply(this,arguments):i)-u)/Ko.sum(o),f=Ko.range(s.length);null!=n&&f.sort(n===cf?function(e,t){return o[t]-o[e]}:function(e,t){return n(s[e],s[t])});var l=[];return f.forEach(function(e){var t;l[e]={data:s[e],value:t=o[e],startAngle:u,endAngle:u+=t*a}}),l}var t=Number,n=cf,r=0,i=ku;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(r=t,e):r},e.endAngle=function(t){return arguments.length?(i=t,e):i},e};var cf={};Ko.layout.stack=function(){function e(u,a){var f=u.map(function(n,r){return t.call(e,n,r)}),l=f.map(function(t){return t.map(function(t,n){return[s.call(e,t,n),o.call(e,t,n)]})}),c=n.call(e,l,a);f=Ko.permute(f,c),l=Ko.permute(l,c);var h,p,d,v=r.call(e,l,a),m=f.length,g=f[0].length;for(p=0;g>p;++p)for(i.call(e,f[0][p],d=v[p],l[0][p][1]),h=1;m>h;++h)i.call(e,f[h][p],d+=l[h-1][p][1],l[h][p][1]);return u}var t=kt,n=us,r=as,i=os,s=is,o=ss;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n="function"==typeof t?t:hf.get(t)||us,e):n},e.offset=function(t){return arguments.length?(r="function"==typeof t?t:pf.get(t)||as,e):r},e.x=function(t){return arguments.length?(s=t,e):s},e.y=function(t){return arguments.length?(o=t,e):o},e.out=function(t){return arguments.length?(i=t,e):i},e};var hf=Ko.map({"inside-out":function(e){var t,n,r=e.length,i=e.map(fs),s=e.map(ls),o=Ko.range(r).sort(function(e,t){return i[e]-i[t]}),u=0,a=0,f=[],l=[];for(t=0;r>t;++t)n=o[t],a>u?(u+=s[n],f.push(n)):(a+=s[n],l.push(n));return l.reverse().concat(f)},reverse:function(e){return Ko.range(e.length).reverse()},"default":us}),pf=Ko.map({silhouette:function(e){var t,n,r,i=e.length,s=e[0].length,o=[],u=0,a=[];for(n=0;s>n;++n){for(t=0,r=0;i>t;t++)r+=e[t][n][1];r>u&&(u=r),o.push(r)}for(n=0;s>n;++n)a[n]=(u-o[n])/2;return a},wiggle:function(e){var t,n,r,i,s,o,u,a,f,l=e.length,c=e[0],h=c.length,p=[];for(p[0]=a=f=0,n=1;h>n;++n){for(t=0,i=0;l>t;++t)i+=e[t][n][1];for(t=0,s=0,u=c[n][0]-c[n-1][0];l>t;++t){for(r=0,o=(e[t][n][1]-e[t][n-1][1])/(2*u);t>r;++r)o+=(e[r][n][1]-e[r][n-1][1])/u;s+=o*e[t][n][1]}p[n]=a-=i?s/i*u:0,f>a&&(f=a)}for(n=0;h>n;++n)p[n]-=f;return p},expand:function(e){var t,n,r,i=e.length,s=e[0].length,o=1/i,u=[];for(n=0;s>n;++n){for(t=0,r=0;i>t;t++)r+=e[t][n][1];if(r)for(t=0;i>t;t++)e[t][n][1]/=r;else for(t=0;i>t;t++)e[t][n][1]=o}for(n=0;s>n;++n)u[n]=0;return u},zero:as});Ko.layout.histogram=function(){function e(e,s){for(var o,u,a=[],f=e.map(n,this),l=r.call(this,f,s),c=i.call(this,l,f,s),s=-1,h=f.length,p=c.length-1,d=t?1:1/h;++s<p;)o=a[s]=[],o.dx=c[s+1]-(o.x=c[s]),o.y=0;if(p>0)for(s=-1;++s<h;)u=f[s],u>=l[0]&&u<=l[1]&&(o=a[Ko.bisect(c,u,1,p)-1],o.y+=d,o.push(e[s]));return a}var t=!0,n=Number,r=ds,i=hs;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(r=Ct(t),e):r},e.bins=function(t){return arguments.length?(i="number"==typeof t?function(e){return ps(e,t)}:Ct(t),e):i},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},Ko.layout.pack=function(){function e(e,s){var o=n.call(this,e,s),u=o[0],a=i[0],f=i[1],l=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(u.x=u.y=0,Zi(u,function(e){e.r=+l(e.value)}),Zi(u,bs),r){var c=r*(t?1:Math.max(2*u.r/a,2*u.r/f))/2;Zi(u,function(e){e.r+=c}),Zi(u,bs),Zi(u,function(e){e.r-=c})}return Ss(u,a/2,f/2,t?1:1/Math.max(2*u.r/a,2*u.r/f)),o}var t,n=Ko.layout.hierarchy().sort(vs),r=0,i=[1,1];return e.size=function(t){return arguments.length?(i=t,e):i},e.radius=function(n){return arguments.length?(t=null==n||"function"==typeof n?n:+n,e):t},e.padding=function(t){return arguments.length?(r=+t,e):r},Gi(e,n)},Ko.layout.tree=function(){function e(e,i){var l=o.call(this,e,i),c=l[0],h=t(c);if(Zi(h,n),h.parent.m=-h.z,Yi(h,r),f)Yi(c,s);else{var p=c,d=c,v=c;Yi(c,function(e){e.x<p.x&&(p=e),e.x>d.x&&(d=e),e.depth>v.depth&&(v=e)});var m=u(p,d)/2-p.x,g=a[0]/(d.x+u(d,p)/2+m),y=a[1]/(v.depth||1);Yi(c,function(e){e.x=(e.x+m)*g,e.y=e.depth*y})}return l}function t(e){for(var t,n={A:null,children:[e]},r=[n];null!=(t=r.pop());)for(var i,s=t.children,o=0,u=s.length;u>o;++o)r.push((s[o]=i={_:s[o],parent:t,children:(i=s[o].children)&&i.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=i);return n.children[0]}function n(e){var t=e.children,n=e.parent.children,r=e.i?n[e.i-1]:null;if(t.length){Ls(e);var s=(t[0].z+t[t.length-1].z)/2;r?(e.z=r.z+u(e._,r._),e.m=e.z-s):e.z=s}else r&&(e.z=r.z+u(e._,r._));e.parent.A=i(e,r,e.parent.A||n[0])}function r(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function i(e,t,n){if(t){for(var r,i=e,s=e,o=t,a=i.parent.children[0],f=i.m,l=s.m,c=o.m,h=a.m;o=Cs(o),i=Ns(i),o&&i;)a=Ns(a),s=Cs(s),s.a=e,r=o.z+c-i.z-f+u(o._,i._),r>0&&(ks(As(o,e,n),e,r),f+=r,l+=r),c+=o.m,f+=i.m,h+=a.m,l+=s.m;o&&!Cs(s)&&(s.t=o,s.m+=c-l),i&&!Ns(a)&&(a.t=i,a.m+=f-h,n=e)}return n}function s(e){e.x*=a[0],e.y=e.depth*a[1]}var o=Ko.layout.hierarchy().sort(null).value(null),u=Ts,a=[1,1],f=null;return e.separation=function(t){return arguments.length?(u=t,e):u},e.size=function(t){return arguments.length?(f=null==(a=t)?s:null,e):f?null:a},e.nodeSize=function(t){return arguments.length?(f=null==(a=t)?null:s,e):f?a:null},Gi(e,o)},Ko.layout.cluster=function(){function e(e,s){var o,u=t.call(this,e,s),a=u[0],f=0;Zi(a,function(e){var t=e.children;t&&t.length?(e.x=Ms(t),e.y=Os(t)):(e.x=o?f+=n(e,o):0,e.y=0,o=e)});var l=_s(a),c=Ds(a),h=l.x-n(l,c)/2,p=c.x+n(c,l)/2;return Zi(a,i?function(e){e.x=(e.x-a.x)*r[0],e.y=(a.y-e.y)*r[1]}:function(e){e.x=(e.x-h)/(p-h)*r[0],e.y=(1-(a.y?e.y/a.y:1))*r[1]}),u}var t=Ko.layout.hierarchy().sort(null).value(null),n=Ts,r=[1,1],i=!1;return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(i=null==(r=t),e):i?null:r},e.nodeSize=function(t){return arguments.length?(i=null!=(r=t),e):i?r:null},Gi(e,t)},Ko.layout.treemap=function(){function e(e,t){for(var n,r,i=-1,s=e.length;++i<s;)r=(n=e[i]).value*(0>t?0:t),n.area=isNaN(r)||0>=r?0:r}function t(n){var s=n.children;if(s&&s.length){var o,u,a,f=c(n),l=[],h=s.slice(),d=1/0,v="slice"===p?f.dx:"dice"===p?f.dy:"slice-dice"===p?1&n.depth?f.dy:f.dx:Math.min(f.dx,f.dy);for(e(h,f.dx*f.dy/n.value),l.area=0;(a=h.length)>0;)l.push(o=h[a-1]),l.area+=o.area,"squarify"!==p||(u=r(l,v))<=d?(h.pop(),d=u):(l.area-=l.pop().area,i(l,v,f,!1),v=Math.min(f.dx,f.dy),l.length=l.area=0,d=1/0);l.length&&(i(l,v,f,!0),l.length=l.area=0),s.forEach(t)}}function n(t){var r=t.children;if(r&&r.length){var s,o=c(t),u=r.slice(),a=[];for(e(u,o.dx*o.dy/t.value),a.area=0;s=u.pop();)a.push(s),a.area+=s.area,null!=s.z&&(i(a,s.z?o.dx:o.dy,o,!u.length),a.length=a.area=0);r.forEach(n)}}function r(e,t){for(var n,r=e.area,i=0,s=1/0,o=-1,u=e.length;++o<u;)(n=e[o].area)&&(s>n&&(s=n),n>i&&(i=n));return r*=r,t*=t,r?Math.max(t*i*d/r,r/(t*s*d)):1/0}function i(e,t,n,r){var i,s=-1,o=e.length,u=n.x,f=n.y,l=t?a(e.area/t):0;if(t==n.dx){for((r||l>n.dy)&&(l=n.dy);++s<o;)i=e[s],i.x=u,i.y=f,i.dy=l,u+=i.dx=Math.min(n.x+n.dx-u,l?a(i.area/l):0);i.z=!0,i.dx+=n.x+n.dx-u,n.y+=l,n.dy-=l}else{for((r||l>n.dx)&&(l=n.dx);++s<o;)i=e[s],i.x=u,i.y=f,i.dx=l,f+=i.dy=Math.min(n.y+n.dy-f,l?a(i.area/l):0);i.z=!1,i.dy+=n.y+n.dy-f,n.x+=l,n.dx-=l}}function s(r){var i=o||u(r),s=i[0];return s.x=0,s.y=0,s.dx=f[0],s.dy=f[1],o&&u.revalue(s),e([s],s.dx*s.dy/s.value),(o?n:t)(s),h&&(o=i),i}var o,u=Ko.layout.hierarchy(),a=Math.round,f=[1,1],l=null,c=Ps,h=!1,p="squarify",d=.5*(1+Math.sqrt(5));return s.size=function(e){return arguments.length?(f=e,s):f},s.padding=function(e){function t(t){var n=e.call(s,t,t.depth);return null==n?Ps(t):Hs(t,"number"==typeof n?[n,n,n,n]:n)}function n(t){return Hs(t,e)}if(!arguments.length)return l;var r;return c=null==(l=e)?Ps:"function"==(r=typeof e)?t:"number"===r?(e=[e,e,e,e],n):n,s},s.round=function(e){return arguments.length?(a=e?Math.round:Number,s):a!=Number},s.sticky=function(e){return arguments.length?(h=e,o=null,s):h},s.ratio=function(e){return arguments.length?(d=e,s):d},s.mode=function(e){return arguments.length?(p=e+"",s):p},Gi(s,u)},Ko.random={normal:function(e,t){var n=arguments.length;return 2>n&&(t=1),1>n&&(e=0),function(){var n,r,i;do n=2*Math.random()-1,r=2*Math.random()-1,i=n*n+r*r;while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var e=Ko.random.normal.apply(Ko,arguments);return function(){return Math.exp(e())}},bates:function(e){var t=Ko.random.irwinHall(e);return function(){return t()/e}},irwinHall:function(e){return function(){for(var t=0,n=0;e>n;n++)t+=Math.random();return t}}},Ko.scale={};var df={floor:kt,ceil:kt};Ko.scale.linear=function(){return Us([0,1],[0,1],gi,!1)};var vf={s:1,g:1,p:1,r:1,e:1};Ko.scale.log=function(){return Qs(Ko.scale.linear().domain([0,1]),10,!0,[1,10])};var mf=Ko.format(".0e"),gf={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};Ko.scale.pow=function(){return Gs(Ko.scale.linear(),1,[0,1])},Ko.scale.sqrt=function(){return Ko.scale.pow().exponent(.5)},Ko.scale.ordinal=function(){return Zs([],{t:"range",a:[[]]})},Ko.scale.category10=function(){return Ko.scale.ordinal().range(yf)},Ko.scale.category20=function(){return Ko.scale.ordinal().range(bf)},Ko.scale.category20b=function(){return Ko.scale.ordinal().range(wf)},Ko.scale.category20c=function(){return Ko.scale.ordinal().range(Ef)};var yf=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(gt),bf=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(gt),wf=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(gt),Ef=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(gt);Ko.scale.quantile=function(){return eo([],[])},Ko.scale.quantize=function(){return to(0,1,[0,1])},Ko.scale.threshold=function(){return no([.5],[0,1])},Ko.scale.identity=function(){return ro([0,1])},Ko.svg={},Ko.svg.arc=function(){function e(){var e=t.apply(this,arguments),s=n.apply(this,arguments),o=r.apply(this,arguments)+Sf,u=i.apply(this,arguments)+Sf,a=(o>u&&(a=o,o=u,u=a),u-o),f=Cu>a?"0":"1",l=Math.cos(o),c=Math.sin(o),h=Math.cos(u),p=Math.sin(u);return a>=xf?e?"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+ -e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"Z":e?"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L"+e*h+","+e*p+"A"+e+","+e+" 0 "+f+",0 "+e*l+","+e*c+"Z":"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L0,0"+"Z"}var t=io,n=so,r=oo,i=uo;return e.innerRadius=function(n){return arguments.length?(t=Ct(n),e):t},e.outerRadius=function(t){return arguments.length?(n=Ct(t),e):n},e.startAngle=function(t){return arguments.length?(r=Ct(t),e):r},e.endAngle=function(t){return arguments.length?(i=Ct(t),e):i},e.centroid=function(){var e=(t.apply(this,arguments)+n.apply(this,arguments))/2,s=(r.apply(this,arguments)+i.apply(this,arguments))/2+Sf;return[Math.cos(s)*e,Math.sin(s)*e]},e};var Sf=-Lu,xf=ku-Au;Ko.svg.line=function(){return ao(kt)};var Tf=Ko.map({linear:fo,"linear-closed":lo,step:co,"step-before":ho,"step-after":po,basis:wo,"basis-open":Eo,"basis-closed":So,bundle:xo,cardinal:go,"cardinal-open":vo,"cardinal-closed":mo,monotone:Ao});Tf.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var Nf=[0,2/3,1/3,0],Cf=[0,1/3,2/3,0],kf=[0,1/6,2/3,1/6];Ko.svg.line.radial=function(){var e=ao(Oo);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},ho.reverse=po,po.reverse=ho,Ko.svg.area=function(){return Mo(kt)},Ko.svg.area.radial=function(){var e=Mo(Oo);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},Ko.svg.chord=function(){function e(e,u){var a=t(this,s,e,u),f=t(this,o,e,u);return"M"+a.p0+r(a.r,a.p1,a.a1-a.a0)+(n(a,f)?i(a.r,a.p1,a.r,a.p0):i(a.r,a.p1,f.r,f.p0)+r(f.r,f.p1,f.a1-f.a0)+i(f.r,f.p1,a.r,a.p0))+"Z"}function t(e,t,n,r){var i=t.call(e,n,r),s=u.call(e,i,r),o=a.call(e,i,r)+Sf,l=f.call(e,i,r)+Sf;return{r:s,a0:o,a1:l,p0:[s*Math.cos(o),s*Math.sin(o)],p1:[s*Math.cos(l),s*Math.sin(l)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function r(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Cu)+",1 "+t}function i(e,t,n,r){return"Q 0,0 "+r}var s=yr,o=br,u=_o,a=oo,f=uo;return e.radius=function(t){return arguments.length?(u=Ct(t),e):u},e.source=function(t){return arguments.length?(s=Ct(t),e):s},e.target=function(t){return arguments.length?(o=Ct(t),e):o},e.startAngle=function(t){return arguments.length?(a=Ct(t),e):a},e.endAngle=function(t){return arguments.length?(f=Ct(t),e):f},e},Ko.svg.diagonal=function(){function e(e,i){var s=t.call(this,e,i),o=n.call(this,e,i),u=(s.y+o.y)/2,a=[s,{x:s.x,y:u},{x:o.x,y:u},o];return a=a.map(r),"M"+a[0]+"C"+a[1]+" "+a[2]+" "+a[3]}var t=yr,n=br,r=Do;return e.source=function(n){return arguments.length?(t=Ct(n),e):t},e.target=function(t){return arguments.length?(n=Ct(t),e):n},e.projection=function(t){return arguments.length?(r=t,e):r},e},Ko.svg.diagonal.radial=function(){var e=Ko.svg.diagonal(),t=Do,n=e.projection;return e.projection=function(e){return arguments.length?n(Po(t=e)):t},e},Ko.svg.symbol=function(){function e(e,r){return(Lf.get(t.call(this,e,r))||jo)(n.call(this,e,r))}var t=Bo,n=Ho;return e.type=function(n){return arguments.length?(t=Ct(n),e):t},e.size=function(t){return arguments.length?(n=Ct(t),e):n},e};var Lf=Ko.map({circle:jo,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+ -3*t+","+ -t+"H"+ -t+"V"+ -3*t+"H"+t+"V"+ -t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+ -t+"V"+t+"H"+ -3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*_f)),n=t*_f;return"M0,"+ -t+"L"+n+",0"+" 0,"+t+" "+ -n+",0"+"Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+ -t+","+ -t+"L"+t+","+ -t+" "+t+","+t+" "+ -t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Mf),n=t*Mf/2;return"M0,"+n+"L"+t+","+ -n+" "+ -t+","+ -n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Mf),n=t*Mf/2;return"M0,"+ -n+"L"+t+","+n+" "+ -t+","+n+"Z"}});Ko.svg.symbolTypes=Lf.keys();var Af,Of,Mf=Math.sqrt(3),_f=Math.tan(30*Mu),Df=[],Pf=0;Df.call=bu.call,Df.empty=bu.empty,Df.node=bu.node,Df.size=bu.size,Ko.transition=function(e){return arguments.length?Af?e.transition():e:Su.transition()},Ko.transition.prototype=Df,Df.select=function(e){var t,n,r,i=this.id,s=[];e=S(e);for(var o=-1,u=this.length;++o<u;){s.push(t=[]);for(var a=this[o],f=-1,l=a.length;++f<l;)(r=a[f])&&(n=e.call(r,r.__data__,f,o))?("__data__"in r&&(n.__data__=r.__data__),Ro(n,f,i,r.__transition__[i]),t.push(n)):t.push(null)}return Fo(s,i)},Df.selectAll=function(e){var t,n,r,i,s,o=this.id,u=[];e=x(e);for(var a=-1,f=this.length;++a<f;)for(var l=this[a],c=-1,h=l.length;++c<h;)if(r=l[c]){s=r.__transition__[o],n=e.call(r,r.__data__,c,a),u.push(t=[]);for(var p=-1,d=n.length;++p<d;)(i=n[p])&&Ro(i,p,o,s),t.push(i)}return Fo(u,o)},Df.filter=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=P(e));for(var s=0,o=this.length;o>s;s++){i.push(t=[]);for(var n=this[s],u=0,a=n.length;a>u;u++)(r=n[u])&&e.call(r,r.__data__,u,s)&&t.push(r)}return Fo(i,this.id)},Df.tween=function(e,t){var n=this.id;return arguments.length<2?this.node().__transition__[n].tween.get(e):B(this,null==t?function(t){t.__transition__[n].tween.remove(e)}:function(r){r.__transition__[n].tween.set(e,t)})},Df.attr=function(e,t){function n(){this.removeAttribute(u)}function r(){this.removeAttributeNS(u.space,u.local)}function i(e){return null==e?n:(e+="",function(){var t,n=this.getAttribute(u);return n!==e&&(t=o(n,e),function(e){this.setAttribute(u,t(e))})})}function s(e){return null==e?r:(e+="",function(){var t,n=this.getAttributeNS(u.space,u.local);return n!==e&&(t=o(n,e),function(e){this.setAttributeNS(u.space,u.local,t(e))})})}if(arguments.length<2){for(t in e)this.attr(t,e[t]);return this}var o="transform"==e?qi:gi,u=Ko.ns.qualify(e);return Io(this,"attr."+e,t,u.local?s:i)},Df.attrTween=function(e,t){function n(e,n){var r=t.call(this,e,n,this.getAttribute(i));return r&&function(e){this.setAttribute(i,r(e))}}function r(e,n){var r=t.call(this,e,n,this.getAttributeNS(i.space,i.local));return r&&function(e){this.setAttributeNS(i.space,i.local,r(e))}}var i=Ko.ns.qualify(e);return this.tween("attr."+e,i.local?r:n)},Df.style=function(e,t,n){function r(){this.style.removeProperty(e)}function i(t){return null==t?r:(t+="",function(){var r,i=eu.getComputedStyle(this,null).getPropertyValue(e);return i!==t&&(r=gi(i,t),function(t){this.style.setProperty(e,r(t),n)})})}var s=arguments.length;if(3>s){if("string"!=typeof e){2>s&&(t="");for(n in e)this.style(n,e[n],t);return this}n=""}return Io(this,"style."+e,t,i)},Df.styleTween=function(e,t,n){function r(r,i){var s=t.call(this,r,i,eu.getComputedStyle(this,null).getPropertyValue(e));return s&&function(t){this.style.setProperty(e,s(t),n)}}return arguments.length<3&&(n=""),this.tween("style."+e,r)},Df.text=function(e){return Io(this,"text",e,qo)},Df.remove=function(){return this.each("end.transition",function(){var e;this.__transition__.count<2&&(e=this.parentNode)&&e.removeChild(this)})},Df.ease=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof e&&(e=Ko.ease.apply(Ko,arguments)),B(this,function(n){n.__transition__[t].ease=e}))},Df.delay=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].delay:B(this,"function"==typeof e?function(n,r,i){n.__transition__[t].delay=+e.call(n,n.__data__,r,i)}:(e=+e,function(n){n.__transition__[t].delay=e}))},Df.duration=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].duration:B(this,"function"==typeof e?function(n,r,i){n.__transition__[t].duration=Math.max(1,e.call(n,n.__data__,r,i))}:(e=Math.max(1,e),function(n){n.__transition__[t].duration=e}))},Df.each=function(e,t){var n=this.id;if(arguments.length<2){var r=Of,i=Af;Af=n,B(this,function(t,r,i){Of=t.__transition__[n],e.call(t,t.__data__,r,i)}),Of=r,Af=i}else B(this,function(r){var i=r.__transition__[n];(i.event||(i.event=Ko.dispatch("start","end"))).on(e,t)});return this},Df.transition=function(){for(var e,t,n,r,i=this.id,s=++Pf,o=[],u=0,a=this.length;a>u;u++){o.push(e=[]);for(var t=this[u],f=0,l=t.length;l>f;f++)(n=t[f])&&(r=Object.create(n.__transition__[i]),r.delay+=r.duration,Ro(n,f,s,r)),e.push(n)}return Fo(o,s)},Ko.svg.axis=function(){function e(e){e.each(function(){var e,f=Ko.select(this),l=this.__chart__||n,c=this.__chart__=n.copy(),h=null==a?c.ticks?c.ticks.apply(c,u):c.domain():a,p=null==t?c.tickFormat?c.tickFormat.apply(c,u):kt:t,d=f.selectAll(".tick").data(h,c),v=d.enter().insert("g",".domain").attr("class","tick").style("opacity",Au),m=Ko.transition(d.exit()).style("opacity",Au).remove(),g=Ko.transition(d.order()).style("opacity",1),y=js(c),b=f.selectAll(".domain").data([0]),w=(b.enter().append("path").attr("class","domain"),Ko.transition(b));v.append("line"),v.append("text");var E=v.select("line"),S=g.select("line"),x=d.select("text").text(p),T=v.select("text"),N=g.select("text");switch(r){case"bottom":e=Uo,E.attr("y2",i),T.attr("y",Math.max(i,0)+o),S.attr("x2",0).attr("y2",i),N.attr("x",0).attr("y",Math.max(i,0)+o),x.attr("dy",".71em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+s+"V0H"+y[1]+"V"+s);break;case"top":e=Uo,E.attr("y2",-i),T.attr("y",-(Math.max(i,0)+o)),S.attr("x2",0).attr("y2",-i),N.attr("x",0).attr("y",-(Math.max(i,0)+o)),x.attr("dy","0em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+ -s+"V0H"+y[1]+"V"+ -s);break;case"left":e=zo,E.attr("x2",-i),T.attr("x",-(Math.max(i,0)+o)),S.attr("x2",-i).attr("y2",0),N.attr("x",-(Math.max(i,0)+o)).attr("y",0),x.attr("dy",".32em").style("text-anchor","end"),w.attr("d","M"+ -s+","+y[0]+"H0V"+y[1]+"H"+ -s);break;case"right":e=zo,E.attr("x2",i),T.attr("x",Math.max(i,0)+o),S.attr("x2",i).attr("y2",0),N.attr("x",Math.max(i,0)+o).attr("y",0),x.attr("dy",".32em").style("text-anchor","start"),w.attr("d","M"+s+","+y[0]+"H0V"+y[1]+"H"+s)}if(c.rangeBand){var C=c,k=C.rangeBand()/2;l=c=function(e){return C(e)+k}}else l.rangeBand?l=c:m.call(e,c);v.call(e,l),g.call(e,c)})}var t,n=Ko.scale.linear(),r=Hf,i=6,s=6,o=3,u=[10],a=null;return e.scale=function(t){return arguments.length?(n=t,e):n},e.orient=function(t){return arguments.length?(r=t in Bf?t+"":Hf,e):r},e.ticks=function(){return arguments.length?(u=arguments,e):u},e.tickValues=function(t){return arguments.length?(a=t,e):a},e.tickFormat=function(n){return arguments.length?(t=n,e):t},e.tickSize=function(t){var n=arguments.length;return n?(i=+t,s=+arguments[n-1],e):i},e.innerTickSize=function(t){return arguments.length?(i=+t,e):i},e.outerTickSize=function(t){return arguments.length?(s=+t,e):s},e.tickPadding=function(t){return arguments.length?(o=+t,e):o},e.tickSubdivide=function(){return arguments.length&&e},e};var Hf="bottom",Bf={top:1,right:1,bottom:1,left:1};Ko.svg.brush=function(){function e(s){s.each(function(){var s=Ko.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",i).on("touchstart.brush",i),o=s.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),s.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var u=s.selectAll(".resize").data(d,kt);u.exit().remove(),u.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return jf[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),u.style("display",e.empty()?"none":null);var l,c=Ko.transition(s),h=Ko.transition(o);a&&(l=js(a),h.attr("x",l[0]).attr("width",l[1]-l[0]),n(c)),f&&(l=js(f),h.attr("y",l[0]).attr("height",l[1]-l[0]),r(c)),t(c)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+l[+/e$/.test(e)]+","+c[+/^s/.test(e)]+")"})}function n(e){e.select(".extent").attr("x",l[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",l[1]-l[0])}function r(e){e.select(".extent").attr("y",c[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",c[1]-c[0])}function i(){function i(){32==Ko.event.keyCode&&(L||(b=null,O[0]-=l[1],O[1]-=c[1],L=2),y())}function d(){32==Ko.event.keyCode&&2==L&&(O[0]+=l[1],O[1]+=c[1],L=0,y())}function v(){var e=Ko.mouse(E),i=!1;w&&(e[0]+=w[0],e[1]+=w[1]),L||(Ko.event.altKey?(b||(b=[(l[0]+l[1])/2,(c[0]+c[1])/2]),O[0]=l[+(e[0]<b[0])],O[1]=c[+(e[1]<b[1])]):b=null),C&&m(e,a,0)&&(n(T),i=!0),k&&m(e,f,1)&&(r(T),i=!0),i&&(t(T),x({type:"brush",mode:L?"move":"resize"}))}function m(e,t,n){var r,i,u=js(t),a=u[0],f=u[1],d=O[n],v=n?c:l,m=v[1]-v[0];return L&&(a-=d,f-=m+d),r=(n?p:h)?Math.max(a,Math.min(f,e[n])):e[n],L?i=(r+=d)+m:(b&&(d=Math.max(a,Math.min(f,2*b[n]-r))),r>d?(i=r,r=d):i=d),v[0]!=r||v[1]!=i?(n?o=null:s=null,v[0]=r,v[1]=i,!0):void 0}function g(){v(),T.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),Ko.select("body").style("cursor",null),M.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),A(),x({type:"brushend"})}var b,w,E=this,S=Ko.select(Ko.event.target),x=u.of(E,arguments),T=Ko.select(E),N=S.datum(),C=!/^(n|s)$/.test(N)&&a,k=!/^(e|w)$/.test(N)&&f,L=S.classed("extent"),A=z(),O=Ko.mouse(E),M=Ko.select(eu).on("keydown.brush",i).on("keyup.brush",d);if(Ko.event.changedTouches?M.on("touchmove.brush",v).on("touchend.brush",g):M.on("mousemove.brush",v).on("mouseup.brush",g),T.interrupt().selectAll("*").interrupt(),L)O[0]=l[0]-O[0],O[1]=c[0]-O[1];else if(N){var _=+/w$/.test(N),D=+/^n/.test(N);w=[l[1-_]-O[0],c[1-D]-O[1]],O[0]=l[_],O[1]=c[D]}else Ko.event.altKey&&(b=O.slice());T.style("pointer-events","none").selectAll(".resize").style("display",null),Ko.select("body").style("cursor",S.style("cursor")),x({type:"brushstart"}),v()}var s,o,u=w(e,"brushstart","brush","brushend"),a=null,f=null,l=[0,0],c=[0,0],h=!0,p=!0,d=Ff[0];return e.event=function(e){e.each(function(){var e=u.of(this,arguments),t={x:l,y:c,i:s,j:o},n=this.__chart__||t;this.__chart__=t,Af?Ko.select(this).transition().each("start.brush",function(){s=n.i,o=n.j,l=n.x,c=n.y,e({type:"brushstart"})}).tween("brush:brush",function(){var n=yi(l,t.x),r=yi(c,t.y);return s=o=null,function(i){l=t.x=n(i),c=t.y=r(i),e({type:"brush",mode:"resize"})}}).each("end.brush",function(){s=t.i,o=t.j,e({type:"brush",mode:"resize"}),e({type:"brushend"})}):(e({type:"brushstart"}),e({type:"brush",mode:"resize"}),e({type:"brushend"}))})},e.x=function(t){return arguments.length?(a=t,d=Ff[!a<<1|!f],e):a},e.y=function(t){return arguments.length?(f=t,d=Ff[!a<<1|!f],e):f},e.clamp=function(t){return arguments.length?(a&&f?(h=!!t[0],p=!!t[1]):a?h=!!t:f&&(p=!!t),e):a&&f?[h,p]:a?h:f?p:null},e.extent=function(t){var n,r,i,u,h;return arguments.length?(a&&(n=t[0],r=t[1],f&&(n=n[0],r=r[0]),s=[n,r],a.invert&&(n=a(n),r=a(r)),n>r&&(h=n,n=r,r=h),(n!=l[0]||r!=l[1])&&(l=[n,r])),f&&(i=t[0],u=t[1],a&&(i=i[1],u=u[1]),o=[i,u],f.invert&&(i=f(i),u=f(u)),i>u&&(h=i,i=u,u=h),(i!=c[0]||u!=c[1])&&(c=[i,u])),e):(a&&(s?(n=s[0],r=s[1]):(n=l[0],r=l[1],a.invert&&(n=a.invert(n),r=a.invert(r)),n>r&&(h=n,n=r,r=h))),f&&(o?(i=o[0],u=o[1]):(i=c[0],u=c[1],f.invert&&(i=f.invert(i),u=f.invert(u)),i>u&&(h=i,i=u,u=h))),a&&f?[[n,i],[r,u]]:a?[n,r]:f&&[i,u])},e.clear=function(){return e.empty()||(l=[0,0],c=[0,0],s=o=null),e},e.empty=function(){return!!a&&l[0]==l[1]||!!f&&c[0]==c[1]},Ko.rebind(e,u,"on")};var jf={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Ff=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],If=ra.format=fa.timeFormat,qf=If.utc,Rf=qf("%Y-%m-%dT%H:%M:%S.%LZ");If.iso=Date.prototype.toISOString&&+(new Date("2000-01-01T00:00:00.000Z"))?Wo:Rf,Wo.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},Wo.toString=Rf.toString,ra.second=It(function(e){return new ia(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))},function(e){return e.getSeconds()}),ra.seconds=ra.second.range,ra.seconds.utc=ra.second.utc.range,ra.minute=It(function(e){return new ia(6e4*Math.floor(e/6e4))},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))},function(e){return e.getMinutes()}),ra.minutes=ra.minute.range,ra.minutes.utc=ra.minute.utc.range,ra.hour=It(function(e){var t=e.getTimezoneOffset()/60;return new ia(36e5*(Math.floor(e/36e5-t)+t))},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))},function(e){return e.getHours()}),ra.hours=ra.hour.range,ra.hours.utc=ra.hour.utc.range,ra.month=It(function(e){return e=ra.day(e),e.setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),ra.months=ra.month.range,ra.months.utc=ra.month.utc.range;var Uf=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],zf=[[ra.second,1],[ra.second,5],[ra.second,15],[ra.second,30],[ra.minute,1],[ra.minute,5],[ra.minute,15],[ra.minute,30],[ra.hour,1],[ra.hour,3],[ra.hour,6],[ra.hour,12],[ra.day,1],[ra.day,2],[ra.week,1],[ra.month,1],[ra.month,3],[ra.year,1]],Wf=If.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!=e.getDate()}],["%b %d",function(e){return 1!=e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",Ln]]),Xf={range:function(e,t,n){return Ko.range(Math.ceil(e/n)*n,+t,n).map(Vo)},floor:kt,ceil:kt};zf.year=ra.year,ra.scale=function(){return Xo(Ko.scale.linear(),zf,Wf)};var Vf=zf.map(function(e){return[e[0].utc,e[1]]}),$f=qf.multi([[".%L",function(e){return e.getUTCMilliseconds()}],[":%S",function(e){return e.getUTCSeconds()}],["%I:%M",function(e){return e.getUTCMinutes()}],["%I %p",function(e){return e.getUTCHours()}],["%a %d",function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],["%b %d",function(e){return 1!=e.getUTCDate()}],["%B",function(e){return e.getUTCMonth()}],["%Y",Ln]]);Vf.year=ra.year.utc,ra.scale.utc=function(){return Xo(Ko.scale.linear(),Vf,$f)},Ko.text=Lt(function(e){return e.responseText}),Ko.json=function(e,t){return At(e,"application/json",$o,t)},Ko.html=function(e,t){return At(e,"text/html",Jo,t)},Ko.xml=Lt(function(e){return e.responseXML}),"function"==typeof define&&define.amd?define("d3",Ko):"object"==typeof module&&module.exports?module.exports=Ko:this.d3=Ko}(),define("vas-basic/components/screen_explain",["jquery","d3","core/db","core/ui","core/config","core/registry","core/base/components","core/user"],function(e,t,n,r,i,s,o,u){var a=function(t){o.ExplainScreen.call(this,t),this.topicInfo=null,this.taskBtn=[],this.activeTask=0,this.disableAnimation=!0,t.addClass("explain"),this.backdropDOM=e('<div class="'+i.css.backdrop+'"></div>'),t.append(this.backdropDOM),this.backdrop=s.instanceComponent("backdrop.explain",this.backdropDOM),this.foregroundDOM=e('<div class="'+i.css.foreground+' fullscreen"></div>'),t.append(this.foregroundDOM),this.elmWindow=e('<div class="explain-window cs-green"></div>').appendTo(this.foregroundDOM);var n=e('<div class="explain-header">').appendTo(this.elmWindow);this.elmIcon=e('<div class="icon" style="background-image: url(static/img/level-icons/pdfs.png);"></div>').appendTo(n),this.elmTitle=e("<h1>Level Title</h1>").appendTo(n),this.elmSubtitle=e('<p class="subtitle">Level Title</p>').appendTo(n),this.elmScreen=e('<div class="explain-screen"></div>').appendTo(this.elmWindow),this.elmFooter=e('<div class="explain-footer"></div>').appendTo(this.elmWindow),this.elmPopup=e('<div class="explain-popup"></div>').appendTo(this.elmWindow),this.elmPopupBody=e("<div></div>").appendTo(this.elmPopup),this.elmPopupFooter=e('<div class="btn-host"></div>').appendTo(this.elmPopup),this.elmWindow.click(function(e){e.stopPropagation(),e.preventDefault()}.bind(this)),this.foregroundDOM.click(function(e){this.trigger("hideExplain")}.bind(this)),this.elmPopup.hide(),this.createExplainScreen()};a.prototype=Object.create(o.ExplainScreen.prototype),a.prototype.loadAnimation=function(e,t){var r=n.openDatabase("animations");r.get(e,function(e,n){!e||(this.explainComponent.onAnimationUpdated(e,t),this.explainComponent.onAnimationStop())}.bind(this))},a.prototype.playAnimation=function(){this.elmPopup.fadeOut(),this.explainComponent.onAnimationStart(),r.hideAllfirstTimeAids()},a.prototype.stopAnimation=function(){this.explainComponent.onAnimationStop()},a.prototype.createExplainScreen=function(){this.elmScreen.addClass("cs-blackboard");var t=e("<div></div>").appendTo(this.elmScreen),n=s.instanceComponent("explain.blackboard",t);if(!n){console.warn("ExplainScreen: Unable to ininitalize explain blackboard!"),t.remove();return}this.explainComponent=n,this.forwardVisualEvents(n),this.adoptEvents(n),n.on("animationCompleted",function(){if(this.disableAnimation)return;this.elmPopup.fadeIn(),r.showFirstTimeAid("explain.button.replay"),r.showFirstTimeAid("explain.button.start"),this.topicInfo.taskDetails[this.activeTask].seen_intro||(this.topicInfo.taskDetails[this.activeTask].seen_intro=!0,u.setTaskAnimationAsSeen(this.topicInfo.taskDetails[this.activeTask]._id))}.bind(this))},a.prototype.onResize=function(t,n){this.width=t,this.height=n;var r=e(this.elmWindow).width(),i=e(this.elmWindow).height();this.elmWindow.css({left:(t-r)/2,top:(n-i)/2})},a.prototype.onHidden=function(){},a.prototype.onWillShow=function(e){this.disableAnimation=!1,e()},a.prototype.onWillHide=function(e){this.disableAnimation=!0,e()},a.prototype.onShown=function(){r.showFirstTimeAid("explain.button.nextLevel"),this.elmPopup.is(":visible")&&(r.showFirstTimeAid("explain.button.replay"),r.showFirstTimeAid("explain.button.start"))},a.prototype.onTopicUpdated=function(t){this.topicInfo=t,this.elmTitle.text(t.info.title),this.elmSubtitle.html(t.info.desc),this.elmFooter.empty(),this.taskBtn=[],this.activeTask=0;for(var n=0;n<t.taskDetails.length;n++){var r=t.taskDetails[n],i=e('<a href="#" class="btn-level">'+(n+1)+"</a>");this.activeTask=n;if(!r.enabled)return;n==1&&s.registerVisualAid("explain.button.nextLevel",i,{screen:"screen.explain"}),i.click(function(e){return function(t){this.selectTask(e)}}(n).bind(this)),this.elmFooter.append(i),this.taskBtn.push(i)}this.selectTask(this.activeTask)},a.prototype.selectTask=function(t){for(var n=0;n<this.taskBtn.length;n++)n<t?(this.taskBtn[n].removeClass("active"),this.taskBtn[n].addClass("blur")):n==t?(this.taskBtn[n].removeClass("blur"),this.taskBtn[n].addClass("active")):this.taskBtn[n].removeClass("blur active");var r=this.topicInfo.taskDetails[t];if(!r)return;this.elmPopupBody.empty(),this.elmPopupBody.append(e("<h2>"+r.info.title+"</h2>")),this.elmPopupBody.append(e("<div>"+r.info.desc+"</div>")),this.elmPopupFooter.empty();var i=e('<a href="#" class="btn-do"><span class="uicon uicon-play-media"></span></a>').appendTo(this.elmPopupFooter).click(function(e){this.playAnimation()}.bind(this)),o=e('<a href="#" class="btn-do"><span class="uicon uicon-play"></span></a>').appendTo(this.elmPopupFooter).click(function(e){this.trigger("startTask",r._id)}.bind(this));r.seen_intro?(this.elmPopup.show(),this.loadAnimation(r.info.animation,function(){this.stopAnimation(),setTimeout(function(){this.stopAnimation()}.bind(this),500)}.bind(this))):this.loadAnimation(r.info.animation,function(){this.playAnimation()}.bind(this)),s.registerVisualAid("explain.button.replay",i,{screen:"screen.explain"}),s.registerVisualAid("explain.button.start",o,{screen:"screen.explain"})},s.registerComponent("screen.explain",a,1)}),define("vas-basic/components/screen_home",["jquery","d3","core/ui","core/config","core/registry","core/base/components"],function(e,t,n,r,i,s){function u(e){var n=t.rgb(e);return n.darker()}function a(e){var t=e.radius+26,n=e.x-t,r=e.x+t,i=e.y-t,s=e.y+t;return function(t,o,u,a,f){if(t.point&&t.point!==e){var l=e.x-t.point.x,c=e.y-t.point.y,h=Math.sqrt(l*l+c*c),p=e.radius+t.point.radius;h<p&&(h=(h-p)/h*.5,e.x-=l*=h,e.y-=c*=h,t.point.x+=l,t.point.y+=c)}return o>r||a<n||u>s||f<i}}function f(r){var s=r.select("circle");s.empty()&&(s=r.append("circle").attr("class","node")),s.attr("r",function(e){return e.radius}).style("fill",function(e){return e.color}).style("stroke",function(e){return u(e.color)});var a=r.select("image");a.empty()&&(a=r.append("image")),a.attr("width",function(e){return e.radius*2-8}).attr("height",function(e){return e.radius*2-8}).attr("transform",function(e){return"translate(-"+(e.radius-4)+",-"+(e.radius-4)+")"}).attr("xlink:href",function(e){return e.icon?e.icon:o});var f;r.on("mouseover",function(r,i){t.select(this).select("circle").style("stroke-width",5),clearTimeout(f),f=setTimeout(function(){n.showPopup("widget.onscreen",this,function(t){t.append(e("<p>"+r.desc+"</p>"))},{"offset-x":2*r.radius+20,"offset-y":r.radius,color:"#2ECC71",title:r.name})}.bind(this),250)}),r.on("mouseout",function(e,r){t.select(this).select("circle").style("stroke-width",3),clearTimeout(f),f=setTimeout(function(){n.hidePopup()},100)}),r.on("click",function(e,t){e.click&&e.click()}),r.each(function(t,n){t.tagAid&&i.registerVisualAid(t.tagAid,e(this).find("image"),{screen:"screen.home"})})}var o="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",l=function(n){s.HomeScreen.call(this,n),n.addClass("home"),this.backdropDOM=e('<div class="'+r.css.backdrop+'"></div>'),n.append(this.backdropDOM),this.backdrop=i.instanceComponent("backdrop.explain",this.backdropDOM),this.foregroundDOM=e('<div class="'+r.css.foreground+'"></div>'),n.append(this.foregroundDOM),this.svg=t.select(this.foregroundDOM[0]).append("svg").attr("class","dv-home"),this.graph={nodes:[{name:"Introduction to the game",desc:"Learn about the Virtual Atom Smasher interface and purpose.",icon:"static/img/logo.png",color:"#ECF0F1",radius:50,click:function(){this.trigger("explainTopic","ea662db6a205b19ae791d95da0021429")}.bind(this)},{name:"Collision Elementary",desc:"Your first task to the world of particle physics! Collide two electron-electron beams!",icon:"static/img/level-icons/hard.png",color:"#2ECC71",radius:20,click:function(){this.trigger("playLevel",1)}.bind(this)}],links:[{source:1,target:0}]},this.setupScene(),this.updateScene()};l.prototype=Object.create(s.HomeScreen.prototype),l.prototype.setupScene=function(){var e=t.scale.category20();this.force=t.layout.force().linkDistance(function(e){return e.source.index==0||e.target.index==0?100:20}).gravity(.4).charge(-2e3).size([this.width,this.height]),this.links=this.svg.selectAll(".link").data(this.graph.links),this.links.enter().append("line").attr("class","link").style("stroke",function(e){u(e.source.color)}),this.nodes=this.svg.selectAll(".node").data(this.graph.nodes),this.nodes.enter().append("g").attr("class","node").call(f).call(this.force.drag),this.force.on("tick",function(){var e=t.geom.quadtree(this.graph.nodes),n=0,r=this.graph.nodes.length;while(++n<r)e.visit(a(this.graph.nodes[n]));this.links.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),this.nodes.attr("transform",function(e){return"translate("+e.x+","+e.y+")"})}.bind(this))},l.prototype.updateScene=function(){this.force.links(this.graph.links).nodes(this.graph.nodes).start(),this.links.remove(),this.nodes.remove(),this.links=this.svg.selectAll(".link").data(this.graph.links),this.links.enter().append("line").attr("class","link").style("stroke",function(e){return u(e.source.color)}),this.nodes=this.svg.selectAll(".node").data(this.graph.nodes),this.nodes.enter().append("g").attr("class","node").call(f).call(this.force.drag)},l.prototype.onResize=function(e,t){this.width=e,this.height=t,this.svg.attr("width",e).attr("height",t),this.force.size([e,t])},l.prototype.onHidden=function(){this.force.stop()},l.prototype.onWillShow=function(e){this.updateScene(),e()},l.prototype.onShown=function(){n.showFirstTimeAid("home.begin"),n.showFirstTimeAid("home.firstBranch")},l.prototype.onTopicTreeUpdated=function(e){this.graph.nodes=[],this.graph.links=e.links;var t={green:"#2ECC71"};for(var n=0;n<e.nodes.length;n++){var r=e.nodes[n],i={name:r.info.name||"",desc:r.info.desc||"",icon:r.info.icon||"static/img/level-icons/hard.png",color:t[r.info.color||"green"],radius:20,click:function(e){return function(e){this.trigger("explainTopic",r._id)}}(r).bind(this)};this.graph.nodes.push(i)}this.graph.nodes[0].radius=50,this.graph.nodes[0].color="#ECF0F1",this.graph.nodes[0].icon="static/img/logo.png",this.graph.nodes[0].tagAid="home.begin",this.graph.nodes.length>1&&(this.graph.nodes[1].tagAid="home.firstBranch"),this.updateScene()},i.registerComponent("screen.home",l,1)}),define("vas-basic/components/screen_running",["jquery","core/config","core/registry","core/base/components","core/ui"],function(e,t,n,r,i){function s(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}var o=function(s){r.RunningScreen.call(this,s),this.diameter=200,this.machines=[],this.lastWorkers=0,this.rateLastTime=0,this.rateLastNevts=0,this.rateAvgBuffer=[],window.run=this,s.addClass("running"),this.backdropDOM=e('<div class="'+t.css.backdrop+'"></div>'),s.append(this.backdropDOM),this.backdrop=n.instanceComponent("backdrop.running",this.backdropDOM),this.foregroundDOM=e('<div class="'+t.css.foreground+'"></div>'),s.append(this.foregroundDOM),this.ppTL=e('<div class="pagepart run-tl"></div>'),this.ppTR=e('<div class="pagepart run-tr"></div>'),this.ppBL=e('<div class="pagepart run-bl"></div>'),this.foregroundDOM.append(this.ppTL),this.foregroundDOM.append(this.ppTR),this.foregroundDOM.append(this.ppBL);var o=e('<div class="btn-taglike"><span class="uicon uicon-explain"></span><br />Tutorial</div>');this.ppTL.append(o),o.click(function(e){e.preventDefault(),e.stopPropagation(),i.showTutorial("ui.running")});var u=e('<div class="btn-taglike"><span class="uicon uicon-gear"></span><br />Status</div>');this.ppTR.append(u);var a=e('<div class="btn-taglike"><span class="uicon uicon-eye"></span><br />Details</div>');this.ppBL.append(a),this.infoEventRate=e("<h1>0</h1>"),this.ppTL.append(this.infoEventRate),this.ppTL.append(e("<p>Events/sec</p>")),this.infoWorkers=e("<h1>0</h1>"),this.ppTR.append(this.infoWorkers),this.ppTR.append(e("<p>Connected machines</p>")),this.infoPercent=e("<h1>25%</h1>"),this.ppBL.append(this.infoPercent),this.ppBL.append(e("<p>Completed</p>")),this.hostObserving=e('<div class="observing-host"></div>'),this.foregroundDOM.append(this.hostObserving),this.statusWidget=n.instanceComponent("widget.running_status",this.foregroundDOM),this.statusWidget?(this.forwardVisualEvents(this.statusWidget),this.forwardEvents(this.statusWidget,["onWorkerAdded","onWorkerRemoved","onStartRun"]),this.statusWidget.on("abort",function(){this.trigger("abortRun")}.bind(this))):console.warn("Unable to instantiate running screen status widget"),n.registerVisualAid("running.label.workers",this.infoWorkers,{screen:"screen.running"}),n.registerVisualAid("running.label.events",this.infoEventRate,{screen:"screen.running"}),n.registerVisualAid("running.label.percent",this.infoPercent,{screen:"screen.running"}),this.obsElms=[],this.defineObservables()};o.prototype=Object.create(r.RunningScreen.prototype),o.prototype.defineObservables=function(e){var e=[];for(var t=0;t<5;t++)e.push({info:{name:"O"+t,"short":"O"+t,book:"more-"+t}});this.hostObserving.empty(),this.obsElms=[];var n=e.length,r=Math.PI*2/(n+1),i=-Math.PI;for(var t=0;t<n;t++){var s=this.createObservable(i+=r,e[t]);this.obsElms.push(s)}},o.prototype.createObservable=function(e,t){var r=n.instanceComponent("widget.observable.running",this.hostObserving);return r?(r.setRadialConfig(150,350,e),r.onMetaUpdate(t),r.onUpdate(undefined),r):(console.warn("Unable to instantiate an observable widget!"),undefined)},o.prototype.onWorkerRemoved=function(e){for(var t=0;t<this.machines.length;t++)if(this.machines[t].id==e){this.machines.splice(t,1);break}this.infoWorkers.text(this.machines.length)},o.prototype.onWorkerAdded=function(e,t){this.machines.length==0&&i.showFirstTimeAid("running.label.workers"),t.id=e,this.machines.push(t),this.infoWorkers.text(this.machines.length)},o.prototype.onStartRun=function(e,t){this.machines=[],this.rateAvgBuffer=[],this.rateLastTime=0,this.rateLastNevts=0,this.infoWorkers.text("0"),this.infoEventRate.text("0")},o.prototype.onUpdate=function(e,t){if(e.length==0)return;var n=e[0].data.nevts,r=0;if(this.rateLastNevts!=0){var o=n-this.rateLastNevts,u=(Date.now()-this.rateLastTime)/1e3,a=o/u;this.rateAvgBuffer.push(a);for(var f=0;f<this.rateAvgBuffer.length;f++)r+=this.rateAvgBuffer[f];this.rateAvgBuffer.length>5&&this.rateAvgBuffer.splice(0,1),r=Math.round(r/this.rateAvgBuffer.length)}this.rateLastNevts=n,this.rateLastTime=Date.now(),r>0&&(this.infoEventRate.text(s(r)),i.showFirstTimeAid("running.label.events"));var l=this.machines.length*2e5,c=n/l;c=t,this.statusWidget.onUpdate(c),this.infoPercent.text(Math.round(c*100)+"%"),c>.25&&i.showFirstTimeAid("running.label.percent"),console.log(e),window.h=e},o.prototype.onShown=function(){},o.prototype.onResize=function(e,t){var n=160,r=160;this.width=e,this.height=t,this.pivotX=this.width/2,this.pivotY=this.height/2,this.statusWidget.setPosition(this.pivotX,this.pivotY);for(var i=0;i<this.obsElms.length;i++)this.obsElms[i].onResize(this.width,this.height)},n.registerComponent("screen.running",o,1)}),function(e){typeof define=="function"&&define.amd?define("jquery-knob",["jquery"],e):e(jQuery)}(function(e){var t={},n=Math.max,r=Math.min;t.c={},t.c.d=e(document),t.c.t=function(e){return e.originalEvent.touches.length-1},t.o=function(){var n=this;this.o=null,this.$=null,this.i=null,this.g=null,this.v=null,this.cv=null,this.x=0,this.y=0,this.w=0,this.h=0,this.$c=null,this.c=null,this.t=0,this.isInit=!1,this.fgColor=null,this.pColor=null,this.dH=null,this.cH=null,this.eH=null,this.rH=null,this.scale=1,this.relative=!1,this.relativeWidth=!1,this.relativeHeight=!1,this.$div=null,this.run=function(){var t=function(e,t){var r;for(r in t)n.o[r]=t[r];n._carve().init(),n._configure()._draw()};if(this.$.data("kontroled"))return;this.$.data("kontroled",!0),this.extend(),this.o=e.extend({min:this.$.data("min")!==undefined?this.$.data("min"):0,max:this.$.data("max")!==undefined?this.$.data("max"):100,stopper:!0,readOnly:this.$.data("readonly")||this.$.attr("readonly")==="readonly",cursor:this.$.data("cursor")===!0&&30||this.$.data("cursor")||0,thickness:this.$.data("thickness")&&Math.max(Math.min(this.$.data("thickness"),1),.01)||.35,lineCap:this.$.data("linecap")||"butt",width:this.$.data("width")||200,height:this.$.data("height")||200,displayInput:this.$.data("displayinput")==null||this.$.data("displayinput"),displayPrevious:this.$.data("displayprevious"),fgColor:this.$.data("fgcolor")||"#87CEEB",inputColor:this.$.data("inputcolor"),font:this.$.data("font")||"Arial",fontWeight:this.$.data("font-weight")||"bold",inline:this.$.data("inline")!==undefined?this.$.data("inline"):!1,className:this.$.data("className")||"",step:this.$.data("step")||1,rotation:this.$.data("rotation"),draw:null,change:null,cancel:null,release:null,format:function(e){return e},parse:function(e){return parseFloat(e)}},this.o),this.o.flip=this.o.rotation==="anticlockwise"||this.o.rotation==="acw",this.o.inputColor||(this.o.inputColor=this.o.fgColor),this.$.is("fieldset")?(this.v={},this.i=this.$.find("input"),this.i.each(function(t){var r=e(this);n.i[t]=r,n.v[t]=n.o.parse(r.val()),r.bind("change blur",function(){var e={};e[t]=r.val(),n.val(e)})}),this.$.find("legend").remove()):(this.i=this.$,this.v=this.o.parse(this.$.val()),this.v===""&&(this.v=this.o.min),this.$.bind("change blur",function(){n.val(n._validate(n.o.parse(n.$.val())))})),!this.o.displayInput&&this.$.hide(),this.$c=e(document.createElement("canvas")).attr({width:this.o.width,height:this.o.height}),this.$div=e('<div style="'+(this.o.inline?"display:inline;":"")+"width:"+this.o.width+"px;height:"+this.o.height+"px;"+'" class="'+this.o.className+'"></div>'),this.$.wrap(this.$div).before(this.$c),this.$div=this.$.parent(),typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement(this.$c[0]),this.c=this.$c[0].getContext?this.$c[0].getContext("2d"):null;if(!this.c)throw{name:"CanvasNotSupportedException",message:"Canvas not supported. Please use excanvas on IE8.0.",toString:function(){return this.name+": "+this.message}};return this.scale=(window.devicePixelRatio||1)/(this.c.webkitBackingStorePixelRatio||this.c.mozBackingStorePixelRatio||this.c.msBackingStorePixelRatio||this.c.oBackingStorePixelRatio||this.c.backingStorePixelRatio||1),this.relativeWidth=this.o.width%1!==0&&this.o.width.indexOf("%"),this.relativeHeight=this.o.height%1!==0&&this.o.height.indexOf("%"),this.relative=this.relativeWidth||this.relativeHeight,this._carve(),this.v instanceof Object?(this.cv={},this.copy(this.v,this.cv)):this.cv=this.v,this.$.bind("configure",t).parent().bind("configure",t),this._listen()._configure()._xy().init(),this.isInit=!0,this.$.val(this.o.format(this.v)),this._draw(),this},this._carve=function(){if(this.relative){var e=this.relativeWidth?this.$div.parent().width()*parseInt(this.o.width)/100:this.$div.parent().width(),t=this.relativeHeight?this.$div.parent().height()*parseInt(this.o.height)/100:this.$div.parent().height();this.w=this.h=Math.min(e,t)}else this.w=this.o.width,this.h=this.o.height;return this.$div.css({width:this.w+"px",height:this.h+"px"}),this.$c.attr({width:this.w,height:this.h}),this.scale!==1&&(this.$c[0].width=this.$c[0].width*this.scale,this.$c[0].height=this.$c[0].height*this.scale,this.$c.width(this.w),this.$c.height(this.h)),this},this._draw=function(){var e=!0;n.g=n.c,n.clear(),n.dH&&(e=n.dH()),e!==!1&&n.draw()},this._touch=function(e){var r=function(e){var t=n.xy2val(e.originalEvent.touches[n.t].pageX,e.originalEvent.touches[n.t].pageY);if(t==n.cv)return;if(n.cH&&n.cH(t)===!1)return;n.change(n._validate(t)),n._draw()};return this.t=t.c.t(e),r(e),t.c.d.bind("touchmove.k",r).bind("touchend.k",function(){t.c.d.unbind("touchmove.k touchend.k"),n.val(n.cv)}),this},this._mouse=function(e){var r=function(e){var t=n.xy2val(e.pageX,e.pageY);if(t==n.cv)return;if(n.cH&&n.cH(t)===!1)return;n.change(n._validate(t)),n._draw()};return r(e),t.c.d.bind("mousemove.k",r).bind("keyup.k",function(e){if(e.keyCode===27){t.c.d.unbind("mouseup.k mousemove.k keyup.k");if(n.eH&&n.eH()===!1)return;n.cancel()}}).bind("mouseup.k",function(e){t.c.d.unbind("mousemove.k mouseup.k keyup.k"),n.val(n.cv)}),this},this._xy=function(){var e=this.$c.offset();return this.x=e.left,this.y=e.top,this},this._listen=function(){return this.o.readOnly?this.$.attr("readonly","readonly"):(this.$c.bind("mousedown",function(e){e.preventDefault(),n._xy()._mouse(e)}).bind("touchstart",function(e){e.preventDefault(),n._xy()._touch(e)}),this.listen()),this.relative&&e(window).resize(function(){n._carve().init(),n._draw()}),this},this._configure=function(){return this.o.draw&&(this.dH=this.o.draw),this.o.change&&(this.cH=this.o.change),this.o.cancel&&(this.eH=this.o.cancel),this.o.release&&(this.rH=this.o.release),this.o.displayPrevious?(this.pColor=this.h2rgba(this.o.fgColor,"0.4"),this.fgColor=this.h2rgba(this.o.fgColor,"0.6")):this.fgColor=this.o.fgColor,this},this._clear=function(){this.$c[0].width=this.$c[0].width},this._validate=function(e){return~~((e<0?-0.5:.5)+e/this.o.step)*this.o.step},this.listen=function(){},this.extend=function(){},this.init=function(){},this.change=function(e){},this.val=function(e){},this.xy2val=function(e,t){},this.draw=function(){},this.clear=function(){this._clear()},this.h2rgba=function(e,t){var n;return e=e.substring(1,7),n=[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)],"rgba("+n[0]+","+n[1]+","+n[2]+","+t+")"},this.copy=function(e,t){for(var n in e)t[n]=e[n]}},t.Dial=function(){t.o.call(this),this.startAngle=null,this.xy=null,this.radius=null,this.lineWidth=null,this.cursorExt=null,this.w2=null,this.PI2=2*Math.PI,this.extend=function(){this.o=e.extend({bgColor:this.$.data("bgcolor")||"#EEEEEE",angleOffset:this.$.data("angleoffset")||0,angleArc:this.$.data("anglearc")||360,inline:!0},this.o)},this.val=function(e,t){if(null==e)return this.v;e=this.o.parse(e);if(t!==!1&&e!=this.v&&this.rH&&this.rH(e)===!1)return;this.cv=this.o.stopper?n(r(e,this.o.max),this.o.min):e,this.v=this.cv,this.$.val(this.o.format(this.v)),this._draw()},this.xy2val=function(e,t){var i,s;return i=Math.atan2(e-(this.x+this.w2),-(t-this.y-this.w2))-this.angleOffset,this.o.flip&&(i=this.angleArc-i-this.PI2),this.angleArc!=this.PI2&&i<0&&i>-0.5?i=0:i<0&&(i+=this.PI2),s=~~(.5+i*(this.o.max-this.o.min)/this.angleArc)+this.o.min,this.o.stopper&&(s=n(r(s,this.o.max),this.o.min)),s},this.listen=function(){var t=this,i,s,o=function(e){e.preventDefault();var o=e.originalEvent,u=o.detail||o.wheelDeltaX,a=o.detail||o.wheelDeltaY,f=t._validate(t.o.parse(t.$.val()))+(u>0||a>0?t.o.step:u<0||a<0?-t.o.step:0);f=n(r(f,t.o.max),t.o.min),t.val(f,!1),t.rH&&(clearTimeout(i),i=setTimeout(function(){t.rH(f),i=null},100),s||(s=setTimeout(function(){i&&t.rH(f),s=null},200)))},u,a,f=1,l={37:-t.o.step,38:t.o.step,39:t.o.step,40:-t.o.step};this.$.bind("keydown",function(i){var s=i.keyCode;s>=96&&s<=105&&(s=i.keyCode=s-48),u=parseInt(String.fromCharCode(s));if(isNaN(u)){s!==13&&s!==8&&s!==9&&s!==189&&(s!==190||t.$.val().match(/\./))&&i.preventDefault();if(e.inArray(s,[37,38,39,40])>-1){i.preventDefault();var o=t.o.parse(t.$.val())+l[s]*f;t.o.stopper&&(o=n(r(o,t.o.max),t.o.min)),t.change(o),t._draw(),a=window.setTimeout(function(){f*=2},30)}}}).bind("keyup",function(e){isNaN(u)?a&&(window.clearTimeout(a),a=null,f=1,t.val(t.$.val())):t.$.val()>t.o.max&&t.$.val(t.o.max)||t.$.val()<t.o.min&&t.$.val(t.o.min)}),this.$c.bind("mousewheel DOMMouseScroll",o),this.$.bind("mousewheel DOMMouseScroll",o)},this.init=function(){if(this.v<this.o.min||this.v>this.o.max)this.v=this.o.min;this.$.val(this.v),this.w2=this.w/2,this.cursorExt=this.o.cursor/100,this.xy=this.w2*this.scale,this.lineWidth=this.xy*this.o.thickness,this.lineCap=this.o.lineCap,this.radius=this.xy-this.lineWidth/2,this.o.angleOffset&&(this.o.angleOffset=isNaN(this.o.angleOffset)?0:this.o.angleOffset),this.o.angleArc&&(this.o.angleArc=isNaN(this.o.angleArc)?this.PI2:this.o.angleArc),this.angleOffset=this.o.angleOffset*Math.PI/180,this.angleArc=this.o.angleArc*Math.PI/180,this.startAngle=1.5*Math.PI+this.angleOffset,this.endAngle=1.5*Math.PI+this.angleOffset+this.angleArc;var e=n(String(Math.abs(this.o.max)).length,String(Math.abs(this.o.min)).length,2)+2;this.o.displayInput&&this.i.css({width:(this.w/2+4>>0)+"px",height:(this.w/3>>0)+"px",position:"absolute","vertical-align":"middle","margin-top":(this.w/3>>0)+"px","margin-left":"-"+(this.w*3/4+2>>0)+"px",border:0,background:"none",font:this.o.fontWeight+" "+(this.w/e>>0)+"px "+this.o.font,"text-align":"center",color:this.o.inputColor||this.o.fgColor,padding:"0px","-webkit-appearance":"none"})||this.i.css({width:"0px",visibility:"hidden"})},this.change=function(e){this.cv=e,this.$.val(this.o.format(e))},this.angle=function(e){return(e-this.o.min)*this.angleArc/(this.o.max-this.o.min)},this.arc=function(e){var t,n;return e=this.angle(e),this.o.flip?(t=this.endAngle+1e-5,n=t-e-1e-5):(t=this.startAngle-1e-5,n=t+e+1e-5),this.o.cursor&&(t=n-this.cursorExt)&&(n+=this.cursorExt),{s:t,e:n,d:this.o.flip&&!this.o.cursor}},this.draw=function(){var e=this.g,t=this.arc(this.cv),n,r=1;e.lineWidth=this.lineWidth,e.lineCap=this.lineCap,e.beginPath(),e.strokeStyle=this.o.bgColor,e.arc(this.xy,this.xy,this.radius,this.endAngle-1e-5,this.startAngle+1e-5,!0),e.stroke(),this.o.displayPrevious&&(n=this.arc(this.v),e.beginPath(),e.strokeStyle=this.pColor,e.arc(this.xy,this.xy,this.radius,n.s,n.e,n.d),e.stroke(),r=this.cv==this.v),e.beginPath(),e.strokeStyle=r?this.o.fgColor:this.fgColor,e.arc(this.xy,this.xy,this.radius,t.s,t.e,t.d),e.stroke()},this.cancel=function(){this.val(this.v)}},e.fn.dial=e.fn.knob=function(n){return this.each(function(){var r=new t.Dial;r.o=n,r.$=e(this),r.run()}).parent()}}),define("vas-basic/components/screen_tuning",["jquery","core/config","core/registry","core/base/components","core/db","core/ui","core/user","liveq/core","jquery-knob"],function(e,t,n,i,s,o,u,a){var f=function(r){i.TuningScreen.call(this,r),this.host=r,this.width=0,this.height=0,this.obsAngleSpan=Math.PI*2,this.obsAngleShift=0,this.obsWideSpan=0,this.obsMinDistance=400,this.obsMaxDistance=600,this.tunAngleSpan=Math.PI*2,this.tunAngleShift=0,this.tunWideSpan=0,this.tunMinDistance=150,this.tunMaxDistance=350,this.saveButtons=[],this.activeSaveSlot=0,this.taskData=null,this.tunables={},this.observables={},this.parameters={},this.tuneWidgets={},this.observeWidgets={},this.obsElms=[],this.tunElms=[],this.observablesLevelRings=[],this.tunablesLevelRings=[],this.observableByID={},r.addClass("tuning"),this.backdropDOM=e('<div class="'+t.css.backdrop+'"></div>'),r.append(this.backdropDOM),this.backdrop=n.instanceComponent("backdrop.tuning",this.backdropDOM),this.forwardVisualEvents(this.backdrop),this.foregroundDOM=e('<div class="'+t.css.foreground+'"></div>'),r.append(this.foregroundDOM),this.hostTuning=e('<div class="tuning-host fullscreen"></div>'),this.foregroundDOM.append(this.hostTuning),this.preparePageParts(),this.preparePinView(),this.prepareTuningStatus(),this.prepareObservingStatus();var s=[],o=[],u=[],a=0,f=0;for(var l=0;l<5;l++){var c={tun:[],obs:[],feats:[],train:[]};for(var h=0;h<5;h++){var p="o"+f++;o[p]={info:{"short":"O"+p,name:"Observable #"+p,book:"book-"+p}},c.obs.push(p)}for(var h=0;h<5;h++){var d="t"+a++;u[d]={value:{min:0,max:10,dec:3},info:{"short":"T"+d,name:"Tunable #"+d,book:"book-"+d}},c.tun.push(d)}s.push(c)}};f.prototype=Object.create(i.TuningScreen.prototype),f.prototype.showBook=function(e){alert("You will be presented with book #"+e)},f.prototype.prepareTuningStatus=function(){this.tuningGroups={},this.tuningSB0=e('<div class="sidebar sb0"></div>'),this.tuningSB1=e('<div class="sidebar sb1"></div>'),this.foregroundDOM.append(this.tuningSB0),this.foregroundDOM.append(this.tuningSB1),this.sidebarButtonsDOM=e('<div class="sidebar-buttons"></div>').appendTo(this.tuningSB0),this.tuningBodySB0=e("<div></div>").appendTo(this.tuningSB0),this.tuningBodySB1=e("<div></div>").appendTo(this.tuningSB1);var t=e('<div class="btn-tutorial"><span class="uicon uicon-explain"></span><br />Tutorial</div>').appendTo(this.sidebarButtonsDOM);t.click(function(e){e.preventDefault(),e.stopPropagation(),o.showTutorial("ui.tuning")}),n.registerVisualAid("tuning.button.tutorial",t,{screen:"screen.tuning"});for(var r=3;r>=0;r--){var i=e('<div class="btn-save"><div class="led"></div><div class="text">'+(r+1)+"</div></div></div>").appendTo(this.sidebarButtonsDOM);i.click(function(e){return function(t){t.preventDefault(),t.stopPropagation(),this.activateSave(e)}}(r).bind(this)),r==3&&n.registerVisualAid("tuning.button.save",i,{screen:"screen.tuning"}),this.saveButtons.unshift(i),this.activeSaveSlot==r&&i.addClass("active")}},f.prototype.prepareObservingStatus=function(){this.observingWidget=n.instanceComponent("widget.tuning.status-observe",this.hostTuning),this.observingWidget?this.forwardVisualEvents(this.observingWidget):console.warn("Unable to instantiate observing status widget!"),this.observingWidget.onUpdate(),this.observingWidget.on("begin",function(){this.trigger("submitParameters",this.getValueMap())}.bind(this))},f.prototype.updateTuningStatus=function(){for(var e=0;e<this.tunElms.length;e++){var t=this.tunElms[e].hostDOM;this.tunElms[e].onResize(t.width(),t.height())}},f.prototype.updateObservingStatus=function(){var t=this.width,n=this.height,i=0,s=0;e("body").hasClass("layout-compact")?(i=200,t-=i):e("body").hasClass("layout-wide")?(i=230,t-=i*2):e("body").hasClass("layout-vertical")||e("body").hasClass("layout-mobile"),t>n?r=n/2-10:r=t/2-10,this.observingWidget.onMove(i,s),this.observingWidget.onResize(t,n),this.observingWidget.setRadialConfig&&this.observingWidget.setRadialConfig(104,r-24);var o=this.obsAngleShift,u=this.obsAngleSpan/this.obsElms.length;for(var a=0;a<this.obsElms.length;a++)this.obsElms[a].setRadialConfig&&this.obsElms[a].setRadialConfig(104,r-24,o+=u),this.obsElms[a].onMove(i,s),this.obsElms[a].onResize(t,n)},f.prototype.prepareEvents=function(){this.mouse={x:0,y:0},this.foregroundDOM.mousemove(function(e){var t=300,n=0,r=0;n=(e.clientX-this.width/2)/(this.width/2),e.clientY>t?r=(e.clientY-t)/(this.height-t-this.detailsViewHeight):r=.01,n=Math.pow(Math.abs(n),4)*(Math.abs(n)/n),r=Math.pow(Math.abs(r),4)*(Math.abs(r)/r);var i=50,s=i+this.obsMaxDistance*2-this.width,o=i+this.obsMaxDistance+this.pivotY-this.height;s<0&&(s=0),o<0&&(o=0),this.hostTuning.css({left:-n*s,top:-r*o}),this.forwardHorizon()}.bind(this))},f.prototype.preparePageParts=function(){this.ppTL=e('<div class="floater f-header"></div>'),this.foregroundDOM.append(this.ppTL),this.infoTitle=e("<h1>Level 1</h1>"),this.ppTL.append(this.infoTitle),this.infoSubtitle=e("<p>A short description of this level</p>"),this.ppTL.append(this.infoSubtitle)},f.prototype.preparePinView=function(){this.detailsViewHeight=0,this.detailsView=e('<div class="details-view"></div>'),this.foregroundDOM.append(this.detailsView),this.pinViewComponent=n.instanceComponent("screen.tuning.pin",this.detailsView);var t=e('<div class="btn-taglike"><span class="uicon uicon-pin"></span><br />Pinned</div>');this.detailsView.append(t),t.click(function(){var e=this.detailsView.hasClass("expanded");e?(this.detailsViewHeight=0,this.detailsView.removeClass("expanded"),this.onResize(this.width,this.height),this.pinViewComponent.hide()):(this.detailsViewHeight=150,this.detailsView.addClass("expanded"),this.onResize(this.width,this.height),this.pinViewComponent.show())}.bind(this)),this.detailsView.mousemove(function(e){e.stopPropagation()})},f.prototype.createTunable=function(t,r,i){var o=i.info&&i.info.group?i.info.group:"general",u=this.tuningGroups[o];if(!u){var a={title:o,book:""},f=s.cache.definitions&&s.cache.definitions["tunable-groups"]&&s.cache.definitions["tunable-groups"].groups?s.cache.definitions["tunable-groups"].groups:{};f[o]&&(a=f[o]);var l=e("<h1>"+a.title+"</h1>");if(a.book){var c=e('<span class="help">?</span>');l.append(c),c.click(function(e){return function(t){t.preventDefault(),t.stopPropagation(),this.showBook(e)}}(a.book).bind(this))}this.tuningBodySB0.append(l),this.tuningBodySB0.append(u=e('<div class="group"></div>')),this.tuningGroups[o]=u}var h=e('<div class="tunable"></div>');u.append(h);var p=n.instanceComponent("widget.tunable.tuning",h);if(!p)return console.warn("Unable to instantiate a tuning widget!"),undefined;this.forwardVisualEvents(p),p.on("explain",function(e){this.showBook(e)}.bind(this)),p.on("valueChanged",function(e){this.requestInterpolation(),this.commitSaveChanges()}.bind(this)),p.onMetaUpdate(i),p.onUpdate(parseFloat(i.def)||0);if(this.taskData){var d=this.taskData.save;for(var v=0;v<d.length;v++)d[v]?p.onSaveSlotUpdate(v,d[v][i._id]||null):p.onSaveSlotUpdate(v,null)}return p},f.prototype.createObservable=function(e,t){var r=n.instanceComponent("widget.observable.tuning",this.hostTuning);return r?(this.forwardVisualEvents(r),r.setRadialConfig(undefined,undefined,e),r.on("explain",function(e){this.showBook(e)}.bind(this)),r.on("pin",function(e){return function(){alert("Will pin element"+e)}}(r).bind(this)),r.onMetaUpdate(t),r.onUpdate(undefined),r):(console.warn("Unable to instantiate an observable widget!"),undefined)},f.prototype.defineMainScreen=function(e,t,r){var i=!0,s=!0;this.tuningBodySB0.empty(),this.tuningBodySB1.empty(),this.hostTuning.find(".observable").remove(),this.pivotX=this.width/2,this.pivotY=150,this.obsElms=[],this.tunElms=[],this.observablesLevelRings=[],this.tunablesLevelRings=[],this.tuningGroups={};var o=this.tunMinDistance,u=(this.tunMaxDistance-this.tunMinDistance)/e.length,a=0;for(var f=0;f<e.length;f++)a+=e[f].obs.length;var l=this.obsAngleSpan/(a+1),c=this.obsAngleShift,h=0;for(var f=0;f<e.length;f++)h+=e[f].tun.length;var p=this.tunAngleSpan/(h+1),d=this.tunAngleShift;for(var f=0;f<e.length;f++){var v=e[f],m=[],g=[];for(var y=0;y<v.obs.length;y++){var b=t[v.obs[y]];if(!b){console.warn("TuningScreen: Unable to find observable",v.obs[y]);continue}var w=this.createObservable(c+=l,b);if(!w){console.warn("TuningScreen: Could not create observable!");continue}this.obsElms.push(w),this.observableByID[b._id]=w,s&&(n.registerVisualAid("tuning.observable",w,{screen:"screen.tuning"}),s=!1),w.on("click",function(e){return function(){this.focusTunableRing(e)}}(f).bind(this)),g.push(w)}this.observablesLevelRings.push(g);for(var y=0;y<v.tun.length;y++){var E=r[v.tun[y]];if(!E){console.warn("TuningScreen: Unable to find tunable",v.tun[y]);continue}var w=this.createTunable(d+=p,o,E);if(!w){console.warn("TuningScreen: Could not create tunable!");continue}this.tunElms.push(w),i&&(n.registerVisualAid("tuning.tunable",w,{screen:"screen.tuning"}),i=!1),m.push(w)}this.tunablesLevelRings.push(m)}this.updateTuningStatus(),this.updateObservingStatus()},f.prototype.onTunablesDefined=function(e){this.tunables={};for(var t=0;t<e.length;t++)this.tunables[e[t]._id]=e[t]},f.prototype.onObservablesDefined=function(e){this.observables={};for(var t=0;t<e.length;t++)this.observables[e[t]._id]=e[t]},f.prototype.onLevelsDefined=function(e){this.levels=e},f.prototype.onStartTask=function(e){this.taskData=e,this.infoTitle.text(this.taskData.info.title||"Untitled Task"),this.infoSubtitle.text(this.taskData.info.subtitle||""),this.defineMainScreen([this.taskData],this.observables,this.tunables)},f.prototype.onWillShow=function(e){a.openSocket(this.taskData.lab,function(){e()},function(e){alert("Could not connect to LiveQ! "+e)})},f.prototype.onShown=function(){o.showFirstTimeAid("tuning.tunable"),o.showFirstTimeAid("tuning.observable"),o.showFirstTimeAid("tuning.button.save")},f.prototype.onResize=function(e,t){this.width=e,this.height=t,this.updateTuningStatus(),this.updateObservingStatus(),this.pinViewComponent.onResize(e,this.detailsViewHeight)},f.prototype.onUpdate=function(e){var t=0,n=0;for(var r=0;r<e.length;r++){var i=e[r];this.observableByID[i.id]&&(this.observableByID[i.id].onUpdate(i),t+=this.observableByID[i.id].getValue(),n+=1)}n>0?this.observingWidget.onUpdate(t/n):this.observingWidget.onUpdate(1e3)},f.prototype.activateSave=function(e){this.saveButtons[this.activeSaveSlot].removeClass("active"),this.activeSaveSlot=e,this.saveButtons[this.activeSaveSlot].addClass("active");var t=this.taskData.save[this.activeSaveSlot];if(t)for(var n=0;n<this.tunElms.length;n++){var r=this.tunElms[n].meta._id;t[r]!=undefined&&this.tunElms[n].onUpdate(t[r])}},f.prototype.commitSaveChanges=function(){var e={};for(var t=0;t<this.tunElms.length;t++){var n=this.tunElms[t].meta._id,r=this.tunElms[t].getValue();this.tunElms[t].onSaveSlotUpdate(this.activeSaveSlot,r),e[n]=r}this.taskData.save[this.activeSaveSlot]=e,u.setTaskSaveSlot(this.taskData._id,this.activeSaveSlot,e)},f.prototype.getReferenceHistos=function(e){var e=this.getValueMap()},f.prototype.requestInterpolation=function(e){var e=this.getValueMap();a.requestInterpolation(e,function(e){var t=0,n=0;for(var r=0;r<e.length;r++){var i=e[r];this.observableByID[i.id]&&(this.observableByID[i.id].onUpdate(i),t+=this.observableByID[i.id].getValue(),n+=1)}n>0?this.observingWidget.onUpdate(t/n):this.observingWidget.onUpdate(1e3)}.bind(this),function(e){}.bind(this))},f.prototype.getValueMap=function(){var e={};for(var t=0;t<this.tunElms.length;t++){var n=this.tunElms[t].meta._id,r=this.tunElms[t].getValue();e[n]=r}return e},f.prototype.focusTunableRing=function(e){for(var t=0;t<this.tunablesLevelRings.length;t++){for(var n=0;n<this.tunablesLevelRings[t].length;n++);for(var n=0;n<this.observablesLevelRings[t].length;n++);}},f.prototype.forwardHorizon=function(){var e=-parseInt(this.hostTuning.css("top"));for(var t=0;t<this.obsElms.length;t++)this.obsElms[t].onHorizonTopChanged(e+this.height-this.detailsViewHeight);for(var t=0;t<this.tunElms.length;t++)this.tunElms[t].onHorizonTopChanged(e+this.height-this.detailsViewHeight)},f.prototype.handleParameterUpdate=function(e,t){this.parameters[e]=t,this.trigger("changeParameters",this.parameters)},n.registerComponent("screen.tuning",f,1)}),define("vas-basic/components/screen_progress",["core/config","core/registry","core/base/components"],function(e,t,n){var r=function(r){n.ProgressScreen.call(this,r),r.addClass("progress"),this.backdropDOM=$('<div class="'+e.css.backdrop+'"></div>'),r.append(this.backdropDOM),this.backdrop=t.instanceComponent("backdrop.progress",this.backdropDOM),this.foregroundDOM=$('<div class="'+e.css.foreground+'"></div>'),r.append(this.foregroundDOM),this.elmBar=$('<div class="bar"></div>'),this.elmBarValue=$('<div class="bar-value"></div>'),this.elmBar.append(this.elmBarValue),this.foregroundDOM.append(this.elmBar),this.elmStatus=$('<div class="bar-status"></div>'),this.elmProgress=$('<div class="bar-progress"></div>'),this.foregroundDOM.append(this.elmStatus),this.foregroundDOM.append(this.elmProgress),this.elmLogo=$('<div class="logo"></div>'),this.foregroundDOM.append(this.elmLogo),this.onProgress(0,"Initializing")};r.prototype=Object.create(n.ProgressScreen.prototype),r.prototype.onProgress=function(e,t){this.elmBarValue.css({width:e*100+"%"}),this.elmProgress.text(Math.round(e*100)+"%"),this.elmStatus.text(t)},r.prototype.onWillHide=function(e){e()},r.prototype.onWillShow=function(e){e()},t.registerComponent("screen.progress",r,1)}),define("vas-basic/components/screen_login",["core/config","core/registry","core/base/components","core/ui"],function(e,t,n,r){var i=function(i){n.LoginScreen.call(this,i),i.addClass("login"),this.backdropDOM=$('<div class="'+e.css.backdrop+'"></div>'),i.append(this.backdropDOM),this.backdrop=t.instanceComponent("backdrop.login",this.backdropDOM),this.foregroundDOM=$('<div class="'+e.css.foreground+'"></div>'),i.append(this.foregroundDOM),this.elmHost=$('<div class="host"></div>'),this.foregroundDOM.append(this.elmHost),this.elmHeader=$('<div class="header"></div>'),this.elmHost.append(this.elmHeader),this.elmHeader.append($('<div class="logo-icon"></div>')),this.elmHeader.append($('<div class="logo-text"><h1><span>Virtual</span> Atom Smasher</h1><p>Learn particle physics & help scientists at CERN</p></div>')),this.elmBody=$('<div class="body"></div>'),this.elmHost.append(this.elmBody),this.elmLeftBody=$('<div class="left"></div>'),this.elmBody.append(this.elmLeftBody),this.elmRightBody=$('<div class="right"></div>'),this.elmBody.append(this.elmRightBody),this.elmLeftBody.append($("<h1>Welcome visitor!</h1>")),this.elmLeftBody.append($("<p>Virtual Atom Smasher is a revolutionary educational game that brings you along with the theoretical physicists inside CERN!</p>")),this.elmLeftBody.append($("<p>Playing this game you are not only learning about particle physics, but you are actively helping scientists with their research!</p>"));var s=$('<a href="do:tour"><img src="static/img/take-tour.png" /></a>');s.click(function(e){e.preventDefault(),e.stopPropagation(),r.showTutorial("pub.welcome")}),this.elmLeftBody.append(s),this.elmRightBody.append($("<h1>Welcome fellow scientist!</h1>"));var o=$('<input  id="login-username" type="text" />'),u=$('<input id="login-password" type="password" />'),a=$("<table></table>"),f=$("<tr></tr"),l=$("<tr></tr>"),c=$('<th><label for="login-username">Username:</label></th>'),h=$('<th><label for="login-password">Password:</label></th>'),p=$("<td></td>"),d=$("<td></td>");p.append(o),d.append(u),f.append(c).append(p),l.append(h).append(d),a.append(f).append(l),this.elmRightBody.append(a);var v=$('<div class="login"></div>');this.elmRightBody.append(v);var m=$('<input type="button" value="Login" />');v.append(m),m.click(function(e){e.preventDefault(),e.stopPropagation(),this.trigger("login",o.val(),u.val())}.bind(this));var g=$('<input type="button" value="Register" />');v.append(g),g.click(function(e){e.preventDefault(),e.stopPropagation(),this.trigger("register",o.val(),u.val())}.bind(this))};i.prototype=Object.create(n.LoginScreen.prototype),i.prototype.onWillShow=function(e){e()},t.registerComponent("screen.login",i,1)}),define("vas-basic/components/screen_results",["jquery","core/config","core/registry","core/base/components","core/db","core/ui","core/user","liveq/core","jquery-knob"],function(e,t,n,r,i,s,o,u){var a=function(i){r.ResultsScreen.call(this,i),this.host=i,this.width=0,this.height=0,this.backdropDOM=e('<div class="'+t.css.backdrop+'"></div>'),i.append(this.backdropDOM),this.backdrop=n.instanceComponent("backdrop.results",this.backdropDOM),this.forwardVisualEvents(this.backdrop),this.foregroundDOM=e('<div class="'+t.css.foreground+'"></div>'),i.append(this.foregroundDOM)};a.prototype=Object.create(r.ResultsScreen.prototype),n.registerComponent("screen.results",a,1)}),define("vas-basic/components/nav_mini",["core/registry","core/base/components","core/ui"],function(e,t,n){var r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAQAAAD9CzEMAAAACXBIWXMAAABIAAAASABGyWs+AAAACXZwQWcAAAAwAAAAMADO7oxXAAAAAmJLR0QA/4ePzL8AAASiSURBVFjD7VdtTFNXGC4tTr4MrSTb1C0yKLDtz3QzZIEFlyybEWTOSZQ5R4cM3YC5/dhNRJchDFGUAWNTYjPqpKx82Mm4VCgOEaIhQPmsqCBlsIwJMRBGOz609Jzdc+4BLtyGWwj7x3nyPu193of3aU57Lq1ItLpW1+pa0qr0NhwyKCo3/i/Dtc6NCZNmG7DB8ZHbUVrxCo/XeXVprMAKH1ufTFvhE1tnrm7dCo6/Hjh4bwpMgT/u71bEhT00oed/NelfWpHhJc6348Ys43Dcdo32CXaRiEQxm+p/GwfjcGS4NrKY2apKeVuaMcuY1ZFZu0vptMTxZeuNBWZggSNjSaelPjPqHhfVsdEJMzBPt2SXeZoaLNACkeufx6mvLGl8xba+u6NgFHR1hyrcPbmdYKfEt/p6ca9haBg9svhyn8PDCyU3Px00D8NhQOt830BbIxLpg1suNp+veI11RD1XSw8D5GCKcPx+B8dflRnyh8AQGDB/ky7zRUrRU3WJDycZDQ5YauKLnZEW7pp3/O8JpDHAHOdYQPmr9+4MgAHY8SA02l2KA59uLkUKLoYb869iPUR8/O37fayG+DPhgF8kVbGmsX7QD7TXfENc8Culg+72IIULo7FsC/sX0c9X62ZUwS0qkd66ZLL1wm7LibMyOVIKnPUJ3f/2QhPohfO5a7QiSo1P9Huuyq8fTCKtplL9zGI7v7XZ2AW6YENPaIwb3oJiWZ0aKQzssa3mQrEH8m0XH9vR2o+01p7S1+0Ovywpj2kf6wSdoLDSbzu7NdotDXeQshjqG7UB5FO1ubwCKR2W8sNqyYLxGun1vDZbO2yxJGawW6MSlymaR9shA7Aow6ZHpXtV+ASHuf2Y1DrZDttsVcpC7r2q5OW6dgM0gBpT6CfuMvxWe1TkGmwGwKhQgJnHJqsuvcAFH0DxVztv/Yk6NxvUL8zd53+tB/Xg5yq/N13x1hS++HsjUpaCqhrNZrJV3lo9Ui6qAmbuTJcO6jup72R+6HmuU/HeG4/qYB0gJcSzV9UDRTvYebvdMk/qOyO/8JwJ2Obk9awL2bPC8GrrDcgAkBJizlX1VFoIOyVAvH6Dq5vdT9MVSg+Wj7jPBU9yEaWDGICUEM+7OnxUMEBDlUIMQEqI513FCgeoqStg+YgRDrhMaSAGIEVY2RF9OiIhIj4ifv/R5DzNxGx3nuuQcICKyocYgBTmnMaNgWtnj7+/JPlAvo10Oa58+LFwwE+UCvCxJ9Z93r/zU855rfZ8CuEAJaWEGIAU5rAgno8mXY5LCT8SDsilLgA+wnm34Fzanu+gcMB5KgdiAFKYd/ECztOky3HlwA+FA36gsiAGIIWZH5BDky7HlQUPCAd8T52DGIAU5jBeQDZNuhzXOfiBcEAWdQbwwQ/IpO35IoUDso+kQYRTgC2WQ3kBGTTb5brS4Puxwu+Bf+rUt5ABIIWZH3CWJl2OK3Vsa6ADX7vOJJ8EC7GTF5BOL/QkTysy1jnyq2Hfmtgjya0pgylDc3iH98rS1dx+ymBS87snPDc5/NV3g1Tu4yefgVzu5bnQEST1l885fOUe3mvXrP6KXdb6D5CDZ2hqP2zJAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDEwLTAyLTExVDEyOjUwOjE4LTA2OjAwp3AJqwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAwOS0xMC0yMlQyMzozNzoxMC0wNTowMAJwBy8AAAAASUVORK5CYII=",i=function(e){t.Nav.call(this,e);var n=$('<a href="javascript:;"><img src="'+r+'" alt="Home" /></a>');e.append(n),e.click(function(e){e.preventDefault(),e.stopPropagation(),this.trigger("changeScreen","screen.home")}.bind(this))};i.prototype=Object.create(t.Nav.prototype),i.prototype.onPageWillChange=function(e,t){t=="screen.tuning"||t=="screen.running"||t=="screen.explain"?this.hostDOM.fadeIn():this.hostDOM.fadeOut()},e.registerComponent("nav.mini",i,1)}),define("popcorn",[],function(){(function(e,t){function n(e){m.put.call(this,e)}function r(e){this.parent=e,this.byStart=[{start:-1,end:-1}],this.byEnd=[{start:-1,end:-1}],this.animating=[],this.endIndex=this.startIndex=0,this.previousUpdateTime=-1,this.count=1}function i(e,t){return function(){if(g.plugin.debug)return e.apply(this,arguments);try{return e.apply(this,arguments)}catch(n){g.plugin.errors.push({plugin:t,thrown:n,source:e.toString()}),this.emit("pluginerror",g.plugin.errors)}}}if(t.addEventListener){var s=Array.prototype,o=Object.prototype,u=s.forEach,a=s.slice,f=o.hasOwnProperty,l=o.toString,c=e.Popcorn,h=[],p=!1,d={events:{hash:{},apis:{}}},v=function(){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,16)}}(),m={put:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}},g=function(e,t){return new g.p.init(e,t||null)};g.version="1.5.6",g.isSupported=!0,g.instances=[],g.p=g.prototype={init:function(e,n){var i,s=this;if(typeof e!="function"){if(typeof e=="string")try{i=t.querySelector(e)}catch(u){throw Error("Popcorn.js Error: Invalid media element selector: "+e)}this.media=i||e,i=this.media.nodeName&&this.media.nodeName.toLowerCase()||"video",this[i]=this.media,this.options=g.extend({},n)||{},this.id=this.options.id||g.guid(i);if(g.byId(this.id))throw Error("Popcorn.js Error: Cannot use duplicate ID ("+this.id+")");this.isDestroyed=!1,this.data={running:{cue:[]},timeUpdate:g.nop,disabled:{},events:{},hooks:{},history:[],state:{volume:this.media.volume},trackRefs:{},trackEvents:new r(this)},g.instances.push(this);var a=function(){s.media.currentTime<0&&(s.media.currentTime=0),s.media.removeEventListener("loadedmetadata",a,!1);var e,t,n,r,i;e=s.media.duration,e=e!=e?Number.MAX_VALUE:e+1,g.addTrackEvent(s,{start:e,end:e}),s.isDestroyed||(s.data.durationChange=function(){var e=s.media.duration,t=e+1,n=s.data.trackEvents.byStart,r=s.data.trackEvents.byEnd;n.pop(),r.pop();for(var i=r.length-1;i>0;i--)r[i].end>e&&s.removeTrackEvent(r[i]._id);for(r=0;r<n.length;r++)n[r].end>e&&s.removeTrackEvent(n[r]._id);s.data.trackEvents.byEnd.push({start:t,end:t}),s.data.trackEvents.byStart.push({start:t,end:t})},s.media.addEventListener("durationchange",s.data.durationChange,!1)),s.options.frameAnimation?(s.data.timeUpdate=function(){g.timeUpdate(s,{}),g.forEach(g.manifest,function(e,o){if(t=s.data.running[o]){r=t.length;for(var u=0;u<r;u++)n=t[u],(i=n._natives)&&i.frame&&i.frame.call(s,{},n,s.currentTime())}}),s.emit("timeupdate"),!s.isDestroyed&&v(s.data.timeUpdate)},!s.isDestroyed&&v(s.data.timeUpdate)):(s.data.timeUpdate=function(e){g.timeUpdate(s,e)},s.isDestroyed||s.media.addEventListener("timeupdate",s.data.timeUpdate,!1))};return s.media.addEventListener("error",function(){s.error=s.media.error},!1),s.media.readyState>=1?a():s.media.addEventListener("loadedmetadata",a,!1),this}if(t.readyState==="complete")e(t,g);else{h.push(e);if(!p){p=!0;var o=function(){t.removeEventListener("DOMContentLoaded",o,!1);for(var e=0,n=h.length;e<n;e++)h[e].call(t,g);h=null};t.addEventListener("DOMContentLoaded",o,!1)}}}},g.p.init.prototype=g.p,g.byId=function(e){for(var t=g.instances,n=t.length,r=0;r<n;r++)if(t[r].id===e)return t[r];return null},g.forEach=function(e,t,n){if(!e||!t)return{};n=n||this;var r,i;if(u&&e.forEach===u)return e.forEach(t,n);if(l.call(e)==="[object NodeList]"){r=0;for(i=e.length;r<i;r++)t.call(n,e[r],r,e);return e}for(r in e)f.call(e,r)&&t.call(n,e[r],r,e);return e},g.extend=function(e){var t=a.call(arguments,1);return g.forEach(t,function(t){for(var n in t)e[n]=t[n]}),e},g.extend(g,{noConflict:function(t){return t&&(e.Popcorn=c),g},error:function(e){throw Error(e)},guid:function(e){return g.guid.counter++,(e?e:"")+(+(new Date)+g.guid.counter)},sizeOf:function(e){var t=0,n;for(n in e)t++;return t},isArray:Array.isArray||function(e){return l.call(e)==="[object Array]"},nop:function(){},position:function(n){if(!n.parentNode)return null;n=n.getBoundingClientRect();var r={},i=t.documentElement,s=t.body,o,u,a;o=i.clientTop||s.clientTop||0,u=i.clientLeft||s.clientLeft||0,a=e.pageYOffset&&i.scrollTop||s.scrollTop,i=e.pageXOffset&&i.scrollLeft||s.scrollLeft,o=Math.ceil(n.top+a-o),u=Math.ceil(n.left+i-u);for(var f in n)r[f]=Math.round(n[f]);return g.extend({},r,{top:o,left:u})},disable:function(e,t){if(!e.data.disabled[t]){e.data.disabled[t]=!0;if(t in g.registryByName&&e.data.running[t])for(var n=e.data.running[t].length-1,r;n>=0;n--)r=e.data.running[t][n],r._natives.end.call(e,null,r),e.emit("trackend",g.extend({},r,{plugin:r.type,type:"trackend"}));return e}},enable:function(e,t){if(e.data.disabled[t]){e.data.disabled[t]=!1;if(t in g.registryByName&&e.data.running[t])for(var n=e.data.running[t].length-1,r;n>=0;n--)r=e.data.running[t][n],r._natives.start.call(e,null,r),e.emit("trackstart",g.extend({},r,{plugin:r.type,type:"trackstart",track:r}));return e}},destroy:function(e){var t=e.data.events,n=e.data.trackEvents,r,i,s,o;for(i in t){r=t[i];for(s in r)delete r[s];t[i]=null}for(o in g.registryByName)g.removePlugin(e,o);n.byStart.length=0,n.byEnd.length=0,e.isDestroyed||(e.data.timeUpdate&&e.media.removeEventListener("timeupdate",e.data.timeUpdate,!1),e.isDestroyed=!0),g.instances.splice(g.instances.indexOf(e),1)}}),g.guid.counter=1,g.extend(g.p,function(){var e={};return g.forEach("load play pause currentTime playbackRate volume duration preload playbackRate autoplay loop controls muted buffered readyState seeking paused played seekable ended".split(/\s+/g),function(t){e[t]=function(e){var n;return typeof this.media[t]=="function"?(e!=null&&/play|pause/.test(t)&&(this.media.currentTime=g.util.toSeconds(e)),this.media[t](),this):e!=null?(n=this.media[t],this.media[t]=e,n!==e&&this.emit("attrchange",{attribute:t,previousValue:n,currentValue:e}),this):this.media[t]}}),e}()),g.forEach("enable disable".split(" "),function(e){g.p[e]=function(t){return g[e](this,t)}}),g.extend(g.p,{roundTime:function(){return Math.round(this.media.currentTime)},exec:function(e,t,r){var i=arguments.length,s="trackadded",o,u;try{u=g.util.toSeconds(e)}catch(a){}typeof u=="number"&&(e=u);if(typeof e=="number"&&i===2)r=t,t=e,e=g.guid("cue");else if(i===1)t=-1;else if(o=this.getTrackEvent(e))this.data.trackEvents.remove(e),n.end(this,o),g.removeTrackEvent.ref(this,e),s="cuechange",typeof e=="string"&&i===2&&(typeof t=="number"&&(r=o._natives.start),typeof t=="function"&&(r=t,t=o.start));else if(i>=2){if(typeof t=="string"){try{u=g.util.toSeconds(t)}catch(f){}t=u}typeof t=="number"&&(r=r||g.nop()),typeof t=="function"&&(r=t,t=-1)}return i={id:e,start:t,end:t+1,_running:!1,_natives:{start:r||g.nop,end:g.nop,type:"cue"}},o&&(i=g.extend(o,i)),s==="cuechange"?(i._id=i.id||i._id||g.guid(i._natives.type),this.data.trackEvents.add(i),n.start(this,i),this.timeUpdate(this,null,!0),g.addTrackEvent.ref(this,i),this.emit(s,g.extend({},i,{id:e,type:s,previousValue:{time:o.start,fn:o._natives.start},currentValue:{time:t,fn:r||g.nop},track:o}))):g.addTrackEvent(this,i),this},mute:function(e){return e=e==null||e===!0?"muted":"unmuted",e==="unmuted"&&(this.media.muted=!1,this.media.volume=this.data.state.volume),e==="muted"&&(this.data.state.volume=this.media.volume,this.media.muted=!0),this.emit(e),this},unmute:function(e){return this.mute(e==null?!1:!e)},position:function(){return g.position(this.media)},toggle:function(e){return g[this.data.disabled[e]?"enable":"disable"](this,e)},defaults:function(e,t){return g.isArray(e)?(g.forEach(e,function(e){for(var t in e)this.defaults(t,e[t])},this),this):(this.options.defaults||(this.options.defaults={}),this.options.defaults[e]||(this.options.defaults[e]={}),g.extend(this.options.defaults[e],t),this)}}),g.Events={UIEvents:"blur focus focusin focusout load resize scroll unload",MouseEvents:"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave click dblclick",Events:"loadstart progress suspend emptied stalled play pause error loadedmetadata loadeddata waiting playing canplay canplaythrough seeking seeked timeupdate ended ratechange durationchange volumechange"},g.Events.Natives=g.Events.UIEvents+" "+g.Events.MouseEvents+" "+g.Events.Events,d.events.apiTypes=["UIEvents","MouseEvents","Events"],function(e,t){for(var n=d.events.apiTypes,r=e.Natives.split(/\s+/g),i=0,s=r.length;i<s;i++)t.hash[r[i]]=!0;n.forEach(function(n){t.apis[n]={};for(var r=e[n].split(/\s+/g),i=r.length,s=0;s<i;s++)t.apis[n][r[s]]=!0})}(g.Events,d.events),g.events={isNative:function(e){return!!d.events.hash[e]},getInterface:function(e){if(!g.events.isNative(e))return!1;var t=d.events,n=t.apiTypes;t=t.apis;for(var r=0,i=n.length,s,o;r<i;r++){o=n[r];if(t[o][e]){s=o;break}}return s},all:g.Events.Natives.split(/\s+/g),fn:{trigger:function(n,r){var i,s=this.data.events[n];if(s){if(i=g.events.getInterface(n))return i=t.createEvent(i),i.initEvent(n,!0,!0,e,1),this.media.dispatchEvent(i),this;for(i=s.slice();i.length;)i.shift().call(this,r)}return this},listen:function(e,t){var n=this,r=!0,i=g.events.hooks[e],s,o;if(typeof t!="function")throw Error("Popcorn.js Error: Listener is not a function");return this.data.events[e]||(this.data.events[e]=[],r=!1),i&&(i.add&&i.add.call(this,{},t),i.bind&&(e=i.bind),i.handler&&(o=t,t=function(e){i.handler.call(n,e,o)}),r=!0,this.data.events[e]||(this.data.events[e]=[],r=!1)),this.data.events[e].push(t),!r&&g.events.all.indexOf(e)>-1&&this.media.addEventListener(e,function(t){if(n.data.events[e])for(s=n.data.events[e].slice();s.length;)s.shift().call(n,t)},!1),this},unlisten:function(e,t){var n,r=this.data.events[e];if(r){if(typeof t=="string"){for(n=0;n<r.length;n++)r[n].name===t&&r.splice(n--,1);return this}if(typeof t=="function"){for(;n!==-1;)n=r.indexOf(t),n!==-1&&r.splice(n,1);return this}return this.data.events[e]=null,this}}},hooks:{canplayall:{bind:"canplaythrough",add:function(e,t){var n=!1;this.media.readyState&&(setTimeout(function(){t.call(this,e)}.bind(this),0),n=!0),this.data.hooks.canplayall={fired:n}},handler:function(e,t){this.data.hooks.canplayall.fired||(t.call(this,e),this.data.hooks.canplayall.fired=!0)}}}},g.forEach([["trigger","emit"],["listen","on"],["unlisten","off"]],function(e){g.p[e[0]]=g.p[e[1]]=g.events.fn[e[0]]}),n.start=function(e,t){t.end>e.media.currentTime&&t.start<=e.media.currentTime&&!t._running&&(t._running=!0,e.data.running[t._natives.type].push(t),e.data.disabled[t._natives.type]||(t._natives.start.call(e,null,t),e.emit("trackstart",g.extend({},t,{plugin:t._natives.type,type:"trackstart",track:t}))))},n.end=function(e,t){var n;(t.end<=e.media.currentTime||t.start>e.media.currentTime)&&t._running&&(n=e.data.running[t._natives.type],t._running=!1,n.splice(n.indexOf(t),1),e.data.disabled[t._natives.type]||(t._natives.end.call(e,null,t),e.emit("trackend",g.extend({},t,{plugin:t._natives.type,type:"trackend",track:t}))))},r.prototype.where=function(e){return(this.parent.getTrackEvents()||[]).filter(function(t){var n,r;if(!e)return!0;for(n in e){r=e[n];if(t[n]&&t[n]===r||t._natives[n]&&t._natives[n]===r)return!0}return!1})},r.prototype.add=function(e){var t=this.byStart,n=this.byEnd,r;e&&e._id&&this.parent.data.history.push(e._id),e.start=g.util.toSeconds(e.start,this.parent.options.framerate),e.end=g.util.toSeconds(e.end,this.parent.options.framerate);for(r=t.length-1;r>=0;r--)if(e.start>=t[r].start){t.splice(r+1,0,e);break}for(t=n.length-1;t>=0;t--)if(e.end>n[t].end){n.splice(t+1,0,e);break}r<=this.parent.data.trackEvents.startIndex&&e.start<=this.parent.data.trackEvents.previousUpdateTime&&this.parent.data.trackEvents.startIndex++,t<=this.parent.data.trackEvents.endIndex&&e.end<this.parent.data.trackEvents.previousUpdateTime&&this.parent.data.trackEvents.endIndex++,this.count++},r.prototype.remove=function(e){e instanceof n&&(e=e.id);if(typeof e=="object")return this.where(e).forEach(function(e){this.removeTrackEvent(e._id)},this.parent),this;var t,r,i;i=this.byStart.length;for(var s=0,o=0,u=[],a=[],f=[],l=[];--i>-1;)t=this.byStart[s],r=this.byEnd[s],t._id||(u.push(t),a.push(r)),t._id&&(t._id!==e&&u.push(t),r._id!==e&&a.push(r),t._id===e&&(o=s)),s++;i=this.animating.length,s=0;if(i)for(;--i>-1;)t=this.animating[s],t._id||f.push(t),t._id&&t._id!==e&&f.push(t),s++;o<=this.startIndex&&this.startIndex--,o<=this.endIndex&&this.endIndex--,this.byStart=u,this.byEnd=a,this.animating=f,this.count--,i=this.parent.data.history.length;for(s=0;s<i;s++)this.parent.data.history[s]!==e&&l.push(this.parent.data.history[s]);this.parent.data.history=l},g.addTrackEvent=function(e,t){var r;t instanceof n||((t=new n(t))&&t._natives&&t._natives.type&&e.options.defaults&&e.options.defaults[t._natives.type]&&(r=g.extend({},t),g.extend(t,e.options.defaults[t._natives.type],r)),t._natives&&(t._id=t.id||t._id||g.guid(t._natives.type),t._natives._setup&&(t._natives._setup.call(e,t),e.emit("tracksetup",g.extend({},t,{plugin:t._natives.type,type:"tracksetup",track:t})))),e.data.trackEvents.add(t),n.start(e,t),this.timeUpdate(e,null,!0),t._id&&g.addTrackEvent.ref(e,t),e.emit("trackadded",g.extend({},t,t._natives?{plugin:t._natives.type}:{},{type:"trackadded",track:t})))},g.addTrackEvent.ref=function(e,t){return e.data.trackRefs[t._id]=t,e},g.removeTrackEvent=function(e,t){var n=e.getTrackEvent(t);n&&(n._natives._teardown&&n._natives._teardown.call(e,n),e.data.trackEvents.remove(t),g.removeTrackEvent.ref(e,t),n._natives&&e.emit("trackremoved",g.extend({},n,{plugin:n._natives.type,type:"trackremoved",track:n})))},g.removeTrackEvent.ref=function(e,t){return delete e.data.trackRefs[t],e},g.getTrackEvents=function(e){var t=[];e=e.data.trackEvents.byStart;for(var n=e.length,r=0,i;r<n;r++)i=e[r],i._id&&t.push(i);return t},g.getTrackEvents.ref=function(e){return e.data.trackRefs},g.getTrackEvent=function(e,t){return e.data.trackRefs[t]},g.getTrackEvent.ref=function(e,t){return e.data.trackRefs[t]},g.getLastTrackEventId=function(e){return e.data.history[e.data.history.length-1]},g.timeUpdate=function(e,t){var n=e.media.currentTime,r=e.data.trackEvents.previousUpdateTime,i=e.data.trackEvents,s=i.endIndex,o=i.startIndex,u=i.byStart.length,a=i.byEnd.length,f=g.registryByName,l,c,h;if(r<=n){for(;i.byEnd[s]&&i.byEnd[s].end<=n;){l=i.byEnd[s],c=(r=l._natives)&&r.type;if(!(!r||f[c]||e[c])){g.removeTrackEvent(e,l._id);return}l._running===!0&&(l._running=!1,h=e.data.running[c],h.splice(h.indexOf(l),1),e.data.disabled[c]||(r.end.call(e,t,l),e.emit("trackend",g.extend({},l,{plugin:c,type:"trackend",track:l})))),s++}for(;i.byStart[o]&&i.byStart[o].start<=n;){l=i.byStart[o],c=(r=l._natives)&&r.type;if(!(!r||f[c]||e[c])){g.removeTrackEvent(e,l._id);return}l.end>n&&l._running===!1&&(l._running=!0,e.data.running[c].push(l),e.data.disabled[c]||(r.start.call(e,t,l),e.emit("trackstart",g.extend({},l,{plugin:c,type:"trackstart",track:l})))),o++}}else if(r>n){for(;i.byStart[o]&&i.byStart[o].start>n;){l=i.byStart[o],c=(r=l._natives)&&r.type;if(!(!r||f[c]||e[c])){g.removeTrackEvent(e,l._id);return}l._running===!0&&(l._running=!1,h=e.data.running[c],h.splice(h.indexOf(l),1),e.data.disabled[c]||(r.end.call(e,t,l),e.emit("trackend",g.extend({},l,{plugin:c,type:"trackend",track:l})))),o--}for(;i.byEnd[s]&&i.byEnd[s].end>n;){l=i.byEnd[s],c=(r=l._natives)&&r.type;if(!(!r||f[c]||e[c])){g.removeTrackEvent(e,l._id);return}l.start<=n&&l._running===!1&&(l._running=!0,e.data.running[c].push(l),e.data.disabled[c]||(r.start.call(e,t,l),e.emit("trackstart",g.extend({},l,{plugin:c,type:"trackstart",track:l})))),s--}}i.endIndex=s,i.startIndex=o,i.previousUpdateTime=n,i.byStart.length<u&&i.startIndex--,i.byEnd.length<a&&i.endIndex--},g.extend(g.p,{getTrackEvents:function(){return g.getTrackEvents.call(null,this)},getTrackEvent:function(e){return g.getTrackEvent.call(null,this,e)},getLastTrackEventId:function(){return g.getLastTrackEventId.call(null,this)},removeTrackEvent:function(e){return g.removeTrackEvent.call(null,this,e),this},removePlugin:function(e){return g.removePlugin.call(null,this,e),this},timeUpdate:function(e){return g.timeUpdate.call(null,this,e),this},destroy:function(){return g.destroy.call(null,this),this}}),g.manifest={},g.registry=[],g.registryByName={},g.plugin=function(e,t,r){if(!(g.protect.natives.indexOf(e.toLowerCase())>=0)){var s=typeof t=="function",o=["start","end","type","manifest"],u=["_setup","_teardown","start","end","frame"],l={},c=function(e,t){return e=e||g.nop,t=t||g.nop,function(){e.apply(this,arguments),t.apply(this,arguments)}};g.manifest[e]=r=r||t.manifest||{},u.forEach(function(n){t[n]=i(t[n]||g.nop,e)});var h=function(t,i){if(!i)return this;if(i.ranges&&g.isArray(i.ranges))return g.forEach(i.ranges,function(t){t=g.extend({},i,t),delete t.ranges,this[e](t)},this),this;var s=i._natives={},l="",h;return g.extend(s,t),i._natives.type=i._natives.plugin=e,i._running=!1,s.start=s.start||s["in"],s.end=s.end||s.out,i.once&&(s.end=c(s.end,function(){this.removeTrackEvent(i._id)})),s._teardown=c(function(){var e=a.call(arguments),t=this.data.running[s.type];e.unshift(null),e[1]._running&&t.splice(t.indexOf(i),1)&&s.end.apply(this,e),e[1]._running=!1,this.emit("trackend",g.extend({},i,{plugin:s.type,type:"trackend",track:g.getTrackEvent(this,i.id||i._id)}))},s._teardown),s._teardown=c(s._teardown,function(){this.emit("trackteardown",g.extend({},i,{plugin:e,type:"trackteardown",track:g.getTrackEvent(this,i.id||i._id)}))}),i.compose=i.compose||[],typeof i.compose=="string"&&(i.compose=i.compose.split(" ")),i.effect=i.effect||[],typeof i.effect=="string"&&(i.effect=i.effect.split(" ")),i.compose=i.compose.concat(i.effect),i.compose.forEach(function(e){l=g.compositions[e]||{},u.forEach(function(e){s[e]=c(s[e],l[e])})}),i._natives.manifest=r,"start"in i||(i.start=i["in"]||0),!i.end&&i.end!==0&&(i.end=i.out||Number.MAX_VALUE),f.call(i,"toString")||(i.toString=function(){var t=["start: "+i.start,"end: "+i.end,"id: "+(i.id||i._id)];return i.target!=null&&t.push("target: "+i.target),e+" ( "+t.join(", ")+" )"}),i.target||(h="options"in r&&r.options,i.target=h&&"target"in h&&h.target),!i._id&&i._natives&&(i._id=g.guid(i._natives.type)),i instanceof n?(i._natives&&(i._id=i.id||i._id||g.guid(i._natives.type),i._natives._setup&&(i._natives._setup.call(this,i),this.emit("tracksetup",g.extend({},i,{plugin:i._natives.type,type:"tracksetup",track:i})))),this.data.trackEvents.add(i),n.start(this,i),this.timeUpdate(this,null,!0),i._id&&g.addTrackEvent.ref(this,i)):g.addTrackEvent(this,i),g.forEach(t,function(e,t){o.indexOf(t)===-1&&this.on(t,e)},this),this};g.p[e]=l[e]=function(r,i){var o,u;if(r&&!i)i=r;else{if(o=this.getTrackEvent(r)){u=i;var a={},l;for(l in o)f.call(u,l)&&f.call(o,l)&&(a[l]=o[l]);return o._natives._update?(this.data.trackEvents.remove(o),f.call(i,"start")&&(o.start=i.start),f.call(i,"end")&&(o.end=i.end),n.end(this,o),s&&t.call(this,o),o._natives._update.call(this,o,i),this.data.trackEvents.add(o),n.start(this,o),o._natives.type!=="cue"&&this.emit("trackchange",{id:o.id,type:"trackchange",previousValue:a,currentValue:u,track:o}),this):(g.extend(o,i),this.data.trackEvents.remove(r),o._natives._teardown&&o._natives._teardown.call(this,o),g.removeTrackEvent.ref(this,r),s?h.call(this,t.call(this,o),o):(o._id=o.id||o._id||g.guid(o._natives.type),o._natives&&o._natives._setup&&(o._natives._setup.call(this,o),this.emit("tracksetup",g.extend({},o,{plugin:o._natives.type,type:"tracksetup",track:o}))),this.data.trackEvents.add(o),n.start(this,o),this.timeUpdate(this,null,!0),g.addTrackEvent.ref(this,o)),this.emit("trackchange",{id:o.id,type:"trackchange",previousValue:a,currentValue:o,track:o}),this)}i.id=r}return this.data.running[e]=this.data.running[e]||[],o=g.extend({},this.options.defaults&&this.options.defaults[e]||{},i),h.call(this,s?t.call(this,o):t,o),this},r&&g.extend(t,{manifest:r});var p={fn:l[e],definition:t,base:t,parents:[],name:e};return g.registry.push(g.extend(l,p,{type:e})),g.registryByName[e]=p,l}g.error("'"+e+"' is a protected function name")},g.plugin.errors=[],g.plugin.debug=g.version==="1.5.6",g.removePlugin=function(e,t){if(!t){t=e,e=g.p;if(g.protect.natives.indexOf(t.toLowerCase())>=0){g.error("'"+t+"' is a protected function name");return}var n=g.registry.length,r;for(r=0;r<n;r++)if(g.registry[r].name===t){g.registry.splice(r,1),delete g.registryByName[t],delete g.manifest[t],delete e[t];return}}n=e.data.trackEvents.byStart,r=e.data.trackEvents.byEnd;var i=e.data.trackEvents.animating,s,o;s=0;for(o=n.length;s<o;s++)n[s]&&n[s]._natives&&n[s]._natives.type===t&&(n[s]._natives._teardown&&n[s]._natives._teardown.call(e,n[s]),n.splice(s,1),s--,o--,e.data.trackEvents.startIndex<=s&&(e.data.trackEvents.startIndex--,e.data.trackEvents.endIndex--)),r[s]&&r[s]._natives&&r[s]._natives.type===t&&r.splice(s,1);s=0;for(o=i.length;s<o;s++)i[s]&&i[s]._natives&&i[s]._natives.type===t&&(i.splice(s,1),s--,o--)},g.compositions={},g.compose=function(e,t,n){g.manifest[e]=n||t.manifest||{},g.compositions[e]=t},g.plugin.effect=g.effect=g.compose;var y=/^(?:\.|#|\[)/;g.dom={debug:!1,find:function(e,n){var r=null;n=n||t;if(e){if(!y.test(e)){r=t.getElementById(e);if(r!==null)return r}try{r=n.querySelector(e)}catch(i){if(g.dom.debug)throw Error(i)}}return r}};var b=/\?/,w={ajax:null,url:"",data:"",dataType:"",success:g.nop,type:"GET",async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8"};g.xhr=function(e){e.dataType=e.dataType&&e.dataType.toLowerCase()||null;if(!e.dataType||e.dataType!=="jsonp"&&e.dataType!=="script"){e=g.extend({},w,e),e.ajax=new XMLHttpRequest;if(e.ajax)return e.type==="GET"&&e.data&&(e.url+=(b.test(e.url)?"&":"?")+e.data,e.data=null),e.ajax.open(e.type,e.url,e.async),e.type==="POST"&&e.ajax.setRequestHeader("Content-Type",e.contentType),e.ajax.send(e.data||null),g.xhr.httpData(e)}else g.xhr.getJSONP(e.url,e.success,e.dataType==="script")},g.xhr.httpData=function(e){var t,n=null,r,i=null;return e.ajax.onreadystatechange=function(){if(e.ajax.readyState===4){try{n=JSON.parse(e.ajax.responseText)}catch(s){}t={xml:e.ajax.responseXML,text:e.ajax.responseText,json:n};if(!t.xml||!t.xml.documentElement){t.xml=null;try{r=new DOMParser,i=r.parseFromString(e.ajax.responseText,"text/xml"),i.getElementsByTagName("parsererror").length||(t.xml=i)}catch(o){}}e.dataType&&(t=t[e.dataType]),e.success.call(e.ajax,t)}},t},g.xhr.getJSONP=function(e,n,r){var i=t.head||t.getElementsByTagName("head")[0]||t.documentElement,s=t.createElement("script"),o=!1,u=[];u=/(=)\?(?=&|$)|\?\?/;var a,f;r||(f=e.match(/(callback=[^&]*)/),f!==null&&f.length?(u=f[1].split("=")[1],u==="?"&&(u="jsonp"),a=g.guid(u),e=e.replace(/(callback=[^&]*)/,"callback="+a)):(a=g.guid("jsonp"),u.test(e)&&(e=e.replace(u,"$1"+a)),u=e.split(/\?(.+)?/),e=u[0]+"?",u[1]&&(e+=u[1]+"&"),e+="callback="+a),window[a]=function(e){n&&n(e),o=!0}),s.addEventListener("load",function(){r&&n&&n(),o&&delete window[a],i.removeChild(s)},!1),s.addEventListener("error",function(e){n&&n({error:e}),r||delete window[a],i.removeChild(s)},!1),s.src=e,i.insertBefore(s,i.firstChild)},g.getJSONP=g.xhr.getJSONP,g.getScript=g.xhr.getScript=function(e,t){return g.xhr.getJSONP(e,t,!0)},g.util={toSeconds:function(e,t){var n=/^([0-9]+:){0,2}[0-9]+([.;][0-9]+)?$/,r,i,s;return typeof e=="number"?e:(typeof e=="string"&&!n.test(e)&&g.error("Invalid time format"),n=e.split(":"),r=n.length-1,i=n[r],i.indexOf(";")>-1&&(i=i.split(";"),s=0,t&&typeof t=="number"&&(s=parseFloat(i[1],10)/t),n[r]=parseInt(i[0],10)+s),r=n[0],{1:parseFloat(r,10),2:parseInt(r,10)*60+parseFloat(n[1],10),3:parseInt(r,10)*3600+parseInt(n[1],10)*60+parseFloat(n[2],10)}[n.length||1])}},g.p.cue=g.p.exec,g.protect={natives:function(e){return Object.keys?Object.keys(e):function(e){var t,n=[];for(t in e)f.call(e,t)&&n.push(t);return n}(e)}(g.p).map(function(e){return e.toLowerCase()})},g.forEach({listen:"on",unlisten:"off",trigger:"emit",exec:"cue"},function(e,t){var n=g.p[t];g.p[t]=function(){return typeof console!="undefined"&&console.warn&&(console.warn("Deprecated method '"+t+"', "+(e==null?"do not use.":"use '"+e+"' instead.")),g.p[t]=n),g.p[e].apply(this,[].slice.call(arguments))}}),e.Popcorn=g}else{e.Popcorn={isSupported:!1};for(s="byId forEach extend effects error guid sizeOf isArray nop position disable enable destroyaddTrackEvent removeTrackEvent getTrackEvents getTrackEvent getLastTrackEventId timeUpdate plugin removePlugin compose effect xhr getJSONP getScript".split(/\s+/);s.length;)e.Popcorn[s.shift()]=function(){}}})(window,window.document),function(e,t){var n=e.document,r=e.location,i=/:\/\//,s=r.href.replace(r.href.split("/").slice(-1)[0],""),o=function(e,t,n){e=e||0,t=(t||e||0)+1,n=n||1,t=Math.ceil((t-e)/n)||0;var r=0,i=[];for(i.length=t;r<t;)i[r++]=e,e+=n;return i};t.sequence=function(e,n){return new t.sequence.init(e,n)},t.sequence.init=function(e,r){this.parent=n.getElementById(e),this.seqId=t.guid("__sequenced"),this.queue=[],this.playlist=[],this.inOuts={ofVideos:[],ofClips:[]},this.dims={width:0,height:0},this.active=0,this.playing=this.cycling=!1,this.times={last:0},this.events={};var o=this,u=0;return t.forEach(r,function(r,u){var a=n.createElement("video");a.preload="auto",a.controls=!0,a.style.display=u&&"none"||"",a.id=o.seqId+"-"+u,o.queue.push(a);var f=r["in"],c=r.out;o.inOuts.ofVideos.push({"in":f!==undefined&&f||1,out:c!==undefined&&c||0}),o.inOuts.ofVideos[u].out=o.inOuts.ofVideos[u].out||o.inOuts.ofVideos[u]["in"]+2,a.src=i.test(r.src)?r.src:s+r.src,a.setAttribute("data-sequence-owner",e),a.setAttribute("data-sequence-guid",o.seqId),a.setAttribute("data-sequence-id",u),a.setAttribute("data-sequence-clip",[o.inOuts.ofVideos[u]["in"],o.inOuts.ofVideos[u].out].join(":")),o.parent.appendChild(a),o.playlist.push(t("#"+a.id))}),o.inOuts.ofVideos.forEach(function(e){e={"in":u,out:u+(e.out-e["in"])},o.inOuts.ofClips.push(e),u=e.out+1}),t.forEach(this.queue,function(e,n){function r(){return n||(o.dims.width=e.videoWidth,o.dims.height=e.videoHeight),e.currentTime=o.inOuts.ofVideos[n]["in"]-.5,e.removeEventListener("canplaythrough",r,!1),!0}e.addEventListener("canplaythrough",r,!1),e.addEventListener("play",function(){o.playing=!0},!1),e.addEventListener("pause",function(){o.playing=!1},!1),e.addEventListener("timeupdate",function(n){n=n.srcElement||n.target,n=+(n.dataset&&n.dataset.sequenceId||n.getAttribute("data-sequence-id"));var r=Math.floor(e.currentTime);o.times.last!==r&&n===o.active&&(o.times.last=r,r===o.inOuts.ofVideos[n].out&&t.sequence.cycle.call(o,n))},!1)}),this},t.sequence.init.prototype=t.sequence.prototype,t.sequence.cycle=function(e){this.queue||t.error("Popcorn.sequence.cycle is not a public method");var n=this.queue,r=this.inOuts.ofVideos,i=n[e],s=0,o;return n[e+1]&&(s=e+1),n[e+1]?(n=n[s],r=r[s],t.extend(n,{width:this.dims.width,height:this.dims.height}),o=this.playlist[s],i.pause(),this.active=s,this.times.last=r["in"]-1,o.currentTime(r["in"]),o[s?"play":"pause"](),this.trigger("cycle",{position:{previous:e,current:s}}),s&&(i.style.display="none",n.style.display=""),this.cycling=!1):this.playlist[e].pause(),this};var u=["timeupdate","play","pause"];t.extend(t.sequence.prototype,{eq:function(e){return this.playlist[e]},remove:function(){this.parent.innerHTML=null},clip:function(e){return this.inOuts.ofVideos[e]},duration:function(){for(var e=0,t=this.inOuts.ofClips,n=0;n<t.length;n++)e+=t[n].out-t[n]["in"]+1;return e-1},play:function(){return this.playlist[this.active].play(),this},exec:function(e,n){var r=this.active;return this.inOuts.ofClips.forEach(function(t,n){e>=t["in"]&&e<=t.out&&(r=n)}),e+=this.inOuts.ofVideos[r]["in"]-this.inOuts.ofClips[r]["in"],t.addTrackEvent(this.playlist[r],{start:e-1,end:e,_running:!1,_natives:{start:n||t.nop,end:t.nop,type:"exec"}}),this},listen:function(e,n){var r=this,i=this.playlist,s=i.length,o=0;return n||(n=t.nop),t.Events.Natives.indexOf(e)>-1?t.forEach(i,function(t){t.listen(e,function(i){i.active=r,u.indexOf(e)>-1?n.call(t,i):++o===s&&n.call(t,i)})}):(this.events[e]||(this.events[e]={}),i=n.name||t.guid("__"+e),this.events[e][i]=n),this},unlisten:function(){},trigger:function(e,n){var r=this;if(!(t.Events.Natives.indexOf(e)>-1))return this.events[e]&&t.forEach(this.events[e],function(t){t.call(r,{type:e},n)}),this}}),t.forEach(t.manifest,function(e,n){t.sequence.prototype[n]=function(e){var r={},i=[],s,u,a,f,l;for(s=0;s<this.inOuts.ofClips.length;s++)i=this.inOuts.ofClips[s],u=o(i["in"],i.out),a=u.indexOf(e.start),f=u.indexOf(e.end),a>-1&&(r[s]=t.extend({},i,{start:u[a],clipIdx:a})),f>-1&&(r[s]=t.extend({},i,{end:u[f],clipIdx:f}));s=Object.keys(r).map(function(e){return+e}),i=o(s[0],s[1]);for(s=0;s<i.length;s++){a={},f=i[s];var c=r[f];c?(l=this.inOuts.ofVideos[f],u=c.clipIdx,l=o(l["in"],l.out),c.start&&(a.start=l[u],a.end=l[l.length-1]),c.end&&(a.start=l[0],a.end=l[u])):(a.start=this.inOuts.ofVideos[f]["in"],a.end=this.inOuts.ofVideos[f].out),this.playlist[f][n](t.extend({},e,a))}return this}})}(this,Popcorn),function(e,t){function n(e){e=typeof e=="string"?e:[e.language,e.region].join("-");var t=e.split("-");return{iso6391:e,language:t[0]||"",region:t[1]||""}}var r=e.navigator,i=n(r.userLanguage||r.language);t.locale={get:function(){return i},set:function(e){return i=n(e),t.locale.broadcast(),i},broadcast:function(e){var n=t.instances,r=n.length,i=0,s;for(e=e||"locale:changed";i<r;i++)s=n[i],e in s.data.events&&s.trigger(e)}}}(this,this.Popcorn),function(e){document.addEventListener("DOMContentLoaded",function(){var t=document.querySelectorAll("[data-timeline-sources]");e.forEach(t,function(n,r){var i=t[r],s,o,u;i.id||(i.id=e.guid("__popcorn")),i.nodeType&&i.nodeType===1&&(u=e("#"+i.id),s=(i.getAttribute("data-timeline-sources")||"").split(","),s[0]&&e.forEach(s,function(e){o=e.split("!"),o.length===1&&(o=e.match(/(.*)[\/\\]([^\/\\]+\.\w+)$/)[2].split("."),o[0]="parse"+o[1].toUpperCase(),o[1]=e),s[0]&&u[o[0]]&&u[o[0]](o[1])}),u.autoplay()&&u.play())})},!1)}(Popcorn),function(e){var t=function(t,n){return t=t||e.nop,n=n||e.nop,function(){t.apply(this,arguments),n.apply(this,arguments)}};e.player=function(n,r){if(!e[n]){r=r||{};var i=function(n,i,s){s=s||{};var o=new Date/1e3,u=o,a=0,f=0,l=1,c=!1,h={},v=typeof n=="string"?e.dom.find(n):n,m={};Object.prototype.__defineGetter__||(m=v||document.createElement("div"));for(var g in v)g in m||(typeof v[g]=="object"?m[g]=v[g]:typeof v[g]=="function"?m[g]=function(e){return"length"in v[e]&&!v[e].call?v[e]:function(){return v[e].apply(v,arguments)}}(g):e.player.defineProperty(m,g,{get:function(e){return function(){return v[e]}}(g),set:e.nop,configurable:!0}));var y=function(){o=new Date/1e3,m.paused||(m.currentTime+=o-u,m.dispatchEvent("timeupdate"),setTimeout(y,10)),u=o};return m.play=function(){this.paused=!1,m.readyState>=4&&(u=new Date/1e3,m.dispatchEvent("play"),y())},m.pause=function(){this.paused=!0,m.dispatchEvent("pause")},e.player.defineProperty(m,"currentTime",{get:function(){return a},set:function(e){return a=+e,m.dispatchEvent("timeupdate"),a},configurable:!0}),e.player.defineProperty(m,"volume",{get:function(){return l},set:function(e){return l=+e,m.dispatchEvent("volumechange"),l},configurable:!0}),e.player.defineProperty(m,"muted",{get:function(){return c},set:function(e){return c=+e,m.dispatchEvent("volumechange"),c},configurable:!0}),e.player.defineProperty(m,"readyState",{get:function(){return f},set:function(e){return f=e},configurable:!0}),m.addEventListener=function(e,t){return h[e]||(h[e]=[]),h[e].push(t),t},m.removeEventListener=function(e,t){var n,r=h[e];if(r){for(n=h[e].length-1;n>=0;n--)t===r[n]&&r.splice(n,1);return t}},m.dispatchEvent=function(t){var n,r=t.type;if(!r){r=t;if(t=e.events.getInterface(r))n=document.createEvent(t),n.initEvent(r,!0,!0,window,1)}if(h[r])for(t=h[r].length-1;t>=0;t--)h[r][t].call(this,n,this)},m.src=i||"",m.duration=0,m.paused=!0,m.ended=0,s&&s.events&&e.forEach(s.events,function(e,t){m.addEventListener(t,e,!1)}),r._canPlayType(v.nodeName,i)!==!1?r._setup?r._setup.call(m,s):(m.readyState=4,m.dispatchEvent("loadedmetadata"),m.dispatchEvent("loadeddata"),m.dispatchEvent("canplaythrough")):setTimeout(function(){m.dispatchEvent("error")},0),n=new e.p.init(m,s),r._teardown&&(n.destroy=t(n.destroy,function(){r._teardown.call(m,s)})),n};i.canPlayType=r._canPlayType=r._canPlayType||e.nop,e[n]=e.player.registry[n]=i}},e.player.registry={},e.player.defineProperty=Object.defineProperty||function(t,n,r){t.__defineGetter__(n,r.get||e.nop),t.__defineSetter__(n,r.set||e.nop)},e.player.playerQueue=function(){var e=[],t=!1;return{next:function(){t=!1,e.shift(),e[0]&&e[0]()},add:function(n){e.push(function(){t=!0,n&&n()}),!t&&e[0]()}}},e.smart=function(t,n,r){var i=typeof t=="string"?e.dom.find(t):t,s,o,u,a,f,l="HTMLYouTubeVideoElement HTMLVimeoVideoElement HTMLSoundCloudAudioElement HTMLNullVideoElement".split(" ");if(i){n=typeof n=="string"?[n]:n,t=0;for(f=n.length;t<f;t++){s=n[t];for(o=0;o<l.length;o++)if((a=e[l[o]])&&a._canPlaySrc(s)==="probably")return u=a(i),r=e(u,r),setTimeout(function(){u.src=s},0),r;for(var c in e.player.registry)if(e.player.registry.hasOwnProperty(c)&&e.player.registry[c].canPlayType(i.nodeName,s))return e[c](i,s,r)}var h;c=e.guid("popcorn-video-"),o=document.createElement("div"),o.style.width="100%",o.style.height="100%";if(n.length===1)return h=document.createElement("video"),h.id=c,i.appendChild(h),setTimeout(function(){var e=document.createElement("div");e.innerHTML=n[0],h.src=e.firstChild.nodeValue},0),e("#"+c,r);i.appendChild(o),l='<video id="'+c+'" preload=auto autobuffer>',t=0;for(f=n.length;t<f;t++)l+='<source src="'+n[t]+'">';return l+="</video>",o.innerHTML=l,r&&r.events&&r.events.error&&i.addEventListener("error",r.events.error,!1),e("#"+c,r)}e.error("Specified target `"+t+"` was not found.")}}(Popcorn),function(e){var t=Object.prototype.hasOwnProperty;e.parsers={},e.parser=function(n,r,i){if(e.protect.natives.indexOf(n.toLowerCase())>=0)e.error("'"+n+"' is a protected function name");else{typeof r=="function"&&!i&&(i=r,r="");if(typeof i=="function"&&typeof r=="string"){var s={};return s[n]=function(n,s,o){if(!n)return this;typeof s!="function"&&!o&&(o=s,s=null);var u=this;return e.xhr({url:n,dataType:r,success:function(e){var n,r,a=0;e=i(e,o).data||[];if(n=e.length){for(;a<n;a++){r=e[a];for(var f in r)t.call(r,f)&&u[f]&&u[f](r[f])}s&&s()}}}),this},e.extend(e.p,s),s}}}}(Popcorn),function(e,t){function n(e){var t=n.options;e=t.parser[t.strictMode?"strict":"loose"].exec(e);for(var r={},i=14;i--;)r[t.key[i]]=e[i]||"";return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,i){n&&(r[t.q.name][n]=i)}),r}n.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var r={length:0,start:e.nop,end:e.nop};window.MediaError=window.MediaError||function(){function e(e,t){this.code=e||null,this.message=t||""}return e.MEDIA_ERR_NONE_ACTIVE=0,e.MEDIA_ERR_ABORTED=1,e.MEDIA_ERR_NETWORK=2,e.MEDIA_ERR_DECODE=3,e.MEDIA_ERR_NONE_SUPPORTED=4,e}(),e._MediaElementProto=function(){var i={},s;return Object.prototype.__defineGetter__||(i=t.createElement("div")),i._util={type:"HTML5",TIMEUPDATE_MS:250,MIN_WIDTH:300,MIN_HEIGHT:150,isAttributeSet:function(e){return typeof e=="string"||e===!0},parseUri:n},i.addEventListener=function(e,n,r){t.addEventListener(this._eventNamespace+e,n,r)},i.removeEventListener=function(e,n,r){t.removeEventListener(this._eventNamespace+e,n,r)},i.dispatchEvent=function(e){var n=t.createEvent("CustomEvent");n.initCustomEvent(this._eventNamespace+e,!1,!1,{type:e,target:this.parentNode,data:null}),t.dispatchEvent(n)},i.load=e.nop,i.canPlayType=function(){return""},i.getBoundingClientRect=function(){return s.getBoundingClientRect()},i.NETWORK_EMPTY=0,i.NETWORK_IDLE=1,i.NETWORK_LOADING=2,i.NETWORK_NO_SOURCE=3,i.HAVE_NOTHING=0,i.HAVE_METADATA=1,i.HAVE_CURRENT_DATA=2,i.HAVE_FUTURE_DATA=3,i.HAVE_ENOUGH_DATA=4,Object.defineProperties(i,{currentSrc:{get:function(){return this.src!==undefined?this.src:""},configurable:!0},parentNode:{get:function(){return s},set:function(e){s=e},configurable:!0},preload:{get:function(){return"auto"},set:e.nop,configurable:!0},controls:{get:function(){return!0},set:e.nop,configurable:!0},poster:{get:function(){return""},set:e.nop,configurable:!0},crossorigin:{get:function(){return""},configurable:!0},played:{get:function(){return r},configurable:!0},seekable:{get:function(){return r},configurable:!0},buffered:{get:function(){return r},configurable:!0},defaultMuted:{get:function(){return!1},configurable:!0},defaultPlaybackRate:{get:function(){return 1},configurable:!0},style:{get:function(){return this.parentNode.style},configurable:!0},id:{get:function(){return this.parentNode.id},configurable:!0}}),i}}(Popcorn,window.document),function(e,t,n){function r(){if(t.jwplayer){a=!0;for(var e=l.length;e--;)l[e](),delete l[e]}else setTimeout(r,100)}function i(){if(!f){if(!t.jwplayer){var e=n.createElement("script");e.src="https://jwpsrv.com/library/zaIF4JI9EeK2FSIACpYGxA.js";var i=n.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}f=!0,r()}return a}function s(e){l.unshift(e)}function o(r){function o(e){B.unshift(e)}function a(){setTimeout(function(){L.duration=P.getDuration(),C.dispatchEvent("durationchange"),L.readyState=C.HAVE_METADATA,C.dispatchEvent("loadedmetadata"),C.dispatchEvent("loadeddata"),L.readyState=C.HAVE_FUTURE_DATA,C.dispatchEvent("canplay");for(_=!0;B.length;)B[0](),B.shift();L.readyState=C.HAVE_ENOUGH_DATA,C.dispatchEvent("canplaythrough")},0)}function f(){O?O=!1:F?(F=!1,a()):S()}function l(){L.seeking&&(L.ended=!1,L.seeking=!1,C.dispatchEvent("timeupdate"),C.dispatchEvent("seeked"),C.dispatchEvent("canplay"),C.dispatchEvent("canplaythrough"))}function c(){P.onPause(f),P.onTime(function(){!L.ended&&!L.seeking&&(L.currentTime=P.getPosition(),C.dispatchEvent("timeupdate"))}),P.onSeek(l),P.onPlay(function(){L.ended||(j?(j=!1,L.autoplay||!L.paused?(L.paused=!1,o(w),a()):(M=F=!0,P.pause(!0))):M?(M=!1,O=!0,P.pause(!0)):w())}),P.onBufferChange(E),P.onComplete(x),P.play(!0)}function d(e){var t={name:"MediaError"};t.message=e.message,t.code=e.code||5,L.error=t,C.dispatchEvent("error")}function v(e){if(C._canPlaySrc(e)){var t=C._util.parseUri(e).queryKey;L.controls=t.controls=t.controls||L.controls,L.src=e,i()?(A&&A&&P&&P.destroy(),jwplayer(k.id).setup({file:e,width:"100%",height:"100%",controls:L.controls}),P=jwplayer(k.id),P.onReady(c),P.onError(d),jwplayer.utils.log=function(e,t){typeof console!="undefined"&&typeof console.log!="undefined"&&(t?console.log(e,t):console.log(e)),e==="No suitable players found and fallback enabled"&&d({message:e,code:4})},L.networkState=C.NETWORK_LOADING,C.dispatchEvent("loadstart"),C.dispatchEvent("progress")):s(function(){v(e)})}else L.error={name:"MediaError",message:"Media Source Not Supported",code:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED},C.dispatchEvent("error")}function m(e){L.currentTime=e,_?(y(),P.seek(e)):o(function(){y(),P.seek(e)})}function y(){L.seeking=!0,L.paused&&(M=!0),C.dispatchEvent("seeking")}function w(){L.paused=!1;if(H){H=!1;if(L.loop&&!D||!L.loop)D=!0,C.dispatchEvent("play");C.dispatchEvent("playing")}}function E(){C.dispatchEvent("progress")}function S(){L.paused=!0,H||(H=!0,C.dispatchEvent("pause"))}function x(){L.loop?m(0):(L.ended=!0,S(),C.dispatchEvent("timeupdate"),C.dispatchEvent("ended"))}function T(e){L.volume=e,_?(P.setVolume(L.volume*100),C.dispatchEvent("volumechange")):o(function(){T(L.volume)})}function N(e){L.muted=e,_?(P.setMute(e),C.dispatchEvent("volumechange")):o(function(){N(L.muted)})}if(!t.postMessage)throw"ERROR: HTMLJWPlayerVideoElement requires window.postMessage";var C=new e._MediaElementProto,k=typeof r=="string"?n.querySelector(r):r,L={src:u,networkState:C.NETWORK_EMPTY,readyState:C.HAVE_NOTHING,seeking:!1,autoplay:u,preload:u,controls:!1,loop:!1,poster:u,volume:1,muted:!1,currentTime:0,duration:NaN,ended:!1,paused:!0,error:null},A=!1,O=!1,M=!1,_=!1,D=!1,P,H=!0,B=[],j=!0,F=!1;return C._eventNamespace=e.guid("HTMLJWPlayerVideoElement::"),C.parentNode=k,C._util.type="JWPlayer",C.play=function(){C.dispatchEvent("play"),L.paused=!1,_?(L.ended&&(m(0),L.ended=!1),P.play(!0)):o(function(){C.play()})},C.pause=function(){L.paused=!0,_?P.pause(!0):o(function(){C.pause()})},Object.defineProperties(C,{src:{get:function(){return L.src},set:function(e){e&&e!==L.src&&v(e)}},autoplay:{get:function(){return L.autoplay},set:function(e){L.autoplay=C._util.isAttributeSet(e)}},loop:{get:function(){return L.loop},set:function(e){L.loop=C._util.isAttributeSet(e)}},width:{get:function(){return C.parentNode.offsetWidth}},height:{get:function(){return C.parentNode.offsetHeight}},currentTime:{get:function(){return L.currentTime},set:function(e){m(e)}},duration:{get:function(){return P.getDuration()}},ended:{get:function(){return L.ended}},paused:{get:function(){return L.paused}},seeking:{get:function(){return L.seeking}},readyState:{get:function(){return L.readyState}},networkState:{get:function(){return L.networkState}},volume:{get:function(){return L.volume},set:function(e){if(e<0||e>1)throw"Volume value must be between 0.0 and 1.0";T(e)}},muted:{get:function(){return L.muted},set:function(e){N(C._util.isAttributeSet(e))}},error:{get:function(){return L.error}},buffered:{get:function(){var e={start:function(e){if(e===0)return 0;throw"INDEX_SIZE_ERR: DOM Exception 1"},end:function(e){if(e===0)return e=P.getDuration(),e?e*(P.getBuffer()/100):0;throw"INDEX_SIZE_ERR: DOM Exception 1"}};return Object.defineProperties(e,{length:{get:function(){return 1}}}),e}}}),C._canPlaySrc=e.HTMLJWPlayerVideoElement._canPlaySrc,C.canPlayType=e.HTMLJWPlayerVideoElement.canPlayType,C}var u="",a=!1,f=!1,l=[];e.HTMLJWPlayerVideoElement=function(e){return new o(e)},e.HTMLJWPlayerVideoElement._canPlaySrc=function(){return"probably"},e.HTMLJWPlayerVideoElement.canPlayType=function(){return"probably"}}(Popcorn,window,document),function(e,t){function n(t){this.startTime=0,this.currentTime=t.currentTime||0,this.duration=t.duration||NaN,this.playInterval=null,this.paused=!0,this.playbackRate=this.defaultPlaybackRate=1,this.ended=t.endedCallback||e.nop}function r(r){function o(e){S.push(e)}function u(){return y?w.currentTime:0}function a(e){e!==u()&&(y?(E.seeking=!0,v.dispatchEvent("seeking"),w.seekTo(e),E.ended=!1,E.seeking=!1,v.dispatchEvent("timeupdate"),v.dispatchEvent("seeked"),v.dispatchEvent("canplay"),v.dispatchEvent("canplaythrough")):o(function(){a(e)}))}function f(){v.dispatchEvent("timeupdate")}function c(){E.paused=!0,clearInterval(x),v.dispatchEvent("pause")}function d(){E.loop?(a(0),v.play()):(E.ended=!0,c(),v.dispatchEvent("timeupdate"),v.dispatchEvent("ended"))}var v=new e._MediaElementProto,m=typeof r=="string"?t.querySelector(r):r,g=t.createElement("div"),y=!1,w,E={src:i,networkState:v.NETWORK_EMPTY,readyState:v.HAVE_NOTHING,autoplay:i,preload:i,controls:i,loop:!1,poster:i,volume:1,muted:!1,width:m.width|0?m.width:v._util.MIN_WIDTH,height:m.height|0?m.height:v._util.MIN_HEIGHT,seeking:!1,ended:!1,paused:1,error:null},S=[],x;return v._eventNamespace=e.guid("HTMLNullVideoElement::"),v.parentNode=m,v._util.type="NullVideo",v.play=function(){y?(w.play(),E.paused&&(E.paused===1?(E.paused=!1,v.dispatchEvent("play"),v.dispatchEvent("playing")):(E.ended&&(a(0),E.ended=!1),E.paused&&(E.paused=!1,E.loop||v.dispatchEvent("play"),v.dispatchEvent("playing"))),x=setInterval(f,v._util.TIMEUPDATE_MS))):o(function(){v.play()})},v.pause=function(){y?(w.pause(),E.paused||c()):o(function(){v.pause()})},Object.defineProperties(v,{src:{get:function(){return E.src},set:function(e){if(e&&e!==E.src)if(v._canPlaySrc(e)){E.src=e,y&&y&&w&&(w.pause(),w=null,m.removeChild(g),g=t.createElement("div")),g.width=E.width,g.height=E.height,m.appendChild(g),e=s.exec(e),w=new n({currentTime:+e[1],duration:+e[2],endedCallback:d}),v.dispatchEvent("loadstart"),v.dispatchEvent("progress"),v.dispatchEvent("durationchange"),y=!0,E.networkState=v.NETWORK_IDLE,E.readyState=v.HAVE_METADATA,v.dispatchEvent("loadedmetadata"),v.dispatchEvent("loadeddata"),E.readyState=v.HAVE_FUTURE_DATA,v.dispatchEvent("canplay"),E.readyState=v.HAVE_ENOUGH_DATA;for(v.dispatchEvent("canplaythrough");S.length;)e=S.shift(),e();E.autoplay&&v.play()}else E.error={name:"MediaError",message:"Media Source Not Supported",code:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED},v.dispatchEvent("error")}},autoplay:{get:function(){return E.autoplay},set:function(e){E.autoplay=v._util.isAttributeSet(e)}},loop:{get:function(){return E.loop},set:function(e){E.loop=v._util.isAttributeSet(e)}},width:{get:function(){return g.width},set:function(e){g.width=e,E.width=g.width}},height:{get:function(){return g.height},set:function(e){g.height=e,E.height=g.height}},currentTime:{get:function(){return u()},set:function(e){a(e)}},duration:{get:function(){return w?w.duration:NaN}},ended:{get:function(){return E.ended}},paused:{get:function(){return E.paused}},seeking:{get:function(){return E.seeking}},readyState:{get:function(){return E.readyState}},networkState:{get:function(){return E.networkState}},volume:{get:function(){return E.volume},set:function(e){if(e<0||e>1)throw"Volume value must be between 0.0 and 1.0";E.volume=e,v.dispatchEvent("volumechange")}},muted:{get:function(){return E.muted},set:function(e){e=v._util.isAttributeSet(e),E.muted=e,v.dispatchEvent("volumechange")}},playbackRate:{get:function(){return w.playbackRate},set:function(e){w.playbackRate=e,v.dispatchEvent("ratechange")}},error:{get:function(){return E.error}}}),v._canPlaySrc=e.HTMLNullVideoElement._canPlaySrc,v.canPlayType=e.HTMLNullVideoElement.canPlayType,v}var i="",s=/#t=(\d+\.?\d*)?,?(\d+\.?\d*)/;n.prototype={play:function(){var e=this;this.paused&&(this.paused=!1,this.startTime=Date.now(),this.playInterval=setInterval(function(){e.currentTime+=(Date.now()-e.startTime)/(1e3/e.playbackRate),e.startTime=Date.now(),e.currentTime>=e.duration&&(e.pause(e.duration),e.ended()),e.currentTime<0&&e.pause(0)},16))},pause:function(){this.paused||(this.paused=!0,clearInterval(this.playInterval))},seekTo:function(e){e=e<0?0:e,this.currentTime=e=e>this.duration?this.duration:e}},e.HTMLNullVideoElement=function(e){return new r(e)},e.HTMLNullVideoElement._canPlaySrc=function(e){return s.test(e)?"probably":i},e.HTMLNullVideoElement.canPlayType=function(e){return e==="video/x-nullvideo"?"probably":i}}(Popcorn,document),function(e,t,n){function r(e){var n=this,r=e.src.split("?")[0];r.substr(0,2)==="//"&&(r=t.location.protocol+r),"play pause paused seekTo unload getCurrentTime getDuration getVideoEmbedCode getVideoHeight getVideoWidth getVideoUrl getColor setColor setLoop getVolume setVolume addEventListener".split(" ").forEach(function(t){n[t]=function(n){n=JSON.stringify({method:t,value:n}),e.contentWindow&&e.contentWindow.postMessage(n,r)}})}function i(i){function a(e){M.unshift(e)}function f(e){var t=C.duration;if(t!==e){C.duration=e,x.dispatchEvent("durationchange");if(isNaN(t)){C.networkState=x.NETWORK_IDLE,C.readyState=x.HAVE_METADATA,x.dispatchEvent("loadedmetadata"),x.dispatchEvent("loadeddata"),C.readyState=x.HAVE_FUTURE_DATA,x.dispatchEvent("canplay"),C.readyState=x.HAVE_ENOUGH_DATA,x.dispatchEvent("canplaythrough"),C.autoplay&&x.play();for(e=M.length;e--;)M[e](),delete M[e]}}}function c(e){k?(C.seeking=!0,x.dispatchEvent("seeking"),A.seekTo(e)):a(function(){c(e)})}function v(){x.dispatchEvent("timeupdate")}function m(e){(C.currentTime=e)!==P&&x.dispatchEvent("timeupdate"),P=C.currentTime}function y(e){if(e.origin===u){var n;try{n=JSON.parse(e.data)}catch(i){console.warn(i)}if(n.player_id==L)switch(n.event){case"ready":A=new r(N),A.addEventListener("loadProgress"),A.addEventListener("pause"),A.setVolume(0),A.play();break;case"loadProgress":parseFloat(n.data.duration)>0&&!k&&(k=!0,A.pause());break;case"pause":A.setVolume(1),t.removeEventListener("message",y,!1),t.addEventListener("message",b,!1),A.addEventListener("loadProgress"),A.addEventListener("playProgress"),A.addEventListener("play"),A.addEventListener("pause"),A.addEventListener("finish"),A.addEventListener("seek"),A.getDuration(),C.networkState=x.NETWORK_LOADING,x.dispatchEvent("loadstart"),x.dispatchEvent("progress")}}}function b(e){if(e.origin===u){var t;try{t=JSON.parse(e.data)}catch(n){console.warn(n)}if(t.player_id==L){switch(t.method){case"getCurrentTime":m(parseFloat(t.value));break;case"getDuration":f(parseFloat(t.value));break;case"getVolume":e=parseFloat(t.value),C.volume!==e&&(C.volume=e,x.dispatchEvent("volumechange"))}switch(t.event){case"loadProgress":x.dispatchEvent("progress"),f(parseFloat(t.data.duration));break;case"playProgress":m(parseFloat(t.data.seconds));break;case"play":C.ended&&c(0),D||(D=setInterval(w,s),C.loop&&x.dispatchEvent("play")),_=setInterval(v,x._util.TIMEUPDATE_MS),C.paused=!1,O&&(O=!1,C.loop||x.dispatchEvent("play"),x.dispatchEvent("playing"));break;case"pause":C.paused=!0,O||(O=!0,clearInterval(_),x.dispatchEvent("pause"));break;case"finish":C.loop?(c(0),x.play()):(C.ended=!0,x.dispatchEvent("ended"));break;case"seek":m(parseFloat(t.data.seconds)),C.seeking=!1,x.dispatchEvent("timeupdate"),x.dispatchEvent("seeked"),x.dispatchEvent("canplay"),x.dispatchEvent("canplaythrough")}}}}function w(){A.getCurrentTime()}function E(e){C.volume=e,k?(A.setVolume(e),x.dispatchEvent("volumechange")):a(function(){E(e)})}function S(e){k?e?(C.muted=C.volume,E(0)):(C.muted=0,E(C.muted)):(C.muted=e?1:0,a(function(){S(e)}))}if(!t.postMessage)throw"ERROR: HTMLVimeoVideoElement requires window.postMessage";var x=new e._MediaElementProto,T=typeof i=="string"?e.dom.find(i):i,N=n.createElement("iframe"),C={src:o,networkState:x.NETWORK_EMPTY,readyState:x.HAVE_NOTHING,seeking:!1,autoplay:o,preload:o,controls:!1,loop:!1,poster:o,volume:1,muted:0,currentTime:0,duration:NaN,ended:!1,paused:!0,error:null},k=!1,L=e.guid(),A,O=!0,M=[],_,D,P=0;return x._eventNamespace=e.guid("HTMLVimeoVideoElement::"),x.parentNode=T,x._util.type="Vimeo",x.play=function(){C.paused=!1,k?A.play():a(function(){x.play()})},x.pause=function(){C.paused=!0,k?A.pause():a(function(){x.pause()})},Object.defineProperties(x,{src:{get:function(){return C.src},set:function(e){if(e&&e!==C.src)if(x._canPlaySrc(e)){C.src=e,k&&k&&A&&(clearInterval(D),A.pause(),t.removeEventListener("message",b,!1),T.removeChild(N),N=n.createElement("iframe")),k=!1,e=x._util.parseUri(e);var r=e.queryKey,i,s=["api=1","player_id="+L,"title=0","byline=0","portrait=0"];C.loop=r.loop==="1"||C.loop,delete r.loop,C.autoplay=r.autoplay==="1"||C.autoplay,delete r.autoplay,e=u+"/video/"+/\d+$/.exec(e.path)+"?";for(i in r)r.hasOwnProperty(i)&&s.push(encodeURIComponent(i)+"="+encodeURIComponent(r[i]));e+=s.join("&"),N.id=L,N.style.width="100%",N.style.height="100%",N.frameBorder=0,N.webkitAllowFullScreen=!0,N.mozAllowFullScreen=!0,N.allowFullScreen=!0,T.appendChild(N),N.src=e,t.addEventListener("message",y,!1)}else C.error={name:"MediaError",message:"Media Source Not Supported",code:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED},x.dispatchEvent("error")}},autoplay:{get:function(){return C.autoplay},set:function(e){C.autoplay=x._util.isAttributeSet(e)}},loop:{get:function(){return C.loop},set:function(e){C.loop=x._util.isAttributeSet(e)}},width:{get:function(){return x.parentNode.offsetWidth}},height:{get:function(){return x.parentNode.offsetHeight}},currentTime:{get:function(){return C.currentTime},set:function(e){c(e)}},duration:{get:function(){return C.duration}},ended:{get:function(){return C.ended}},paused:{get:function(){return C.paused}},seeking:{get:function(){return C.seeking}},readyState:{get:function(){return C.readyState}},networkState:{get:function(){return C.networkState}},volume:{get:function(){return C.muted>0?C.muted:C.volume},set:function(e){if(e<0||e>1)throw"Volume value must be between 0.0 and 1.0";E(e)}},muted:{get:function(){return C.muted>0},set:function(e){S(x._util.isAttributeSet(e))}},error:{get:function(){return C.error}}}),x._canPlaySrc=e.HTMLVimeoVideoElement._canPlaySrc,x.canPlayType=e.HTMLVimeoVideoElement.canPlayType,x}var s=16,o="",u="https://player.vimeo.com";e.HTMLVimeoVideoElement=function(e){return new i(e)},e.HTMLVimeoVideoElement._canPlaySrc=function(e){return/player.vimeo.com\/video\/\d+/.test(e)||/vimeo.com\/\d+/.test(e)?"probably":o},e.HTMLVimeoVideoElement.canPlayType=function(e){return e==="video/x-vimeo"?"probably":o}}(Popcorn,window,document),function(e,t){function n(){return"maybe"}function r(e,r){var i=typeof e=="string"?t.querySelector(e):e,s=t.createElement(r);return i.appendChild(s),s._canPlaySrc=n,s}e.HTMLVideoElement=function(e){return r(e,"video")},e.HTMLVideoElement._canPlaySrc=n,e.HTMLAudioElement=function(e){return r(e,"audio")},e.HTMLAudioElement._canPlaySrc=n}(Popcorn,window.document),function(e,t,n){function r(){var e;if(YT.loaded)for(c=!0;p.length;)e=p.shift(),e();else setTimeout(r,250)}function i(){var e;return h||(t.YT?r():(e=n.createElement("script"),e.addEventListener("load",r,!1),e.src="https://www.youtube.com/iframe_api",n.head.appendChild(e)),h=!0),c}function s(e){p.push(e)}function o(r){function o(e){$.push(e)}function c(){X.pauseVideo(),S("play",c),E("play",P)}function h(){E("pause",H),S("pause",h)}function p(){var e=function(){X.isMuted()?(E("play",w),X.playVideo()):setTimeout(e,0)};U=!0,X.mute(),e()}function d(e){var t={name:"MediaError"};switch(e.data){case 2:t.message="Invalid video parameter.",t.code=MediaError.MEDIA_ERR_ABORTED;break;case 5:t.message="The requested content cannot be played in an HTML5 player or another error related to the HTML5 player has occurred.",t.code=MediaError.MEDIA_ERR_DECODE;case 100:t.message="Video not found.",t.code=MediaError.MEDIA_ERR_NETWORK;break;case 101:case 150:t.message="Video not usable.",t.code=MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:t.message="Unknown error.",t.code=5}R.error=t,F.dispatchEvent("error")}function v(){E("play",P),E("pause",H);if(R.autoplay||!R.paused)S("play",v),R.paused=!1,o(function(){R.paused||P()});R.muted||X.unMute(),R.readyState=F.HAVE_METADATA,F.dispatchEvent("loadedmetadata"),G=setInterval(L,u),F.dispatchEvent("loadeddata"),R.readyState=F.HAVE_FUTURE_DATA,F.dispatchEvent("canplay"),z=!0;for(K=setInterval(A,50);$.length;)$[0](),$.shift();R.readyState=F.HAVE_ENOUGH_DATA,F.dispatchEvent("canplaythrough")}function y(){S("pause",y),X.getCurrentTime()>0?setTimeout(y,0):R.autoplay||!R.paused?(E("play",v),X.playVideo()):v()}function w(){S("play",w),X.getCurrentTime()===0?setTimeout(w,0):(E("pause",y),X.seekTo(0),X.pauseVideo())}function E(e,t){F.addEventListener("youtube-"+e,t,!1)}function S(e,t){F.removeEventListener("youtube-"+e,t,!1)}function x(e){F.dispatchEvent("youtube-"+e)}function T(){R.networkState=F.NETWORK_LOADING,F.dispatchEvent("waiting")}function N(e){switch(e.data){case YT.PlayerState.ENDED:x("ended");break;case YT.PlayerState.PLAYING:x("play");break;case YT.PlayerState.PAUSED:X.getDuration()!==X.getCurrentTime()&&x("pause");break;case YT.PlayerState.BUFFERING:x("buffering")}e.data!==YT.PlayerState.BUFFERING&&J===YT.PlayerState.BUFFERING&&F.dispatchEvent("progress"),J=e.data}function C(r){if(F._canPlaySrc(r)){R.src=r;if(i()){if(U){if(!z){o(function(){C(r)});return}U&&X&&(S("buffering",T),S("ended",B),S("play",P),S("pause",H),H(),W=z=!1,R.currentTime=0,$=[],clearInterval(G),clearInterval(K),X.stopVideo(),X.clearVideo(),X.destroy(),q=n.createElement("div"))}I.appendChild(q);var u=F._util.parseUri(r).queryKey;delete u.v,R.autoplay=u.autoplay==="1"||R.autoplay,delete u.autoplay,R.loop=u.loop==="1"||R.loop,delete u.loop,u.rel=u.rel||0,u.modestbranding=u.modestbranding||1,u.iv_load_policy=u.iv_load_policy||3,u.disablekb=u.disablekb||1,u.showinfo=u.showinfo||0;var a=t.location.protocol==="file:"?"*":t.location.protocol+"//"+t.location.host;u.origin=u.origin||a,u.controls=u.controls||R.controls?2:0,R.controls=u.controls,u.wmode=u.wmode||"opaque",r=f.exec(r)[1],e.getJSONP("https://gdata.youtube.com/feeds/api/videos/"+r+"?v=2&alt=jsonc&callback=?",function(e){e.error?console.warn("failed to retreive duration data, reason: "+e.error.message):e.data?(R.duration=e.data.duration,F.dispatchEvent("durationchange"),X=new YT.Player(q,{width:"100%",height:"100%",wmode:u.wmode,videoId:r,playerVars:u,events:{onReady:p,onError:d,onStateChange:N}}),R.networkState=F.NETWORK_LOADING,F.dispatchEvent("loadstart"),F.dispatchEvent("progress")):console.warn("failed to retreive duration data, reason: no response data")})}else s(function(){C(r)})}else R.error={name:"MediaError",message:"Media Source Not Supported",code:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED},F.dispatchEvent("error")}function L(){var e=X.getCurrentTime();R.seeking?l(e-R.currentTime)<1&&D():(l(R.currentTime-e)>u&&(_(),D()),R.currentTime=e)}function A(){var e=X.getVideoLoadedFraction();e&&Q!==e&&(Q=e,F.dispatchEvent("progress"))}function O(e){e!==R.currentTime&&(R.currentTime=e,z?(_(),X.seekTo(e)):o(function(){_(),X.seekTo(e)}))}function M(){F.dispatchEvent("timeupdate")}function _(){E("pause",h),S("pause",H),R.seeking=!0,F.dispatchEvent("seeking")}function D(){R.ended=!1,R.seeking=!1,F.dispatchEvent("timeupdate"),F.dispatchEvent("seeked"),F.dispatchEvent("canplay"),F.dispatchEvent("canplaythrough")}function P(){R.ended&&(O(0),R.ended=!1),Y=setInterval(M,F._util.TIMEUPDATE_MS),R.paused=!1;if(V){V=!1;if(R.loop&&!W||!R.loop)W=!0,F.dispatchEvent("play");F.dispatchEvent("playing")}}function H(){R.paused=!0,V||(V=!0,clearInterval(Y),F.dispatchEvent("pause"))}function B(){R.loop?(O(0),F.play()):(R.ended=!0,H(),E("play",c),S("play",P),F.dispatchEvent("timeupdate"),F.dispatchEvent("ended"))}function j(e){R.muted=e,z?(X[e?"mute":"unMute"](),F.dispatchEvent("volumechange")):o(function(){j(R.muted)})}if(!t.postMessage)throw"ERROR: HTMLYouTubeVideoElement requires window.postMessage";var F=new e._MediaElementProto,I=typeof r=="string"?n.querySelector(r):r,q=n.createElement("div"),R={src:a,networkState:F.NETWORK_EMPTY,readyState:F.HAVE_NOTHING,seeking:!1,autoplay:a,preload:a,controls:!1,loop:!1,poster:a,volume:1,muted:!1,currentTime:0,duration:NaN,ended:!1,paused:!0,error:null},U=!1,z=!1,W=!1,X,V=!0,$=[],J=-1,K,Q=0,G,Y;return F._eventNamespace=e.guid("HTMLYouTubeVideoElement::"),F.parentNode=I,F._util.type="YouTube",E("buffering",T),E("ended",B),F.play=function(){R.paused=!1,z?X.playVideo():o(function(){F.play()})},F.pause=function(){R.paused=!0,z?(h(),X.pauseVideo()):o(function(){F.pause()})},Object.defineProperties(F,{src:{get:function(){return R.src},set:function(e){e&&e!==R.src&&C(e)}},autoplay:{get:function(){return R.autoplay},set:function(e){R.autoplay=F._util.isAttributeSet(e)}},loop:{get:function(){return R.loop},set:function(e){R.loop=F._util.isAttributeSet(e)}},width:{get:function(){return F.parentNode.offsetWidth}},height:{get:function(){return F.parentNode.offsetHeight}},currentTime:{get:function(){return R.currentTime},set:function(e){O(e)}},duration:{get:function(){return R.duration}},ended:{get:function(){return R.ended}},paused:{get:function(){return R.paused}},seeking:{get:function(){return R.seeking}},readyState:{get:function(){return R.readyState}},networkState:{get:function(){return R.networkState}},volume:{get:function(){return R.volume},set:function(e){if(e<0||e>1)throw"Volume value must be between 0.0 and 1.0";R.volume=e,z?(X.setVolume(R.volume*100),F.dispatchEvent("volumechange")):o(function(){F.volume=e})}},muted:{get:function(){return R.muted},set:function(e){j(F._util.isAttributeSet(e))}},error:{get:function(){return R.error}},buffered:{get:function(){var e={start:function(e){if(e===0)return 0;throw"INDEX_SIZE_ERR: DOM Exception 1"},end:function(e){if(e===0)return R.duration?R.duration*Q:0;throw"INDEX_SIZE_ERR: DOM Exception 1"}};return Object.defineProperties(e,{length:{get:function(){return 1}}}),e},configurable:!0}}),F._canPlaySrc=e.HTMLYouTubeVideoElement._canPlaySrc,F.canPlayType=e.HTMLYouTubeVideoElement.canPlayType,F}var u=10,a="",f=/^.*(?:\/|v=)(.{11})/,l=Math.abs,c=!1,h=!1,p=[];e.HTMLYouTubeVideoElement=function(e){return new o(e)},e.HTMLYouTubeVideoElement._canPlaySrc=function(e){return/(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu).*(?:\/|v=)(.{11})/.test(e)?"probably":a},e.HTMLYouTubeVideoElement.canPlayType=function(e){return e==="video/x-youtube"?"probably":a}}(Popcorn,window,document),function(e,t,n){function r(){return f||(e.getScript("https://w.soundcloud.com/player/api.js",function(){e.getScript("https://connect.soundcloud.com/sdk.js",function(){a=!0,SC.initialize({client_id:"PRaNFlda6Bhf5utPjUsptg"});for(var e=l.length;e--;)l[e](),delete l[e]})}),f=!0),a}function i(e){l.unshift(e)}function s(s){function a(e){D.unshift(e)}function f(){_.bind(SC.Widget.Events.LOAD_PROGRESS,function(e){w({type:"loadProgress",data:e.currentPosition/1e3})}),_.bind(SC.Widget.Events.PLAY_PROGRESS,function(e){w({type:"playProgress",data:e.currentPosition/1e3})}),_.bind(SC.Widget.Events.PLAY,function(){w({type:"play"})}),_.bind(SC.Widget.Events.PAUSE,function(){w({type:"pause"})}),_.bind(SC.Widget.Events.SEEK,function(){_.getPosition(function(e){e/=1e3,A.seeking?Math.floor(e)!==Math.floor(A.currentTime)?_.seekTo(A.currentTime*1e3):(A.ended=!1,A.seeking=!1,C.dispatchEvent("timeupdate"),C.dispatchEvent("seeked"),C.dispatchEvent("canplay"),C.dispatchEvent("canplaythrough")):w({type:"seek",data:e})})}),_.bind(SC.Widget.Events.FINISH,function(){w({type:"finish"})}),O=!0,_.getDuration(c)}function l(){_.bind(SC.Widget.Events.PLAY_PROGRESS,function(e){_.setVolume(0),e.currentPosition>0&&(_.unbind(SC.Widget.Events.PLAY_PROGRESS),_.bind(SC.Widget.Events.PAUSE,function(){_.unbind(SC.Widget.Events.PAUSE),_.setVolume(100),_.bind(SC.Widget.Events.SEEK,function(){_.unbind(SC.Widget.Events.SEEK),f()}),_.seekTo(0)}),_.pause())}),_.play()}function c(e){e/=1e3;var t=A.duration;if(t!==e){A.duration=e,C.dispatchEvent("durationchange");if(isNaN(t)){A.networkState=C.NETWORK_IDLE,A.readyState=C.HAVE_METADATA,C.dispatchEvent("loadedmetadata"),C.dispatchEvent("loadeddata"),A.readyState=C.HAVE_FUTURE_DATA,C.dispatchEvent("canplay"),A.readyState=C.HAVE_ENOUGH_DATA,C.dispatchEvent("canplaythrough");for(e=D.length;e--;)D[e](),delete D[e];A.paused&&A.autoplay&&C.play()}}}function h(e){function t(){A.seeking=!0,C.dispatchEvent("seeking"),_.seekTo(e)}A.currentTime=e,e*=1e3,O?t():addMediaReadyCallback(t)}function v(){A.paused=!0,M||(M=!0,clearInterval(P),C.dispatchEvent("pause"))}function m(){C.dispatchEvent("timeupdate")}function y(e){A.currentTime=e,e!==B&&C.dispatchEvent("timeupdate"),B=e}function w(e){switch(e.type){case"loadProgress":C.dispatchEvent("progress");break;case"playProgress":y(e.data);break;case"play":H||(H=setInterval(E,o),A.loop&&C.dispatchEvent("play")),P=setInterval(m,C._util.TIMEUPDATE_MS),A.paused=!1,M&&(M=!1,A.loop||C.dispatchEvent("play"),C.dispatchEvent("playing"));break;case"pause":v();break;case"finish":A.loop?(h(0),C.play()):(A.ended=!0,C.pause(),v(),C.dispatchEvent("timeupdate"),C.dispatchEvent("ended"));break;case"seek":y(e.data)}}function E(){A.ended||_.getPosition(function(e){y(e/1e3)})}function S(t){C._canPlaySrc(t)?(A.src=t,O&&O&&_&&(clearInterval(H),_.pause(),_.unbind(SC.Widget.Events.READY),_.unbind(SC.Widget.Events.LOAD_PROGRESS),_.unbind(SC.Widget.Events.PLAY_PROGRESS),_.unbind(SC.Widget.Events.PLAY),_.unbind(SC.Widget.Events.PAUSE),_.unbind(SC.Widget.Events.SEEK),_.unbind(SC.Widget.Events.FINISH),k.removeChild(L),L=n.createElement("iframe")),r()?(O=!1,SC.get("/resolve",{url:t},function(t){var n;t.errors&&(n={name:"MediaError"},t.errors[0]&&t.errors[0].error_message==="404 - Not Found"&&(n.message="Video not found.",n.code=MediaError.MEDIA_ERR_NETWORK),A.error=n,C.dispatchEvent("error")),L.id=e.guid("soundcloud-"),L.width=A.width,L.height=A.height,L.frameBorder=0,L.webkitAllowFullScreen=!0,L.mozAllowFullScreen=!0,L.allowFullScreen=!0,N(A.controls),k.appendChild(L),L.onload=function(){L.onload=null,_=SC.Widget(L),_.bind(SC.Widget.Events.READY,l),A.networkState=C.NETWORK_LOADING,C.dispatchEvent("loadstart"),C.dispatchEvent("progress")},L.src="https://w.soundcloud.com/player/?url="+t.uri+"&show_artwork=false&buying=false&liking=false&sharing=false&download=false&show_comments=false&show_user=false&single_active=false"})):i(function(){S(t)})):(A.error={name:"MediaError",message:"Media Source Not Supported",code:MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED},C.dispatchEvent("error"))}function x(e){A.volume=e,O?(_.setVolume(e),C.dispatchEvent("volumechange")):a(function(){x(e)})}function T(e){O?e?(A.muted=A.volume,x(0)):(A.muted=0,x(A.muted)):(A.muted=e?1:0,a(function(){T(e)}))}function N(e){O?(L.style.position="absolute",L.style.visibility=e?"visible":"hidden"):(L.style.opacity=e?"1":"0",L.style.pointerEvents=e?"auto":"none"),A.controls=e}if(!t.postMessage)throw"ERROR: HTMLSoundCloudAudioElement requires window.postMessage";var C=new e._MediaElementProto,k=typeof s=="string"?e.dom.find(s):s,L=n.createElement("iframe"),A={src:u,networkState:C.NETWORK_EMPTY,readyState:C.HAVE_NOTHING,seeking:!1,autoplay:u,preload:u,controls:!1,loop:!1,poster:u,volume:100,muted:0,currentTime:0,duration:NaN,ended:!1,paused:!0,width:k.width|0?k.width:C._util.MIN_WIDTH,height:k.height|0?k.height:C._util.MIN_HEIGHT,error:null},O=!1,M=!0,_,D=[],P,H,B=0;return C._eventNamespace=e.guid("HTMLSoundCloudAudioElement::"),C.parentNode=k,C._util.type="SoundCloud",C.play=function(){A.paused=!1,O?(A.ended&&h(0),_.play()):a(function(){C.play()})},C.pause=function(){A.paused=!0,O?_.pause():a(function(){C.pause()})},Object.defineProperties(C,{src:{get:function(){return A.src},set:function(e){e&&e!==A.src&&S(e)}},autoplay:{get:function(){return A.autoplay},set:function(e){A.autoplay=C._util.isAttributeSet(e)}},loop:{get:function(){return A.loop},set:function(e){A.loop=C._util.isAttributeSet(e)}},width:{get:function(){return L.width},set:function(e){L.width=e,A.width=L.width}},height:{get:function(){return L.height},set:function(e){L.height=e,A.height=L.height}},currentTime:{get:function(){return A.currentTime},set:function(e){h(e)}},duration:{get:function(){return A.duration}},ended:{get:function(){return A.ended}},paused:{get:function(){return A.paused}},seeking:{get:function(){return A.seeking}},readyState:{get:function(){return A.readyState}},networkState:{get:function(){return A.networkState}},volume:{get:function(){return(A.muted>0?A.muted:A.volume)/100},set:function(e){if(e<0||e>1)throw"Volume value must be between 0.0 and 1.0";e*=100,x(e)}},muted:{get:function(){return A.muted>0},set:function(e){T(C._util.isAttributeSet(e))}},error:{get:function(){return A.error}},controls:{get:function(){return A.controls},set:function(e){N(!!e)}}}),C._canPlaySrc=e.HTMLSoundCloudAudioElement._canPlaySrc,C.canPlayType=e.HTMLSoundCloudAudioElement.canPlayType,C}var o=16,u="",a=!1,f=!1,l=[];e.HTMLSoundCloudAudioElement=function(e){return new s(e)},e.HTMLSoundCloudAudioElement._canPlaySrc=function(e){return/(?:https?:\/\/www\.|https?:\/\/|www\.|\.|^)(soundcloud)/.test(e)?"probably":u},e.HTMLSoundCloudAudioElement.canPlayType=function(e){return e==="audio/x-soundcloud"?"probably":u}}(Popcorn,window,document),function(e){var t=function(t,n){var r=0,i=0,s;e.forEach(n.classes,function(e,t){s=[],e==="parent"?s[0]=document.querySelectorAll("#"+n.target)[0].parentNode:s=document.querySelectorAll("#"+n.target+" "+e),r=0;for(i=s.length;r<i;r++)s[r].classList.toggle(t)})};e.compose("applyclass",{manifest:{about:{name:"Popcorn applyclass Effect",version:"0.1",author:"@scottdowne",website:"scottdowne.wordpress.com"},options:{}},_setup:function(e){e.classes={},e.applyclass=e.applyclass||"";for(var t=e.applyclass.replace(/\s/g,"").split(","),n=[],r=0,i=t.length;r<i;r++)n=t[r].split(":"),n[0]&&(e.classes[n[0]]=n[1]||"")},start:t,end:t})}(Popcorn),function(e){function t(e,n){e.map?e.map.div.style.display=n:setTimeout(function(){t(e,n)},10)}var n=1;e.plugin("openmap",function(r){var i,s,o,u,a,f,c,h,d=document.getElementById(r.target);return i=document.createElement("div"),i.id="openmapdiv"+n,i.style.width="100%",i.style.height="100%",n++,d&&d.appendChild(i),h=function(){if(window.OpenLayers&&window.OpenLayers.Layer.Stamen){r.location?(location=new OpenLayers.LonLat(0,0),e.getJSONP("//tinygeocoder.com/create-api.php?q="+r.location+"&callback=jsonp",function(e){s=new OpenLayers.LonLat(e[1],e[0])})):s=new OpenLayers.LonLat(r.lng,r.lat),r.type=r.type||"ROADMAP";switch(r.type){case"SATELLITE":r.map=new OpenLayers.Map({div:i,maxResolution:.28125,tileSize:new OpenLayers.Size(512,512)});var t=new OpenLayers.Layer.WorldWind("LANDSAT","//worldwind25.arc.nasa.gov/tile/tile.aspx",2.25,4,{T:"105"});r.map.addLayer(t),u=new OpenLayers.Projection("EPSG:4326"),o=new OpenLayers.Projection("EPSG:4326");break;case"TERRAIN":u=new OpenLayers.Projection("EPSG:4326"),o=new OpenLayers.Projection("EPSG:4326"),r.map=new OpenLayers.Map({div:i,projection:o}),t=new OpenLayers.Layer.WMS("USGS Terraserver","//terraserver-usa.org/ogcmap.ashx?",{layers:"DRG"}),r.map.addLayer(t);break;case"STAMEN-TONER":case"STAMEN-WATERCOLOR":case"STAMEN-TERRAIN":t=r.type.replace("STAMEN-","").toLowerCase(),t=new OpenLayers.Layer.Stamen(t),u=new OpenLayers.Projection("EPSG:4326"),o=new OpenLayers.Projection("EPSG:900913"),s=s.transform(u,o),r.map=new OpenLayers.Map({div:i,projection:o,displayProjection:u,controls:[new OpenLayers.Control.Navigation,new OpenLayers.Control.PanPanel,new OpenLayers.Control.ZoomPanel]}),r.map.addLayer(t);break;default:o=new OpenLayers.Projection("EPSG:900913"),u=new OpenLayers.Projection("EPSG:4326"),s=s.transform(u,o),r.map=new OpenLayers.Map({div:i,projection:o,displayProjection:u}),t=new OpenLayers.Layer.OSM,r.map.addLayer(t)}r.map&&(r.map.setCenter(s,r.zoom||10),r.map.div.style.display="none")}else setTimeout(function(){h()},50)},h(),{_setup:function(t){window.OpenLayers||e.getScript("//openlayers.org/api/OpenLayers.js",function(){e.getScript("//maps.stamen.com/js/tile.stamen.js")});var n=function(){if(t.map){t.zoom=t.zoom||2,t.zoom&&typeof t.zoom!="number"&&(t.zoom=+t.zoom),t.map.setCenter(s,t.zoom);if(t.markers){var r=OpenLayers.Util.extend({},OpenLayers.Feature.Vector.style["default"]),i=function(e){clickedFeature=e.feature,clickedFeature.attributes.text&&(c=new OpenLayers.Popup.FramedCloud("featurePopup",clickedFeature.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(120,250),clickedFeature.attributes.text,null,!0,function(){f.unselect(this.feature)}),clickedFeature.popup=c,c.feature=clickedFeature,t.map.addPopup(c))},l=function(e){feature=e.feature,feature.popup&&(c.feature=null,t.map.removePopup(feature.popup),feature.popup.destroy(),feature.popup=null)},h=function(t){e.getJSONP("//tinygeocoder.com/create-api.php?q="+t.location+"&callback=jsonp",function(e){e=(new OpenLayers.Geometry.Point(e[1],e[0])).transform(u,o);var n=OpenLayers.Util.extend({},r);if(!t.size||isNaN(t.size))t.size=14;n.pointRadius=t.size,n.graphicOpacity=1,n.externalGraphic=t.icon,e=new OpenLayers.Feature.Vector(e,null,n),t.text&&(e.attributes={text:t.text}),a.addFeatures([e])})};a=new OpenLayers.Layer.Vector("Point Layer",{style:r}),t.map.addLayer(a);for(var d=0,v=t.markers.length;d<v;d++){var y=t.markers[d];y.text&&(f||(f=new OpenLayers.Control.SelectFeature(a),t.map.addControl(f),f.activate(),a.events.on({featureselected:i,featureunselected:l})));if(y.location)h(y);else{var b=(new OpenLayers.Geometry.Point(y.lng,y.lat)).transform(u,o),w=OpenLayers.Util.extend({},r);if(!y.size||isNaN(y.size))y.size=14;w.pointRadius=y.size,w.graphicOpacity=1,w.externalGraphic=y.icon,b=new OpenLayers.Feature.Vector(b,null,w),y.text&&(b.attributes={text:y.text}),a.addFeatures([b])}}}}else setTimeout(function(){n()},13)};n()},start:function(e,n){t(n,"block")},end:function(e,n){t(n,"none")},_teardown:function(){d&&d.removeChild(i),i=map=s=o=u=a=f=c=null}}},{about:{name:"Popcorn OpenMap Plugin",version:"0.3",author:"@mapmeld",website:"mapadelsur.blogspot.com"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},target:"map-container",type:{elem:"select",options:["ROADMAP","SATELLITE","TERRAIN"],label:"Map Type",optional:!0},zoom:{elem:"input",type:"number",label:"Zoom","default":2},lat:{elem:"input",type:"text",label:"Lat",optional:!0},lng:{elem:"input",type:"text",label:"Lng",optional:!0},location:{elem:"input",type:"text",label:"Location","default":"Toronto, Ontario, Canada"},markers:{elem:"input",type:"text",label:"List Markers",optional:!0}}})}(Popcorn);var e;(function(e){e.plugin("wikipedia",{manifest:{about:{name:"Popcorn Wikipedia Plugin",version:"0.1",author:"@annasob",website:"annasob.wordpress.com"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},lang:{elem:"input",type:"text",label:"Language","default":"english",optional:!0},src:{elem:"input",type:"url",label:"Wikipedia URL","default":"http://en.wikipedia.org/wiki/Cat"},title:{elem:"input",type:"text",label:"Title","default":"Cats",optional:!0},numberofwords:{elem:"input",type:"number",label:"Number of Words","default":"200",optional:!0},target:"wikipedia-container"}},_setup:function(t){var n,r=e.guid();t.lang||(t.lang="en"),t.numberofwords=t.numberofwords||200,window["wikiCallback"+r]=function(e){t._link=document.createElement("a"),t._link.setAttribute("href",t.src),t._link.setAttribute("target","_blank"),t._link.innerHTML=t.title||e.parse.displaytitle,t._desc=document.createElement("p"),n=e.parse.text["*"].substr(e.parse.text["*"].indexOf("<p>")),n=n.replace(/((<(.|\n)+?>)|(\((.*?)\) )|(\[(.*?)\]))/g,""),n=n.split(" "),t._desc.innerHTML=n.slice(0,n.length>=t.numberofwords?t.numberofwords:n.length).join(" ")+" ...",t._fired=!0},t.src&&e.getScript("//"+t.lang+".wikipedia.org/w/api.php?action=parse&props=text&redirects&page="+t.src.slice(t.src.lastIndexOf("/")+1)+"&format=json&callback=wikiCallback"+r),t.toString=function(){return t.src||t._natives.manifest.options.src["default"]}},start:function(e,t){var n=function(){t._fired?t._link&&t._desc&&document.getElementById(t.target)&&(document.getElementById(t.target).appendChild(t._link),document.getElementById(t.target).appendChild(t._desc),t._added=!0):setTimeout(function(){n()},13)};n()},end:function(e,t){t._added&&(document.getElementById(t.target).removeChild(t._link),document.getElementById(t.target).removeChild(t._desc))},_teardown:function(e){e._added&&(e._link.parentNode&&document.getElementById(e.target).removeChild(e._link),e._desc.parentNode&&document.getElementById(e.target).removeChild(e._desc),delete e.target)}})})(Popcorn),function(e){var t=0,n=function(t,n){var r=t.container=document.createElement("div"),i=r.style,s=t.media,o=function(){var e=t.position();i.fontSize="18px",i.width=s.offsetWidth+"px",i.top=e.top+s.offsetHeight-r.offsetHeight-40+"px",i.left=e.left+"px",setTimeout(o,10)};return r.id=n||e.guid(),i.position="absolute",i.color="white",i.textShadow="black 2px 2px 6px",i.fontWeight="bold",i.textAlign="center",o(),t.media.parentNode.appendChild(r),r};e.plugin("subtitle",{manifest:{about:{name:"Popcorn Subtitle Plugin",version:"0.1",author:"Scott Downe",website:"http://scottdowne.wordpress.com/"},options:{start:{elem:"input",type:"text",label:"Start"},end:{elem:"input",type:"text",label:"End"},target:"subtitle-container",text:{elem:"input",type:"text",label:"Text"}}},_setup:function(e){var r=document.createElement("div");r.id="subtitle-"+t++,r.style.display="none",!this.container&&(!e.target||e.target==="subtitle-container")&&n(this),e.container=e.target&&e.target!=="subtitle-container"?document.getElementById(e.target)||n(this,e.target):this.container,document.getElementById(e.container.id)&&document.getElementById(e.container.id).appendChild(r),e.innerContainer=r,e.showSubtitle=function(){e.innerContainer.innerHTML=e.text||""}},start:function(e,t){t.innerContainer.style.display="inline",t.showSubtitle(t,t.text)},end:function(e,t){t.innerContainer.style.display="none",t.innerContainer.innerHTML=""},_teardown:function(e){e.container.removeChild(e.innerContainer)}})}(Popcorn),function(e,t){var n={};e.plugin("documentcloud",{manifest:{about:{name:"Popcorn Document Cloud Plugin",version:"0.1",author:"@humphd, @ChrisDeCairos",website:"http://vocamus.net/dave"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},target:"documentcloud-container",width:{elem:"input",type:"text",label:"Width",optional:!0},height:{elem:"input",type:"text",label:"Height",optional:!0},src:{elem:"input",type:"url",label:"PDF URL","default":"http://www.documentcloud.org/documents/70050-urbina-day-1-in-progress.html"},preload:{elem:"input",type:"checkbox",label:"Preload","default":!0},page:{elem:"input",type:"number",label:"Page Number",optional:!0},aid:{elem:"input",type:"number",label:"Annotation Id",optional:!0}}},_setup:function(r){function i(){function i(e){r._key=e.api.getId(),r._changeView=function(e){r.aid?e.pageSet.showAnnotation(e.api.getAnnotation(r.aid)):e.api.setCurrentPage(r.page)}}function s(){n[r._key]={num:1,id:r._containerId},o.loaded=!0}o.loaded=!1;var a=r.url.replace(/\.html$/,".js"),f=r.target,c=t.getElementById(f),h=t.createElement("div"),v=e.position(c),m=r.width||v.width;v=r.height||v.height;var y=r.sidebar||!0,b=r.text||!0,w=r.pdf||!0,E=r.showAnnotations||!0,S=r.zoom||700,x=r.search||!0;if(!function(t){var s=!1;return e.forEach(o.viewers,function(e){e.api.getSchema().canonicalURL===t&&(i(e),e=n[r._key],r._containerId=e.id,e.num+=1,s=!0,o.loaded=!0)}),s}(r.url))h.id=r._containerId=e.guid(f),f="#"+h.id,c.appendChild(h),u.trigger("documentready"),o.load(a,{width:m,height:v,sidebar:y,text:b,pdf:w,showAnnotations:E,zoom:S,search:x,container:f,afterLoad:r.page||r.aid?function(e){i(e),r._changeView(e),h.style.visibility="hidden",e.elements.pages.hide(),s()}:function(e){i(e),s(),h.style.visibility="hidden",e.elements.pages.hide()}})}function s(){window.DV.loaded?i():setTimeout(s,25)}var o=window.DV=window.DV||{},u=this;if(o.loading)s();else{o.loading=!0,o.recordHit="//www.documentcloud.org/pixel.gif";var a=t.createElement("link"),f=t.getElementsByTagName("head")[0];a.rel="stylesheet",a.type="text/css",a.media="screen",a.href="//s3.documentcloud.org/viewer/viewer-datauri.css",f.appendChild(a),o.loaded=!1,e.getScript("http://s3.documentcloud.org/viewer/viewer.js",function(){o.loading=!1,i()})}r.toString=function(){return r.src||r._natives.manifest.options.src["default"]}},start:function(e,n){var r=t.getElementById(n._containerId),i=DV.viewers[n._key];(n.page||n.aid)&&i&&n._changeView(i),r&&i&&(r.style.visibility="visible",i.elements.pages.show())},end:function(e,n){var r=t.getElementById(n._containerId);r&&DV.viewers[n._key]&&(r.style.visibility="hidden",DV.viewers[n._key].elements.pages.hide())},_teardown:function(e){var r=t.getElementById(e._containerId);if((e=e._key)&&DV.viewers[e]&&--n[e].num===0){for(DV.viewers[e].api.unload();r.hasChildNodes();)r.removeChild(r.lastChild);r.parentNode.removeChild(r)}}})}(Popcorn,window.document),function(e){var t=/(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu|vimeo|soundcloud|baseplayer)/,n={},r={vimeo:!1,youtube:!1,soundcloud:!1,module:!1};Object.defineProperty(n,void 0,{get:function(){return r[void 0]},set:function(e){r[void 0]=e}}),e.plugin("mediaspawner",{manifest:{about:{name:"Popcorn Media Spawner Plugin",version:"0.1",author:"Matthew Schranz, @mjschranz",website:"mschranz.wordpress.com"},options:{source:{elem:"input",type:"text",label:"Media Source","default":"http://www.youtube.com/watch?v=CXDstfD9eJ0"},caption:{elem:"input",type:"text",label:"Media Caption","default":"Popcorn Popping",optional:!0},target:"mediaspawner-container",start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},autoplay:{elem:"input",type:"checkbox",label:"Autoplay Video",optional:!0},width:{elem:"input",type:"number",label:"Media Width","default":400,units:"px",optional:!0},height:{elem:"input",type:"number",label:"Media Height","default":200,units:"px",optional:!0}}},_setup:function(r){function i(){function t(){u!=="HTML5"&&!window.Popcorn[u]?setTimeout(function(){t()},300):(r.id=r._container.id,r._container.style.width=r.width+"px",r._container.style.height=r.height+"px",r.popcorn=e.smart("#"+r.id,r.source),u==="HTML5"&&r.popcorn.controls(!0),r._container.style.width="0px",r._container.style.height="0px",r._container.style.visibility="hidden",r._container.style.overflow="hidden")}u!=="HTML5"&&!window.Popcorn[u]&&!n[u]?(n[u]=!0,e.getScript("http://popcornjs.org/code/players/"+u+"/popcorn."+u+".js",function(){t()})):t()}function s(){window.Popcorn.player?i():setTimeout(function(){s()},300)}var o=document.getElementById(r.target)||{},u,a,f;(a=t.exec(r.source))?(u=a[1],u==="youtu"&&(u="youtube")):u="HTML5",r._type=u,r._container=document.createElement("div"),a=r._container,a.id="mediaSpawnerdiv-"+e.guid(),r.width=r.width||400,r.height=r.height||200,r.caption&&(f=document.createElement("div"),f.innerHTML=r.caption,f.style.display="none",r._capCont=f,a.appendChild(f)),o&&o.appendChild(a),!window.Popcorn.player&&!n.module?(n.module=!0,e.getScript("http://popcornjs.org/code/modules/player/popcorn.player.js",s)):s(),r.toString=function(){return r.source||r._natives.manifest.options.source["default"]}},start:function(e,t){t._capCont&&(t._capCont.style.display=""),t._container.style.width=t.width+"px",t._container.style.height=t.height+"px",t._container.style.visibility="visible",t._container.style.overflow="visible",t.autoplay&&t.popcorn.play()},end:function(e,t){t._capCont&&(t._capCont.style.display="none"),t._container.style.width="0px",t._container.style.height="0px",t._container.style.visibility="hidden",t._container.style.overflow="hidden",t.popcorn.pause()},_teardown:function(e){e.popcorn&&e.popcorn.destory&&e.popcorn.destroy(),document.getElementById(e.target)&&document.getElementById(e.target).removeChild(e._container)}})}(Popcorn,this),function(e){var t=1;e.plugin("timeline",function(e){var n=document.getElementById(e.target),r=document.createElement("div"),i,s=!0;return n&&!n.firstChild?(n.appendChild(i=document.createElement("div")),i.style.width="inherit",i.style.height="inherit",i.style.overflow="auto"):i=n.firstChild,r.style.display="none",r.id="timelineDiv"+t,e.direction=e.direction||"up",e.direction.toLowerCase()==="down"&&(s=!1),n&&i&&(s?i.insertBefore(r,i.firstChild):i.appendChild(r)),t++,r.innerHTML="<p><span id='big' style='font-size:24px; line-height: 130%;' >"+e.title+"</span><br /><span id='mid' style='font-size: 16px;'>"+e.text+"</span><br />"+e.innerHTML,{start:function(e,t){r.style.display="block",t.direction==="down"&&(i.scrollTop=i.scrollHeight)},end:function(){r.style.display="none"},_teardown:function(){i&&r&&i.removeChild(r)&&!i.firstChild&&n.removeChild(i)}}},{about:{name:"Popcorn Timeline Plugin",version:"0.1",author:"David Seifried @dcseifried",website:"dseifried.wordpress.com"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},target:"feed-container",title:{elem:"input",type:"text",label:"Title"},text:{elem:"input",type:"text",label:"Text"},innerHTML:{elem:"input",type:"text",label:"HTML Code",optional:!0},direction:{elem:"select",options:["DOWN","UP"],label:"Direction",optional:!0}}})}(Popcorn),function(e){var t=0;e.plugin("flickr",function(n){var r,i=document.getElementById(n.target),s,o,u,a,f=n.numberofimages||4,l=n.height||"50px",c=n.width||"50px",h=n.padding||"5px",d=n.border||"0px";r=document.createElement("div"),r.id="flickr"+t,r.style.width="100%",r.style.height="100%",r.style.display="none",t++,i&&i.appendChild(r);var v=function(){s?setTimeout(function(){v()},5):(o="http://api.flickr.com/services/rest/?method=flickr.people.findByUsername&",o+="username="+n.username+"&api_key="+n.apikey+"&format=json&jsoncallback=flickr",e.getJSONP(o,function(e){s=e.user.nsid,m()}))},m=function(){o="http://api.flickr.com/services/feeds/photos_public.gne?",s&&(o+="id="+s+"&"),n.tags&&(o+="tags="+n.tags+"&"),o+="lang=en-us&format=json&jsoncallback=flickr",e.xhr.getJSONP(o,function(t){var n=document.createElement("div");n.innerHTML="<p style='padding:"+h+";'>"+t.title+"<p/>",e.forEach(t.items,function(e,t){if(!(t<f))return!1;u=document.createElement("a"),u.setAttribute("href",e.link),u.setAttribute("target","_blank"),a=document.createElement("img"),a.setAttribute("src",e.media.m),a.setAttribute("height",l),a.setAttribute("width",c),a.setAttribute("style","border:"+d+";padding:"+h),u.appendChild(a),n.appendChild(u)}),r.appendChild(n)})};return n.username&&n.apikey?v():(s=n.userid,m()),n.toString=function(){return n.tags||n.username||"Flickr"},{start:function(){r.style.display="inline"},end:function(){r.style.display="none"},_teardown:function(e){document.getElementById(e.target)&&document.getElementById(e.target).removeChild(r)}}},{about:{name:"Popcorn Flickr Plugin",version:"0.2",author:"Scott Downe, Steven Weerdenburg, Annasob",website:"http://scottdowne.wordpress.com/"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},userid:{elem:"input",type:"text",label:"User ID",optional:!0},tags:{elem:"input",type:"text",label:"Tags"},username:{elem:"input",type:"text",label:"Username",optional:!0},apikey:{elem:"input",type:"text",label:"API Key",optional:!0},target:"flickr-container",height:{elem:"input",type:"text",label:"Height","default":"50px",optional:!0},width:{elem:"input",type:"text",label:"Width","default":"50px",optional:!0},padding:{elem:"input",type:"text",label:"Padding",optional:!0},border:{elem:"input",type:"text",label:"Border","default":"5px",optional:!0},numberofimages:{elem:"input",type:"number","default":4,label:"Number of Images"}}})}(Popcorn),function(e){e.plugin("webpage",{manifest:{about:{name:"Popcorn Webpage Plugin",version:"0.1",author:"@annasob",website:"annasob.wordpress.com"},options:{id:{elem:"input",type:"text",label:"Id",optional:!0},start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},src:{elem:"input",type:"url",label:"Webpage URL","default":"http://mozillapopcorn.org"},target:"iframe-container"}},_setup:function(e){var t=document.getElementById(e.target);e.src=e.src.replace(/^(https?:)?(\/\/)?/,"//"),e._iframe=document.createElement("iframe"),e._iframe.setAttribute("width","100%"),e._iframe.setAttribute("height","100%"),e._iframe.id=e.id,e._iframe.src=e.src,e._iframe.style.display="none",t&&t.appendChild(e._iframe)},start:function(e,t){t._iframe.src=t.src,t._iframe.style.display="inline"},end:function(e,t){t._iframe.style.display="none"},_teardown:function(e){document.getElementById(e.target)&&document.getElementById(e.target).removeChild(e._iframe)}})}(Popcorn),function(e){var t={},n=0,r=document.createElement("span"),i=["webkit","Moz","ms","O",""],s=["Transform","TransitionDuration","TransitionTimingFunction"],o={},u;document.getElementsByTagName("head")[0].appendChild(r);for(var a=0,f=s.length;a<f;a++)for(var l=0,c=i.length;l<c;l++){u=i[l]+s[a];if(u in r.style){o[s[a].toLowerCase()]=u;break}}document.getElementsByTagName("head")[0].appendChild(r),e.plugin("wordriver",{manifest:{about:{name:"Popcorn WordRiver Plugin"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},target:"wordriver-container",text:{elem:"input",type:"text",label:"Text","default":"Popcorn.js"},color:{elem:"input",type:"text",label:"Color","default":"Green",optional:!0}}},_setup:function(e){e._duration=e.end-e.start;var n;if(!(n=t[e.target])){n=e.target,t[n]=document.createElement("div");var r=document.getElementById(n);r&&r.appendChild(t[n]),t[n].style.height="100%",t[n].style.position="relative",n=t[n]}e._container=n,e.word=document.createElement("span"),e.word.style.position="absolute",e.word.style.whiteSpace="nowrap",e.word.style.opacity=0,e.word.style.MozTransitionProperty="opacity, -moz-transform",e.word.style.webkitTransitionProperty="opacity, -webkit-transform",e.word.style.OTransitionProperty="opacity, -o-transform",e.word.style.transitionProperty="opacity, transform",e.word.style[o.transitionduration]="1s, "+e._duration+"s",e.word.style[o.transitiontimingfunction]="linear",e.word.innerHTML=e.text,e.word.style.color=e.color||"black"},start:function(e,t){t._container.appendChild(t.word),t.word.style[o.transform]="",t.word.style.fontSize=~~(30+20*Math.random())+"px",n%=t._container.offsetWidth-t.word.offsetWidth,t.word.style.left=n+"px",n+=t.word.offsetWidth+10,t.word.style[o.transform]="translateY("+(t._container.offsetHeight-t.word.offsetHeight)+"px)",t.word.style.opacity=1,setTimeout(function(){t.word.style.opacity=0},(t.end-t.start-1||1)*1e3)},end:function(e,t){t.word.style.opacity=0},_teardown:function(e){var n=document.getElementById(e.target);e.word.parentNode&&e._container.removeChild(e.word),t[e.target]&&!t[e.target].childElementCount&&n&&n.removeChild(t[e.target])&&delete t[e.target]}})}(Popcorn);var t;return function(e){function n(e,t,n){e=e.type?e.type.toUpperCase():"HYBRID";var r;if(e==="STAMEN-WATERCOLOR"||e==="STAMEN-TERRAIN"||e==="STAMEN-TONER")r=e.replace("STAMEN-","").toLowerCase();return n=new google.maps.Map(n,{mapTypeId:r?r:google.maps.MapTypeId[e],mapTypeControlOptions:{mapTypeIds:[]}}),r&&n.mapTypes.set(r,new google.maps.StamenMapType(r)),n.getDiv().style.display="none",n}var r=1,i=!1,s=!1,o,u;t=function(n){typeof google!="undefined"&&google.maps&&google.maps.Geocoder&&google.maps.LatLng?(o=new google.maps.Geocoder,e.getScript("//maps.stamen.com/js/tile.stamen.js",function(){s=!0})):setTimeout(function(){t(n)},1)},u=function(){document.body?(i=!0,e.getScript("//maps.google.com/maps/api/js?sensor=false&callback=googleCallback")):setTimeout(function(){u()},1)},e.plugin("googlemap",function(e){var t,a,f,c=document.getElementById(e.target);e.type=e.type||"ROADMAP",e.zoom=e.zoom||1,e.lat=e.lat||0,e.lng=e.lng||0,i||u(),t=document.createElement("div"),t.id="actualmap"+r,t.style.width=e.width||"100%",t.style.height=e.height?e.height:c&&c.clientHeight?c.clientHeight+"px":"100%",r++,c&&c.appendChild(t);var p=function(){s?t&&(e.location?o.geocode({address:e.location},function(r,i){t&&i===google.maps.GeocoderStatus.OK&&(e.lat=r[0].geometry.location.lat(),e.lng=r[0].geometry.location.lng(),f=new google.maps.LatLng(e.lat,e.lng),a=n(e,f,t))}):(f=new google.maps.LatLng(e.lat,e.lng),a=n(e,f,t))):setTimeout(function(){p()},5)};return p(),e.toString=function(){return e.location||(e.lat&&e.lng?e.lat+", "+e.lng:e._natives.manifest.options.location["default"])},{start:function(e,n){var r=this,i,s=function(){if(a){n._map=a,a.getDiv().style.display="block",google.maps.event.trigger(a,"resize"),a.setCenter(f),n.zoom&&typeof n.zoom!="number"&&(n.zoom=+n.zoom),a.setZoom(n.zoom),n.heading&&typeof n.heading!="number"&&(n.heading=+n.heading),n.pitch&&typeof n.pitch!="number"&&(n.pitch=+n.pitch);if(n.type==="STREETVIEW"){a.setStreetView(i=new google.maps.StreetViewPanorama(t,{position:f,pov:{heading:n.heading=n.heading||0,pitch:n.pitch=n.pitch||0,zoom:n.zoom}}));var e=function(t,i){var s=google.maps.geometry.spherical.computeHeading;setTimeout(function(){var i=r.media.currentTime;if(typeof n.tween=="object"){for(var a=0,f=t.length;a<f;a++){var l=t[a];i>=l.interval*(a+1)/1e3&&(i<=l.interval*(a+2)/1e3||i>=l.interval*f/1e3)&&(h.setPosition(new google.maps.LatLng(l.position.lat,l.position.lng)),h.setPov({heading:l.pov.heading||s(l,t[a+1])||0,zoom:l.pov.zoom||0,pitch:l.pov.pitch||0}))}e(t,t[0].interval)}else{a=0;for(f=t.length;a<f;a++)l=n.interval,i>=l*(a+1)/1e3&&(i<=l*(a+2)/1e3||i>=l*f/1e3)&&(o.setPov({heading:s(t[a],t[a+1])||0,zoom:n.zoom,pitch:n.pitch||0}),o.setPosition(u[a]));e(u,n.interval)}},i)};if(n.location&&typeof n.tween=="string"){var o=i,u=[],l=new google.maps.DirectionsService,c=new google.maps.DirectionsRenderer(o);l.route({origin:n.location,destination:n.tween,travelMode:google.maps.TravelMode.DRIVING},function(t,r){if(r==google.maps.DirectionsStatus.OK){c.setDirections(t);for(var i=t.routes[0].overview_path,s=0,o=i.length;s<o;s++)u.push(new google.maps.LatLng(i[s].lat(),i[s].lng()));n.interval=n.interval||1e3,e(u,10)}})}else if(typeof n.tween=="object"){var h=i;l=0;for(var p=n.tween.length;l<p;l++)n.tween[l].interval=n.tween[l].interval||1e3,e(n.tween,10)}}n.onmaploaded&&n.onmaploaded(n,a)}else setTimeout(function(){s()},13)};s()},end:function(){a&&(a.getDiv().style.display="none")},_teardown:function(e){var n=document.getElementById(e.target);n&&n.removeChild(t),t=a=f=null,e._map=null}}},{about:{name:"Popcorn Google Map Plugin",version:"0.1",author:"@annasob",website:"annasob.wordpress.com"},options:{start:{elem:"input",type:"start",label:"Start"},end:{elem:"input",type:"start",label:"End"},target:"map-container",type:{elem:"select",options:["ROADMAP","SATELLITE","STREETVIEW","HYBRID","TERRAIN","STAMEN-WATERCOLOR","STAMEN-TERRAIN","STAMEN-TONER"],label:"Map Type",optional:!0},zoom:{elem:"input",type:"text",label:"Zoom","default":0,optional:!0},lat:{elem:"input",type:"text",label:"Lat",optional:!0},lng:{elem:"input",type:"text",label:"Lng",optional:!0},location:{elem:"input",type:"text",label:"Location","default":"Toronto, Ontario, Canada"},heading:{elem:"input",type:"text",label:"Heading","default":0,optional:!0},pitch:{elem:"input",type:"text",label:"Pitch","default":1,optional:!0}}})}(Popcorn),function(e){e.plugin("mustache",function(t){var n,r,i,s;e.getScript("http://mustache.github.com/extras/mustache.js");var o=!!t.dynamic,u=typeof t.template,a=typeof t.data,f=document.getElementById(t.target);return t.container=f||document.createElement("div"),u==="function"?o?i=t.template:s=t.template(t):s=u==="string"?t.template:"",a==="function"?o?n=t.data:r=t.data(t):r=a==="string"?JSON.parse(t.data):a==="object"?t.data:"",{start:function(e,t){var o=function(){if(window.Mustache){n&&(r=n(t)),i&&(s=i(t));var e=Mustache.to_html(s,r).replace(/^\s*/mg,"");t.container.innerHTML=e}else setTimeout(function(){o()},10)};o()},end:function(e,t){t.container.innerHTML=""},_teardown:function(){n=r=i=s=null}}},{about:{name:"Popcorn Mustache Plugin",version:"0.1",author:"David Humphrey (@humphd)",website:"http://vocamus.net/dave"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},target:"mustache-container",template:{elem:"input",type:"text",label:"Template"},data:{elem:"input",type:"text",label:"Data"},dynamic:{elem:"input",type:"checkbox",label:"Dynamic","default":!0}}})}(Popcorn),document.addEventListener("click",function(e){e=e.target,(e.nodeName==="A"||e.parentNode&&e.parentNode.nodeName==="A")&&Popcorn.instances.forEach(function(e){e.options.pauseOnLinkClicked&&e.pause()})},!1),function(e){e.plugin("footnote",{manifest:{about:{name:"Popcorn Footnote Plugin",version:"0.2",author:"@annasob, @rwaldron",website:"annasob.wordpress.com"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},text:{elem:"input",type:"text",label:"Text"},target:"footnote-container"}},_setup:function(t){var n=e.dom.find(t.target);t._container=document.createElement("div"),t._container.style.display="none",t._container.innerHTML=t.text,n.appendChild(t._container)},start:function(e,t){t._container.style.display="inline"},end:function(e,t){t._container.style.display="none"},_teardown:function(t){var n=e.dom.find(t.target);n&&n.removeChild(t._container)}})}(Popcorn),function(e){var t=1,n=!1;e.plugin("googlefeed",function(r){var i=function(){var t=!1,r=0,i=document.getElementsByTagName("link"),s=i.length,o=document.head||document.getElementsByTagName("head")[0],u=document.createElement("link");window.GFdynamicFeedControl?n=!0:e.getScript("//www.google.com/uds/solutions/dynamicfeed/gfdynamicfeedcontrol.js",function(){n=!0});for(;r<s;r++)i[r].href==="//www.google.com/uds/solutions/dynamicfeed/gfdynamicfeedcontrol.css"&&(t=!0);t||(u.type="text/css",u.rel="stylesheet",u.href="//www.google.com/uds/solutions/dynamicfeed/gfdynamicfeedcontrol.css",o.insertBefore(u,o.firstChild))};window.google?i():e.getScript("//www.google.com/jsapi",function(){google.load("feeds","1",{callback:function(){i()}})});var s=document.createElement("div"),o=document.getElementById(r.target),u=function(){n?r.feed=new GFdynamicFeedControl(r.url,s,{vertical:r.orientation.toLowerCase()==="vertical"?!0:!1,horizontal:r.orientation.toLowerCase()==="horizontal"?!0:!1,title:r.title=r.title||"Blog"}):setTimeout(function(){u()},5)};if(!r.orientation||r.orientation.toLowerCase()!=="vertical"&&r.orientation.toLowerCase()!=="horizontal")r.orientation="vertical";return s.style.display="none",s.id="_feed"+t,s.style.width="100%",s.style.height="100%",t++,o&&o.appendChild(s),u(),r.toString=function(){return r.url||r._natives.manifest.options.url["default"]},{start:function(){s.setAttribute("style","display:inline")},end:function(){s.setAttribute("style","display:none")},_teardown:function(e){document.getElementById(e.target)&&document.getElementById(e.target).removeChild(s),delete e.feed}}},{about:{name:"Popcorn Google Feed Plugin",version:"0.1",author:"David Seifried",website:"dseifried.wordpress.com"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},target:"feed-container",url:{elem:"input",type:"url",label:"Feed URL","default":"http://planet.mozilla.org/rss20.xml"},title:{elem:"input",type:"text",label:"Title","default":"Planet Mozilla",optional:!0},orientation:{elem:"select",options:["Vertical","Horizontal"],label:"Orientation","default":"Vertical",optional:!0}}})}(Popcorn),function(e){function t(e){return String(e).replace(/&(?!\w+;)|[<>"']/g,function(e){return r[e]||e})}function n(e,t){var n=e.container=document.createElement("div"),r=n.style,i=e.media,s=function(){var t=e.position();r.fontSize="18px",r.width=i.offsetWidth+"px",r.top=t.top+i.offsetHeight-n.offsetHeight-40+"px",r.left=t.left+"px",setTimeout(s,10)};return n.id=t||"",r.position="absolute",r.color="white",r.textShadow="black 2px 2px 6px",r.fontWeight="bold",r.textAlign="center",s(),e.media.parentNode.appendChild(n),n}var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};e.plugin("text",{manifest:{about:{name:"Popcorn Text Plugin",version:"0.1",author:"@humphd"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},text:{elem:"input",type:"text",label:"Text","default":"Popcorn.js"},escape:{elem:"input",type:"checkbox",label:"Escape"},multiline:{elem:"input",type:"checkbox",label:"Multiline"}}},_setup:function(r){var i,s,o=r._container=document.createElement("div");o.style.display="none",r.target?(i=e.dom.find(r.target))?["VIDEO","AUDIO"].indexOf(i.nodeName)>-1&&(i=n(this,r.target+"-overlay")):i=n(this,r.target):i=this.container?this.container:n(this),r._target=i,s=r.escape?t(r.text):r.text,s=r.multiline?s.replace(/\r?\n/gm,"<br>"):s,o.innerHTML=s||"",i.appendChild(o),r.toString=function(){return r.text||r._natives.manifest.options.text["default"]}},start:function(e,t){t._container.style.display="inline"},end:function(e,t){t._container.style.display="none"},_teardown:function(e){var t=e._target;t&&t.removeChild(e._container)}})}(Popcorn),function(e){e.plugin("code",function(t){var n=!1,r=this,i=function(){var e=function(e){return function(t,i){var s=function(){n&&t.call(r,i),n&&e(s)};s()}};return window.webkitRequestAnimationFrame?e(window.webkitRequestAnimationFrame):window.mozRequestAnimationFrame?e(window.mozRequestAnimationFrame):e(function(e){window.setTimeout(e,16)})}();if(!t.onStart||typeof t.onStart!="function")t.onStart=e.nop;return t.onEnd&&typeof t.onEnd!="function"&&(t.onEnd=undefined),t.onFrame&&typeof t.onFrame!="function"&&(t.onFrame=undefined),{start:function(e,t){t.onStart.call(r,t),t.onFrame&&(n=!0,i(t.onFrame,t))},end:function(e,t){t.onFrame&&(n=!1),t.onEnd&&t.onEnd.call(r,t)}}},{about:{name:"Popcorn Code Plugin",version:"0.1",author:"David Humphrey (@humphd)",website:"http://vocamus.net/dave"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},onStart:{elem:"input",type:"function",label:"onStart"},onFrame:{elem:"input",type:"function",label:"onFrame",optional:!0},onEnd:{elem:"input",type:"function",label:"onEnd"}}})}(Popcorn),function(e){function t(e){function t(){var t=e.getBoundingClientRect(),n=s.getBoundingClientRect();n.left!==t.left&&(s.style.left=t.left+"px"),n.top!==t.top&&(s.style.top=t.top+"px")}var i=-1,s=document.createElement("div"),o=getComputedStyle(e).zIndex;return s.setAttribute("data-popcorn-helper-container",!0),s.style.position="absolute",s.style.zIndex=isNaN(o)?n:o+1,document.body.appendChild(s),{element:s,start:function(){i=setInterval(t,r)},stop:function(){clearInterval(i),i=-1},destroy:function(){document.body.removeChild(s),i!==-1&&clearInterval(i)}}}var n=2e3,r=10;e.plugin("image",{manifest:{about:{name:"Popcorn image Plugin",version:"0.1",author:"Scott Downe",website:"http://scottdowne.wordpress.com/"},options:{start:{elem:"input",type:"number",label:"Start"},end:{elem:"input",type:"number",label:"End"},src:{elem:"input",type:"url",label:"Image URL","default":"http://mozillapopcorn.org/wp-content/themes/popcorn/images/for_developers.png"},href:{elem:"input",type:"url",label:"Link","default":"http://mozillapopcorn.org/wp-content/themes/popcorn/images/for_developers.png",optional:!0},target:"image-container",text:{elem:"input",type:"text",label:"Caption","default":"Popcorn.js",optional:!0}}},_setup:function(n){var r=document.createElement("img"),i=document.getElementById(n.target);n.anchor=document.createElement("a"),n.anchor.style.position="relative",n.anchor.style.textDecoration="none",n.anchor.style.display="none",i&&(["VIDEO","AUDIO"].indexOf(i.nodeName)>-1?(n.trackedContainer=t(i),n.trackedContainer.element.appendChild(n.anchor)):i&&i.appendChild(n.anchor)),r.addEventListener("load",function(){r.style.borderStyle="none",n.anchor.href=n.href||n.src||"#",n.anchor.target="_blank";var t,s;r.style.height=i.style.height,r.style.width=i.style.width,n.anchor.appendChild(r),n.text&&(t=r.height/12+"px",s=document.createElement("div"),e.extend(s.style,{color:"black",fontSize:t,fontWeight:"bold",position:"relative",textAlign:"center",width:r.style.width||r.width+"px",zIndex:"10"}),s.innerHTML=n.text||"",s.style.top=(r.style.height.replace("px","")||r.height)/2-s.offsetHeight/2+"px",n.anchor.insertBefore(s,r))},!1),r.src=n.src,n.toString=function(){var e=n.src||n._natives.manifest.options.src["default"],t=e.replace(/.*\//g,"");return t.length?t:e}},start:function(e,t){t.anchor.style.display="inline",t.trackedContainer&&t.trackedContainer.start()},end:function(e,t){t.anchor.style.display="none",t.trackedContainer&&t.trackedContainer.stop()},_teardown:function(e){e.trackedContainer?e.trackedContainer.destroy():e.anchor.parentNode&&e.anchor.parentNode.removeChild(e.anchor)}})}(Popcorn),function(e){e.parser("parseXML","XML",function(t){var n={title:"",remote:"",data:[]},r={},i=function(e){e=e.split(":");if(e.length===1)return parseFloat(e[0],10);if(e.length===2)return parseFloat(e[0],10)+parseFloat(e[1]/12,10);if(e.length===3)return parseInt(e[0]*60,10)+parseFloat(e[1],10)+parseFloat(e[2]/12,10);if(e.length===4)return parseInt(e[0]*3600,10)+parseInt(e[1]*60,10)+parseFloat(e[2],10)+parseFloat(e[3]/12,10)},s=function(e){for(var t={},n=0,s=e.length;n<s;n++){var o=e.item(n).nodeName,u=e.item(n).nodeValue,a=r[u];if(o==="in")t.start=i(u);else if(o==="out")t.end=i(u);else if(o==="resourceid")for(var f in a)a.hasOwnProperty(f)&&!t[f]&&f!=="id"&&(t[f]=a[f]);else t[o]=u}return t},o=function(e,t){var n={};return n[e]=t,n},u=function(t,i,a){var f={};e.extend(f,i,s(t.attributes),{text:t.textContent||t.text}),i=t.childNodes;if(i.length<1||i.length===1&&i[0].nodeType===3)a?r[f.id]=f:n.data.push(o(t.nodeName,f));else for(t=0;t<i.length;t++)i[t].nodeType===1&&u(i[t],f,a)};t=t.documentElement.childNodes;for(var a=0,f=t.length;a<f;a++)t[a].nodeType===1&&(t[a].nodeName==="manifest"?u(t[a],{},!0):u(t[a],{},!1));return n})}(Popcorn),function(e){e.parser("parseSBV",function(e){var t={title:"",remote:"",data:[]},n=[],r=0,i=0,s=function(e){e=e.split(":");var t=e.length-1,n;try{n=parseInt(e[t-1],10)*60+parseFloat(e[t],10),t===2&&(n+=parseInt(e[0],10)*3600)}catch(r){throw"Bad cue"}return n},o=function(e,t){var n={};return n[e]=t,n};e=e.text.split(/(?:\r\n|\r|\n)/gm);for(i=e.length;r<i;){var u={},a=[],f=e[r++].split(",");try{u.start=s(f[0]);for(u.end=s(f[1]);r<i&&e[r];)a.push(e[r++]);u.text=a.join("<br />"),n.push(o("subtitle",u))}catch(l){for(;r<i&&e[r];)r++}for(;r<i&&!e[r];)r++}return t.data=n,t})}(Popcorn),function(e){e.parser("parseJSON","JSON",function(t){var n={title:"",remote:"",data:[]};return e.forEach(t.data,function(e){n.data.push(e)}),n})}(Popcorn),function(e){e.parser("parseTTXT",function(e){var t={title:"",remote:"",data:[]},n=function(e){e=e.split(":");var t=0;try{return parseFloat(e[0],10)*60*60+parseFloat(e[1],10)*60+parseFloat(e[2],10)}catch(n){t=0}return t},r=function(e,t){var n={};return n[e]=t,n};e=e.xml.lastChild.lastChild;for(var i=Number.MAX_VALUE,s=[];e;){if(e.nodeType===1&&e.nodeName==="TextSample"){var o={};o.start=n(e.getAttribute("sampleTime")),o.text=e.getAttribute("text"),o.text&&(o.end=i-.001,s.push(r("subtitle",o))),i=o.start}e=e.previousSibling}return t.data=s.reverse(),t})}(Popcorn),function(e){function t(e,s,o){var u=e.firstChild;e=n(e,o),o=[];for(var a;u;)u.nodeType===1&&(u.nodeName==="p"?o.push(r(u,s,e)):u.nodeName==="div"&&(a=i(u.getAttribute("begin")),a<0&&(a=s),o.push.apply(o,t(u,a,e)))),u=u.nextSibling;return o}function n(e,t){var n=e.getAttribute("region");return n!==null?n:t||""}function r(e,t,r){var u={};return u.text=(e.textContent||e.text).replace(s,"").replace(o,"<br />"),u.id=e.getAttribute("xml:id")||e.getAttribute("id"),u.start=i(e.getAttribute("begin"),t),u.end=i(e.getAttribute("end"),t),u.target=n(e,r),u.end<0&&(u.end=i(e.getAttribute("duration"),0),u.end>=0?u.end+=u.start:u.end=Number.MAX_VALUE),{subtitle:u}}function i(t,n){var r;if(!t)return-1;try{return e.util.toSeconds(t)}catch(i){for(var s=t.length-1;s>=0&&t[s]<="9"&&t[s]>="0";)s--;return r=s,s=parseFloat(t.substring(0,r)),r=t.substring(r),s*({h:3600,m:60,s:1,ms:.001}[r]||-1)+(n||0)}}var s=/^[\s]+|[\s]+$/gm,o=/(?:\r\n|\r|\n)/gm;e.parser("parseTTML",function(e){var n={title:"",remote:"",data:[]};if(!e.xml||!e.xml.documentElement)return n;e=e.xml.documentElement.firstChild;if(!e)return n;for(;e.nodeName!=="body";)e=e.nextSibling;return e&&(n.data=t(e,0)),n})}(Popcorn),function(e){function t(e){var t=e.split(":");e=e.length;var n;if(e!==12&&e!==9)throw"Bad cue";e=t.length-1;try{n=parseInt(t[e-1],10)*60+parseFloat(t[e],10),e===2&&(n+=parseInt(t[0],10)*3600)}catch(r){throw"Bad cue"}return n}function n(e,t){var n={};return n[e]=t,n}e.parser("parseVTT",function(e){var r={title:"",remote:"",data:[]},i=[],s=0,o=0,u,a;e=e.text.split(/(?:\r\n|\r|\n)/gm),o=e.length;if(o===0||e[0]!=="WEBVTT")return r;for(s++;s<o;){u=[];try{for(var f=s;f<o&&!e[f];)f++;s=f;var c=e[s++];f=void 0;var h={};if(!c||c.indexOf("-->")===-1)throw"Bad cue";f=c.replace(/--\>/," --> ").split(/[\t ]+/);if(f.length<2)throw"Bad cue";h.id=c,h.start=t(f[0]),h.end=t(f[2]);for(a=h;s<o&&e[s];)u.push(e[s++]);a.text=u.join("<br />"),i.push(n("subtitle",a))}catch(p){for(s=s;s<o&&e[s];)s++;s=s}}return r.data=i,r})}(Popcorn),function(e){function t(e,t){var r=e.substr(10).split(","),i;i={start:n(r[t.start]),end:n(r[t.end])};if(i.start===-1||i.end===-1)throw"Invalid time";var s=f.call(u,/\{(\\[\w]+\(?([\w\d]+,?)+\)?)+\}/gi,""),o=s.replace,u;u=r.length,f=[];for(var a=t.text;a<u;a++)f.push(r[a]);u=f.join(",");var f=u.replace;return i.text=o.call(s,/\\N/gi,"<br />"),i}function n(e){var t=e.split(":");return e.length!==10||t.length<3?-1:parseInt(t[0],10)*3600+parseInt(t[1],10)*60+parseFloat(t[2],10)}function r(e,t){var n={};return n[e]=t,n}e.parser("parseSSA",function(e){var n={title:"",remote:"",data:[]},i=[],s=0,o;e=e.text.split(/(?:\r\n|\r|\n)/gm);for(o=e.length;s<o&&e[s]!=="[Events]";)s++;var u=e[++s].substr(8).split(", "),a={},f,l;l=0;for(f=u.length;l<f;l++)u[l]==="Start"?a.start=l:u[l]==="End"?a.end=l:u[l]==="Text"&&(a.text=l);for(;++s<o&&e[s]&&e[s][0]!=="[";)try{i.push(r("subtitle",t(e[s],a)))}catch(c){}return n.data=i,n})}(Popcorn),function(e){function t(e,t){var n={};return n[e]=t,n}function n(e){e=e.split(":");try{var t=e[2].split(",");return t.length===1&&(t=e[2].split(".")),parseFloat(e[0],10)*3600+parseFloat(e[1],10)*60+parseFloat(t[0],10)+parseFloat(t[1],10)/1e3}catch(n){return 0}}e.parser("parseSRT",function(e,r){var i={title:"",remote:"",data:[]},s=[],o=0,u=0,a,f,c,h,p;a=e.text.split(/(?:\r\n|\r|\n)/gm);for(c=a.length-1;c>=0&&!a[c];)c--;h=c+1;for(o=0;o<h;o++){p={},c=[];for(o=o;!a[o];)o++;o=o,p.id=parseInt(a[o++],10),f=a[o++].split(/[\t ]*--\>[\t ]*/),p.start=n(f[0]),u=f[1].indexOf(" "),u!==-1&&(f[1]=f[1].substr(0,u));for(p.end=n(f[1]);o<h&&a[o];)c.push(a[o++]);p.text=c.join("\\N").replace(/\{(\\[\w]+\(?([\w\d]+,?)+\)?)+\}/gi,""),p.text=p.text.replace(/</g,"&lt;").replace(/>/g,"&gt;"),p.text=p.text.replace(/&lt;(\/?(font|b|u|i|s))((\s+(\w|\w[\w\-]*\w)(\s*=\s*(?:\".*?\"|'.*?'|[^'\">\s]+))?)+\s*|\s*)(\/?)&gt;/gi,"<$1$3$7>"),p.text=p.text.replace(/\\N/gi,"<br />"),r&&r.target&&(p.target=r.target),s.push(t("subtitle",p))}return i.data=s,i})}(Popcorn),function(e,t){t.player("vimeo",{_canPlayType:function(e,n){return typeof n=="string"&&t.HTMLVimeoVideoElement._canPlaySrc(n)}}),t.vimeo=function(e,n,r){typeof console!="undefined"&&console.warn&&console.warn("Deprecated player 'vimeo'. Please use Popcorn.HTMLVimeoVideoElement directly.");var i=t.HTMLVimeoVideoElement(e);return e=t(i,r),setTimeout(function(){i.src=n},0),e}}(window,Popcorn),function(e,t){var n=function(e,n){return typeof n=="string"&&t.HTMLYouTubeVideoElement._canPlaySrc(n)};t.player("youtube",{_canPlayType:n}),t.youtube=function(e,n,r){typeof console!="undefined"&&console.warn&&console.warn("Deprecated player 'youtube'. Please use Popcorn.HTMLYouTubeVideoElement directly.");var i=t.HTMLYouTubeVideoElement(e);return e=t(i,r),setTimeout(function(){i.src=n},0),e},t.youtube.canPlayType=n}(window,Popcorn),function(e,t){t.player("soundcloud",{_canPlayType:function(e,n){return typeof n=="string"&&t.HTMLSoundCloudAudioElement._canPlaySrc(n)&&e.toLowerCase()!=="audio"}}),t.soundcloud=function(e,n,r){typeof console!="undefined"&&console.warn&&console.warn("Deprecated player 'soundcloud'. Please use Popcorn.HTMLSoundCloudAudioElement directly.");var i=t.HTMLSoundCloudAudioElement(e);return e=t(i,r),setTimeout(function(){i.src=n},0),e}}(window,Popcorn),Popcorn}),define("core/base/agent",["core/base/component"],function(e){var t=function(t){e.call(this,t)};return t.prototype=Object.create(e.prototype),t.prototype.onSequenceDefined=function(e,t){t&&t()},t.prototype.onStart=function(){},t.prototype.onStop=function(){},t}),define("vas-basic/components/tvhead_agent",["jquery","popcorn","core/ui","core/registry","core/base/agent"],function(e,t,n,r,i){t.plugin("maskedFocus",function(e){var t=!0,n=null,r=null;return{start:function(t,n){var r=e.videoHost;e.onEnter!==undefined&&e.onEnter(),r.realign(e.focus),r.trigger("focusVisualAid",e.focus,e.end-e.start,e.addClass||"",e.title)},end:function(t,n){var r=e.videoHost;r.trigger("blurVisualAid"),r.realign(!1),e.onExit!==undefined&&e.onExit()}}});var s=function(t){i.call(this,t),this.myWidth=415,this.myHeight=390,this.myHandsOffset=300,this.activeAid=!1,this.lastAid=!1,this.lastSeed=Math.random(),this.hostDOM.addClass("tvhead"),this.tvHead=e('<div class="head"></div>'),this.tvBody=e('<div class="body"></div>'),this.hostDOM.append(this.tvHead),this.hostDOM.append(this.tvBody)};s.prototype=Object.create(i.prototype),i.prototype.realign=function(t){this.activeAid=t,this.hostDOM.removeClass("left"),this.hostDOM.removeClass("right"),t!=this.lastAid&&(this.lastSeed=Math.random(),this.lastAid=t);if(!t)this.hostDOM.css({left:(this.width-this.myWidth)/2,top:(this.height-this.myHeight)/2}),this.hostDOM.removeClass("left"),this.hostDOM.removeClass("right");else{var t=r.getVisualAid(t);if(!t){this.activeAid=!1,this.hostDOM.css({left:(this.width-this.myWidth)/2,top:(this.height-this.myHeight)/2});return}var n=26,i=26,s=21,o=156,u=10,a=e(t).offset(),f=e(t).width(),l=e(t).height(),c=a.top+l/2-this.myHandsOffset;c+s<0?c=-s:c+this.myHeight-o>this.height&&(c=this.height-this.myHeight+o);var h=a.left+u+f,p=a.left+u+f,d=a.left+u+f+this.myWidth-i<this.width,v=a.left-u-this.myWidth,m=a.left-u-this.myWidth+n>0;if(m&&d)this.lastSeed>.5?(h=p,this.hostDOM.addClass("left")):(h=v,this.hostDOM.addClass("right"));else if(!m&&d)h=p,this.hostDOM.addClass("left");else if(m&&!d)h=v,this.hostDOM.addClass("right");else{var g=-n,y=this.width-this.myWidth+i,b=g+this.myWidth-a.left,w=a.left+f-y;b<w?(h=g,this.hostDOM.addClass("right")):(h=y,this.hostDOM.addClass("left"))}this.hostDOM.css({left:h,top:c})}},i.prototype.onSequenceDefined=function(n,r){n||console.error("TVhead: Invalid sequence specified");if(!n.video){console.error("TVhead: Video source not defined in sequence");return}n.aids||(n.aids=[]),this.tvHead.empty();var i=e('<div id="misc-presentation-video"></div>').css({width:360,height:203});this.tvHead.append(i);var s=t.HTMLYouTubeVideoElement("#misc-presentation-video");s.src=n.video,s.addEventListener("loadeddata",function(){r()}),this.eExplainPopcorn=t(s);var o=n.aids;for(var u=0;u<o.length;u++){var a=o[u],f=a.at+(a.duration||10);u<o.length-1&&(f=o[u+1].at),a.focus!==undefined&&this.eExplainPopcorn.maskedFocus({start:a.at,end:f,focus:a.focus,videoHost:this,title:a.title,text:a.text,placement:a.placement,addClass:a.addClass,onEnter:a.onEnter,onExit:a.onExit})}this.eExplainPopcorn.on("ended",function(){this.trigger("completed")}.bind(this))},i.prototype.onStart=function(){this.eExplainPopcorn.play()},i.prototype.onStop=function(){this.eExplainPopcorn.pause()},s.prototype.onWillShow=function(e){this.hostDOM.removeClass("left"),this.hostDOM.removeClass("right"),this.hostDOM.css({left:(this.width-this.myWidth)/2,top:(this.height-this.myHeight)/2}),e()},s.prototype.onResize=function(e,t){this.width=e,this.height=t,this.realign(this.activeAid)},r.registerComponent("tutorial.agent",s,1)}),define("vas-basic/components/backdrop_explain",["core/registry","core/base/components"],function(e,t){var n=function(e){t.Backdrop.call(this,e)};n.prototype=Object.create(t.Backdrop.prototype),e.registerComponent("backdrop.explain",n,1)}),define("vas-basic/components/backdrop_home",["core/registry","core/base/components"],function(e,t){var n=function(e){t.Backdrop.call(this,e)};n.prototype=Object.create(t.Backdrop.prototype),e.registerComponent("backdrop.home",n,1)}),define("vas-basic/components/backdrop_running",["core/registry","core/base/components"],function(e,t){var n=function(e){t.Backdrop.call(this,e)};n.prototype=Object.create(t.Backdrop.prototype),e.registerComponent("backdrop.running",n,1)}),define("vas-basic/components/backdrop_tuning",["core/registry","core/base/components"],function(e,t){var n=function(e){t.Backdrop.call(this,e)};n.prototype=Object.create(t.Backdrop.prototype),e.registerComponent("backdrop.tuning",n,1)}),define("vas-basic/components/backdrop_progress",["core/registry","core/base/components"],function(e,t){var n=function(e){t.Backdrop.call(this,e),e.css({})};n.prototype=Object.create(t.Backdrop.prototype),e.registerComponent("backdrop.progress",n,1)}),define("vas-basic/components/backdrop_login",["core/registry","core/base/components"],function(e,t){var n=function(e){t.Backdrop.call(this,e)};n.prototype=Object.create(t.Backdrop.prototype),e.registerComponent("backdrop.login",n,1)}),define("vas-basic/components/backdrop_results",["core/registry","core/base/components"],function(e,t){var n=function(e){t.Backdrop.call(this,e)};n.prototype=Object.create(t.Backdrop.prototype),e.registerComponent("backdrop.results",n,1)}),function(e,t){typeof define=="function"&&define.amd?define("dragdealer",t):e.Dragdealer=t()}(this,function(){var e=function(e,t){this.bindMethods(),this.options=this.applyDefaults(t||{}),this.wrapper=this.getWrapperElement(e);if(!this.wrapper)return;this.handle=this.getHandleElement(this.wrapper,this.options.handleClass);if(!this.handle)return;this.init(),this.bindEventListeners()};e.prototype={defaults:{disabled:!1,horizontal:!0,vertical:!1,slide:!0,steps:0,snap:!1,loose:!1,speed:.1,xPrecision:0,yPrecision:0,handleClass:"handle"},init:function(){this.value={prev:[-1,-1],current:[this.options.x||0,this.options.y||0],target:[this.options.x||0,this.options.y||0]},this.offset={wrapper:[0,0],mouse:[0,0],prev:[-999999,-999999],current:[0,0],target:[0,0]},this.change=[0,0],this.stepRatios=this.calculateStepRatios(),this.activity=!1,this.dragging=!1,this.tapping=!1,this.reflow(),this.options.disabled&&this.disable()},applyDefaults:function(e){for(var t in this.defaults)e.hasOwnProperty(t)||(e[t]=this.defaults[t]);return e},getWrapperElement:function(e){return typeof e=="string"?document.getElementById(e):e},getHandleElement:function(e,t){var n=e.getElementsByTagName("div"),r=new RegExp("(^|\\s)"+t+"(\\s|$)"),i;for(i=0;i<n.length;i++)if(r.test(n[i].className))return n[i]},calculateStepRatios:function(){var e=[];if(this.options.steps>1)for(var t=0;t<=this.options.steps-1;t++)e[t]=t/(this.options.steps-1);return e},setWrapperOffset:function(){this.offset.wrapper=u.get(this.wrapper)},calculateBounds:function(){var e={top:this.options.top||0,bottom:-(this.options.bottom||0)+this.wrapper.offsetHeight,left:this.options.left||0,right:-(this.options.right||0)+this.wrapper.offsetWidth};return e.availWidth=e.right-e.left-this.handle.offsetWidth,e.availHeight=e.bottom-e.top-this.handle.offsetHeight,e},calculateValuePrecision:function(){var e=this.options.xPrecision||Math.abs(this.bounds.availWidth),t=this.options.yPrecision||Math.abs(this.bounds.availHeight);return[e?1/e:0,t?1/t:0]},bindMethods:function(){this.onHandleMouseDown=t(this.onHandleMouseDown,this),this.onHandleTouchStart=t(this.onHandleTouchStart,this),this.onDocumentMouseMove=t(this.onDocumentMouseMove,this),this.onWrapperTouchMove=t(this.onWrapperTouchMove,this),this.onWrapperMouseDown=t(this.onWrapperMouseDown,this),this.onWrapperTouchStart=t(this.onWrapperTouchStart,this),this.onDocumentMouseUp=t(this.onDocumentMouseUp,this),this.onDocumentTouchEnd=t(this.onDocumentTouchEnd,this),this.onHandleClick=t(this.onHandleClick,this),this.onWindowResize=t(this.onWindowResize,this)},bindEventListeners:function(){n(this.handle,"mousedown",this.onHandleMouseDown),n(this.handle,"touchstart",this.onHandleTouchStart),n(document,"mousemove",this.onDocumentMouseMove),n(this.wrapper,"touchmove",this.onWrapperTouchMove),n(this.wrapper,"mousedown",this.onWrapperMouseDown),n(this.wrapper,"touchstart",this.onWrapperTouchStart),n(document,"mouseup",this.onDocumentMouseUp),n(document,"touchend",this.onDocumentTouchEnd),n(this.handle,"click",this.onHandleClick),n(window,"resize",this.onWindowResize);var e=this;this.interval=setInterval(function(){e.animate()},25),this.animate(!1,!0)},unbindEventListeners:function(){r(this.handle,"mousedown",this.onHandleMouseDown),r(this.handle,"touchstart",this.onHandleTouchStart),r(document,"mousemove",this.onDocumentMouseMove),r(this.wrapper,"touchmove",this.onWrapperTouchMove),r(this.wrapper,"mousedown",this.onWrapperMouseDown),r(this.wrapper,"touchstart",this.onWrapperTouchStart),r(document,"mouseup",this.onDocumentMouseUp),r(document,"touchend",this.onDocumentTouchEnd),r(this.handle,"click",this.onHandleClick),r(window,"resize",this.onWindowResize),clearInterval(this.interval)},onHandleMouseDown:function(e){o.refresh(e),i(e),s(e),this.activity=!1,this.startDrag()},onHandleTouchStart:function(e){o.refresh(e),s(e),this.activity=!1,this.startDrag()},onDocumentMouseMove:function(e){o.refresh(e),this.dragging&&(this.activity=!0)},onWrapperTouchMove:function(e){o.refresh(e);if(!this.activity&&this.draggingOnDisabledAxis()){this.dragging&&this.stopDrag();return}i(e),this.activity=!0},onWrapperMouseDown:function(e){o.refresh(e),i(e),this.startTap()},onWrapperTouchStart:function(e){o.refresh(e),i(e),this.startTap()},onDocumentMouseUp:function(e){this.stopDrag(),this.stopTap()},onDocumentTouchEnd:function(e){this.stopDrag(),this.stopTap()},onHandleClick:function(e){this.activity&&(i(e),s(e))},onWindowResize:function(e){this.reflow()},enable:function(){this.disabled=!1,this.handle.className=this.handle.className.replace(/\s?disabled/g,"")},disable:function(){this.disabled=!0,this.handle.className+=" disabled"},reflow:function(){this.setWrapperOffset(),this.bounds=this.calculateBounds(),this.valuePrecision=this.calculateValuePrecision(),this.updateOffsetFromValue()},getStep:function(){return[this.getStepNumber(this.value.target[0]),this.getStepNumber(this.value.target[1])]},getValue:function(){return this.value.target},setStep:function(e,t,n){this.setValue(this.options.steps&&e>1?(e-1)/(this.options.steps-1):0,this.options.steps&&t>1?(t-1)/(this.options.steps-1):0,n)},setValue:function(e,t,n){this.setTargetValue([e,t||0]),n&&(this.groupCopy(this.value.current,this.value.target),this.updateOffsetFromValue(),this.callAnimationCallback())},startTap:function(){if(this.disabled)return;this.tapping=!0,this.setWrapperOffset(),this.setTargetValueByOffset([o.x-this.offset.wrapper[0]-this.handle.offsetWidth/2,o.y-this.offset.wrapper[1]-this.handle.offsetHeight/2])},stopTap:function(){if(this.disabled||!this.tapping)return;this.tapping=!1,this.setTargetValue(this.value.current)},startDrag:function(){if(this.disabled)return;this.dragging=!0,this.setWrapperOffset(),this.offset.mouse=[o.x-u.get(this.handle)[0],o.y-u.get(this.handle)[1]]},stopDrag:function(){if(this.disabled||!this.dragging)return;this.dragging=!1;var e=this.groupClone(this.value.current);if(this.options.slide){var t=this.change;e[0]+=t[0]*4,e[1]+=t[1]*4}this.setTargetValue(e)},callAnimationCallback:function(){var e=this.value.current;this.options.snap&&this.options.steps>1&&(e=this.getClosestSteps(e)),this.groupCompare(e,this.value.prev)||(typeof this.options.animationCallback=="function"&&this.options.animationCallback.call(this,e[0],e[1]),this.groupCopy(this.value.prev,e))},callTargetCallback:function(){typeof this.options.callback=="function"&&this.options.callback.call(this,this.value.target[0],this.value.target[1])},animate:function(e,t){if(e&&!this.dragging)return;if(this.dragging){var n=this.groupClone(this.value.target),r=[o.x-this.offset.wrapper[0]-this.offset.mouse[0],o.y-this.offset.wrapper[1]-this.offset.mouse[1]];this.setTargetValueByOffset(r,this.options.loose),this.change=[this.value.target[0]-n[0],this.value.target[1]-n[1]]}(this.dragging||t)&&this.groupCopy(this.value.current,this.value.target);if(this.dragging||this.glide()||t)this.updateOffsetFromValue(),this.callAnimationCallback()},glide:function(){var e=[this.value.target[0]-this.value.current[0],this.value.target[1]-this.value.current[1]];return!e[0]&&!e[1]?!1:(Math.abs(e[0])>this.valuePrecision[0]||Math.abs(e[1])>this.valuePrecision[1]?(this.value.current[0]+=e[0]*this.options.speed,this.value.current[1]+=e[1]*this.options.speed):this.groupCopy(this.value.current,this.value.target),!0)},updateOffsetFromValue:function(){this.options.snap?this.offset.current=this.getOffsetsByRatios(this.getClosestSteps(this.value.current)):this.offset.current=this.getOffsetsByRatios(this.value.current),this.groupCompare(this.offset.current,this.offset.prev)||(this.renderHandlePosition(),this.groupCopy(this.offset.prev,this.offset.current))},renderHandlePosition:function(){this.options.horizontal&&(this.handle.style.left=String(this.offset.current[0])+"px"),this.options.vertical&&(this.handle.style.top=String(this.offset.current[1])+"px")},setTargetValue:function(e,t){var n=t?this.getLooseValue(e):this.getProperValue(e);this.groupCopy(this.value.target,n),this.offset.target=this.getOffsetsByRatios(n),this.callTargetCallback()},setTargetValueByOffset:function(e,t){var n=this.getRatiosByOffsets(e),r=t?this.getLooseValue(n):this.getProperValue(n);this.groupCopy(this.value.target,r),this.offset.target=this.getOffsetsByRatios(r)},getLooseValue:function(e){var t=this.getProperValue(e);return[t[0]+(e[0]-t[0])/4,t[1]+(e[1]-t[1])/4]},getProperValue:function(e){var t=this.groupClone(e);return t[0]=Math.max(t[0],0),t[1]=Math.max(t[1],0),t[0]=Math.min(t[0],1),t[1]=Math.min(t[1],1),(!this.dragging&&!this.tapping||this.options.snap)&&this.options.steps>1&&(t=this.getClosestSteps(t)),t},getRatiosByOffsets:function(e){return[this.getRatioByOffset(e[0],this.bounds.availWidth,this.bounds.left),this.getRatioByOffset(e[1],this.bounds.availHeight,this.bounds.top)]},getRatioByOffset:function(e,t,n){return t?(e-n)/t:0},getOffsetsByRatios:function(e){return[this.getOffsetByRatio(e[0],this.bounds.availWidth,this.bounds.left),this.getOffsetByRatio(e[1],this.bounds.availHeight,this.bounds.top)]},getOffsetByRatio:function(e,t,n){return Math.round(e*t)+n},getStepNumber:function(e){return this.getClosestStep(e)*(this.options.steps-1)+1},getClosestSteps:function(e){return[this.getClosestStep(e[0]),this.getClosestStep(e[1])]},getClosestStep:function(e){var t=0,n=1;for(var r=0;r<=this.options.steps-1;r++)Math.abs(this.stepRatios[r]-e)<n&&(n=Math.abs(this.stepRatios[r]-e),t=r);return this.stepRatios[t]},groupCompare:function(e,t){return e[0]==t[0]&&e[1]==t[1]},groupCopy:function(e,t){e[0]=t[0],e[1]=t[1]},groupClone:function(e){return[e[0],e[1]]},draggingOnDisabledAxis:function(){return!this.options.horizontal&&o.xDiff>o.yDiff||!this.options.vertical&&o.yDiff>o.xDiff}};var t=function(e,t){return function(){return e.apply(t,arguments)}},n=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},r=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},i=function(e){e||(e=window.event),e.preventDefault&&e.preventDefault(),e.returnValue=!1},s=function(e){e||(e=window.event),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},o={x:0,y:0,xDiff:0,yDiff:0,refresh:function(e){e||(e=window.event),e.type=="mousemove"?this.set(e):e.touches&&this.set(e.touches[0])},set:function(e){var t=this.x,n=this.y;if(e.pageX||e.pageY)this.x=e.pageX,this.y=e.pageY;else if(e.clientX||e.clientY)this.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop;this.xDiff=Math.abs(this.x-t),this.yDiff=Math.abs(this.y-n)}},u={get:function(e){var t=0,n=0;if(e.offsetParent)do t+=e.offsetLeft,n+=e.offsetTop;while(e=e.offsetParent);return[t,n]}};return e}),define("core/base/data_widget",["core/base/component"],function(e){var t=function(t){e.call(this,t)};return t.prototype=Object.create(e.prototype),t.prototype.onMetaUpdate=function(e){},t.prototype.onUpdate=function(e){},t}),define("core/base/tuning_components",["core/config","core/base/data_widget","core/base/component"],function(e,t,n){var r=function(e){t.call(this,e)};r.prototype=Object.create(t.prototype),r.prototype.onSaveSlotUpdate=function(e){};var i=function(e){t.call(this,e)};i.prototype=Object.create(t.prototype);var s={TunableWidget:r,ObservableWidget:i};return s}),define("core/util/spinner",[],function(){var e=function(e,t){this.value=e.value||0,this.decimals=e.dec||4,this.min=e.min||0,this.max=e.max||1,this.callback=t,this.stepDecimals=this.decimals,this.timerStep=null,this.timerIncrease=null,this.timerForward=null;var n=this;this.doStep=function(e){var t=Math.pow(10,-n.stepDecimals);n.value+=e*t,n.value=parseFloat(n.value.toFixed(n.stepDecimals)),n.value<n.min&&(n.value=n.min),n.value>n.max&&(n.value=n.max),n.callback&&n.callback(n.value)}};return e.prototype.start=function(e){var t=this;this.stepDecimals=this.decimals,t.doStep(e),t.timerForward=setTimeout(function(){t.timerStep=setInterval(function(){t.doStep(e)},100),t.timerIncrease=setInterval(function(){t.stepDecimals>1&&(t.stepDecimals-=1)},1500)},250)},e.prototype.stop=function(){this.timerStep!=null&&(clearInterval(this.timerStep),this.timerStep=null),this.timerIncrease!=null&&(clearInterval(this.timerIncrease),this.timerIncrease=null),this.timerForward!=null&&(clearInterval(this.timerForward),this.timerForward=null)},e}),define("vas-basic/components/tuning/tunable",["jquery","dragdealer","core/registry","core/ui","core/base/tuning_components","core/util/spinner"],function(e,t,n,r,i,s){var o=function(t){i.TunableWidget.call(this,t),this.value=0,this.meta={},this.markers=[],this.lastMarkerInfo={},this.idleTimer=0,this.spinner=null,this.dragdealer=null,this.elmTitle=e('<div class="title"></div>'),this.hostDOM.append(this.elmTitle),this.elmSlider=e('<div class="slider"></div>'),this.hostDOM.append(this.elmSlider),this.elmMarkers=e('<div class="markers"></div>'),this.hostDOM.append(this.elmMarkers),this.elmDragHost=e('<div class="draghost"></div>'),this.elmSlider.append(this.elmDragHost),this.elmDragDealer=e('<div class="dragdealer"></div>'),this.elmDragHost.append(this.elmDragDealer),this.elmDragHandle=e('<div class="handle">0.000</div>'),this.elmDragDealer.append(this.elmDragHandle),this.elmDragArrow=e('<div class="arrow"></div>'),this.elmDragHost.append(this.elmDragArrow),this.btnMinus=e('<a class="minus">-</div>'),this.elmDragHost.append(this.btnMinus),this.btnPlus=e('<a class="plus">+</div>'),this.elmDragHost.append(this.btnPlus),this.dragdealer=null;var s=0;this.elmTitle.mouseenter(function(){clearTimeout(s),s=setTimeout(function(){r.showPopup("widget.onscreen",this.hostDOM,function(e){var t=n.instanceComponent("infoblock.tunable",e);t?(t.onMetaUpdate(this.meta),t.onUpdate(this.getValue()),this.adoptEvents(t)):console.warn("Could not instantiate tunable infoblock!")}.bind(this),{offset:e(this.hostDOM).width()/2+20,title:this.meta.info.name})}.bind(this),250)}.bind(this)),this.hostDOM.mouseleave(function(){clearTimeout(s),s=setTimeout(function(){r.hidePopup()}.bind(this),100)}.bind(this)),this.updateMarkers([null,null,null,null])};o.prototype=Object.create(i.TunableWidget.prototype),o.prototype.handleValueChange=function(e,t){this.value=e,this.update(),t==1?this.spinner&&(this.spinner.value=this.getValue()):t==2&&this.dragdealer&&this.dragdealer.setValue(this.value,0,!0),clearTimeout(this.idleTimer),this.idleTimer=setTimeout(function(){this.trigger("valueChanged",this.getValue())}.bind(this),250)},o.prototype.renderValue=function(){var e=this.getValue(),t=0;return this.meta.value&&this.meta["value"]["dec"]!=undefined&&(t=this.meta.value.dec),e.toFixed(t)},o.prototype.getValue=function(){if(!this.meta.value)return this.value;var e=this.meta.value.min+(this.meta.value.max-this.meta.value.min)*this.value;return parseFloat(e.toFixed(this.meta.value.dec||2))},o.prototype.unmapValue=function(e){return e==undefined||e==null?e:this.meta.value?(e-this.meta.value.min)/(this.meta.value.max-this.meta.value.min):this.value=e},o.prototype.update=function(){this.elmDragHandle.html(this.renderValue());var t=20,n=10,r=e(this.elmDragDealer).width()-n;this.elmDragArrow.css({left:t+r*this.value});for(var i=0;i<this.markers.length;i++)this.markers[i].v?this.markers[i].e.show():this.markers[i].e.hide(),this.markers[i].e.css({left:r*this.markers[i].v}),this.markers[i].eArrow.css({"border-bottom-color":"#3498db"}),this.markers[i].eLabel.css({color:"#3498db"})},o.prototype.updateMarkers=function(t){this.elmMarkers.empty(),this.markers=[];for(var n=0;n<t.length;n++){var r=t[n],i=e('<div class="marker"></div>'),s=e('<div class="arrow"></div>'),o=e('<div class="label"></div>');i.append(s),i.append(o),this.elmMarkers.append(i),o.text(n+1),i.click(function(e){return function(t){t.preventDefault(),t.stopPropagation(),this.dragdealer.setValue(this.markers[e].v,0)}}(this.markers.length).bind(this)),this.markers.push({e:i,eArrow:s,eLabel:o,v:r}),r||i.hide()}this.update()},o.prototype.onSaveSlotUpdate=function(e,t){this.markers[e].v=this.unmapValue(t),this.update()},o.prototype.onUpdate=function(e){this.value=this.unmapValue(e);if(this.dragdealer==null)return;this.dragdealer.setValue(this.value,0)},o.prototype.onMetaUpdate=function(e){this.meta=e,this.elmTitle.text(e.info["short"]);if(this.spinner)return;this.spinner=new s(this.meta.value,function(e){this.handleValueChange(this.unmapValue(e),2)}.bind(this)),this.btnPlus.mousedown(function(e){e.preventDefault(),e.stopPropagation(),this.spinner.start(1)}.bind(this)),this.btnPlus.mouseup(function(e){e.preventDefault(),e.stopPropagation(),this.spinner.stop()}.bind(this)),this.btnMinus.mousedown(function(e){e.preventDefault(),e.stopPropagation(),this.spinner.start(-1)}.bind(this)),this.btnMinus.mouseup(function(e){e.preventDefault(),e.stopPropagation(),this.spinner.stop()}.bind(this))},o.prototype.onResize=function(e,t){this.width=e,this.height=t,this.update()},o.prototype.onWillShow=function(e){setTimeout(this.update.bind(this),100),e()},o.prototype.onShown=function(){if(this.dragdealer!=null)return;this.dragdealer=new t(this.elmDragDealer[0],{horizontal:!0,vertical:!1,slide:!1,requestAnimationFrame:!0,value:this.value,animationCallback:function(e,t){this.handleValueChange(e,1)}.bind(this)})},n.registerComponent("widget.tunable.tuning",o,1)}),define("core/util/math",["core/config"],function(e){var t={};return t.mapChiSq=function(t,n,r,i){i||(i=function(e){return Math.log(e)/Math.log(10)});var s=e["chi2-bounds"].min,o=e["chi2-bounds"].max;if(t<s)return n;if(t>o)return r;var u=i(s),a=i(o),f=i(t);return(r-n)/(a-u)*(f-u)+n},t}),define("liveq/Calculate",[],function(){var e={};return e.chi2Bins=function(e,t,n){if(t.bins!=e.bins)return null;var r=[];n||(n=.05);for(var i=0;i<e.bins;i++){if(e.values[i][0]==0&&t.values[i][0]==0)return r.push(0),null;if(e.values[i][0]==0||t.values[i][0]==0){r.push(0);continue}var s=e.values[i][0],o=t.values[i][0],u,a;s>o?(u=e.values[i][2],a=t.values[i][1]):(u=e.values[i][1],a=t.values[i][2]);var f=(s-o)*(s-o),l=a*a+u*u+n*s*n*s;if(l==0){r.push(0);continue}var c=f/l;r.push(c)}return r},e.chi2=function(t,n,r){var i=e.chi2Bins(t,n,r),s=0;for(var o=0;o<i.length;o++)s+=i[o];return s/=i.length,s},e.chi2WithError=function(e,t,n){if(t.bins!=e.bins)return null;var r=0,i=0,s=0;n||(n=.05);for(var o=0;o<e.bins;o++){var u=1,a=e.values[o][0],f=t.values[o][0],l=t.values[o][1],c=t.values[o][2],h=0;f==0?console.warn("yData=0 on bin #",o," between: ",e,t):h=a/f;var p=l/f,d=c/f,v=n/f,m=n/f;if(h!=0){s++;var g=h>1?Math.pow(h-1,2)/(Math.pow(p,2)+Math.pow(.05*h,2)):Math.pow(h-1,2)/(Math.pow(d,2)+Math.pow(.05*h,2)),y=h>1?g*4*Math.pow(u*v,2)/(Math.pow(p,2)+Math.pow(.05,2)):g*4*Math.pow(u*m,2)/(Math.pow(d,2)+Math.pow(.05,2));r+=g,i+=y}}var b=r/s,w=Math.sqrt(i)/s;return[b,w]},e}),define("vas-basic/components/tuning/observable",["jquery","core/registry","core/ui","core/base/tuning_components","core/config","core/util/math","liveq/Calculate"],function(e,t,n,r,i,s,o){var u=function(e){r.ObservableWidget.call(this,e),this.x=0,this.y=0,this.active=!0,this.diameter=45,this.mouseOver=!1,this._handleTimer=0,this.value=null,this.element=$('<div class="grey"></div>'),e.append(this.element),this.indicator=$('<div class="indicator"></div>'),e.append(this.indicator),this.element.addClass("observable"),this.element.addClass("sz-big"),this.element.mouseenter(function(){this.mouseOver=!0,this.active&&this.handleFocus()}.bind(this)),this.element.mouseleave(function(){this.mouseOver=!1,this.handleBlur()}.bind(this)),this.element.click(function(){this.trigger("click")}.bind(this))};u.prototype=Object.create(r.ObservableWidget.prototype),u.prototype.onMetaUpdate=function(e){this.meta=e,this.element.text(e.info["short"])},u.prototype.onUpdate=function(e){e==undefined?this.value=null:this.value=e,this.update()},u.prototype.handleFocus=function(){clearTimeout(this._handleTimer),this._handleTimer=setTimeout(function(){n.showPopup("widget.onscreen",this.x,this.y,function(e){var n=t.instanceComponent("infoblock.observable",e);n?(n.onMetaUpdate(this.meta),n.onUpdate(this.value),this.adoptEvents(n)):console.warn("Could not instantiate observable infoblock!")}.bind(this),{offset:50,title:this.meta.info.name})}.bind(this),250)},u.prototype.handleBlur=function(){clearTimeout(this._handleTimer),this._handleTimer=setTimeout(function(){n.hidePopup()}.bind(this),100)},u.prototype.setActive=function(e){this.active=e,e?(this.element.removeClass("inactive"),this.onHorizonTopChanged(this.bottom),this.mouseOver&&this.handleFocus()):(this.element.addClass("inactive"),this.indicator.hide())},u.prototype.getValue=function(){if(!this.value)return i["chi2-bounds"].max;var e=o.chi2WithError(this.value.data,this.value.ref.data);return e[0]},u.prototype.onHorizonTopChanged=function(e){this.bottom=e;if(!this.active)return;this.y>this.bottom?(this.indicator.css({top:e-15}),this.indicator.show()):this.indicator.hide()},u.prototype.setRadialConfig=function(e,t,n){e!==undefined&&(this.minDistance=e),t!==undefined&&(this.maxDistance=t),n!==undefined&&(this.angle=n||0),this.update()},u.prototype.onResize=function(e,t){this.width=e,this.height=t,this.pivotX=e/2+this.left,this.pivotY=t/2+this.top,this.update()},u.prototype.update=function(){var e=this.getValue(),t=s.mapChiSq(e,this.minDistance,this.maxDistance);this.x=this.pivotX+Math.sin(this.angle)*t,this.y=this.pivotY+Math.cos(this.angle)*t,e<=i["chi2-bounds"].good?(this.element.removeClass("grey"),this.element.addClass("green")):(this.element.removeClass("green"),this.element.addClass("grey")),this.element.css({left:this.x-this.diameter/2,top:this.y-this.diameter/2}),this.indicator.css({left:this.x-10})},t.registerComponent("widget.observable.tuning",u,1)}),define("vas-basic/components/tuning/status-tune",["jquery","core/registry","core/ui","core/base/data_widget","core/config"],function(e,t,n,r,i){var s=function(e){r.call(this,e),this.diameter=160,this.element=$('<div class="progress-widget"></div>'),e.append(this.element);var t=this,n=function(e,n){var r=$('<div class="c-marker"></div>'),i=$('<div class="label">'+n+"</div>");return r.css({left:t.diameter/2-e,top:t.diameter/2-e,width:2*e,height:2*e,"border-radius":e,"-webkit-border-radius":e,"-moz-border-radius":e,"-o-border-radius":e}),r.append(i),r};this.titleElm=$('<div class="title">Tune</div>'),this.subtitleElm=$('<div class="subtitle">Slide</div>'),this.element.append(this.titleElm),this.element.append(this.subtitleElm)};s.prototype=Object.create(r.prototype),s.prototype.onMetaUpdate=function(e){},s.prototype.onUpdate=function(e){},s.prototype.onResize=function(e,t){this.width=e,this.height=t;var n=this.left+this.width/2,r=this.top+this.height/2;this.element.css({left:n-this.diameter/2,top:r-this.diameter/2})},t.registerComponent("widget.tuning.status-tune",s,1)}),define("vas-basic/components/tuning/status-observe",["jquery","core/registry","core/ui","core/base/data_widget","core/config","core/util/math"],function(e,t,n,r,i,s){var o=function(e){r.call(this,e),this.diameter=160,this.minValue=.2,this.maxValue=1e3,this.shownVisualAid=!1,this.element=$('<div class="progress-widget"></div>'),e.append(this.element),this.element.append(this.elmChiGood=this.createRadialMarker(1,"Target","#2ecc71","#2ecc71")),this.element.append(this.elmChiAverage=this.createRadialMarker(1,"&chi;<sup>2</sup> = "+i["chi2-bounds"].average)),this.knobConfig={min:0,max:100,width:this.diameter-12,height:this.diameter-12,thickness:.35,angleArc:270,angleOffset:-135,readOnly:!0,className:"knob",fgColor:"#16a085",bgColor:"#bdc3c7"},this.progressKnob=$('<input type="text" value="25" />'),this.element.append(this.progressKnob),this.progressKnob.knob(this.knobConfig),this.startIcon=$('<a href="do:begin" class="button">Validate</a>'),this.element.append(this.startIcon),this.startIcon.click(function(e){e.preventDefault(),e.stopPropagation(),this.trigger("begin")}.bind(this)),this.element.append('<div class="message"><span class="uicon uicon-warning"></span><br/>Results are estimated!</div>'),t.registerVisualAid("tuning.status",this.element,{screen:"screen.tuning"}),t.registerVisualAid("tuning.button.begin",this.startIcon,{screen:"screen.tuning"}),t.registerVisualAid("tuning.marker.target",this.elmChiGood,{screen:"screen.tuning"})};o.prototype=Object.create(r.prototype),o.prototype.createRadialMarker=function(e,t,n,r,i){var s=i||1,o=$('<div class="c-marker"></div>'),u=$('<div class="label">'+t+"</div>");o.css({left:this.diameter/2-e-s/2,top:this.diameter/2-e-s/2,width:2*e-s,height:2*e-s,"border-radius":e+s/2,"-webkit-border-radius":e+s/2,"-moz-border-radius":e+s/2,"-o-border-radius":e+s/2,"z-index":-1}),n&&(o.css({"border-color":n}),u.css({color:n}));if(r){var a=0,f=0,l=0;r[0]=="#"&&(a=parseInt(r.substr(1,2),16),f=parseInt(r.substr(3,2),16),l=parseInt(r.substr(5,2),16)),o.css({"background-color":"rgba("+a+","+f+","+l+",0.3)"})}return o.append(u),o},o.prototype.updateRadialMarker=function(e,t,n){var r=n||1;e.css({left:this.diameter/2-t-r/2,top:this.diameter/2-t-r/2,width:2*t-r,height:2*t-r,"border-radius":t+r/2,"-webkit-border-radius":t+r/2,"-moz-border-radius":t+r/2,"-o-border-radius":t+r/2})},o.prototype.onShown=function(){n.showFirstTimeAid("tuning.status"),n.showFirstTimeAid("tuning.marker.target")},o.prototype.onMetaUpdate=function(e){},o.prototype.onUpdate=function(e){if(e==undefined){this.progressKnob.val(0).trigger("change");return}e<=i["chi2-bounds"].good?(this.knobConfig.fgColor="#16a085",this.progressKnob.trigger("configure",this.knobConfig),this.shownVisualAid||(this.shownVisualAid=!0,n.showFirstTimeAid("tuning.button.begin"))):e<=i["chi2-bounds"].average?(this.knobConfig.fgColor="#f39c12",this.progressKnob.trigger("configure",this.knobConfig)):(this.knobConfig.fgColor="#e74c3c",this.progressKnob.trigger("configure",this.knobConfig)),this.progressKnob.val(100-s.mapChiSq(e,0,100)).trigger("change")},o.prototype.onResize=function(e,t){this.width=e,this.height=t;var n=this.left+this.width/2,r=this.top+this.height/2;this.element.css({left:n-this.diameter/2,top:r-this.diameter/2})},o.prototype.setRadialConfig=function(e,t){this.updateRadialMarker(this.elmChiGood,s.mapChiSq(i["chi2-bounds"].good,e,t)),this.updateRadialMarker(this.elmChiAverage,s.mapChiSq(i["chi2-bounds"].average,e,t))},t.registerComponent("widget.tuning.status-observe",o,1)}),define("vas-basic/components/tuning/pin",["jquery","core/registry","core/base/component","core/config"],function(e,t,n,r){var i=function(e){n.call(this,e),this.scrollerView=$('<div class="scroller"></div>'),this.hostDOM.append(this.scrollerView)};i.prototype=Object.create(n.prototype),i.prototype.onResize=function(e,t){},t.registerComponent("screen.tuning.pin",i,1)}),define("vas-basic/components/running/observable",["jquery","core/registry","core/ui","core/base/tuning_components","core/config","core/util/math","liveq/Calculate"],function(e,t,n,r,i,s,o){var u=function(e){r.ObservableWidget.call(this,e),this.x=0,this.y=0,this.active=!0,this.diameter=45,this.mouseOver=!1,this._handleTimer=0,this.value=null,this.element=$('<div class="grey"></div>'),e.append(this.element),this.indicator=$('<div class="indicator"></div>'),e.append(this.indicator),this.element.addClass("observable"),this.element.addClass("sz-big"),this.element.mouseenter(function(){this.mouseOver=!0,this.active&&this.handleFocus()}.bind(this)),this.element.mouseleave(function(){this.mouseOver=!1,this.handleBlur()}.bind(this)),this.element.click(function(){this.trigger("click")}.bind(this))};u.prototype=Object.create(r.ObservableWidget.prototype),u.prototype.onMetaUpdate=function(e){this.meta=e,this.element.text(e.info["short"])},u.prototype.onUpdate=function(e){e==undefined?this.value=null:this.value=e,this.update()},u.prototype.handleFocus=function(){clearTimeout(this._handleTimer),this._handleTimer=setTimeout(function(){n.showPopup("widget.onscreen",this.x,this.y,function(e){var n=t.instanceComponent("infoblock.observable",e);n?(n.onMetaUpdate(this.meta),n.onUpdate(this.value),this.adoptEvents(n)):console.warn("Could not instantiate observable infoblock!")}.bind(this),{offset:50,title:this.meta.info.name})}.bind(this),250)},u.prototype.handleBlur=function(){clearTimeout(this._handleTimer),this._handleTimer=setTimeout(function(){n.hidePopup()}.bind(this),100)},u.prototype.setActive=function(e){this.active=e,e?(this.element.removeClass("inactive"),this.onHorizonTopChanged(this.bottom),this.mouseOver&&this.handleFocus()):(this.element.addClass("inactive"),this.indicator.hide())},u.prototype.getValue=function(){if(!this.value)return 0;for(var e=0;e<this.value.data.bins.length;e++);var t=o.chi2WithError(this.value.data,this.value.ref.data);return t[0]},u.prototype.onHorizonTopChanged=function(e){this.bottom=e;if(!this.active)return;this.y>this.bottom?(this.indicator.css({top:e-15}),this.indicator.show()):this.indicator.hide()},u.prototype.setRadialConfig=function(e,t,n){e!==undefined&&(this.minDistance=e),t!==undefined&&(this.maxDistance=t),n!==undefined&&(this.angle=n||0),this.update()},u.prototype.onResize=function(e,t){this.width=e,this.height=t,this.pivotX=e/2+this.left,this.pivotY=t/2+this.top,this.update()},u.prototype.update=function(){var e=this.getValue(),t=s.mapChiSq(e,this.minDistance,this.maxDistance);this.x=this.pivotX+Math.sin(this.angle)*t,this.y=this.pivotY+Math.cos(this.angle)*t,e<=i["chi2-bounds"].good?(this.element.removeClass("grey"),this.element.addClass("green")):(this.element.removeClass("green"),this.element.addClass("grey")),this.element.css({left:this.x-this.diameter/2,top:this.y-this.diameter/2}),this.indicator.css({left:this.x-10})},t.registerComponent("widget.observable.running",u,1)}),define("vas-basic/components/running/status",["jquery","core/registry","core/ui","core/base/data_widget"],function(e,t,n,r){var i=function(e){r.call(this,e),this.diameter=200,this.shootRadius=200,this.shootZoneWidth=40,this.pinIDs={},this.element=$('<div class="progress-widget"></div>'),e.append(this.element),this.abortIcon=$('<a href="do:abort" class="button"><div>Abort</div></a>'),this.element.append(this.abortIcon),this.abortIcon.click(function(e){e.preventDefault(),e.stopPropagation(),this.trigger("abort")}.bind(this)),this.progressKnob=$('<input type="text" value="25" />'),this.progressKnobBlur=$('<input type="text" value="25" />'),this.element.append(this.progressKnob),this.element.append(this.progressKnobBlur),this.progressKnob.knob({min:0,max:100,width:this.diameter-12,height:this.diameter-12,thickness:.1,angleArc:270,angleOffset:45,readOnly:!0,className:"knob",fgColor:"#22b573",bgColor:"#EFEFEF"}),this.progressKnobBlur.knob({min:0,max:100,width:this.diameter-12,height:this.diameter-12,thickness:.1,angleArc:270,angleOffset:45,readOnly:!0,className:"knob blur",fgColor:"#22b573",bgColor:"transparent"}),this.shootTarget=250,this.element.append(this.elmShootZone=this.createRadialMarker(this.shootTarget,"","#2ecc71","",this.shootZoneWidth)),this.element.append(this.elmShootMin=this.createRadialMarker(this.shootTarget-this.shootZoneWidth/2,"","#2ecc71")),this.element.append(this.elmShootMax=this.createRadialMarker(this.shootTarget+this.shootZoneWidth/2,"Your target","#2ecc71")),this.elmShootZone.css({"border-style":"solid","border-width":this.shootZoneWidth,opacity:.3}),this.globeDOM=$('<div class="globe"></div>'),this.element.append(this.globeDOM),this.globe=t.instanceComponent("widget.globe3d",this.globeDOM),this.globe?(this.forwardVisualEvents(this.globe),this.globe.onResize(this.diameter,this.diameter)):console.warn("Unable to instantiate Glob3D widget"),t.registerVisualAid("running.button.abort",this.abortIcon,{screen:"screen.running"})};i.prototype=Object.create(r.prototype),i.prototype.createRadialMarker=function(e,t,n,r,i){var s=i||1,o=$('<div class="c-marker"></div>'),u=$('<div class="label">'+t+"</div>");o.css({left:this.diameter/2-e-s/2,top:this.diameter/2-e-s/2,width:2*e-s,height:2*e-s,"border-radius":e+s/2,"-webkit-border-radius":e+s/2,"-moz-border-radius":e+s/2,"-o-border-radius":e+s/2}),n&&(o.css({"border-color":n}),u.css({color:n}));if(r){var a=0,f=0,l=0;r[0]=="#"&&(a=parseInt(r.substr(1,2),16),f=parseInt(r.substr(3,2),16),l=parseInt(r.substr(5,2),16)),o.css({"background-color":"rgba("+a+","+f+","+l+",0.3)"})}return o.append(u),o},i.prototype.updateRadialMarker=function(e,t,n){var r=n||1;e.css({left:this.diameter/2-t-r/2,top:this.diameter/2-t-r/2,width:2*t-r,height:2*t-r,"border-radius":t+r/2,"-webkit-border-radius":t+r/2,"-moz-border-radius":t+r/2,"-o-border-radius":t+r/2})},i.prototype.onShown=function(){n.showFirstTimeAid("running.button.abort")},i.prototype.onWorkerRemoved=function(e){this.globe.removePin(this.pinIDs[e]),delete this.pinIDs[e]},i.prototype.onWorkerAdded=function(e,t){var n=t.lat||Math.random()*180-90,r=t.lng||Math.random()*180;this.pinIDs[e]=this.globe.addPin(n,r)},i.prototype.onStartRun=function(e,t){this.pinIDs={},this.globe.removeAllPins()},i.prototype.onMetaUpdate=function(e){},i.prototype.onUpdate=function(e){if(e==undefined){this.progressKnob.val(0).trigger("change"),this.progressKnobBlur.val(0).trigger("change");return}this.progressKnob.val(e*100).trigger("change"),this.progressKnobBlur.val(e*100).trigger("change")},i.prototype.onHorizonTopChanged=function(e){this.bottom=e,this.y>this.bottom?(this.indicator.css({top:e-15}),this.indicator.fadeIn()):this.indicator.fadeOut()},i.prototype.setPosition=function(e,t){this.element.css({left:e-this.diameter/2,top:t-this.diameter/2})},t.registerComponent("widget.running_status",i,1)}),define("vas-basic/components/onscreen",["jquery","core/registry","core/base/components"],function(e,t,n){var r=function(e){n.Popup.call(this,e),this.anchor={x:0,y:0},this.offsetX=0,this.offsetY=0,this.fixedWidth=350,this.fixedHeight=250,this.side=0,this.visible=!1,this.mouseOver=!1,this.element=$('<div class="onscreen"></div>'),e.append(this.element),this.bulletElm=$('<div class="bullet"></div>'),this.titleElm=$('<div class="title">Details on the parameter</div>'),this.element.append(this.bulletElm),this.element.append(this.titleElm),this.textContainer=$('<div class="document"></div>'),this.element.append(this.textContainer),this.textContainer.append($("<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis ullamcorper est at massa euismod sodales. In tincidunt mauris posuere, ornare sem ac, molestie diam. Maecenas ultrices ultricies purus, vel adipiscing leo ultrices vitae. Maecenas vestibulum, augue fermentum tincidunt tempus, diam libero cursus sem, ac vestibulum dui odio ut risus. Proin mi turpis, posuere et tristique pellentesque, condimentum sed lacus. Nulla at purus id leo vehicula mattis. Duis rhoncus mi at est lobortis hendrerit. Donec commodo accumsan mi a sodales. Vivamus cursus semper interdum.</p>")),this.textContainer.append($("<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis ullamcorper est at massa euismod sodales. In tincidunt mauris posuere, ornare sem ac, molestie diam. Maecenas ultrices ultricies purus, vel adipiscing leo ultrices vitae. Maecenas vestibulum, augue fermentum tincidunt tempus, diam libero cursus sem, ac vestibulum dui odio ut risus. Proin mi turpis, posuere et tristique pellentesque, condimentum sed lacus. Nulla at purus id leo vehicula mattis. Duis rhoncus mi at est lobortis hendrerit. Donec commodo accumsan mi a sodales. Vivamus cursus semper interdum.</p>")),this.mouseOutCallback=!1,this.element.mouseenter(function(){this.mouseOver=!0}.bind(this)),this.element.mouseleave(function(){this.mouseOver=!1,this.visible||(this.element.removeClass("visible"),this.mouseOutCallback&&this.mouseOutCallback())}.bind(this))};r.prototype=Object.create(n.Popup.prototype),r.prototype.onAnchorUpdate=function(e,t){this.anchor.x=e,this.anchor.y=t,this.side=1,this.anchor.x+this.offsetX+this.fixedWidth>this.width&&(this.side=0),this.anchor.y-this.offsetY-this.fixedHeight/2<0&&(this.anchor.y=this.fixedHeight/2-this.offsetY),this.anchor.y+this.offsetY+this.fixedHeight/2>this.height&&(this.anchor.y=this.height-this.fixedHeight/2-this.offsetY),this.update()},r.prototype.onPopupConfig=function(e,t){t&&(this.textContainer.empty(),t(this.textContainer)),e.title&&this.titleElm.html(e.title),e.offset&&(this.offsetX=e.offset),e["offset-x"]&&(this.offsetX=e["offset-x"]),e["offset-y"]&&(this.offsetY=e["offset-y"]),e.color&&this.bulletElm.css("background-color",e.color)},r.prototype.onWillShow=function(e){this.visible||(this.element.addClass("visible"),this.visible=!0),e()},r.prototype.onWillHide=function(e){this.visible?(this.visible=!1,this.mouseOver?this.mouseOutCallback=e:(this.element.removeClass("visible"),e())):e()},r.prototype.update=function(){this.side==0?(this.element.removeClass("right"),this.element.addClass("left"),this.element.css({left:this.anchor.x-this.fixedWidth-this.offsetX,top:this.anchor.y-this.fixedHeight/2+this.offsetY,width:this.fixedWidth,height:this.fixedHeight})):(this.element.removeClass("left"),this.element.addClass("right"),this.element.css({left:this.anchor.x+this.offsetX,top:this.anchor.y-this.fixedHeight/2+this.offsetY,width:this.fixedWidth,height:this.fixedHeight}))},t.registerComponent("widget.onscreen",r,1)});var fabric=fabric||{version:"1.4.9"};typeof exports!="undefined"&&(exports.fabric=fabric),typeof document!="undefined"&&typeof window!="undefined"?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom("<!DOCTYPE html><html><head></head><body></body></html>"),fabric.window=fabric.document.createWindow()),fabric.isTouchSupported="ontouchstart"in fabric.document.documentElement,fabric.isLikelyNode=typeof Buffer!="undefined"&&typeof window=="undefined",fabric.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width"],fabric.DPI=96,function(){function e(e,t){if(!this.__eventListeners[e])return;t?fabric.util.removeFromArray(this.__eventListeners[e],t):this.__eventListeners[e].length=0}function t(e,t){this.__eventListeners||(this.__eventListeners={});if(arguments.length===1)for(var n in e)this.on(n,e[n]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(t);return this}function n(t,n){if(!this.__eventListeners)return;if(arguments.length===0)this.__eventListeners={};else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in t)e.call(this,r,t[r]);else e.call(this,t,n);return this}function r(e,t){if(!this.__eventListeners)return;var n=this.__eventListeners[e];if(!n)return;for(var r=0,i=n.length;r<i;r++)n[r].call(this,t||{});return this}fabric.Observable={observe:t,stopObserving:n,fire:r,on:t,off:n,trigger:r}}(),fabric.Collection={add:function(){this._objects.push.apply(this._objects,arguments);for(var e=0,t=arguments.length;e<t;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.renderAll(),this},insertAt:function(e,t,n){var r=this.getObjects();return n?r[t]=e:r.splice(t,0,e),this._onObjectAdded(e),this.renderOnAddRemove&&this.renderAll(),this},remove:function(){var e=this.getObjects(),t;for(var n=0,r=arguments.length;n<r;n++)t=e.indexOf(arguments[n]),t!==-1&&(e.splice(t,1),this._onObjectRemoved(arguments[n]));return this.renderOnAddRemove&&this.renderAll(),this},forEachObject:function(e,t){var n=this.getObjects(),r=n.length;while(r--)e.call(t,n[r],r,n);return this},getObjects:function(e){return typeof e=="undefined"?this._objects:this._objects.filter(function(t){return t.type===e})},item:function(e){return this.getObjects()[e]},isEmpty:function(){return this.getObjects().length===0},size:function(){return this.getObjects().length},contains:function(e){return this.getObjects().indexOf(e)>-1},complexity:function(){return this.getObjects().reduce(function(e,t){return e+=t.complexity?t.complexity():0,e},0)}},function(e){var t=Math.sqrt,n=Math.atan2,r=Math.PI/180;fabric.util={removeFromArray:function(e,t){var n=e.indexOf(t);return n!==-1&&e.splice(n,1),e},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},degreesToRadians:function(e){return e*r},radiansToDegrees:function(e){return e/r},rotatePoint:function(e,t,n){var r=Math.sin(n),i=Math.cos(n);e.subtractEquals(t);var s=e.x*i-e.y*r,o=e.x*r+e.y*i;return(new fabric.Point(s,o)).addEquals(t)},transformPoint:function(e,t,n){return n?new fabric.Point(t[0]*e.x+t[1]*e.y,t[2]*e.x+t[3]*e.y):new fabric.Point(t[0]*e.x+t[1]*e.y+t[4],t[2]*e.x+t[3]*e.y+t[5])},invertTransform:function(e){var t=e.slice(),n=1/(e[0]*e[3]-e[1]*e[2]);t=[n*e[3],-n*e[1],-n*e[2],n*e[0],0,0];var r=fabric.util.transformPoint({x:e[4],y:e[5]},t);return t[4]=-r.x,t[5]=-r.y,t},toFixed:function(e,t){return parseFloat(Number(e).toFixed(t))},parseUnit:function(e){var t=/\D{0,2}$/.exec(e),n=parseFloat(e);switch(t[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return n*fabric.DPI/72*12;default:return n}},falseFunction:function(){return!1},getKlass:function(e,t){return e=fabric.util.string.camelize(e.charAt(0).toUpperCase()+e.slice(1)),fabric.util.resolveNamespace(t)[e]},resolveNamespace:function(t){if(!t)return fabric;var n=t.split("."),r=n.length,i=e||fabric.window;for(var s=0;s<r;++s)i=i[n[s]];return i},loadImage:function(e,t,n,r){if(!e){t&&t.call(n,e);return}var i=fabric.util.createImage();i.onload=function(){t&&t.call(n,i),i=i.onload=i.onerror=null},i.onerror=function(){fabric.log("Error loading "+i.src),t&&t.call(n,null,!0),i=i.onload=i.onerror=null},e.indexOf("data")!==0&&typeof r!="undefined"&&(i.crossOrigin=r),i.src=e},enlivenObjects:function(e,t,n,r){function i(){++o===u&&t&&t(s)}e=e||[];var s=[],o=0,u=e.length;if(!u){t&&t(s);return}e.forEach(function(e,t){if(!e||!e.type){i();return}var o=fabric.util.getKlass(e.type,n);o.async?o.fromObject(e,function(n,o){o||(s[t]=n,r&&r(e,s[t])),i()}):(s[t]=o.fromObject(e),r&&r(e,s[t]),i())})},groupSVGElements:function(e,t,n){var r;return r=new fabric.PathGroup(e,t),typeof n!="undefined"&&r.setSourcePath(n),r},populateWithProperties:function(e,t,n){if(n&&Object.prototype.toString.call(n)==="[object Array]")for(var r=0,i=n.length;r<i;r++)n[r]in e&&(t[n[r]]=e[n[r]])},drawDashedLine:function(e,r,i,s,o,u){var a=s-r,f=o-i,l=t(a*a+f*f),c=n(f,a),h=u.length,p=0,v=!0;e.save(),e.translate(r,i),e.moveTo(0,0),e.rotate(c),r=0;while(l>r)r+=u[p++%h],r>l&&(r=l),e[v?"lineTo":"moveTo"](r,0),v=!v;e.restore()},createCanvasElement:function(e){return e||(e=fabric.document.createElement("canvas")),!e.getContext&&typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement(e),e},createImage:function(){return fabric.isLikelyNode?new(require("canvas").Image):fabric.document.createElement("img")},createAccessors:function(e){var t=e.prototype;for(var n=t.stateProperties.length;n--;){var r=t.stateProperties[n],i=r.charAt(0).toUpperCase()+r.slice(1),s="set"+i,o="get"+i;t[o]||(t[o]=function(e){return new Function('return this.get("'+e+'")')}(r)),t[s]||(t[s]=function(e){return new Function("value",'return this.set("'+e+'", value)')}(r))}},clipContext:function(e,t){t.save(),t.beginPath(),e.clipTo(t),t.clip()},multiplyTransformMatrices:function(e,t){var n=[[e[0],e[2],e[4]],[e[1],e[3],e[5]],[0,0,1]],r=[[t[0],t[2],t[4]],[t[1],t[3],t[5]],[0,0,1]],i=[];for(var s=0;s<3;s++){i[s]=[];for(var o=0;o<3;o++){var u=0;for(var a=0;a<3;a++)u+=n[s][a]*r[a][o];i[s][o]=u}}return[i[0][0],i[1][0],i[0][1],i[1][1],i[0][2],i[1][2]]},getFunctionBody:function(e){return(String(e).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},normalizePoints:function(e,t){var n=fabric.util.array.min(e,"x"),r=fabric.util.array.min(e,"y");n=n<0?n:0,r=n<0?r:0;for(var i=0,s=e.length;i<s;i++)e[i].x-=t.width/2+n||0,e[i].y-=t.height/2+r||0},isTransparent:function(e,t,n,r){r>0&&(t>r?t-=r:t=0,n>r?n-=r:n=0);var i=!0,s=e.getImageData(t,n,r*2||1,r*2||1);for(var o=3,u=s.data.length;o<u;o+=4){var a=s.data[o];i=a<=0;if(i===!1)break}return s=null,i}}}(typeof exports!="undefined"?exports:this),function(){function i(t,i,o,u,f,l,h,p,v){r=n.call(arguments);if(e[r])return e[r];var m=s(h,o,u,p,v,t,i),y=(m.x1-m.x0)*(m.x1-m.x0)+(m.y1-m.y0)*(m.y1-m.y0),b=1/y-.25;b<0&&(b=0);var w=Math.sqrt(b);l===f&&(w=-w);var E=.5*(m.x0+m.x1)-w*(m.y1-m.y0),S=.5*(m.y0+m.y1)+w*(m.x1-m.x0),x=Math.atan2(m.y0-S,m.x0-E),T=Math.atan2(m.y1-S,m.x1-E),N=T-x;N<0&&l===1?N+=2*Math.PI:N>0&&l===0&&(N-=2*Math.PI);var C=Math.ceil(Math.abs(N/(Math.PI*.5+.001))),k=[];for(var L=0;L<C;L++){var A=x+L*N/C,O=x+(L+1)*N/C;k[L]=[E,S,A,O,o,u,m.sinTh,m.cosTh]}return e[r]=k,k}function s(e,t,n,r,i,s,o){var u=e*(Math.PI/180),a=Math.sin(u),f=Math.cos(u);t=Math.abs(t),n=Math.abs(n);var l=f*(r-s)+a*(i-o),c=f*(i-o)-a*(r-s),h=l*l/(t*t)+c*c/(n*n);h*=.25,h>1&&(h=Math.sqrt(h),t*=h,n*=h);var p=f/t,d=a/t,v=-a/n,m=f/n;return{x0:p*r+d*i,y0:v*r+m*i,x1:p*s+d*o,y1:v*s+m*o,sinTh:a,cosTh:f}}function o(e,i,s,o,u,a,f,l){r=n.call(arguments);if(t[r])return t[r];var h=Math.sin(s),p=Math.cos(s),v=Math.sin(o),m=Math.cos(o),g=l*u,y=-f*a,w=f*u,E=l*a,S=.25*(o-s),x=8/3*Math.sin(S)*Math.sin(S)/Math.sin(S*2),T=e+p-x*h,N=i+h+x*p,C=e+m,k=i+v,L=C+x*v,A=k-x*m;return t[r]=[g*T+y*N,w*T+E*N,g*L+y*A,w*L+E*A,g*C+y*k,w*C+E*k],t[r]}var e={},t={},n=Array.prototype.join,r;fabric.util.drawArc=function(e,t,n,r){var s=r[0],u=r[1],a=r[2],l=r[3],c=r[4],h=r[5],p=r[6],d=i(h,p,s,u,l,c,a,t,n);for(var v=0;v<d.length;v++){var m=o.apply(this,d[v]);e.bezierCurveTo.apply(e,m)}}}(),function(){function t(t,n){var r=e.call(arguments,2),i=[];for(var s=0,o=t.length;s<o;s++)i[s]=r.length?t[s][n].apply(t[s],r):t[s][n].call(t[s]);return i}function n(e,t){return i(e,t,function(e,t){return e>=t})}function r(e,t){return i(e,t,function(e,t){return e<t})}function i(e,t,n){if(!e||e.length===0)return;var r=e.length-1,i=t?e[r][t]:e[r];if(t)while(r--)n(e[r][t],i)&&(i=e[r][t]);else while(r--)n(e[r],i)&&(i=e[r]);return i}var e=Array.prototype.slice;Array.prototype.indexOf||(Array.prototype.indexOf=function(e){if(this===void 0||this===null)throw new TypeError;var t=Object(this),n=t.length>>>0;if(n===0)return-1;var r=0;arguments.length>0&&(r=Number(arguments[1]),r!==r?r=0:r!==0&&r!==Number.POSITIVE_INFINITY&&r!==Number.NEGATIVE_INFINITY&&(r=(r>0||-1)*Math.floor(Math.abs(r))));if(r>=n)return-1;var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++)if(i in t&&t[i]===e)return i;return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,r=this.length>>>0;n<r;n++)n in this&&e.call(t,this[n],n,this)}),Array.prototype.map||(Array.prototype.map=function(e,t){var n=[];for(var r=0,i=this.length>>>0;r<i;r++)r in this&&(n[r]=e.call(t,this[r],r,this));return n}),Array.prototype.every||(Array.prototype.every=function(e,t){for(var n=0,r=this.length>>>0;n<r;n++)if(n in this&&!e.call(t,this[n],n,this))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(e,t){for(var n=0,r=this.length>>>0;n<r;n++)if(n in this&&e.call(t,this[n],n,this))return!0;return!1}),Array.prototype.filter||(Array.prototype.filter=function(e,t){var n=[],r;for(var i=0,s=this.length>>>0;i<s;i++)i in this&&(r=this[i],e.call(t,r,i,this)&&n.push(r));return n}),Array.prototype.reduce||(Array.prototype.reduce=function(e){var t=this.length>>>0,n=0,r;if(arguments.length>1)r=arguments[1];else do{if(n in this){r=this[n++];break}if(++n>=t)throw new TypeError}while(!0);for(;n<t;n++)n in this&&(r=e.call(null,r,this[n],n,this));return r}),fabric.util.array={invoke:t,min:r,max:n}}(),function(){function e(e,t){for(var n in t)e[n]=t[n];return e}function t(t){return e({},t)}fabric.util.object={extend:e,clone:t}}(),function(){function e(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function t(e,t){return e.charAt(0).toUpperCase()+(t?e.slice(1):e.slice(1).toLowerCase())}function n(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,"").replace(/[\s\xA0]+$/,"")}),fabric.util.string={camelize:e,capitalize:t,escapeXml:n}}(),function(){var e=Array.prototype.slice,t=Function.prototype.apply,n=function(){};Function.prototype.bind||(Function.prototype.bind=function(r){var i=this,s=e.call(arguments,1),o;return s.length?o=function(){return t.call(i,this instanceof n?this:r,s.concat(e.call(arguments)))}:o=function(){return t.call(i,this instanceof n?this:r,arguments)},n.prototype=this.prototype,o.prototype=new n,o})}(),function(){function i(){}function s(t){var n=this.constructor.superclass.prototype[t];return arguments.length>1?n.apply(this,e.call(arguments,1)):n.call(this)}function o(){function u(){this.initialize.apply(this,arguments)}var n=null,o=e.call(arguments,0);typeof o[0]=="function"&&(n=o.shift()),u.superclass=n,u.subclasses=[],n&&(i.prototype=n.prototype,u.prototype=new i,n.subclasses.push(u));for(var l=0,h=o.length;l<h;l++)r(u,o[l],n);return u.prototype.initialize||(u.prototype.initialize=t),u.prototype.constructor=u,u.prototype.callSuper=s,u}var e=Array.prototype.slice,t=function(){},n=function(){for(var e in{toString:1})if(e==="toString")return!1;return!0}(),r=function(e,t,r){for(var i in t)i in e.prototype&&typeof e.prototype[i]=="function"&&(t[i]+"").indexOf("callSuper")>-1?e.prototype[i]=function(e){return function(){var n=this.constructor.superclass;this.constructor.superclass=r;var i=t[e].apply(this,arguments);this.constructor.superclass=n;if(e!=="initialize")return i}}(i):e.prototype[i]=t[i],n&&(t.toString!==Object.prototype.toString&&(e.prototype.toString=t.toString),t.valueOf!==Object.prototype.valueOf&&(e.prototype.valueOf=t.valueOf))};fabric.util.createClass=o}(),function(){function t(e){var t=Array.prototype.slice.call(arguments,1),n,r,i=t.length;for(r=0;r<i;r++){n=typeof e[t[r]];if(!/^(?:function|object|unknown)$/.test(n))return!1}return!0}function s(e,t){return{handler:t,wrappedHandler:o(e,t)}}function o(e,t){return function(r){t.call(n(e),r||fabric.window.event)}}function u(e,t){return function(n){if(c[e]&&c[e][t]){var r=c[e][t];for(var i=0,s=r.length;i<s;i++)r[i].call(this,n||fabric.window.event)}}}function d(t,n){t||(t=fabric.window.event);var r=t.target||(typeof t.srcElement!==e?t.srcElement:null),i=fabric.util.getScrollLeftTop(r,n);return{x:v(t)+i.left,y:m(t)+i.top}}function g(e,t,n){var r=e.type==="touchend"?"changedTouches":"touches";return e[r]&&e[r][0]?e[r][0][t]-(e[r][0][t]-e[r][0][n])||e[n]:e[n]}var e="unknown",n,r,i=function(){var e=0;return function(t){return t.__uniqueID||(t.__uniqueID="uniqueID__"+e++)}}();(function(){var e={};n=function(t){return e[t]},r=function(t,n){e[t]=n}})();var a=t(fabric.document.documentElement,"addEventListener","removeEventListener")&&t(fabric.window,"addEventListener","removeEventListener"),f=t(fabric.document.documentElement,"attachEvent","detachEvent")&&t(fabric.window,"attachEvent","detachEvent"),l={},c={},h,p;a?(h=function(e,t,n){e.addEventListener(t,n,!1)},p=function(e,t,n){e.removeEventListener(t,n,!1)}):f?(h=function(e,t,n){var o=i(e);r(o,e),l[o]||(l[o]={}),l[o][t]||(l[o][t]=[]);var u=s(o,n);l[o][t].push(u),e.attachEvent("on"+t,u.wrappedHandler)},p=function(e,t,n){var r=i(e),s;if(l[r]&&l[r][t])for(var o=0,u=l[r][t].length;o<u;o++)s=l[r][t][o],s&&s.handler===n&&(e.detachEvent("on"+t,s.wrappedHandler),l[r][t][o]=null)}):(h=function(e,t,n){var r=i(e);c[r]||(c[r]={});if(!c[r][t]){c[r][t]=[];var s=e["on"+t];s&&c[r][t].push(s),e["on"+t]=u(r,t)}c[r][t].push(n)},p=function(e,t,n){var r=i(e);if(c[r]&&c[r][t]){var s=c[r][t];for(var o=0,u=s.length;o<u;o++)s[o]===n&&s.splice(o,1)}}),fabric.util.addListener=h,fabric.util.removeListener=p;var v=function(t){return typeof t.clientX!==e?t.clientX:0},m=function(t){return typeof t.clientY!==e?t.clientY:0};fabric.isTouchSupported&&(v=function(e){return g(e,"pageX","clientX")},m=function(e){return g(e,"pageY","clientY")}),fabric.util.getPointer=d,fabric.util.object.extend(fabric.util,fabric.Observable)}(),function(){function e(e,t){var n=e.style;if(!n)return e;if(typeof t=="string")return e.style.cssText+=";"+t,t.indexOf("opacity")>-1?s(e,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var r in t)if(r==="opacity")s(e,t[r]);else{var i=r==="float"||r==="cssFloat"?typeof n.styleFloat=="undefined"?"cssFloat":"styleFloat":r;n[i]=t[r]}return e}var t=fabric.document.createElement("div"),n=typeof t.style.opacity=="string",r=typeof t.style.filter=="string",i=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,s=function(e){return e};n?s=function(e,t){return e.style.opacity=t,e}:r&&(s=function(e,t){var n=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(n.zoom=1),i.test(n.filter)?(t=t>=.9999?"":"alpha(opacity="+t*100+")",n.filter=n.filter.replace(i,t)):n.filter+=" alpha(opacity="+t*100+")",e}),fabric.util.setStyle=e}(),function(){function t(e){return typeof e=="string"?fabric.document.getElementById(e):e}function s(e,t){var n=fabric.document.createElement(e);for(var r in t)r==="class"?n.className=t[r]:r==="for"?n.htmlFor=t[r]:n.setAttribute(r,t[r]);return n}function o(e,t){e&&(" "+e.className+" ").indexOf(" "+t+" ")===-1&&(e.className+=(e.className?" ":"")+t)}function u(e,t,n){return typeof t=="string"&&(t=s(t,n)),e.parentNode&&e.parentNode.replaceChild(t,e),t.appendChild(e),t}function a(e,t){var n,r,i=0,s=0,o=fabric.document.documentElement,u=fabric.document.body||{scrollLeft:0,scrollTop:0};r=e;while(e&&e.parentNode&&!n)e=e.parentNode,e!==fabric.document&&fabric.util.getElementStyle(e,"position")==="fixed"&&(n=e),e!==fabric.document&&r!==t&&fabric.util.getElementStyle(e,"position")==="absolute"?(i=0,s=0):e===fabric.document?(i=u.scrollLeft||o.scrollLeft||0,s=u.scrollTop||o.scrollTop||0):(i+=e.scrollLeft||0,s+=e.scrollTop||0);return{left:i,top:s}}function f(e){var t,n=e&&e.ownerDocument,r={left:0,top:0},i={left:0,top:0},s,o={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!n)return{left:0,top:0};for(var u in o)i[o[u]]+=parseInt(l(e,u),10)||0;return t=n.documentElement,typeof e.getBoundingClientRect!="undefined"&&(r=e.getBoundingClientRect()),s=fabric.util.getScrollLeftTop(e,null),{left:r.left+s.left-(t.clientLeft||0)+i.left,top:r.top+s.top-(t.clientTop||0)+i.top}}var e=Array.prototype.slice,n,r=function(t){return e.call(t,0)};try{n=r(fabric.document.childNodes)instanceof Array}catch(i){}n||(r=function(e){var t=new Array(e.length),n=e.length;while(n--)t[n]=e[n];return t});var l;fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?l=function(e,t){return fabric.document.defaultView.getComputedStyle(e,null)[t]}:l=function(e,t){var n=e.style[t];return!n&&e.currentStyle&&(n=e.currentStyle[t]),n},function(){function n(e){return typeof e.onselectstart!="undefined"&&(e.onselectstart=fabric.util.falseFunction),t?e.style[t]="none":typeof e.unselectable=="string"&&(e.unselectable="on"),e}function r(e){return typeof e.onselectstart!="undefined"&&(e.onselectstart=null),t?e.style[t]="":typeof e.unselectable=="string"&&(e.unselectable=""),e}var e=fabric.document.documentElement.style,t="userSelect"in e?"userSelect":"MozUserSelect"in e?"MozUserSelect":"WebkitUserSelect"in e?"WebkitUserSelect":"KhtmlUserSelect"in e?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=n,fabric.util.makeElementSelectable=r}(),function(){function e(e,t){var n=fabric.document.getElementsByTagName("head")[0],r=fabric.document.createElement("script"),i=!0;r.onload=r.onreadystatechange=function(e){if(i){if(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")return;i=!1,t(e||fabric.window.event),r=r.onload=r.onreadystatechange=null}},r.src=e,n.appendChild(r)}fabric.util.getScript=e}(),fabric.util.getById=t,fabric.util.toArray=r,fabric.util.makeElement=s,fabric.util.addClass=o,fabric.util.wrapElement=u,fabric.util.getScrollLeftTop=a,fabric.util.getElementOffset=f,fabric.util.getElementStyle=l}(),function(){function e(e,t){return e+(/\?/.test(e)?"&":"?")+t}function n(){}function r(r,i){i||(i={});var s=i.method?i.method.toUpperCase():"GET",o=i.onComplete||function(){},u=t(),f;return u.onreadystatechange=function(){u.readyState===4&&(o(u),u.onreadystatechange=n)},s==="GET"&&(f=null,typeof i.parameters=="string"&&(r=e(r,i.parameters))),u.open(s,r,!0),(s==="POST"||s==="PUT")&&u.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),u.send(f),u}var t=function(){var e=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}];for(var t=e.length;t--;)try{var n=e[t]();if(n)return e[t]}catch(r){}}();fabric.util.request=r}(),fabric.log=function(){},fabric.warn=function(){},typeof console!="undefined"&&["log","warn"].forEach(function(e){typeof console[e]!="undefined"&&console[e].apply&&(fabric[e]=function(){return console[e].apply(console,arguments)})}),function(){function e(e){n(function(t){e||(e={});var r=t||+(new Date),i=e.duration||500,s=r+i,o,u=e.onChange||function(){},a=e.abort||function(){return!1},f=e.easing||function(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t},l="startValue"in e?e.startValue:0,c="endValue"in e?e.endValue:100,h=e.byValue||c-l;e.onStart&&e.onStart(),function p(t){o=t||+(new Date);var c=o>s?i:o-r;if(a()){e.onComplete&&e.onComplete();return}u(f(c,l,h,i));if(o>s){e.onComplete&&e.onComplete();return}n(p)}(r)})}function n(){return t.apply(fabric.window,arguments)}var t=fabric.window.requestAnimationFrame||fabric.window.webkitRequestAnimationFrame||fabric.window.mozRequestAnimationFrame||fabric.window.oRequestAnimationFrame||fabric.window.msRequestAnimationFrame||function(e){fabric.window.setTimeout(e,1e3/60)};fabric.util.animate=e,fabric.util.requestAnimFrame=n}(),function(){function e(e,t,n,r){return e<Math.abs(t)?(e=t,r=n/4):r=n/(2*Math.PI)*Math.asin(t/e),{a:e,c:t,p:n,s:r}}function t(e,t,n){return e.a*Math.pow(2,10*(t-=1))*Math.sin((t*n-e.s)*2*Math.PI/e.p)}function n(e,t,n,r){return n*((e=e/r-1)*e*e+1)+t}function r(e,t,n,r){return e/=r/2,e<1?n/2*e*e*e+t:n/2*((e-=2)*e*e+2)+t}function i(e,t,n,r){return n*(e/=r)*e*e*e+t}function s(e,t,n,r){return-n*((e=e/r-1)*e*e*e-1)+t}function o(e,t,n,r){return e/=r/2,e<1?n/2*e*e*e*e+t:-n/2*((e-=2)*e*e*e-2)+t}function u(e,t,n,r){return n*(e/=r)*e*e*e*e+t}function a(e,t,n,r){return n*((e=e/r-1)*e*e*e*e+1)+t}function f(e,t,n,r){return e/=r/2,e<1?n/2*e*e*e*e*e+t:n/2*((e-=2)*e*e*e*e+2)+t}function l(e,t,n,r){return-n*Math.cos(e/r*(Math.PI/2))+n+t}function c(e,t,n,r){return n*Math.sin(e/r*(Math.PI/2))+t}function h(e,t,n,r){return-n/2*(Math.cos(Math.PI*e/r)-1)+t}function p(e,t,n,r){return e===0?t:n*Math.pow(2,10*(e/r-1))+t}function d(e,t,n,r){return e===r?t+n:n*(-Math.pow(2,-10*e/r)+1)+t}function v(e,t,n,r){return e===0?t:e===r?t+n:(e/=r/2,e<1?n/2*Math.pow(2,10*(e-1))+t:n/2*(-Math.pow(2,-10*--e)+2)+t)}function m(e,t,n,r){return-n*(Math.sqrt(1-(e/=r)*e)-1)+t}function g(e,t,n,r){return n*Math.sqrt(1-(e=e/r-1)*e)+t}function y(e,t,n,r){return e/=r/2,e<1?-n/2*(Math.sqrt(1-e*e)-1)+t:n/2*(Math.sqrt(1-(e-=2)*e)+1)+t}function b(n,r,i,s){var o=1.70158,u=0,a=i;if(n===0)return r;n/=s;if(n===1)return r+i;u||(u=s*.3);var f=e(a,i,u,o);return-t(f,n,s)+r}function w(t,n,r,i){var s=1.70158,o=0,u=r;if(t===0)return n;t/=i;if(t===1)return n+r;o||(o=i*.3);var a=e(u,r,o,s);return a.a*Math.pow(2,-10*t)*Math.sin((t*i-a.s)*2*Math.PI/a.p)+a.c+n}function E(n,r,i,s){var o=1.70158,u=0,a=i;if(n===0)return r;n/=s/2;if(n===2)return r+i;u||(u=s*.3*1.5);var f=e(a,i,u,o);return n<1?-0.5*t(f,n,s)+r:f.a*Math.pow(2,-10*(n-=1))*Math.sin((n*s-f.s)*2*Math.PI/f.p)*.5+f.c+r}function S(e,t,n,r,i){return i===undefined&&(i=1.70158),n*(e/=r)*e*((i+1)*e-i)+t}function x(e,t,n,r,i){return i===undefined&&(i=1.70158),n*((e=e/r-1)*e*((i+1)*e+i)+1)+t}function T(e,t,n,r,i){return i===undefined&&(i=1.70158),e/=r/2,e<1?n/2*e*e*(((i*=1.525)+1)*e-i)+t:n/2*((e-=2)*e*(((i*=1.525)+1)*e+i)+2)+t}function N(e,t,n,r){return n-C(r-e,0,n,r)+t}function C(e,t,n,r){return(e/=r)<1/2.75?n*7.5625*e*e+t:e<2/2.75?n*(7.5625*(e-=1.5/2.75)*e+.75)+t:e<2.5/2.75?n*(7.5625*(e-=2.25/2.75)*e+.9375)+t:n*(7.5625*(e-=2.625/2.75)*e+.984375)+t}function k(e,t,n,r){return e<r/2?N(e*2,0,n,r)*.5+t:C(e*2-r,0,n,r)*.5+n*.5+t}fabric.util.ease={easeInQuad:function(e,t,n,r){return n*(e/=r)*e+t},easeOutQuad:function(e,t,n,r){return-n*(e/=r)*(e-2)+t},easeInOutQuad:function(e,t,n,r){return e/=r/2,e<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},easeInCubic:function(e,t,n,r){return n*(e/=r)*e*e+t},easeOutCubic:n,easeInOutCubic:r,easeInQuart:i,easeOutQuart:s,easeInOutQuart:o,easeInQuint:u,easeOutQuint:a,easeInOutQuint:f,easeInSine:l,easeOutSine:c,easeInOutSine:h,easeInExpo:p,easeOutExpo:d,easeInOutExpo:v,easeInCirc:m,easeOutCirc:g,easeInOutCirc:y,easeInElastic:b,easeOutElastic:w,easeInOutElastic:E,easeInBack:S,easeOutBack:x,easeInOutBack:T,easeInBounce:N,easeOutBounce:C,easeInOutBounce:k}}(),function(e){function l(e){return e in a?a[e]:e}function c(e,n,r){var i=Object.prototype.toString.call(n)==="[object Array]",s;return e!=="fill"&&e!=="stroke"||n!=="none"?e==="fillRule"?n=n==="evenodd"?"destination-over":n:e==="strokeDashArray"?n=n.replace(/,/g," ").split(/\s+/).map(function(e){return parseInt(e)}):e==="transformMatrix"?r&&r.transformMatrix?n=u(r.transformMatrix,t.parseTransformAttribute(n)):n=t.parseTransformAttribute(n):e==="visible"?(n=n==="none"||n==="hidden"?!1:!0,r&&r.visible===!1&&(n=!1)):e==="originX"?n=n==="start"?"left":n==="end"?"right":"center":s=i?n.map(o):o(n):n="",!i&&isNaN(s)?n:s}function h(e){for(var n in f){if(!e[n]||typeof e[f[n]]=="undefined")continue;if(e[n].indexOf("url(")===0)continue;var r=new t.Color(e[n]);e[n]=r.setAlpha(s(r.getAlpha()*e[f[n]],2)).toRgba(),delete e[f[n]]}return e}function p(e,t){var n=e.match(/(normal|italic)?\s*(normal|small-caps)?\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\s*(\d+)px(?:\/(normal|[\d\.]+))?\s+(.*)/);if(!n)return;var r=n[1],i=n[3],s=n[4],o=n[5],u=n[6];r&&(t.fontStyle=r),i&&(t.fontWeight=isNaN(parseFloat(i))?i:parseFloat(i)),s&&(t.fontSize=parseFloat(s)),u&&(t.fontFamily=u),o&&(t.lineHeight=o==="normal"?1:o)}function d(e,t){var n,r;e.replace(/;$/,"").split(";").forEach(function(e){var i=e.split(":");n=l(i[0].trim().toLowerCase()),r=c(n,i[1].trim()),n==="font"?p(r,t):t[n]=r})}function v(e,t){var n,r;for(var i in e){if(typeof e[i]=="undefined")continue;n=l(i.toLowerCase()),r=c(n,e[i]),n==="font"?p(r,t):t[n]=r}}function m(e){var n=e.nodeName,r=e.getAttribute("class"),i=e.getAttribute("id"),s={};for(var o in t.cssRules){var u=r&&(new RegExp("^\\."+r)).test(o)||i&&(new RegExp("^#"+i)).test(o)||(new RegExp("^"+n)).test(o);if(u)for(var a in t.cssRules[o]){var f=l(a),h=c(f,t.cssRules[o][a]);s[f]=h}}return s}function g(e){var t=e.getElementsByTagName("use");while(t.length){var n=t[0],r=n.getAttribute("xlink:href").substr(1),i=n.getAttribute("x")||0,s=n.getAttribute("y")||0,o=e.getElementById(r).cloneNode(!0),u=(n.getAttribute("transform")||"")+" translate("+i+", "+s+")",a;for(var f=0,l=n.attributes,c=l.length;f<c;f++){var h=l.item(f);if(h.nodeName==="x"||h.nodeName==="y"||h.nodeName==="xlink:href")continue;h.nodeName==="transform"?u=u+" "+h.nodeValue:o.setAttribute(h.nodeName,h.nodeValue)}o.setAttribute("transform",u),o.removeAttribute("id"),a=n.parentNode,a.replaceChild(o,n)}}function y(e,t){t[3]=t[0]=t[0]>t[3]?t[3]:t[0];if(t[0]===1&&t[3]===1&&t[4]===0&&t[5]===0)return;var n=document.createElement("g");while(e.firstChild!=null){var r=e.firstChild;n.appendChild(r)}n.setAttribute("transform","matrix("+t[0]+" "+t[1]+" "+t[2]+" "+t[3]+" "+t[4]+" "+t[5]+")"),e.appendChild(n)}function w(e){var n=e.objects,i=e.options;return n=n.map(function(e){return t[r(e.type)].fromObject(e)}),{objects:n,options:i}}function E(e,t,n){t[n]&&t[n].toSVG&&e.push('<pattern x="0" y="0" id="',n,'Pattern" ','width="',t[n].source.width,'" height="',t[n].source.height,'" patternUnits="userSpaceOnUse">','<image x="0" y="0" ','width="',t[n].source.width,'" height="',t[n].source.height,'" xlink:href="',t[n].source.src,'"></image></pattern>')}var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.string.capitalize,i=t.util.object.clone,s=t.util.toFixed,o=t.util.parseUnit,u=t.util.multiplyTransformMatrices,a={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","stroke-dasharray":"strokeDashArray","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"originX"},f={stroke:"strokeOpacity",fill:"fillOpacity"};t.parseTransformAttribute=function(){function e(e,t){var n=t[0];e[0]=Math.cos(n),e[1]=Math.sin(n),e[2]=-Math.sin(n),e[3]=Math.cos(n)}function n(e,t){var n=t[0],r=t.length===2?t[1]:t[0];e[0]=n,e[3]=r}function r(e,t){e[2]=t[0]}function i(e,t){e[1]=t[0]}function s(e,t){e[4]=t[0],t.length===2&&(e[5]=t[1])}var o=[1,0,0,1,0,0],u="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",a="(?:\\s+,?\\s*|,\\s*)",f="(?:(skewX)\\s*\\(\\s*("+u+")\\s*\\))",l="(?:(skewY)\\s*\\(\\s*("+u+")\\s*\\))",c="(?:(rotate)\\s*\\(\\s*("+u+")(?:"+a+"("+u+")"+a+"("+u+"))?\\s*\\))",h="(?:(scale)\\s*\\(\\s*("+u+")(?:"+a+"("+u+"))?\\s*\\))",p="(?:(translate)\\s*\\(\\s*("+u+")(?:"+a+"("+u+"))?\\s*\\))",d="(?:(matrix)\\s*\\(\\s*("+u+")"+a+"("+u+")"+a+"("+u+")"+a+"("+u+")"+a+"("+u+")"+a+"("+u+")\\s*\\))",v="(?:"+d+"|"+p+"|"+h+"|"+c+"|"+f+"|"+l+")",m="(?:"+v+"(?:"+a+v+")*)",g="^\\s*(?:"+m+"?)\\s*$",y=new RegExp(g),b=new RegExp(v,"g");return function(u){var a=o.concat(),f=[];if(!u||u&&!y.test(u))return a;u.replace(b,function(u){var l=(new RegExp(v)).exec(u).filter(function(e){return e!==""&&e!=null}),c=l[1],h=l.slice(2).map(parseFloat);switch(c){case"translate":s(a,h);break;case"rotate":h[0]=t.util.degreesToRadians(h[0]),e(a,h);break;case"scale":n(a,h);break;case"skewX":r(a,h);break;case"skewY":i(a,h);break;case"matrix":a=h}f.push(a.concat()),a=o.concat()});var l=f[0];while(f.length>1)f.shift(),l=t.util.multiplyTransformMatrices(l,f[0]);return l}}(),t.parseSVGDocument=function(){function o(e,t){while(e&&(e=e.parentNode))if(t.test(e.nodeName))return!0;return!1}var e=/^(path|circle|polygon|polyline|ellipse|rect|line|image|text)$/,r="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",s=new RegExp("^\\s*("+r+"+)\\s*,?\\s*("+r+"+)\\s*,?\\s*("+r+"+)\\s*,?\\s*("+r+"+)\\s*$");return function(r,u,a){if(!r)return;var f=new Date;g(r);var l=r.getAttribute("viewBox"),c=parseFloat(r.getAttribute("width")),h=parseFloat(r.getAttribute("height")),p,d;if(l&&(l=l.match(s))){var v=parseFloat(l[1]),m=parseFloat(l[2]),b=1,w=1;p=parseFloat(l[3]),d=parseFloat(l[4]),c&&c!==p&&(b=c/p),h&&h!==d&&(w=h/d),y(r,[b,0,0,w,-v,-m])}var E=t.util.toArray(r.getElementsByTagName("*"));if(E.length===0&&t.isLikelyNode){E=r.selectNodes('//*[name(.)!="svg"]');var S=[];for(var x=0,T=E.length;x<T;x++)S[x]=E[x];E=S}var N=E.filter(function(t){return e.test(t.tagName)&&!o(t,/^(?:pattern|defs)$/)});if(!N||N&&!N.length){u&&u([],{});return}var C={width:c?c:p,height:h?h:d,widthAttr:c,heightAttr:h};t.gradientDefs=n(t.getGradientDefs(r),t.gradientDefs),t.cssRules=n(t.getCSSRules(r),t.cssRules),t.parseElements(N,function(e){t.documentParsingTime=new Date-f,u&&u(e,C)},i(C),a)}}();var b={has:function(e,t){t(!1)},get:function(){},set:function(){}};n(t,{resolveGradients:function(e){for(var n=e.length;n--;){var r=e[n].get("fill");if(!/^url\(/.test(r))continue;var i=r.slice(5,r.length-1);t.gradientDefs[i]&&e[n].set("fill",t.Gradient.fromElement(t.gradientDefs[i],e[n]))}},getGradientDefs:function(e){var t=e.getElementsByTagName("linearGradient"),n=e.getElementsByTagName("radialGradient"),r,i,s={};i=t.length;for(;i--;)r=t[i],s[r.getAttribute("id")]=r;i=n.length;for(;i--;)r=n[i],s[r.getAttribute("id")]=r;return s},parseAttributes:function(e,r){if(!e)return;var i,s={};e.parentNode&&/^[g|a]$/i.test(e.parentNode.nodeName)&&(s=t.parseAttributes(e.parentNode,r));var o=r.reduce(function(t,n){return i=e.getAttribute(n),i&&(n=l(n),i=c(n,i,s),t[n]=i),t},{});return o=n(o,n(m(e),t.parseStyleAttribute(e))),h(n(s,o))},parseElements:function(e,n,r,i){(new t.ElementsParser(e,n,r,i)).parse()},parseStyleAttribute:function(e){var t={},n=e.getAttribute("style");return n?(typeof n=="string"?d(n,t):v(n,t),t):t},parsePointsAttribute:function(e){if(!e)return null;e=e.replace(/,/g," ").trim(),e=e.split(/\s+/);var t=[],n,r;n=0,r=e.length;for(;n<r;n+=2)t.push({x:parseFloat(e[n]),y:parseFloat(e[n+1])});return t},getCSSRules:function(e){var t=e.getElementsByTagName("style"),n={},r;for(var i=0,s=t.length;i<s;i++){var o=t[0].textContent;o=o.replace(/\/\*[\s\S]*?\*\//g,""),r=o.match(/[^{]*\{[\s\S]*?\}/g),r=r.map(function(e){return e.trim()}),r.forEach(function(e){var t=e.match(/([\s\S]*?)\s*\{([^}]*)\}/);e=t[1];var r=t[2].trim(),i=r.replace(/;$/,"").split(/\s*;\s*/);n[e]||(n[e]={});for(var s=0,o=i.length;s<o;s++){var u=i[s].split(/\s*:\s*/),a=u[0],f=u[1];n[e][a]=f}})}return n},loadSVGFromURL:function(e,n,r){function i(i){var s=i.responseXML;s&&!s.documentElement&&t.window.ActiveXObject&&i.responseText&&(s=new ActiveXObject("Microsoft.XMLDOM"),s.async="false",s.loadXML(i.responseText.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));if(!s||!s.documentElement)return;t.parseSVGDocument(s.documentElement,function(r,i){b.set(e,{objects:t.util.array.invoke(r,"toObject"),options:i}),n(r,i)},r)}e=e.replace(/^\n\s*/,"").trim(),b.has(e,function(r){r?b.get(e,function(e){var t=w(e);n(t.objects,t.options)}):new t.util.request(e,{method:"get",onComplete:i})})},loadSVGFromString:function(e,n,r){e=e.trim();var i;if(typeof DOMParser!="undefined"){var s=new DOMParser;s&&s.parseFromString&&(i=s.parseFromString(e,"text/xml"))}else t.window.ActiveXObject&&(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(e.replace(/<!DOCTYPE[\s\S]*?(\[[\s\S]*\])*?>/i,"")));t.parseSVGDocument(i.documentElement,function(e,t){n(e,t)},r)},createSVGFontFacesMarkup:function(e){var t="";for(var n=0,r=e.length;n<r;n++){if(e[n].type!=="text"||!e[n].path)continue;t+=["@font-face {","font-family: ",e[n].fontFamily,"; ","src: url('",e[n].path,"')","}"].join("")}return t&&(t=['<style type="text/css">',"<![CDATA[",t,"]]>","</style>"].join("")),t},createSVGRefElementsMarkup:function(e){var t=[];return E(t,e,"backgroundColor"),E(t,e,"overlayColor"),t.join("")}})}(typeof exports!="undefined"?exports:this),fabric.ElementsParser=function(e,t,n,r){this.elements=e,this.callback=t,this.options=n,this.reviver=r},fabric.ElementsParser.prototype.parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},fabric.ElementsParser.prototype.createObjects=function(){for(var e=0,t=this.elements.length;e<t;e++)(function(e,t){setTimeout(function(){e.createObject(e.elements[t],t)},0)})(this,e)},fabric.ElementsParser.prototype.createObject=function(e,t){var n=fabric[fabric.util.string.capitalize(e.tagName)];if(n&&n.fromElement)try{this._createObject(n,e,t)}catch(r){fabric.log(r)}else this.checkIfDone()},fabric.ElementsParser.prototype._createObject=function(e,t,n){if(e.async)e.fromElement(t,this.createCallback(n,t),this.options);else{var r=e.fromElement(t,this.options);this.reviver&&this.reviver(t,r),this.instances[n]=r,this.checkIfDone()}},fabric.ElementsParser.prototype.createCallback=function(e,t){var n=this;return function(r){n.reviver&&n.reviver(t,r),n.instances[e]=r,n.checkIfDone()}},fabric.ElementsParser.prototype.checkIfDone=function(){--this.numElements===0&&(this.instances=this.instances.filter(function(e){return e!=null}),fabric.resolveGradients(this.instances),this.callback(this.instances))},function(e){function n(e,t){this.x=e,this.y=t}var t=e.fabric||(e.fabric={});if(t.Point){t.warn("fabric.Point is already defined");return}t.Point=n,n.prototype={constructor:n,add:function(e){return new n(this.x+e.x,this.y+e.y)},addEquals:function(e){return this.x+=e.x,this.y+=e.y,this},scalarAdd:function(e){return new n(this.x+e,this.y+e)},scalarAddEquals:function(e){return this.x+=e,this.y+=e,this},subtract:function(e){return new n(this.x-e.x,this.y-e.y)},subtractEquals:function(e){return this.x-=e.x,this.y-=e.y,this},scalarSubtract:function(e){return new n(this.x-e,this.y-e)},scalarSubtractEquals:function(e){return this.x-=e,this.y-=e,this},multiply:function(e){return new n(this.x*e,this.y*e)},multiplyEquals:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return new n(this.x/e,this.y/e)},divideEquals:function(e){return this.x/=e,this.y/=e,this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,t){return new n(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t)},distanceFrom:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},midPointFrom:function(e){return new n(this.x+(e.x-this.x)/2,this.y+(e.y-this.y)/2)},min:function(e){return new n(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new n(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(e,t){this.x=e,this.y=t},setFromPoint:function(e){this.x=e.x,this.y=e.y},swap:function(e){var t=this.x,n=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=n}}}(typeof exports!="undefined"?exports:this),function(e){function n(e){this.status=e,this.points=[]}var t=e.fabric||(e.fabric={});if(t.Intersection){t.warn("fabric.Intersection is already defined");return}t.Intersection=n,t.Intersection.prototype={appendPoint:function(e){this.points.push(e)},appendPoints:function(e){this.points=this.points.concat(e)}},t.Intersection.intersectLineLine=function(e,r,i,s){var o,u=(s.x-i.x)*(e.y-i.y)-(s.y-i.y)*(e.x-i.x),a=(r.x-e.x)*(e.y-i.y)-(r.y-e.y)*(e.x-i.x),f=(s.y-i.y)*(r.x-e.x)-(s.x-i.x)*(r.y-e.y);if(f!==0){var l=u/f,h=a/f;0<=l&&l<=1&&0<=h&&h<=1?(o=new n("Intersection"),o.points.push(new t.Point(e.x+l*(r.x-e.x),e.y+l*(r.y-e.y)))):o=new n}else u===0||a===0?o=new n("Coincident"):o=new n("Parallel");return o},t.Intersection.intersectLinePolygon=function(e,t,r){var i=new n,s=r.length;for(var o=0;o<s;o++){var u=r[o],a=r[(o+1)%s],f=n.intersectLineLine(e,t,u,a);i.appendPoints(f.points)}return i.points.length>0&&(i.status="Intersection"),i},t.Intersection.intersectPolygonPolygon=function(e,t){var r=new n,i=e.length;for(var s=0;s<i;s++){var o=e[s],u=e[(s+1)%i],a=n.intersectLinePolygon(o,u,t);r.appendPoints(a.points)}return r.points.length>0&&(r.status="Intersection"),r},t.Intersection.intersectPolygonRectangle=function(e,r,i){var s=r.min(i),o=r.max(i),u=new t.Point(o.x,s.y),a=new t.Point(s.x,o.y),f=n.intersectLinePolygon(s,u,e),l=n.intersectLinePolygon(u,o,e),h=n.intersectLinePolygon(o,a,e),p=n.intersectLinePolygon(a,s,e),d=new n;return d.appendPoints(f.points),d.appendPoints(l.points),d.appendPoints(h.points),d.appendPoints(p.points),d.points.length>0&&(d.status="Intersection"),d}}(typeof exports!="undefined"?exports:this),function(e){function n(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function r(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}var t=e.fabric||(e.fabric={});if(t.Color){t.warn("fabric.Color is already defined.");return}t.Color=n,t.Color.prototype={_tryParsingColor:function(e){var t;e in n.colorNameMap&&(e=n.colorNameMap[e]);if(e==="transparent"){this.setSource([255,255,255,0]);return}t=n.sourceFromHex(e),t||(t=n.sourceFromRgb(e)),t||(t=n.sourceFromHsl(e)),t&&this.setSource(t)},_rgbToHsl:function(e,n,r){e/=255,n/=255,r/=255;var i,s,o,u=t.util.array.max([e,n,r]),a=t.util.array.min([e,n,r]);o=(u+a)/2;if(u===a)i=s=0;else{var f=u-a;s=o>.5?f/(2-u-a):f/(u+a);switch(u){case e:i=(n-r)/f+(n<r?6:0);break;case n:i=(r-e)/f+2;break;case r:i=(e-n)/f+4}i/=6}return[Math.round(i*360),Math.round(s*100),Math.round(o*100)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+e[3]+")"},toHex:function(){var e=this.getSource(),t,n,r;return t=e[0].toString(16),t=t.length===1?"0"+t:t,n=e[1].toString(16),n=n.length===1?"0"+n:n,r=e[2].toString(16),r=r.length===1?"0"+r:r,t.toUpperCase()+n.toUpperCase()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var t=this.getSource();return t[3]=e,this.setSource(t),this},toGrayscale:function(){var e=this.getSource(),t=parseInt((e[0]*.3+e[1]*.59+e[2]*.11).toFixed(0),10),n=e[3];return this.setSource([t,t,t,n]),this},toBlackWhite:function(e){var t=this.getSource(),n=(t[0]*.3+t[1]*.59+t[2]*.11).toFixed(0),r=t[3];return e=e||127,n=Number(n)<Number(e)?0:255,this.setSource([n,n,n,r]),this},overlayWith:function(e){e instanceof n||(e=new n(e));var t=[],r=this.getAlpha(),i=.5,s=this.getSource(),o=e.getSource();for(var u=0;u<3;u++)t.push(Math.round(s[u]*(1-i)+o[u]*i));return t[3]=r,this.setSource(t),this}},t.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,t.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/,t.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i,t.Color.colorNameMap={aqua:"#00FFFF",black:"#000000",blue:"#0000FF",fuchsia:"#FF00FF",gray:"#808080",green:"#008000",lime:"#00FF00",maroon:"#800000",navy:"#000080",olive:"#808000",orange:"#FFA500",purple:"#800080",red:"#FF0000",silver:"#C0C0C0",teal:"#008080",white:"#FFFFFF",yellow:"#FFFF00"},t.Color.fromRgb=function(e){return n.fromSource(n.sourceFromRgb(e))},t.Color.sourceFromRgb=function(e){var t=e.match(n.reRGBa);if(t){var r=parseInt(t[1],10)/(/%$/.test(t[1])?100:1)*(/%$/.test(t[1])?255:1),i=parseInt(t[2],10)/(/%$/.test(t[2])?100:1)*(/%$/.test(t[2])?255:1),s=parseInt(t[3],10)/(/%$/.test(t[3])?100:1)*(/%$/.test(t[3])?255:1);return[parseInt(r,10),parseInt(i,10),parseInt(s,10),t[4]?parseFloat(t[4]):1]}},t.Color.fromRgba=n.fromRgb,t.Color.fromHsl=function(e){return n.fromSource(n.sourceFromHsl(e))},t.Color.sourceFromHsl=function(e){var t=e.match(n.reHSLa);if(!t)return;var i=(parseFloat(t[1])%360+360)%360/360,s=parseFloat(t[2])/(/%$/.test(t[2])?100:1),o=parseFloat(t[3])/(/%$/.test(t[3])?100:1),u,f,l;if(s===0)u=f=l=o;else{var c=o<=.5?o*(s+1):o+s-o*s,h=o*2-c;u=r(h,c,i+1/3),f=r(h,c,i),l=r(h,c,i-1/3)}return[Math.round(u*255),Math.round(f*255),Math.round(l*255),t[4]?parseFloat(t[4]):1]},t.Color.fromHsla=n.fromHsl,t.Color.fromHex=function(e){return n.fromSource(n.sourceFromHex(e))},t.Color.sourceFromHex=function(e){if(e.match(n.reHex)){var t=e.slice(e.indexOf("#")+1),r=t.length===3,i=r?t.charAt(0)+t.charAt(0):t.substring(0,2),s=r?t.charAt(1)+t.charAt(1):t.substring(2,4),o=r?t.charAt(2)+t.charAt(2):t.substring(4,6);return[parseInt(i,16),parseInt(s,16),parseInt(o,16),1]}},t.Color.fromSource=function(e){var t=new n;return t.setSource(e),t}}(typeof exports!="undefined"?exports:this),function(){function e(e){var t=e.getAttribute("style"),n=e.getAttribute("offset"),r,i;n=parseFloat(n)/(/%$/.test(n)?100:1);if(t){var s=t.split(/\s*;\s*/);s[s.length-1]===""&&s.pop();for(var o=s.length;o--;){var u=s[o].split(/\s*:\s*/),a=u[0].trim(),f=u[1].trim();a==="stop-color"?r=f:a==="stop-opacity"&&(i=f)}}return r||(r=e.getAttribute("stop-color")||"rgb(0,0,0)"),i||(i=e.getAttribute("stop-opacity")),r=(new fabric.Color(r)).toRgb(),{offset:n,color:r,opacity:isNaN(parseFloat(i))?1:parseFloat(i)}}function t(e){return{x1:e.getAttribute("x1")||0,y1:e.getAttribute("y1")||0,x2:e.getAttribute("x2")||"100%",y2:e.getAttribute("y2")||0}}function n(e){return{x1:e.getAttribute("fx")||e.getAttribute("cx")||"50%",y1:e.getAttribute("fy")||e.getAttribute("cy")||"50%",r1:0,x2:e.getAttribute("cx")||"50%",y2:e.getAttribute("cy")||"50%",r2:e.getAttribute("r")||"50%"}}function r(e,t){for(var n in t){if(typeof t[n]=="string"&&/^\d+%$/.test(t[n])){var r=parseFloat(t[n],10);if(n==="x1"||n==="x2"||n==="r2")t[n]=fabric.util.toFixed(e.width*r/100,2);else if(n==="y1"||n==="y2")t[n]=fabric.util.toFixed(e.height*r/100,2)}i(t,n,e)}}function i(e,t,n){if(t==="x1"||t==="x2")e[t]-=fabric.util.toFixed(n.width/2,2);else if(t==="y1"||t==="y2")e[t]-=fabric.util.toFixed(n.height/2,2)}function s(e,t){for(var n in t){i(t,n,e);if(n==="x1"||n==="x2"||n==="r2")t[n]=fabric.util.toFixed(t[n]/e.width*100,2)+"%";else if(n==="y1"||n==="y2")t[n]=fabric.util.toFixed(t[n]/e.height*100,2)+"%"}}fabric.Gradient=fabric.util.createClass({initialize:function(e){e||(e={});var t={};this.id=fabric.Object.__uid++,this.type=e.type||"linear",t={x1:e.coords.x1||0,y1:e.coords.y1||0,x2:e.coords.x2||0,y2:e.coords.y2||0},this.type==="radial"&&(t.r1=e.coords.r1||0,t.r2=e.coords.r2||0),this.coords=t,this.gradientUnits=e.gradientUnits||"objectBoundingBox",this.colorStops=e.colorStops.slice()},addColorStop:function(e){for(var t in e){var n=new fabric.Color(e[t]);this.colorStops.push({offset:t,color:n.toRgb(),opacity:n.getAlpha()})}return this},toObject:function(){return{type:this.type,coords:this.coords,gradientUnits:this.gradientUnits,colorStops:this.colorStops}},toSVG:function(e,t){var n=fabric.util.object.clone(this.coords),r;this.colorStops.sort(function(e,t){return e.offset-t.offset}),t&&this.gradientUnits==="userSpaceOnUse"?(n.x1+=e.width/2,n.y1+=e.height/2,n.x2+=e.width/2,n.y2+=e.height/2):this.gradientUnits==="objectBoundingBox"&&s(e,n),this.type==="linear"?r=["<linearGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" x1="',n.x1,'" y1="',n.y1,'" x2="',n.x2,'" y2="',n.y2,'">']:this.type==="radial"&&(r=["<radialGradient ",'id="SVGID_',this.id,'" gradientUnits="',this.gradientUnits,'" cx="',n.x2,'" cy="',n.y2,'" r="',n.r2,'" fx="',n.x1,'" fy="',n.y1,'">']);for(var i=0;i<this.colorStops.length;i++)r.push("<stop ",'offset="',this.colorStops[i].offset*100+"%",'" style="stop-color:',this.colorStops[i].color,this.colorStops[i].opacity?";stop-opacity: "+this.colorStops[i].opacity:";",'"/>');return r.push(this.type==="linear"?"</linearGradient>":"</radialGradient>"),r.join("")},toLive:function(e){var t;if(!this.type)return;this.type==="linear"?t=e.createLinearGradient(this.coords.x1,this.coords.y1,this.coords.x2,this.coords.y2):this.type==="radial"&&(t=e.createRadialGradient(this.coords.x1,this.coords.y1,this.coords.r1,this.coords.x2,this.coords.y2,this.coords.r2));for(var n=0,r=this.colorStops.length;n<r;n++){var i=this.colorStops[n].color,s=this.colorStops[n].opacity,o=this.colorStops[n].offset;typeof s!="undefined"&&(i=(new fabric.Color(i)).setAlpha(s).toRgba()),t.addColorStop(parseFloat(o),i)}return t}}),fabric.util.object.extend(fabric.Gradient,{fromElement:function(i,s){var o=i.getElementsByTagName("stop"),u=i.nodeName==="linearGradient"?"linear":"radial",l=i.getAttribute("gradientUnits")||"objectBoundingBox",h=[],p={};u==="linear"?p=t(i):u==="radial"&&(p=n(i));for(var d=o.length;d--;)h.push(e(o[d]));return r(s,p),new fabric.Gradient({type:u,coords:p,gradientUnits:l,colorStops:h})},forObject:function(e,t){return t||(t={}),r(e,t),new fabric.Gradient(t)}})}(),fabric.Pattern=fabric.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,initialize:function(e){e||(e={}),this.id=fabric.Object.__uid++;if(e.source)if(typeof e.source=="string")if(typeof fabric.util.getFunctionBody(e.source)!="undefined")this.source=new Function(fabric.util.getFunctionBody(e.source));else{var t=this;this.source=fabric.util.createImage(),fabric.util.loadImage(e.source,function(e){t.source=e})}else this.source=e.source;e.repeat&&(this.repeat=e.repeat),e.offsetX&&(this.offsetX=e.offsetX),e.offsetY&&(this.offsetY=e.offsetY)},toObject:function(){var e;return typeof this.source=="function"?e=String(this.source):typeof this.source.src=="string"&&(e=this.source.src),{source:e,repeat:this.repeat,offsetX:this.offsetX,offsetY:this.offsetY}},toSVG:function(e){var t=typeof this.source=="function"?this.source():this.source,n=t.width/e.getWidth(),r=t.height/e.getHeight(),i="";return t.src?i=t.src:t.toDataURL&&(i=t.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+this.offsetX+'" y="'+this.offsetY+'" width="'+n+'" height="'+r+'"><image x="0" y="0" width="'+t.width+'" height="'+t.height+'" xlink:href="'+i+'"></image></pattern>'},toLive:function(e){var t=typeof this.source=="function"?this.source():this.source;if(!t)return"";if(typeof t.src!="undefined"){if(!t.complete)return"";if(t.naturalWidth===0||t.naturalHeight===0)return""}return e.createPattern(t,this.repeat)}}),function(e){var t=e.fabric||(e.fabric={});if(t.Shadow){t.warn("fabric.Shadow is already defined.");return}t.Shadow=t.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,initialize:function(e){typeof e=="string"&&(e=this._parseShadow(e));for(var n in e)this[n]=e[n];this.id=t.Object.__uid++},_parseShadow:function(e){var n=e.trim(),r=t.Shadow.reOffsetsAndBlur.exec(n)||[],i=n.replace(t.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)";return{color:i.trim(),offsetX:parseInt(r[1],10)||0,offsetY:parseInt(r[2],10)||0,blur:parseInt(r[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(e){var t="SourceAlpha";return e&&(e.fill===this.color||e.stroke===this.color)&&(t="SourceGraphic"),'<filter id="SVGID_'+this.id+'" y="-40%" height="180%"><feGaussianBlur in="'+t+'" stdDeviation="'+(this.blur?this.blur/3:0)+'"></feGaussianBlur><feOffset dx="'+this.offsetX+'" dy="'+this.offsetY+'"></feOffset><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY};var e={},n=t.Shadow.prototype;return this.color!==n.color&&(e.color=this.color),this.blur!==n.blur&&(e.blur=this.blur),this.offsetX!==n.offsetX&&(e.offsetX=this.offsetX),this.offsetY!==n.offsetY&&(e.offsetY=this.offsetY),e}}),t.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:px)?(?:\s?|$))?(-?\d+(?:px)?(?:\s?|$))?(\d+(?:px)?)?(?:\s?|$)(?:$|\s)/}(typeof exports!="undefined"?exports:this),function(){if(fabric.StaticCanvas){fabric.warn("fabric.StaticCanvas is already defined.");return}var e=fabric.util.object.extend,t=fabric.util.getElementOffset,n=fabric.util.removeFromArray,r=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass({initialize:function(e,t){t||(t={}),this._initStatic(e,t),fabric.StaticCanvas.activeInstance=this},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!0,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:[1,0,0,1,0,0],onBeforeScaleRotate:function(){},_initStatic:function(e,t){this._objects=[],this._createLowerCanvas(e),this._initOptions(t),this._setImageSmoothing(),t.overlayImage&&this.setOverlayImage(t.overlayImage,this.renderAll.bind(this)),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,this.renderAll.bind(this)),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,this.renderAll.bind(this)),t.overlayColor&&this.setOverlayColor(t.overlayColor,this.renderAll.bind(this)),this.calcOffset()},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(e,t,n){return this.__setBgOverlayImage("overlayImage",e,t,n)},setBackgroundImage:function(e,t,n){return this.__setBgOverlayImage("backgroundImage",e,t,n)},setOverlayColor:function(e,t){return this.__setBgOverlayColor("overlayColor",e,t)},setBackgroundColor:function(e,t){return this.__setBgOverlayColor("backgroundColor",e,t)},_setImageSmoothing:function(){var e=this.getContext();e.imageSmoothingEnabled=this.imageSmoothingEnabled,e.webkitImageSmoothingEnabled=this.imageSmoothingEnabled,e.mozImageSmoothingEnabled=this.imageSmoothingEnabled,e.msImageSmoothingEnabled=this.imageSmoothingEnabled,e.oImageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(e,t,n,r){return typeof t=="string"?fabric.util.loadImage(t,function(t){this[e]=new fabric.Image(t,r),n&&n()},this):(this[e]=t,n&&n()),this},__setBgOverlayColor:function(e,t,n){if(t&&t.source){var r=this;fabric.util.loadImage(t.source,function(i){r[e]=new fabric.Pattern({source:i,repeat:t.repeat,offsetX:t.offsetX,offsetY:t.offsetY}),n&&n()})}else this[e]=t,n&&n();return this},_createCanvasElement:function(){var e=fabric.document.createElement("canvas");e.style||(e.style={});if(!e)throw r;return this._initCanvasElement(e),e},_initCanvasElement:function(e){fabric.util.createCanvasElement(e);if(typeof e.getContext=="undefined")throw r},_initOptions:function(e){for(var t in e)this[t]=e[t];this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0;if(!this.lowerCanvasEl.style)return;this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice()},_createLowerCanvas:function(e){this.lowerCanvasEl=fabric.util.getById(e)||this._createCanvasElement(),this._initCanvasElement(this.lowerCanvasEl),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e){return this._setDimension("width",e)},setHeight:function(e){return this._setDimension("height",e)},setDimensions:function(e){for(var t in e)this._setDimension(t,e[t]);return this},_setDimension:function(e,t){return this.lowerCanvasEl[e]=t,this.lowerCanvasEl.style[e]=t+"px",this.upperCanvasEl&&(this.upperCanvasEl[e]=t,this.upperCanvasEl.style[e]=t+"px"),this.cacheCanvasEl&&(this.cacheCanvasEl[e]=t),this.wrapperEl&&(this.wrapperEl.style[e]=t+"px"),this[e]=t,this.calcOffset(),this.renderAll(),this},getZoom:function(){return Math.sqrt(this.viewportTransform[0]*this.viewportTransform[3])},setViewportTransform:function(e){this.viewportTransform=e,this.renderAll();for(var t=0,n=this._objects.length;t<n;t++)this._objects[t].setCoords();return this},zoomToPoint:function(e,t){var n=e;e=fabric.util.transformPoint(e,fabric.util.invertTransform(this.viewportTransform)),this.viewportTransform[0]=t,this.viewportTransform[3]=t;var r=fabric.util.transformPoint(e,this.viewportTransform);this.viewportTransform[4]+=n.x-r.x,this.viewportTransform[5]+=n.y-r.y,this.renderAll();for(var i=0,s=this._objects.length;i<s;i++)this._objects[i].setCoords();return this},setZoom:function(e){return this.zoomToPoint(new fabric.Point(0,0),e),this},absolutePan:function(e){this.viewportTransform[4]=-e.x,this.viewportTransform[5]=-e.y,this.renderAll();for(var t=0,n=this._objects.length;t<n;t++)this._objects[t].setCoords();return this},relativePan:function(e){return this.absolutePan(new fabric.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},getActiveObject:function(){return null},getActiveGroup:function(){return null},_draw:function(e,t){if(!t)return;e.save();var n=this.viewportTransform;e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),t.render(e),e.restore(),this.controlsAboveOverlay||t._renderControls(e)},_onObjectAdded:function(e){this.stateful&&e.setupState(),e.canvas=this,e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.getActiveObject()===e&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared")),this.fire("object:removed",{target:e}),e.fire("removed")},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.discardActiveGroup&&this.discardActiveGroup(),this.discardActiveObject&&this.discardActiveObject(),this.clearContext(this.contextContainer),this.contextTop&&this.clearContext(this.contextTop),this.fire("canvas:cleared"),this.renderAll(),this},renderAll:function(e){var t=this[e===!0&&this.interactive?"contextTop":"contextContainer"],n=this.getActiveGroup();return this.contextTop&&this.selection&&!this._groupSelector&&this.clearContext(this.contextTop),e||this.clearContext(t),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,t),this._renderBackground(t),this._renderObjects(t,n),this._renderActiveGroup(t,n),this.clipTo&&t.restore(),this._renderOverlay(t),this.controlsAboveOverlay&&this.interactive&&this.drawControls(t),this.fire("after:render"),this},_renderObjects:function(e,t){var n,r;if(!t)for(n=0,r=this._objects.length;n<r;++n)this._draw(e,this._objects[n]);else for(n=0,r=this._objects.length;n<r;++n)this._objects[n]&&!t.contains(this._objects[n])&&this._draw(e,this._objects[n])},_renderActiveGroup:function(e,t){if(t){var n=[];this.forEachObject(function(e){t.contains(e)&&n.push(e)}),t._set("objects",n),this._draw(e,t)}},_renderBackground:function(e){this.backgroundColor&&(e.fillStyle=this.backgroundColor.toLive?this.backgroundColor.toLive(e):this.backgroundColor,e.fillRect(this.backgroundColor.offsetX||0,this.backgroundColor.offsetY||0,this.width,this.height)),this.backgroundImage&&this._draw(e,this.backgroundImage)},_renderOverlay:function(e){this.overlayColor&&(e.fillStyle=this.overlayColor.toLive?this.overlayColor.toLive(e):this.overlayColor,e.fillRect(this.overlayColor.offsetX||0,this.overlayColor.offsetY||0,this.width,this.height)),this.overlayImage&&this._draw(e,this.overlayImage)},renderTop:function(){var e=this.contextTop||this.contextContainer;this.clearContext(e),this.selection&&this._groupSelector&&this._drawSelection();var t=this.getActiveGroup();return t&&t.render(e),this._renderOverlay(e),this.fire("after:render"),this},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(e){return this._centerObject(e,new fabric.Point(this.getCenter().left,e.getCenterPoint().y)),this.renderAll(),this},centerObjectV:function(e){return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,this.getCenter().top)),this.renderAll(),this},centerObject:function(e){var t=this.getCenter();return this._centerObject(e,new fabric.Point(t.left,t.top)),this.renderAll(),this},_centerObject:function(e,t){return e.setPositionByOrigin(t,"center","center"),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(t,n){var r=this.getActiveGroup();r&&this.discardActiveGroup();var i={objects:this._toObjects(t,n)};return e(i,this.__serializeBgOverlay()),fabric.util.populateWithProperties(this,i,n),r&&(this.setActiveGroup(new fabric.Group(r.getObjects(),{originX:"center",originY:"center"})),r.forEachObject(function(e){e.set("active",!0)}),this._currentTransform&&(this._currentTransform.target=this.getActiveGroup())),i},_toObjects:function(e,t){return this.getObjects().map(function(n){return this._toObject(n,e,t)},this)},_toObject:function(e,t,n){var r;this.includeDefaultValues||(r=e.includeDefaultValues,e.includeDefaultValues=!1);var i=e[t](n);return this.includeDefaultValues||(e.includeDefaultValues=r),i},__serializeBgOverlay:function(){var e={background:this.backgroundColor&&this.backgroundColor.toObject?this.backgroundColor.toObject():this.backgroundColor};return this.overlayColor&&(e.overlay=this.overlayColor.toObject?this.overlayColor.toObject():this.overlayColor),this.backgroundImage&&(e.backgroundImage=this.backgroundImage.toObject()),this.overlayImage&&(e.overlayImage=this.overlayImage.toObject()),e},toSVG:function(e,t){e||(e={});var n=[];return this._setSVGPreamble(n,e),this._setSVGHeader(n,e),this._setSVGBgOverlayColor(n,"backgroundColor"),this._setSVGBgOverlayImage(n,"backgroundImage"),this._setSVGObjects(n,t),this._setSVGBgOverlayColor(n,"overlayColor"),this._setSVGBgOverlayImage(n,"overlayImage"),n.push("</svg>"),n.join("")},_setSVGPreamble:function(e,t){t.suppressPreamble||e.push('<?xml version="1.0" encoding="',t.encoding||"UTF-8",'" standalone="no" ?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(e,t){e.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',t.viewBox?t.viewBox.width:this.width,'" ','height="',t.viewBox?t.viewBox.height:this.height,'" ',this.backgroundColor&&!this.backgroundColor.toLive?'style="background-color: '+this.backgroundColor+'" ':null,t.viewBox?'viewBox="'+t.viewBox.x+" "+t.viewBox.y+" "+t.viewBox.width+" "+t.viewBox.height+'" ':null,'xml:space="preserve">',"<desc>Created with Fabric.js ",fabric.version,"</desc>","<defs>",fabric.createSVGFontFacesMarkup(this.getObjects()),fabric.createSVGRefElementsMarkup(this),"</defs>")},_setSVGObjects:function(e,t){var n=this.getActiveGroup();n&&this.discardActiveGroup();for(var r=0,i=this.getObjects(),s=i.length;r<s;r++)e.push(i[r].toSVG(t));n&&(this.setActiveGroup(new fabric.Group(n.getObjects())),n.forEachObject(function(e){e.set("active",!0)}))},_setSVGBgOverlayImage:function(e,t){this[t]&&this[t].toSVG&&e.push(this[t].toSVG())},_setSVGBgOverlayColor:function(e,t){this[t]&&this[t].source?e.push('<rect x="',this[t].offsetX,'" y="',this[t].offsetY,'" ','width="',this[t].repeat==="repeat-y"||this[t].repeat==="no-repeat"?this[t].source.width:this.width,'" height="',this[t].repeat==="repeat-x"||this[t].repeat==="no-repeat"?this[t].source.height:this.height,'" fill="url(#'+t+'Pattern)"',"></rect>"):this[t]&&t==="overlayColor"&&e.push('<rect x="0" y="0" ','width="',this.width,'" height="',this.height,'" fill="',this[t],'"',"></rect>")},sendToBack:function(e){return n(this._objects,e),this._objects.unshift(e),this.renderAll&&this.renderAll()},bringToFront:function(e){return n(this._objects,e),this._objects.push(e),this.renderAll&&this.renderAll()},sendBackwards:function(e,t){var r=this._objects.indexOf(e);if(r!==0){var i=this._findNewLowerIndex(e,r,t);n(this._objects,e),this._objects.splice(i,0,e),this.renderAll&&this.renderAll()}return this},_findNewLowerIndex:function(e,t,n){var r;if(n){r=t;for(var i=t-1;i>=0;--i){var s=e.intersectsWithObject(this._objects[i])||e.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(e);if(s){r=i;break}}}else r=t-1;return r},bringForward:function(e,t){var r=this._objects.indexOf(e);if(r!==this._objects.length-1){var i=this._findNewUpperIndex(e,r,t);n(this._objects,e),this._objects.splice(i,0,e),this.renderAll&&this.renderAll()}return this},_findNewUpperIndex:function(e,t,n){var r;if(n){r=t;for(var i=t+1;i<this._objects.length;++i){var s=e.intersectsWithObject(this._objects[i])||e.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(e);if(s){r=i;break}}}else r=t+1;return r},moveTo:function(e,t){return n(this._objects,e),this._objects.splice(t,0,e),this.renderAll&&this.renderAll()},dispose:function(){return this.clear(),this.interactive&&this.removeListeners(),this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),e(fabric.StaticCanvas.prototype,fabric.Observable),e(fabric.StaticCanvas.prototype,fabric.Collection),e(fabric.StaticCanvas.prototype,fabric.DataURLExporter),e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(e){var t=fabric.util.createCanvasElement();if(!t||!t.getContext)return null;var n=t.getContext("2d");if(!n)return null;switch(e){case"getImageData":return typeof n.getImageData!="undefined";case"setLineDash":return typeof n.setLineDash!="undefined";case"toDataURL":return typeof t.toDataURL!="undefined";case"toDataURLWithQuality":try{return t.toDataURL("image/jpeg",0),!0}catch(r){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject}(),fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",setShadow:function(e){return this.shadow=new fabric.Shadow(e),this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.lineJoin=this.strokeLineJoin},_setShadow:function(){if(!this.shadow)return;var e=this.canvas.contextTop;e.shadowColor=this.shadow.color,e.shadowBlur=this.shadow.blur,e.shadowOffsetX=this.shadow.offsetX,e.shadowOffsetY=this.shadow.offsetY},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}}),function(){var e=fabric.util.array.min,t=fabric.util.array.max;fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(e){this.canvas=e,this._points=[]},onMouseDown:function(e){this._prepareForDrawing(e),this._captureDrawingPath(e),this._render()},onMouseMove:function(e){this._captureDrawingPath(e),this.canvas.clearContext(this.canvas.contextTop),this._render()},onMouseUp:function(){this._finalizeAndAddPath()},_prepareForDrawing:function(e){var t=new fabric.Point(e.x,e.y);this._reset(),this._addPoint(t),this.canvas.contextTop.moveTo(t.x,t.y)},_addPoint:function(e){this._points.push(e)},_reset:function(){this._points.length=0,this._setBrushStyles(),this._setShadow()},_captureDrawingPath:function(e){var t=new fabric.Point(e.x,e.y);this._addPoint(t)},_render:function(){var e=this.canvas.contextTop,t=this.canvas.viewportTransform,n=this._points[0],r=this._points[1];e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5]),e.beginPath(),this._points.length===2&&n.x===r.x&&n.y===r.y&&(n.x-=.5,r.x+=.5),e.moveTo(n.x,n.y);for(var i=1,s=this._points.length;i<s;i++){var o=n.midPointFrom(r);e.quadraticCurveTo(n.x,n.y,o.x,o.y),n=this._points[i],r=this._points[i+1]}e.lineTo(n.x,n.y),e.stroke(),e.restore()},_getSVGPathData:function(){return this.box=this.getPathBoundingBox(this._points),this.convertPointsToSVGPath(this._points,this.box.minX,this.box.minY)},getPathBoundingBox:function(n){var r=[],i=[],s=n[0],o=n[1],u=s;for(var f=1,l=n.length;f<l;f++){var c=s.midPointFrom(o);r.push(u.x),r.push(c.x),i.push(u.y),i.push(c.y),s=n[f],o=n[f+1],u=c}return r.push(s.x),i.push(s.y),{minX:e(r),minY:e(i),maxX:t(r),maxY:t(i)}},convertPointsToSVGPath:function(e,t,n){var r=[],i=new fabric.Point(e[0].x-t,e[0].y-n),s=new fabric.Point(e[1].x-t,e[1].y-n);r.push("M ",e[0].x-t," ",e[0].y-n," ");for(var o=1,u=e.length;o<u;o++){var a=i.midPointFrom(s);r.push("Q ",i.x," ",i.y," ",a.x," ",a.y," "),i=new fabric.Point(e[o].x-t,e[o].y-n),o+1<e.length&&(s=new fabric.Point(e[o+1].x-t,e[o+1].y-n))}return r.push("L ",i.x," ",i.y," "),r},createPath:function(e){var t=new fabric.Path(e);return t.fill=null,t.stroke=this.color,t.strokeWidth=this.width,t.strokeLineCap=this.strokeLineCap,t.strokeLineJoin=this.strokeLineJoin,this.shadow&&(this.shadow.affectStroke=!0,t.setShadow(this.shadow)),t},_finalizeAndAddPath:function(){var e=this.canvas.contextTop;e.closePath();var t=this._getSVGPathData().join("");if(t==="M 0 0 Q 0 0 0 0 L 0 0"){this.canvas.renderAll();return}var n=this.box.minX+(this.box.maxX-this.box.minX)/2,r=this.box.minY+(this.box.maxY-this.box.minY)/2;this.canvas.contextTop.arc(n,r,3,0,Math.PI*2,!1);var i=this.createPath(t);i.set({left:n,top:r,originX:"center",originY:"center"}),this.canvas.add(i),i.setCoords(),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderAll(),this.canvas.fire("path:created",{path:i})}})}(),fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(e){this.canvas=e,this.points=[]},drawDot:function(e){var t=this.addPoint(e),n=this.canvas.contextTop,r=this.canvas.viewportTransform;n.save(),n.transform(r[0],r[1],r[2],r[3],r[4],r[5]),n.fillStyle=t.fill,n.beginPath(),n.arc(t.x,t.y,t.radius,0,Math.PI*2,!1),n.closePath(),n.fill(),n.restore()},onMouseDown:function(e){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(e)},onMouseMove:function(e){this.drawDot(e)},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var t=[];for(var n=0,r=this.points.length;n<r;n++){var i=this.points[n],s=new fabric.Circle({radius:i.radius,left:i.x,top:i.y,originX:"center",originY:"center",fill:i.fill});this.shadow&&s.setShadow(this.shadow),t.push(s)}var o=new fabric.Group(t,{originX:"center",originY:"center"});o.canvas=this.canvas,this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.renderAll()},addPoint:function(e){var t=new fabric.Point(e.x,e.y),n=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,r=(new fabric.Color(this.color)).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return t.radius=n,t.fill=r,this.points.push(t),t}}),fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(e){this.canvas=e,this.sprayChunks=[]},onMouseDown:function(e){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(e),this.render()},onMouseMove:function(e){this.addSprayChunk(e),this.render()},onMouseUp:function(){var e=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var t=[];for(var n=0,r=this.sprayChunks.length;n<r;n++){var i=this.sprayChunks[n];for(var s=0,o=i.length;s<o;s++){var u=new fabric.Rect({width:i[s].width,height:i[s].width,left:i[s].x+1,top:i[s].y+1,originX:"center",originY:"center",fill:this.color});this.shadow&&u.setShadow(this.shadow),t.push(u)}}this.optimizeOverlapping&&(t=this._getOptimizedRects(t));var a=new fabric.Group(t,{originX:"center",originY:"center"});a.canvas=this.canvas,this.canvas.add(a),this.canvas.fire("path:created",{path:a}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=e,this.canvas.renderAll()},_getOptimizedRects:function(e){var t={},n;for(var r=0,i=e.length;r<i;r++)n=e[r].left+""+e[r].top,t[n]||(t[n]=e[r]);var s=[];for(n in t)s.push(t[n]);return s},render:function(){var e=this.canvas.contextTop;e.fillStyle=this.color;var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5]);for(var n=0,r=this.sprayChunkPoints.length;n<r;n++){var i=this.sprayChunkPoints[n];typeof i.opacity!="undefined"&&(e.globalAlpha=i.opacity),e.fillRect(i.x,i.y,i.width,i.width)}e.restore()},addSprayChunk:function(e){this.sprayChunkPoints=[];var t,n,r,i=this.width/2;for(var s=0;s<this.density;s++){t=fabric.util.getRandomInt(e.x-i,e.x+i),n=fabric.util.getRandomInt(e.y-i,e.y+i),this.dotWidthVariance?r=fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):r=this.dotWidth;var o=new fabric.Point(t,n);o.width=r,this.randomOpacity&&(o.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(o)}this.sprayChunks.push(this.sprayChunkPoints)}}),fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=20,t=5,n=fabric.document.createElement("canvas"),r=n.getContext("2d");return n.width=n.height=e+t,r.fillStyle=this.color,r.beginPath(),r.arc(e/2,e/2,e/2,0,Math.PI*2,!1),r.closePath(),r.fill(),n},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){var t=this.callSuper("createPath",e);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction()}),t}}),function(){var e=fabric.util.getPointer,t=fabric.util.degreesToRadians,n=fabric.util.radiansToDegrees,r=Math.atan2,i=Math.abs,s=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(e,t){t||(t={}),this._initStatic(e,t),this._initInteractive(),this._createCacheCanvas(),fabric.Canvas.activeInstance=this},uniScaleTransform:!1,centeredScaling:!1,centeredRotation:!1,interactive:!0,selection:!0,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_resetCurrentTransform:function(e){var t=this._currentTransform;t.target.set({scaleX:t.original.scaleX,scaleY:t.original.scaleY,left:t.original.left,top:t.original.top}),this._shouldCenterTransform(e,t.target)?t.action==="rotate"?this._setOriginToCenter(t.target):(t.originX!=="center"&&(t.originX==="right"?t.mouseXSign=-1:t.mouseXSign=1),t.originY!=="center"&&(t.originY==="bottom"?t.mouseYSign=-1:t.mouseYSign=1),t.originX="center",t.originY="center"):(t.originX=t.original.originX,t.originY=t.original.originY)},containsPoint:function(e,t){var n=this.getPointer(e,!0),r=this._normalizePointer(t,n);return t.containsPoint(r)||t._findTargetCorner(n)},_normalizePointer:function(e,t){var n=this.getActiveGroup(),r=t.x,i=t.y,s=n&&e.type!=="group"&&n.contains(e),o;return s&&(o=new fabric.Point(n.left,n.top),o=fabric.util.transformPoint(o,this.viewportTransform,!0),r-=o.x,i-=o.y),{x:r,y:i}},isTargetTransparent:function(e,t,n){var r=e.hasBorders,i=e.transparentCorners;e.hasBorders=e.transparentCorners=!1,this._draw(this.contextCache,e),e.hasBorders=r,e.transparentCorners=i;var s=fabric.util.isTransparent(this.contextCache,t,n,this.targetFindTolerance);return this.clearContext(this.contextCache),s},_shouldClearSelection:function(e,t){var n=this.getActiveGroup(),r=this.getActiveObject();return!t||t&&n&&!n.contains(t)&&n!==t&&!e.shiftKey||t&&!t.evented||t&&!t.selectable&&r&&r!==t},_shouldCenterTransform:function(e,t){if(!t)return;var n=this._currentTransform,r;return n.action==="scale"||n.action==="scaleX"||n.action==="scaleY"?r=this.centeredScaling||t.centeredScaling:n.action==="rotate"&&(r=this.centeredRotation||t.centeredRotation),r?!e.altKey:e.altKey},_getOriginFromCorner:function(e,t){var n={x:e.originX,y:e.originY};if(t==="ml"||t==="tl"||t==="bl")n.x="right";else if(t==="mr"||t==="tr"||t==="br")n.x="left";if(t==="tl"||t==="mt"||t==="tr")n.y="bottom";else if(t==="bl"||t==="mb"||t==="br")n.y="top";return n},_getActionFromCorner:function(e,t){var n="drag";return t&&(n=t==="ml"||t==="mr"?"scaleX":t==="mt"||t==="mb"?"scaleY":t==="mtr"?"rotate":"scale"),n},_setupCurrentTransform:function(e,n){if(!n)return;var r=this.getPointer(e),i=n._findTargetCorner(this.getPointer(e,!0)),s=this._getActionFromCorner(n,i),o=this._getOriginFromCorner(n,i);this._currentTransform={target:n,action:s,scaleX:n.scaleX,scaleY:n.scaleY,offsetX:r.x-n.left,offsetY:r.y-n.top,originX:o.x,originY:o.y,ex:r.x,ey:r.y,left:n.left,top:n.top,theta:t(n.angle),width:n.width*n.scaleX,mouseXSign:1,mouseYSign:1},this._currentTransform.original={left:n.left,top:n.top,scaleX:n.scaleX,scaleY:n.scaleY,originX:o.x,originY:o.y},this._resetCurrentTransform(e)},_translateObject:function(e,t){var n=this._currentTransform.target;n.get("lockMovementX")||n.set("left",e-this._currentTransform.offsetX),n.get("lockMovementY")||n.set("top",t-this._currentTransform.offsetY)},_scaleObject:function(e,t,n){var r=this._currentTransform,i=r.target,s=i.get("lockScalingX"),o=i.get("lockScalingY");if(s&&o)return;var u=i.translateToOriginPoint(i.getCenterPoint(),r.originX,r.originY),a=i.toLocalPoint(new fabric.Point(e,t),r.originX,r.originY);this._setLocalMouse(a,r),this._setObjectScale(a,r,s,o,n),i.setPositionByOrigin(u,r.originX,r.originY)},_setObjectScale:function(e,t,n,r,i){var s=t.target;t.newScaleX=s.scaleX,t.newScaleY=s.scaleY,i==="equally"&&!n&&!r?this._scaleObjectEqually(e,s,t):i?i==="x"&&!s.get("lockUniScaling")?(t.newScaleX=e.x/(s.width+s.strokeWidth),n||s.set("scaleX",t.newScaleX)):i==="y"&&!s.get("lockUniScaling")&&(t.newScaleY=e.y/(s.height+s.strokeWidth),r||s.set("scaleY",t.newScaleY)):(t.newScaleX=e.x/(s.width+s.strokeWidth),t.newScaleY=e.y/(s.height+s.strokeWidth),n||s.set("scaleX",t.newScaleX),r||s.set("scaleY",t.newScaleY)),this._flipObject(t)},_scaleObjectEqually:function(e,t,n){var r=e.y+e.x,i=(t.height+t.strokeWidth)*n.original.scaleY+(t.width+t.strokeWidth)*n.original.scaleX;n.newScaleX=n.original.scaleX*r/i,n.newScaleY=n.original.scaleY*r/i,t.set("scaleX",n.newScaleX),t.set("scaleY",n.newScaleY)},_flipObject:function(e){e.newScaleX<0&&(e.originX==="left"?e.originX="right":e.originX==="right"&&(e.originX="left")),e.newScaleY<0&&(e.originY==="top"?e.originY="bottom":e.originY==="bottom"&&(e.originY="top"))},_setLocalMouse:function(e,t){var n=t.target;t.originX==="right"?e.x*=-1:t.originX==="center"&&(e.x*=t.mouseXSign*2,e.x<0&&(t.mouseXSign=-t.mouseXSign)),t.originY==="bottom"?e.y*=-1:t.originY==="center"&&(e.y*=t.mouseYSign*2,e.y<0&&(t.mouseYSign=-t.mouseYSign)),i(e.x)>n.padding?e.x<0?e.x+=n.padding:e.x-=n.padding:e.x=0,i(e.y)>n.padding?e.y<0?e.y+=n.padding:e.y-=n.padding:e.y=0},_rotateObject:function(e,t){var i=this._currentTransform;if(i.target.get("lockRotation"))return;var s=r(i.ey-i.top,i.ex-i.left),o=r(t-i.top,e-i.left),u=n(o-s+i.theta);u<0&&(u=360+u),i.target.angle=u},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.setAngle(0)},_drawSelection:function(){var e=this.contextTop,t=this._groupSelector,n=t.left,r=t.top,o=i(n),u=i(r);e.fillStyle=this.selectionColor,e.fillRect(t.ex-(n>0?0:-n),t.ey-(r>0?0:-r),o,u),e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor;if(this.selectionDashArray.length>1){var f=t.ex+s-(n>0?0:o),l=t.ey+s-(r>0?0:u);e.beginPath(),fabric.util.drawDashedLine(e,f,l,f+o,l,this.selectionDashArray),fabric.util.drawDashedLine(e,f,l+u-1,f+o,l+u-1,this.selectionDashArray),fabric.util.drawDashedLine(e,f,l,f,l+u,this.selectionDashArray),fabric.util.drawDashedLine(e,f+o-1,l,f+o-1,l+u,this.selectionDashArray),e.closePath(),e.stroke()}else e.strokeRect(t.ex+s-(n>0?0:o),t.ey+s-(r>0?0:u),o,u)},_isLastRenderedObject:function(e){return this.controlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay&&this.lastRenderedObjectWithControlsAboveOverlay.visible&&this.containsPoint(e,this.lastRenderedObjectWithControlsAboveOverlay)&&this.lastRenderedObjectWithControlsAboveOverlay._findTargetCorner(this.getPointer(e,!0))},findTarget:function(e,t){if(this.skipTargetFind)return;if(this._isLastRenderedObject(e))return this.lastRenderedObjectWithControlsAboveOverlay;var n=this.getActiveGroup();if(n&&!t&&this.containsPoint(e,n))return n;var r=this._searchPossibleTargets(e);return this._fireOverOutEvents(r),r},_fireOverOutEvents:function(e){e?this._hoveredTarget!==e&&(this.fire("mouse:over",{target:e}),e.fire("mouseover"),this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout")),this._hoveredTarget=e):this._hoveredTarget&&(this.fire("mouse:out",{target:this._hoveredTarget}),this._hoveredTarget.fire("mouseout"),this._hoveredTarget=null)},_checkTarget:function(e,t,n){if(t&&t.visible&&t.evented&&this.containsPoint(e,t)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||!!t.isEditing)return!0;var r=this.isTargetTransparent(t,n.x,n.y);if(!r)return!0}},_searchPossibleTargets:function(e){var t,n=this.getPointer(e,!0),r=this._objects.length;while(r--)if(this._checkTarget(e,this._objects[r],n)){this.relatedTarget=this._objects[r],t=this._objects[r];break}return t},getPointer:function(t,n,r){r||(r=this.upperCanvasEl);var i=e(t,r),s=r.getBoundingClientRect(),o;return i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,n||(i=fabric.util.transformPoint(i,fabric.util.invertTransform(this.viewportTransform))),s.width===0||s.height===0?o={width:1,height:1}:o={width:r.width/s.width,height:r.height/s.height},{x:i.x*o.width,y:i.y*o.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+e),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.getWidth()+"px",height:this.getHeight()+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var t=this.getWidth()||e.width,n=this.getHeight()||e.height;fabric.util.setStyle(e,{position:"absolute",width:t+"px",height:n+"px",left:0,top:0}),e.width=t,e.height=n,fabric.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,t){t.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},_setActiveObject:function(e){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=e,e.set("active",!0)},setActiveObject:function(e,t){return this._setActiveObject(e),this.renderAll(),this.fire("object:selected",{target:e,e:t}),e.fire("selected",{e:t}),this},getActiveObject:function(){return this._activeObject},_discardActiveObject:function(){this._activeObject&&this._activeObject.set("active",!1),this._activeObject=null},discardActiveObject:function(e){return this._discardActiveObject(),this.renderAll(),this.fire("selection:cleared",{e:e}),this},_setActiveGroup:function(e){this._activeGroup=e,e&&e.set("active",!0)},setActiveGroup:function(e,t){return this._setActiveGroup(e),e&&(this.fire("object:selected",{target:e,e:t}),e.fire("selected",{e:t})),this},getActiveGroup:function(){return this._activeGroup},_discardActiveGroup:function(){var e=this.getActiveGroup();e&&e.destroy(),this.setActiveGroup(null)},discardActiveGroup:function(e){return this._discardActiveGroup(),this.fire("selection:cleared",{e:e}),this},deactivateAll:function(){var e=this.getObjects(),t=0,n=e.length;for(;t<n;t++)e[t].set("active",!1);return this._discardActiveGroup(),this._discardActiveObject(),this},deactivateAllWithDispatch:function(e){var t=this.getActiveGroup()||this.getActiveObject();return t&&this.fire("before:selection:cleared",{target:t,e:e}),this.deactivateAll(),t&&this.fire("selection:cleared",{e:e}),this},drawControls:function(e){var t=this.getActiveGroup();t?this._drawGroupControls(e,t):this._drawObjectsControls(e)},_drawGroupControls:function(e,t){t._renderControls(e)},_drawObjectsControls:function(e){for(var t=0,n=this._objects.length;t<n;++t){if(!this._objects[t]||!this._objects[t].active)continue;this._objects[t]._renderControls(e),this.lastRenderedObjectWithControlsAboveOverlay=this._objects[t]}}});for(var o in fabric.StaticCanvas)o!=="prototype"&&(fabric.Canvas[o]=fabric.StaticCanvas[o]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){}),fabric.Element=fabric.Canvas}(),function(){var e={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},t=fabric.util.addListener,n=fabric.util.removeListener;fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this._bindEvents(),t(fabric.window,"resize",this._onResize),t(this.upperCanvasEl,"mousedown",this._onMouseDown),t(this.upperCanvasEl,"mousemove",this._onMouseMove),t(this.upperCanvasEl,"mousewheel",this._onMouseWheel),t(this.upperCanvasEl,"touchstart",this._onMouseDown),t(this.upperCanvasEl,"touchmove",this._onMouseMove),typeof Event!="undefined"&&"add"in Event&&(Event.add(this.upperCanvasEl,"gesture",this._onGesture),Event.add(this.upperCanvasEl,"drag",this._onDrag),Event.add(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.add(this.upperCanvasEl,"shake",this._onShake))},_bindEvents:function(){this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this)},removeListeners:function(){n(fabric.window,"resize",this._onResize),n(this.upperCanvasEl,"mousedown",this._onMouseDown),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"mousewheel",this._onMouseWheel),n(this.upperCanvasEl,"touchstart",this._onMouseDown),n(this.upperCanvasEl,"touchmove",this._onMouseMove),typeof Event!="undefined"&&"remove"in Event&&(Event.remove(this.upperCanvasEl,"gesture",this._onGesture),Event.remove(this.upperCanvasEl,"drag",this._onDrag),Event.remove(this.upperCanvasEl,"orientation",this._onOrientationChange),Event.remove(this.upperCanvasEl,"shake",this._onShake))},_onGesture:function(e,t){this.__onTransformGesture&&this.__onTransformGesture(e,t)},_onDrag:function(e,t){this.__onDrag&&this.__onDrag(e,t)},_onMouseWheel:function(e,t){this.__onMouseWheel&&this.__onMouseWheel(e,t)},_onOrientationChange:function(e,t){this.__onOrientationChange&&this.__onOrientationChange(e,t)},_onShake:function(e,t){this.__onShake&&this.__onShake(e,t)},_onMouseDown:function(e){this.__onMouseDown(e),t(fabric.document,"touchend",this._onMouseUp),t(fabric.document,"touchmove",this._onMouseMove),n(this.upperCanvasEl,"mousemove",this._onMouseMove),n(this.upperCanvasEl,"touchmove",this._onMouseMove),e.type==="touchstart"?n(this.upperCanvasEl,"mousedown",this._onMouseDown):(t(fabric.document,"mouseup",this._onMouseUp),t(fabric.document,"mousemove",this._onMouseMove))},_onMouseUp:function(e){this.__onMouseUp(e),n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"touchend",this._onMouseUp),n(fabric.document,"mousemove",this._onMouseMove),n(fabric.document,"touchmove",this._onMouseMove),t(this.upperCanvasEl,"mousemove",this._onMouseMove),t(this.upperCanvasEl,"touchmove",this._onMouseMove);if(e.type==="touchend"){var r=this;setTimeout(function(){t(r.upperCanvasEl,"mousedown",r._onMouseDown)},400)}},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(e,t){var n=this.getActiveGroup()||this.getActiveObject();return!!(e&&(e.isMoving||e!==n)||!e&&!!n||!e&&!n&&!this._groupSelector||t&&this._previousPointer&&this.selection&&(t.x!==this._previousPointer.x||t.y!==this._previousPointer.y))},__onMouseUp:function(e){var t;if(this.isDrawingMode&&this._isCurrentlyDrawing){this._onMouseUpInDrawingMode(e);return}this._currentTransform?(this._finalizeCurrentTransform(),t=this._currentTransform.target):t=this.findTarget(e,!0);var n=this._shouldRender(t,this.getPointer(e));this._maybeGroupObjects(e),t&&(t.isMoving=!1),n&&this.renderAll(),this._handleCursorAndEvent(e,t)},_handleCursorAndEvent:function(e,t){this._setCursorFromEvent(e,t);var n=this;setTimeout(function(){n._setCursorFromEvent(e,t)},50),this.fire("mouse:up",{target:t,e:e}),t&&t.fire("mouseup",{e:e})},_finalizeCurrentTransform:function(){var e=this._currentTransform,t=e.target;t._scaling&&(t._scaling=!1),t.setCoords(),this.stateful&&t.hasStateChanged()&&(this.fire("object:modified",{target:t}),t.fire("modified")),this._restoreOriginXY(t)},_restoreOriginXY:function(e){if(this._previousOriginX&&this._previousOriginY){var t=e.translateToOriginPoint(e.getCenterPoint(),this._previousOriginX,this._previousOriginY);e.originX=this._previousOriginX,e.originY=this._previousOriginY,e.left=t.x,e.top=t.y,this._previousOriginX=null,this._previousOriginY=null}},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.discardActiveObject(e).renderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var t=fabric.util.invertTransform(this.viewportTransform),n=fabric.util.transformPoint(this.getPointer(e,!0),t);this.freeDrawingBrush.onMouseDown(n),this.fire("mouse:down",{e:e})},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var t=fabric.util.invertTransform(this.viewportTransform),n=fabric.util.transformPoint(this.getPointer(e,!0),t);this.freeDrawingBrush.onMouseMove(n)}this.setCursor(this.freeDrawingCursor),this.fire("mouse:move",{e:e})},_onMouseUpInDrawingMode:function(e){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this.fire("mouse:up",{e:e})},__onMouseDown:function(e){var t="which"in e?e.which===1:e.button===1;if(!t&&!fabric.isTouchSupported)return;if(this.isDrawingMode){this._onMouseDownInDrawingMode(e);return}if(this._currentTransform)return;var n=this.findTarget(e),r=this.getPointer(e,!0);this._previousPointer=r;var i=this._shouldRender(n,r),s=this._shouldGroup(e,n);this._shouldClearSelection(e,n)?this._clearSelection(e,n,r):s&&(this._handleGrouping(e,n),n=this.getActiveGroup()),n&&n.selectable&&!s&&(this._beforeTransform(e,n),this._setupCurrentTransform(e,n)),i&&this.renderAll(),this.fire("mouse:down",{target:n,e:e}),n&&n.fire("mousedown",{e:e})},_beforeTransform:function(e,t){var n;this.stateful&&t.saveState(),(n=t._findTargetCorner(this.getPointer(e)))&&this.onBeforeScaleRotate(t),t!==this.getActiveGroup()&&t!==this.getActiveObject()&&(this.deactivateAll(),this.setActiveObject(t,e))},_clearSelection:function(e,t,n){this.deactivateAllWithDispatch(e),t&&t.selectable?this.setActiveObject(t,e):this.selection&&(this._groupSelector={ex:n.x,ey:n.y,top:0,left:0})},_setOriginToCenter:function(e){this._previousOriginX=this._currentTransform.target.originX,this._previousOriginY=this._currentTransform.target.originY;var t=e.getCenterPoint();e.originX="center",e.originY="center",e.left=t.x,e.top=t.y,this._currentTransform.left=e.left,this._currentTransform.top=e.top},_setCenterToOrigin:function(e){var t=e.translateToOriginPoint(e.getCenterPoint(),this._previousOriginX,this._previousOriginY);e.originX=this._previousOriginX,e.originY=this._previousOriginY,e.left=t.x,e.top=t.y,this._previousOriginX=null,this._previousOriginY=null},__onMouseMove:function(e){var t,n;if(this.isDrawingMode){this._onMouseMoveInDrawingMode(e);return}var r=this._groupSelector;r?(n=this.getPointer(e,!0),r.left=n.x-r.ex,r.top=n.y-r.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(t=this.findTarget(e),!t||t&&!t.selectable?this.setCursor(this.defaultCursor):this._setCursorFromEvent(e,t)),this.fire("mouse:move",{target:t,e:e}),t&&t.fire("mousemove",{e:e})},_transformObject:function(e){var t=this.getPointer(e),n=this._currentTransform;n.reset=!1,n.target.isMoving=!0,this._beforeScaleTransform(e,n),this._performTransformAction(e,n,t),this.renderAll()},_performTransformAction:function(e,t,n){var r=n.x,i=n.y,s=t.target,o=t.action;o==="rotate"?(this._rotateObject(r,i),this._fire("rotating",s,e)):o==="scale"?(this._onScale(e,t,r,i),this._fire("scaling",s,e)):o==="scaleX"?(this._scaleObject(r,i,"x"),this._fire("scaling",s,e)):o==="scaleY"?(this._scaleObject(r,i,"y"),this._fire("scaling",s,e)):(this._translateObject(r,i),this._fire("moving",s,e),this.setCursor(this.moveCursor))},_fire:function(e,t,n){this.fire("object:"+e,{target:t,e:n}),t.fire(e,{e:n})},_beforeScaleTransform:function(e,t){if(t.action==="scale"||t.action==="scaleX"||t.action==="scaleY"){var n=this._shouldCenterTransform(e,t.target);if(n&&(t.originX!=="center"||t.originY!=="center")||!n&&t.originX==="center"&&t.originY==="center")this._resetCurrentTransform(e),t.reset=!0}},_onScale:function(e,t,n,r){(e.shiftKey||this.uniScaleTransform)&&!t.target.get("lockUniScaling")?(t.currentAction="scale",this._scaleObject(n,r)):(!t.reset&&t.currentAction==="scale"&&this._resetCurrentTransform(e,t.target),t.currentAction="scaleEqually",this._scaleObject(n,r,"equally"))},_setCursorFromEvent:function(e,t){if(!t||!t.selectable)return this.setCursor(this.defaultCursor),!1;var n=this.getActiveGroup(),r=t._findTargetCorner&&(!n||!n.contains(t))&&t._findTargetCorner(this.getPointer(e,!0));return r?this._setCornerCursor(r,t):this.setCursor(t.hoverCursor||this.hoverCursor),!0},_setCornerCursor:function(t,n){if(t in e)this.setCursor(this._getRotatedCornerCursor(t,n));else{if(t!=="mtr"||!n.hasRotatingPoint)return this.setCursor(this.defaultCursor),!1;this.setCursor(this.rotationCursor)}},_getRotatedCornerCursor:function(t,n){var r=Math.round(n.getAngle()%360/45);return r<0&&(r+=8),r+=e[t],r%=8,this.cursorMap[r]}})}(),function(){var e=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(e,t){var n=this.getActiveObject();return e.shiftKey&&(this.getActiveGroup()||n&&n!==t)&&this.selection},_handleGrouping:function(e,t){if(t===this.getActiveGroup()){t=this.findTarget(e,!0);if(!t||t.isType("group"))return}this.getActiveGroup()?this._updateActiveGroup(t,e):this._createActiveGroup(t,e),this._activeGroup&&this._activeGroup.saveCoords()},_updateActiveGroup:function(e,t){var n=this.getActiveGroup();if(n.contains(e)){n.removeWithUpdate(e),this._resetObjectTransform(n),e.set("active",!1);if(n.size()===1){this.discardActiveGroup(t),this.setActiveObject(n.item(0));return}}else n.addWithUpdate(e),this._resetObjectTransform(n);this.fire("selection:created",{target:n,e:t}),n.set("active",!0)},_createActiveGroup:function(e,t){if(this._activeObject&&e!==this._activeObject){var n=this._createGroup(e);n.addWithUpdate(),this.setActiveGroup(n),this._activeObject=null,this.fire("selection:created",{target:n,e:t})}e.set("active",!0)},_createGroup:function(e){var t=this.getObjects(),n=t.indexOf(this._activeObject)<t.indexOf(e),r=n?[this._activeObject,e]:[e,this._activeObject];return new fabric.Group(r,{originX:"center",originY:"center",canvas:this})},_groupSelectedObjects:function(e){var t=this._collectObjects();t.length===1?this.setActiveObject(t[0],e):t.length>1&&(t=new fabric.Group(t.reverse(),{originX:"center",originY:"center",canvas:this}),t.addWithUpdate(),this.setActiveGroup(t,e),t.saveCoords(),this.fire("selection:created",{target:t}),this.renderAll())},_collectObjects:function(){var n=[],r,i=this._groupSelector.ex,s=this._groupSelector.ey,o=i+this._groupSelector.left,u=s+this._groupSelector.top,f=new fabric.Point(e(i,o),e(s,u)),l=new fabric.Point(t(i,o),t(s,u)),c=i===o&&s===u;for(var h=this._objects.length;h--;){r=this._objects[h];if(!r||!r.selectable||!r.visible)continue;if(r.intersectsWithRect(f,l)||r.isContainedWithinRect(f,l)||r.containsPoint(f)||r.containsPoint(l)){r.set("active",!0),n.push(r);if(c)break}}return n},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e);var t=this.getActiveGroup();t&&(t.setObjectsCoords().setCoords(),t.isMoving=!1,this.setCursor(this.defaultCursor)),this._groupSelector=null,this._currentTransform=null}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",n=e.quality||1,r=e.multiplier||1,i={left:e.left,top:e.top,width:e.width,height:e.height};return r!==1?this.__toDataURLWithMultiplier(t,n,i,r):this.__toDataURL(t,n,i)},__toDataURL:function(e,t,n){this.renderAll(!0);var r=this.upperCanvasEl||this.lowerCanvasEl,i=this.__getCroppedCanvas(r,n);e==="jpg"&&(e="jpeg");var s=fabric.StaticCanvas.supports("toDataURLWithQuality")?(i||r).toDataURL("image/"+e,t):(i||r).toDataURL("image/"+e);return this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),i&&(i=null),s},__getCroppedCanvas:function(e,t){var n,r,i="left"in t||"top"in t||"width"in t||"height"in t;return i&&(n=fabric.util.createCanvasElement(),r=n.getContext("2d"),n.width=t.width||this.width,n.height=t.height||this.height,r.drawImage(e,-t.left||0,-t.top||0)),n},__toDataURLWithMultiplier:function(e,t,n,r){var i=this.getWidth(),s=this.getHeight(),o=i*r,u=s*r,a=this.getActiveObject(),f=this.getActiveGroup(),l=this.contextTop||this.contextContainer;r>1&&this.setWidth(o).setHeight(u),l.scale(r,r),n.left&&(n.left*=r),n.top&&(n.top*=r),n.width?n.width*=r:r<1&&(n.width=o),n.height?n.height*=r:r<1&&(n.height=u),f?this._tempRemoveBordersControlsFromGroup(f):a&&this.deactivateAll&&this.deactivateAll(),this.renderAll(!0);var c=this.__toDataURL(e,t,n);return this.width=i,this.height=s,l.scale(1/r,1/r),this.setWidth(i).setHeight(s),f?this._restoreBordersControlsOnGroup(f):a&&this.setActiveObject&&this.setActiveObject(a),this.contextTop&&this.clearContext(this.contextTop),this.renderAll(),c},toDataURLWithMultiplier:function(e,t,n){return this.toDataURL({format:e,multiplier:t,quality:n})},_tempRemoveBordersControlsFromGroup:function(e){e.origHasControls=e.hasControls,e.origBorderColor=e.borderColor,e.hasControls=!0,e.borderColor="rgba(0,0,0,0)",e.forEachObject(function(e){e.origBorderColor=e.borderColor,e.borderColor="rgba(0,0,0,0)"})},_restoreBordersControlsOnGroup:function(e){e.hideControls=e.origHideControls,e.borderColor=e.origBorderColor,e.forEachObject(function(e){e.borderColor=e.origBorderColor,delete e.origBorderColor})}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{loadFromDatalessJSON:function(e,t,n){return this.loadFromJSON(e,t,n)},loadFromJSON:function(e,t,n){if(!e)return;var r=typeof e=="string"?JSON.parse(e):e;this.clear();var i=this;return this._enlivenObjects(r.objects,function(){i._setBgOverlay(r,t)},n),this},_setBgOverlay:function(e,t){var n=this,r={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(!e.backgroundImage&&!e.overlayImage&&!e.background&&!e.overlay){t&&t();return}var i=function(){r.backgroundImage&&r.overlayImage&&r.backgroundColor&&r.overlayColor&&(n.renderAll(),t&&t())};this.__setBgOverlay("backgroundImage",e.backgroundImage,r,i),this.__setBgOverlay("overlayImage",e.overlayImage,r,i),this.__setBgOverlay("backgroundColor",e.background,r,i),this.__setBgOverlay("overlayColor",e.overlay,r,i),i()},__setBgOverlay:function(e,t,n,r){var i=this;if(!t){n[e]=!0;return}e==="backgroundImage"||e==="overlayImage"?fabric.Image.fromObject(t,function(t){i[e]=t,n[e]=!0,r&&r()}):this["set"+fabric.util.string.capitalize(e,!0)](t,function(){n[e]=!0,r&&r()})},_enlivenObjects:function(e,t,n){var r=this;if(!e||e.length===0){t&&t();return}var i=this.renderOnAddRemove;this.renderOnAddRemove=!1,fabric.util.enlivenObjects(e,function(e){e.forEach(function(e,t){r.insertAt(e,t,!0)}),r.renderOnAddRemove=i,t&&t()},null,n)},_toDataURL:function(e,t){this.clone(function(n){t(n.toDataURL(e))})},_toDataURLWithMultiplier:function(e,t,n){this.clone(function(r){n(r.toDataURLWithMultiplier(e,t))})},clone:function(e,t){var n=JSON.stringify(this.toJSON(t));this.cloneWithoutData(function(t){t.loadFromJSON(n,function(){e&&e(t)})})},cloneWithoutData:function(e){var t=fabric.document.createElement("canvas");t.width=this.getWidth(),t.height=this.getHeight();var n=new fabric.Canvas(t);n.clipTo=this.clipTo,this.backgroundImage?(n.setBackgroundImage(this.backgroundImage.src,function(){n.renderAll(),e&&e(n)}),n.backgroundImageOpacity=this.backgroundImageOpacity,n.backgroundImageStretch=this.backgroundImageStretch):e&&e(n)}}),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.toFixed,i=t.util.string.capitalize,s=t.util.degreesToRadians,o=t.StaticCanvas.supports("setLineDash");if(t.Object)return;t.Object=t.util.createClass({type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,cornerSize:12,transparentCorners:!0,hoverCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"source-over",backgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:10,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:.01,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill fillRule shadow clipTo visible backgroundColor".split(" "),initialize:function(e){e&&this.setOptions(e)},_initGradient:function(e){e.fill&&e.fill.colorStops&&!(e.fill instanceof t.Gradient)&&this.set("fill",new t.Gradient(e.fill))},_initPattern:function(e){e.fill&&e.fill.source&&!(e.fill instanceof t.Pattern)&&this.set("fill",new t.Pattern(e.fill)),e.stroke&&e.stroke.source&&!(e.stroke instanceof t.Pattern)&&this.set("stroke",new t.Pattern(e.stroke))},_initClipping:function(e){if(!e.clipTo||typeof e.clipTo!="string")return;var n=t.util.getFunctionBody(e.clipTo);typeof n!="undefined"&&(this.clipTo=new Function("ctx",n))},setOptions:function(e){for(var t in e)this.set(t,e[t]);this._initGradient(e),this._initPattern(e),this._initClipping(e)},transform:function(e,t){this.group&&this.group.transform(e,t),e.globalAlpha=this.opacity;var n=t?this._getLeftTopCoords():this.getCenterPoint();e.translate(n.x,n.y),e.rotate(s(this.angle)),e.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(e){var n=t.Object.NUM_FRACTION_DIGITS,i={type:this.type,originX:this.originX,originY:this.originY,left:r(this.left,n),top:r(this.top,n),width:r(this.width,n),height:r(this.height,n),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,n),strokeDashArray:this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:r(this.strokeMiterLimit,n),scaleX:r(this.scaleX,n),scaleY:r(this.scaleY,n),angle:r(this.getAngle(),n),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,n),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor};return this.includeDefaultValues||(i=this._removeDefaultValues(i)),t.util.populateWithProperties(this,i,e),i},toDatalessObject:function(e){return this.toObject(e)},_removeDefaultValues:function(e){var n=t.util.getKlass(e.type).prototype,r=n.stateProperties;return r.forEach(function(t){e[t]===n[t]&&delete e[t]}),e},toString:function(){return"#<fabric."+i(this.type)+">"},get:function(e){return this[e]},_setObject:function(e){for(var t in e)this._set(t,e[t])},set:function(e,t){return typeof e=="object"?this._setObject(e):typeof t=="function"&&e!=="clipTo"?this._set(e,t(this.get(e))):this._set(e,t),this},_set:function(e,n){var i=e==="scaleX"||e==="scaleY";return i&&(n=this._constrainScale(n)),e==="scaleX"&&n<0?(this.flipX=!this.flipX,n*=-1):e==="scaleY"&&n<0?(this.flipY=!this.flipY,n*=-1):e==="width"||e==="height"?this.minScaleLimit=r(Math.min(.1,1/Math.max(this.width,this.height)),2):e==="shadow"&&n&&!(n instanceof t.Shadow)&&(n=new t.Shadow(n)),this[e]=n,this},toggle:function(e){var t=this.get(e);return typeof t=="boolean"&&this.set(e,!t),this},setSourcePath:function(e){return this.sourcePath=e,this},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:[1,0,0,1,0,0]},render:function(e,n){if(this.width===0||this.height===0||!this.visible)return;e.save(),this._setupFillRule(e),this._transform(e,n),this._setStrokeStyles(e),this._setFillStyles(e);var r=this.transformMatrix;r&&this.group&&(e.translate(-this.group.width/2,-this.group.height/2),e.transform(r[0],r[1],r[2],r[3],r[4],r[5])),this._setShadow(e),this.clipTo&&t.util.clipContext(this,e),this._render(e,n),this.clipTo&&e.restore(),this._removeShadow(e),this._restoreFillRule(e),e.restore()},_transform:function(e,t){var n=this.transformMatrix;n&&!this.group&&e.setTransform(n[0],n[1],n[2],n[3],n[4],n[5]),t||this.transform(e)},_setStrokeStyles:function(e){this.stroke&&(e.lineWidth=this.strokeWidth,e.lineCap=this.strokeLineCap,e.lineJoin=this.strokeLineJoin,e.miterLimit=this.strokeMiterLimit,e.strokeStyle=this.stroke.toLive?this.stroke.toLive(e):this.stroke)},_setFillStyles:function(e){this.fill&&(e.fillStyle=this.fill.toLive?this.fill.toLive(e):this.fill)},_renderControls:function(e,n){var r=this.getViewportTransform();e.save();if(this.active&&!n){var i;this.group&&(i=t.util.transformPoint(this.group.getCenterPoint(),r),e.translate(i.x,i.y),e.rotate(s(this.group.angle))),i=t.util.transformPoint(this.getCenterPoint(),r,null!=this.group),this.group&&(i.x*=this.group.scaleX,i.y*=this.group.scaleY),e.translate(i.x,i.y),e.rotate(s(this.angle)),this.drawBorders(e),this.drawControls(e)}e.restore()},_setShadow:function(e){if(!this.shadow)return;e.shadowColor=this.shadow.color,e.shadowBlur=this.shadow.blur,e.shadowOffsetX=this.shadow.offsetX,e.shadowOffsetY=this.shadow.offsetY},_removeShadow:function(e){if(!this.shadow)return;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0},_renderFill:function(e){if(!this.fill)return;this.fill.toLive&&(e.save(),e.translate(-this.width/2+this.fill.offsetX||0,-this.height/2+this.fill.offsetY||0)),this.fillRule==="destination-over"?e.fill("evenodd"):e.fill(),this.fill.toLive&&e.restore(),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e)},_renderStroke:function(e){if(!this.stroke||this.strokeWidth===0)return;e.save(),this.strokeDashArray?(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),o?(e.setLineDash(this.strokeDashArray),this._stroke&&this._stroke(e)):this._renderDashedStroke&&this._renderDashedStroke(e),e.stroke()):this._stroke?this._stroke(e):e.stroke(),this._removeShadow(e),e.restore()},clone:function(e,n){return this.constructor.fromObject?this.constructor.fromObject(this.toObject(n),e):new t.Object(this.toObject(n))},cloneAsImage:function(e){var n=this.toDataURL();return t.util.loadImage(n,function(n){e&&e(new t.Image(n))}),this},toDataURL:function(e){e||(e={});var n=t.util.createCanvasElement(),r=this.getBoundingRect();n.width=r.width,n.height=r.height,t.util.wrapElement(n,"div");var i=new t.Canvas(n);e.format==="jpg"&&(e.format="jpeg"),e.format==="jpeg"&&(i.backgroundColor="#fff");var s={active:this.get("active"),left:this.getLeft(),top:this.getTop()};this.set("active",!1),this.setPositionByOrigin(new t.Point(n.width/2,n.height/2),"center","center");var o=this.canvas;i.add(this);var u=i.toDataURL(e);return this.set(s).setCoords(),this.canvas=o,i.dispose(),i=null,u},isType:function(e){return this.type===e},complexity:function(){return 0},toJSON:function(e){return this.toObject(e)},setGradient:function(e,n){n||(n={});var r={colorStops:[]};r.type=n.type||(n.r1||n.r2?"radial":"linear"),r.coords={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2};if(n.r1||n.r2)r.coords.r1=n.r1,r.coords.r2=n.r2;for(var i in n.colorStops){var s=new t.Color(n.colorStops[i]);r.colorStops.push({offset:i,color:s.toRgb(),opacity:s.getAlpha()})}return this.set(e,t.Gradient.forObject(this,r))},setPatternFill:function(e){return this.set("fill",new t.Pattern(e))},setShadow:function(e){return this.set("shadow",e?new t.Shadow(e):null)},setColor:function(e){return this.set("fill",e),this},setAngle:function(e){var t=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",e),t&&this._resetOrigin(),this},centerH:function(){return this.canvas.centerObjectH(this),this},centerV:function(){return this.canvas.centerObjectV(this),this},center:function(){return this.canvas.centerObject(this),this},remove:function(){return this.canvas.remove(this),this},getLocalPointer:function(e,t){t=t||this.canvas.getPointer(e);var n=this.translateToOriginPoint(this.getCenterPoint(),"left","top");return{x:t.x-n.x,y:t.y-n.y}},_setupFillRule:function(e){this.fillRule&&(this._prevFillRule=e.globalCompositeOperation,e.globalCompositeOperation=this.fillRule)},_restoreFillRule:function(e){this.fillRule&&this._prevFillRule&&(e.globalCompositeOperation=this._prevFillRule)}}),t.util.createAccessors(t.Object),t.Object.prototype.rotate=t.Object.prototype.setAngle,n(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object.__uid=0}(typeof exports!="undefined"?exports:this),function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{translateToCenterPoint:function(t,n,r){var i=t.x,s=t.y,o=this.stroke?this.strokeWidth:0;return n==="left"?i=t.x+(this.getWidth()+o*this.scaleX)/2:n==="right"&&(i=t.x-(this.getWidth()+o*this.scaleX)/2),r==="top"?s=t.y+(this.getHeight()+o*this.scaleY)/2:r==="bottom"&&(s=t.y-(this.getHeight()+o*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(i,s),t,e(this.angle))},translateToOriginPoint:function(t,n,r){var i=t.x,s=t.y,o=this.stroke?this.strokeWidth:0;return n==="left"?i=t.x-(this.getWidth()+o*this.scaleX)/2:n==="right"&&(i=t.x+(this.getWidth()+o*this.scaleX)/2),r==="top"?s=t.y-(this.getHeight()+o*this.scaleY)/2:r==="bottom"&&(s=t.y+(this.getHeight()+o*this.scaleY)/2),fabric.util.rotatePoint(new fabric.Point(i,s),t,e(this.angle))},getCenterPoint:function(){var e=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,t){var n=this.getCenterPoint();return this.translateToOriginPoint(n,e,t)},toLocalPoint:function(t,n,r){var i=this.getCenterPoint(),s=this.stroke?this.strokeWidth:0,o,u;return n&&r?(n==="left"?o=i.x-(this.getWidth()+s*this.scaleX)/2:n==="right"?o=i.x+(this.getWidth()+s*this.scaleX)/2:o=i.x,r==="top"?u=i.y-(this.getHeight()+s*this.scaleY)/2:r==="bottom"?u=i.y+(this.getHeight()+s*this.scaleY)/2:u=i.y):(o=this.left,u=this.top),fabric.util.rotatePoint(new fabric.Point(t.x,t.y),i,-e(this.angle)).subtractEquals(new fabric.Point(o,u))},setPositionByOrigin:function(e,t,n){var r=this.translateToCenterPoint(e,t,n),i=this.translateToOriginPoint(r,this.originX,this.originY);this.set("left",i.x),this.set("top",i.y)},adjustPosition:function(t){var n=e(this.angle),r=this.getWidth()/2,i=Math.cos(n)*r,s=Math.sin(n)*r,o=this.getWidth(),u=Math.cos(n)*o,f=Math.sin(n)*o;this.originX==="center"&&t==="left"||this.originX==="right"&&t==="center"?(this.left-=i,this.top-=s):this.originX==="left"&&t==="center"||this.originX==="center"&&t==="right"?(this.left+=i,this.top+=s):this.originX==="left"&&t==="right"?(this.left+=u,this.top+=f):this.originX==="right"&&t==="left"&&(this.left-=u,this.top-=f),this.setCoords(),this.originX=t},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originX="center",this.originY="center",this.left=e.x,this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=e.x,this.top=e.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","center")}})}(),function(){var e=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,intersectsWithRect:function(e,t){var n=this.oCoords,r=new fabric.Point(n.tl.x,n.tl.y),i=new fabric.Point(n.tr.x,n.tr.y),s=new fabric.Point(n.bl.x,n.bl.y),o=new fabric.Point(n.br.x,n.br.y),u=fabric.Intersection.intersectPolygonRectangle([r,i,o,s],e,t);return u.status==="Intersection"},intersectsWithObject:function(e){function t(e){return{tl:new fabric.Point(e.tl.x,e.tl.y),tr:new fabric.Point(e.tr.x,e.tr.y),bl:new fabric.Point(e.bl.x,e.bl.y),br:new fabric.Point(e.br.x,e.br.y)}}var n=t(this.oCoords),r=t(e.oCoords),i=fabric.Intersection.intersectPolygonPolygon([n.tl,n.tr,n.br,n.bl],[r.tl,r.tr,r.br,r.bl]);return i.status==="Intersection"},isContainedWithinObject:function(e){var t=e.getBoundingRect(),n=new fabric.Point(t.left,t.top),r=new fabric.Point(t.left+t.width,t.top+t.height);return this.isContainedWithinRect(n,r)},isContainedWithinRect:function(e,t){var n=this.getBoundingRect();return n.left>=e.x&&n.left+n.width<=t.x&&n.top>=e.y&&n.top+n.height<=t.y},containsPoint:function(e){var t=this._getImageLines(this.oCoords),n=this._findCrossPoints(e,t);return n!==0&&n%2===1},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,t){var n,r,i,s,o,u,a=0,f;for(var l in t){f=t[l];if(f.o.y<e.y&&f.d.y<e.y)continue;if(f.o.y>=e.y&&f.d.y>=e.y)continue;f.o.x===f.d.x&&f.o.x>=e.x?(o=f.o.x,u=e.y):(n=0,r=(f.d.y-f.o.y)/(f.d.x-f.o.x),i=e.y-n*e.x,s=f.o.y-r*f.o.x,o=-(i-s)/(n-r),u=i+n*o),o>=e.x&&(a+=1);if(a===2)break}return a},getBoundingRectWidth:function(){return this.getBoundingRect().width},getBoundingRectHeight:function(){return this.getBoundingRect().height},getBoundingRect:function(){this.oCoords||this.setCoords();var e=[this.oCoords.tl.x,this.oCoords.tr.x,this.oCoords.br.x,this.oCoords.bl.x],t=fabric.util.array.min(e),n=fabric.util.array.max(e),r=Math.abs(t-n),i=[this.oCoords.tl.y,this.oCoords.tr.y,this.oCoords.br.y,this.oCoords.bl.y],s=fabric.util.array.min(i),o=fabric.util.array.max(i),u=Math.abs(s-o);return{left:t,top:s,width:r,height:u}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*this.scaleY},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?e<0?-this.minScaleLimit:this.minScaleLimit:e},scale:function(e){return e=this._constrainScale(e),e<0&&(this.flipX=!this.flipX,this.flipY=!this.flipY,e*=-1),this.scaleX=e,this.scaleY=e,this.setCoords(),this},scaleToWidth:function(e){var t=this.getBoundingRectWidth()/this.getWidth();return this.scale(e/this.width/t)},scaleToHeight:function(e){var t=this.getBoundingRectHeight()/this.getHeight();return this.scale(e/this.height/t)},setCoords:function(){var t=this.strokeWidth>1?this.strokeWidth:0,n=e(this.angle),r=this.getViewportTransform(),i=function(e){return fabric.util.transformPoint(e,r)},s=this.width,o=this.height,u=this.strokeLineCap==="round"||this.strokeLineCap==="square",f=this.type==="line"&&this.width===1,l=this.type==="line"&&this.height===1,c=u&&l||this.type!=="line",h=u&&f||this.type!=="line";f?s=t:l&&(o=t),c&&(s+=t),h&&(o+=t),this.currentWidth=s*this.scaleX,this.currentHeight=o*this.scaleY,this.currentWidth<0&&(this.currentWidth=Math.abs(this.currentWidth));var p=Math.sqrt(Math.pow(this.currentWidth/2,2)+Math.pow(this.currentHeight/2,2)),d=Math.atan(isFinite(this.currentHeight/this.currentWidth)?this.currentHeight/this.currentWidth:0),v=Math.cos(d+n)*p,m=Math.sin(d+n)*p,g=Math.sin(n),y=Math.cos(n),b=this.getCenterPoint(),w=new fabric.Point(this.currentWidth,this.currentHeight),E=new fabric.Point(b.x-v,b.y-m),S=new fabric.Point(E.x+w.x*y,E.y+w.x*g),x=new fabric.Point(E.x-w.y*g,E.y+w.y*y),T=new fabric.Point(E.x+w.x/2*y,E.y+w.x/2*g),N=i(E),C=i(S),k=i(new fabric.Point(S.x-w.y*g,S.y+w.y*y)),L=i(x),A=i(new fabric.Point(E.x-w.y/2*g,E.y+w.y/2*y)),O=i(T),M=i(new fabric.Point(S.x-w.y/2*g,S.y+w.y/2*y)),_=i(new fabric.Point(x.x+w.x/2*y,x.y+w.x/2*g)),D=i(new fabric.Point(T.x,T.y)),P=Math.cos(d+n)*this.padding*Math.sqrt(2),H=Math.sin(d+n)*this.padding*Math.sqrt(2);return N=N.add(new fabric.Point(-P,-H)),C=C.add(new fabric.Point(H,-P)),k=k.add(new fabric.Point(P,H)),L=L.add(new fabric.Point(-H,P)),A=A.add(new fabric.Point((-P-H)/2,(-H+P)/2)),O=O.add(new fabric.Point((H-P)/2,-(H+P)/2)),M=M.add(new fabric.Point((H+P)/2,(H-P)/2)),_=_.add(new fabric.Point((P-H)/2,(P+H)/2)),D=D.add(new fabric.Point((H-P)/2,-(H+P)/2)),this.oCoords={tl:N,tr:C,br:k,bl:L,ml:A,mt:O,mr:M,mb:_,mtr:D},this._setCornerCoords&&this._setCornerCoords(),this}})}(),fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e),this}}),fabric.util.object.extend(fabric.Object.prototype,{getSvgStyles:function(){var e=this.fill?this.fill.toLive?"url(#SVGID_"+this.fill.id+")":this.fill:"none",t=this.stroke?this.stroke.toLive?"url(#SVGID_"+this.stroke.id+")":this.stroke:"none",n=this.strokeWidth?this.strokeWidth:"0",r=this.strokeDashArray?this.strokeDashArray.join(" "):"",i=this.strokeLineCap?this.strokeLineCap:"butt",s=this.strokeLineJoin?this.strokeLineJoin:"miter",o=this.strokeMiterLimit?this.strokeMiterLimit:"4",u=typeof this.opacity!="undefined"?this.opacity:"1",a=this.visible?"":" visibility: hidden;",f=this.shadow&&this.type!=="text"?"filter: url(#SVGID_"+this.shadow.id+");":"";return["stroke: ",t,"; ","stroke-width: ",n,"; ","stroke-dasharray: ",r,"; ","stroke-linecap: ",i,"; ","stroke-linejoin: ",s,"; ","stroke-miterlimit: ",o,"; ","fill: ",e,"; ","opacity: ",u,";",f,a].join("")},getSvgTransform:function(){var e=fabric.util.toFixed,t=this.getAngle(),n=this.getViewportTransform(),r=fabric.util.transformPoint(this.getCenterPoint(),n),i=fabric.Object.NUM_FRACTION_DIGITS,s="translate("+e(r.x,i)+" "+e(r.y,i)+")",o=t!==0?" rotate("+e(t,i)+")":"",u=this.scaleX===1&&this.scaleY===1&&n[0]===1&&n[3]===1?"":" scale("+e(this.scaleX*n[0],i)+" "+e(this.scaleY*n[3],i)+")",a=this.flipX?"matrix(-1 0 0 1 0 0) ":"",f=this.flipY?"matrix(1 0 0 -1 0 0)":"";return[s,o,u,a,f].join("")},_createBaseSVGMarkup:function(){var e=[];return this.fill&&this.fill.toLive&&e.push(this.fill.toSVG(this,!1)),this.stroke&&this.stroke.toLive&&e.push(this.stroke.toSVG(this,!1)),this.shadow&&e.push(this.shadow.toSVG(this)),e}}),fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(){return this.stateProperties.some(function(e){return this.get(e)!==this.originalState[e]},this)},saveState:function(e){return this.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this),e&&e.stateProperties&&e.stateProperties.forEach(function(e){this.originalState[e]=this.get(e)},this),this},setupState:function(){return this.originalState={},this.saveState(),this}}),function(){var e=fabric.util.degreesToRadians,t=function(){return typeof G_vmlCanvasManager!="undefined"};fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(e){if(!this.hasControls||!this.active)return!1;var t=e.x,n=e.y,r,i;for(var s in this.oCoords){if(!this.isControlVisible(s))continue;if(s==="mtr"&&!this.hasRotatingPoint)continue;if(!(!this.get("lockUniScaling")||s!=="mt"&&s!=="mr"&&s!=="mb"&&s!=="ml"))continue;i=this._getImageLines(this.oCoords[s].corner),r=this._findCrossPoints({x:t,y:n},i);if(r!==0&&r%2===1)return this.__corner=s,s}return!1},_setCornerCoords:function(){var t=this.oCoords,n=e(this.angle),r=e(45-this.angle),i=Math.sqrt(2*Math.pow(this.cornerSize,2))/2,s=i*Math.cos(r),o=i*Math.sin(r),u=Math.sin(n),f=Math.cos(n);t.tl.corner={tl:{x:t.tl.x-o,y:t.tl.y-s},tr:{x:t.tl.x+s,y:t.tl.y-o},bl:{x:t.tl.x-s,y:t.tl.y+o},br:{x:t.tl.x+o,y:t.tl.y+s}},t.tr.corner={tl:{x:t.tr.x-o,y:t.tr.y-s},tr:{x:t.tr.x+s,y:t.tr.y-o},br:{x:t.tr.x+o,y:t.tr.y+s},bl:{x:t.tr.x-s,y:t.tr.y+o}},t.bl.corner={tl:{x:t.bl.x-o,y:t.bl.y-s},bl:{x:t.bl.x-s,y:t.bl.y+o},br:{x:t.bl.x+o,y:t.bl.y+s},tr:{x:t.bl.x+s,y:t.bl.y-o}},t.br.corner={tr:{x:t.br.x+s,y:t.br.y-o},bl:{x:t.br.x-s,y:t.br.y+o},br:{x:t.br.x+o,y:t.br.y+s},tl:{x:t.br.x-o,y:t.br.y-s}},t.ml.corner={tl:{x:t.ml.x-o,y:t.ml.y-s},tr:{x:t.ml.x+s,y:t.ml.y-o},bl:{x:t.ml.x-s,y:t.ml.y+o},br:{x:t.ml.x+o,y:t.ml.y+s}},t.mt.corner={tl:{x:t.mt.x-o,y:t.mt.y-s},tr:{x:t.mt.x+s,y:t.mt.y-o},bl:{x:t.mt.x-s,y:t.mt.y+o},br:{x:t.mt.x+o,y:t.mt.y+s}},t.mr.corner={tl:{x:t.mr.x-o,y:t.mr.y-s},tr:{x:t.mr.x+s,y:t.mr.y-o},bl:{x:t.mr.x-s,y:t.mr.y+o},br:{x:t.mr.x+o,y:t.mr.y+s}},t.mb.corner={tl:{x:t.mb.x-o,y:t.mb.y-s},tr:{x:t.mb.x+s,y:t.mb.y-o},bl:{x:t.mb.x-s,y:t.mb.y+o},br:{x:t.mb.x+o,y:t.mb.y+s}},t.mtr.corner={tl:{x:t.mtr.x-o+u*this.rotatingPointOffset,y:t.mtr.y-s-f*this.rotatingPointOffset},tr:{x:t.mtr.x+s+u*this.rotatingPointOffset,y:t.mtr.y-o-f*this.rotatingPointOffset},bl:{x:t.mtr.x-s+u*this.rotatingPointOffset,y:t.mtr.y+o-f*this.rotatingPointOffset},br:{x:t.mtr.x+o+u*this.rotatingPointOffset,y:t.mtr.y+s-f*this.rotatingPointOffset}}},drawBorders:function(e){if(!this.hasBorders)return this;var t=this.padding,n=t*2,r=this.getViewportTransform();e.save(),e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,e.strokeStyle=this.borderColor;var i=1/this._constrainScale(this.scaleX),s=1/this._constrainScale(this.scaleY);e.lineWidth=1/this.borderScaleFactor;var o=this.getWidth(),u=this.getHeight(),a=this.strokeWidth>1?this.strokeWidth:0,f=this.strokeLineCap==="round"||this.strokeLineCap==="square",l=this.type==="line"&&this.width===1,c=this.type==="line"&&this.height===1,h=f&&c||this.type!=="line",p=f&&l||this.type!=="line";l?o=a/i:c&&(u=a/s),h&&(o+=a/i),p&&(u+=a/s);var d=fabric.util.transformPoint(new fabric.Point(o,u),r,!0),v=d.x,m=d.y;this.group&&(v*=this.group.scaleX,m*=this.group.scaleY),e.strokeRect(~~(-(v/2)-t)-.5,~~(-(m/2)-t)-.5,~~(v+n)+1,~~(m+n)+1);if(this.hasRotatingPoint&&this.isControlVisible("mtr")&&!this.get("lockRotation")&&this.hasControls){var g=(this.flipY?m+t*2:-m-t*2)/2;e.beginPath(),e.moveTo(0,g),e.lineTo(0,g+(this.flipY?this.rotatingPointOffset:-this.rotatingPointOffset)),e.closePath(),e.stroke()}return e.restore(),this},drawControls:function(e){if(!this.hasControls)return this;var t=this.cornerSize,n=t/2,r=this.getViewportTransform(),i=this.strokeWidth>1?this.strokeWidth:0,s=this.width,o=this.height,u=this.strokeLineCap==="round"||this.strokeLineCap==="square",a=this.type==="line"&&this.width===1,f=this.type==="line"&&this.height===1,l=u&&f||this.type!=="line",c=u&&a||this.type!=="line";a?s=i:f&&(o=i),l&&(s+=i),c&&(o+=i),s*=this.scaleX,o*=this.scaleY;var h=fabric.util.transformPoint(new fabric.Point(s,o),r,!0),p=h.x,d=h.y,v=-(p/2),m=-(d/2),g=this.padding,y=n,b=n-t,w=this.transparentCorners?"strokeRect":"fillRect";return e.save(),e.lineWidth=1,e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,e.strokeStyle=e.fillStyle=this.cornerColor,this._drawControl("tl",e,w,v-y-g,m-y-g),this._drawControl("tr",e,w,v+p-y+g,m-y-g),this._drawControl("bl",e,w,v-y-g,m+d+b+g),this._drawControl("br",e,w,v+p+b+g,m+d+b+g),this.get("lockUniScaling")||(this._drawControl("mt",e,w,v+p/2-y,m-y-g),this._drawControl("mb",e,w,v+p/2-y,m+d+b+g),this._drawControl("mr",e,w,v+p+b+g,m+d/2-y),this._drawControl("ml",e,w,v-y-g,m+d/2-y)),this.hasRotatingPoint&&this._drawControl("mtr",e,w,v+p/2-y,this.flipY?m+d+this.rotatingPointOffset-this.cornerSize/2+g:m-this.rotatingPointOffset-this.cornerSize/2-g),e.restore(),this},_drawControl:function(e,n,r,i,s){var o=this.cornerSize;this.isControlVisible(e)&&(t()||this.transparentCorners||n.clearRect(i,s,o,o),n[r](i,s,o,o))},isControlVisible:function(e){return this._getControlsVisibility()[e]},setControlVisible:function(e,t){return this._getControlsVisibility()[e]=t,this},setControlsVisibility:function(e){e||(e={});for(var t in e)this.setControlVisible(t,e[t]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility}})}(),fabric.util.object.extend(fabric.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;return fabric.util.animate({startValue:e.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(t){e.set("left",t),s.renderAll(),i()},onComplete:function(){e.setCoords(),r()}}),this},fxCenterObjectV:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;return fabric.util.animate({startValue:e.get("top"),endValue:this.getCenter().top,duration:this.FX_DURATION,onChange:function(t){e.set("top",t),s.renderAll(),i()},onComplete:function(){e.setCoords(),r()}}),this},fxRemove:function(e,t){t=t||{};var n=function(){},r=t.onComplete||n,i=t.onChange||n,s=this;return fabric.util.animate({startValue:e.get("opacity"),endValue:0,duration:this.FX_DURATION,onStart:function(){e.set("active",!1)},onChange:function(t){e.set("opacity",t),s.renderAll(),i()},onComplete:function(){s.remove(e),r()}}),this}}),fabric.util.object.extend(fabric.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var e=[],t,n;for(t in arguments[0])e.push(t);for(var r=0,i=e.length;r<i;r++)t=e[r],n=r!==i-1,this._animate(t,arguments[0][t],arguments[1],n)}else this._animate.apply(this,arguments);return this},_animate:function(e,t,n,r){var i=this,s;t=t.toString(),n?n=fabric.util.object.clone(n):n={},~e.indexOf(".")&&(s=e.split("."));var o=s?this.get(s[0])[s[1]]:this.get(e);"from"in n||(n.from=o),~t.indexOf("=")?t=o+parseFloat(t.replace("=","")):t=parseFloat(t),fabric.util.animate({startValue:n.from,endValue:t,byValue:n.by,easing:n.easing,duration:n.duration,abort:n.abort&&function(){return n.abort.call(i)},onChange:function(t){s?i[s[0]][s[1]]=t:i.set(e,t);if(r)return;n.onChange&&n.onChange()},onComplete:function(){if(r)return;i.setCoords(),n.onComplete&&n.onComplete()}})}}),function(e){function s(e,t){var n=e.origin,r=e.axis1,i=e.axis2,s=e.dimension,o=t.nearest,u=t.center,a=t.farthest;return function(){switch(this.get(n)){case o:return Math.min(this.get(r),this.get(i));case u:return Math.min(this.get(r),this.get(i))+.5*this.get(s);case a:return Math.max(this.get(r),this.get(i))}}}var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r={x1:1,x2:1,y1:1,y2:1},i=t.StaticCanvas.supports("setLineDash");if(t.Line){t.warn("fabric.Line is already defined");return}t.Line=t.util.createClass(t.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,initialize:function(e,t){t=t||{},e||(e=[0,0,0,0]),this.callSuper("initialize",t),this.set("x1",e[0]),this.set("y1",e[1]),this.set("x2",e[2]),this.set("y2",e[3]),this._setWidthHeight(t)},_setWidthHeight:function(e){e||(e={}),this.width=Math.abs(this.x2-this.x1)||1,this.height=Math.abs(this.y2-this.y1)||1,this.left="left"in e?e.left:this._getLeftToOriginX(),this.top="top"in e?e.top:this._getTopToOriginY()},_set:function(e,t){return this[e]=t,typeof r[e]!="undefined"&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(e){e.beginPath();var t=this.group&&this.group.type==="path-group";if(t){var n=this.getCenterPoint();e.translate(n.x,n.y),this.transformMatrix||e.translate(-this.group.width/2,-this.group.height/2)}if(!this.strokeDashArray||this.strokeDashArray&&i){var r=this.x1<=this.x2?-1:1,s=this.y1<=this.y2?-1:1;e.moveTo(this.width===1?0:r*this.width/2,this.height===1?0:s*this.height/2),e.lineTo(this.width===1?0:r*-1*this.width/2,this.height===1?0:s*-1*this.height/2)}e.lineWidth=this.strokeWidth;var o=e.strokeStyle;e.strokeStyle=this.stroke||e.fillStyle,this.stroke&&this._renderStroke(e),e.strokeStyle=o},_renderDashedStroke:function(e){var n=this.x1<=this.x2?-1:1,r=this.y1<=this.y2?-1:1,i=this.width===1?0:n*this.width/2,s=this.height===1?0:r*this.height/2;e.beginPath(),t.util.drawDashedLine(e,i,s,-i,-s,this.strokeDashArray),e.closePath()},toObject:function(e){return n(this.callSuper("toObject",e),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})},toSVG:function(e){var t=this._createBaseSVGMarkup();return t.push("<line ",'x1="',this.get("x1"),'" y1="',this.get("y1"),'" x2="',this.get("x2"),'" y2="',this.get("y2"),'" style="',this.getSvgStyles(),'"/>'),e?e(t.join("")):t.join("")},complexity:function(){return 1}}),t.Line.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),t.Line.fromElement=function(e,r){var i=t.parseAttributes(e,t.Line.ATTRIBUTE_NAMES),s=[i.x1||0,i.y1||0,i.x2||0,i.y2||0];return new t.Line(s,n(i,r))},t.Line.fromObject=function(e){var n=[e.x1,e.y1,e.x2,e.y2];return new t.Line(n,e)}}(typeof exports!="undefined"?exports:this),function(e){function i(e){return"radius"in e&&e.radius>0}var t=e.fabric||(e.fabric={}),n=Math.PI*2,r=t.util.object.extend;if(t.Circle){t.warn("fabric.Circle is already defined.");return}t.Circle=t.util.createClass(t.Object,{type:"circle",radius:0,initialize:function(e){e=e||{},this.set("radius",e.radius||0),this.callSuper("initialize",e)},_set:function(e,t){return this.callSuper("_set",e,t),e==="radius"&&this.setRadius(t),this},toObject:function(e){return r(this.callSuper("toObject",e),{radius:this.get("radius")})},toSVG:function(e){var t=this._createBaseSVGMarkup();return t.push("<circle ",'cx="0" cy="0" ','r="',this.radius,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),e?e(t.join("")):t.join("")},_render:function(e,t){e.beginPath(),e.globalAlpha=this.group?e.globalAlpha*this.opacity:this.opacity,e.arc(t?this.left:0,t?this.top:0,this.radius,0,n,!1),this._renderFill(e),this.stroke&&this._renderStroke(e)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(e){this.radius=e,this.set("width",e*2).set("height",e*2)},complexity:function(){return 1}}),t.Circle.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),t.Circle.fromElement=function(e,n){n||(n={});var s=t.parseAttributes(e,t.Circle.ATTRIBUTE_NAMES);if(!i(s))throw new Error("value of `r` attribute is required and can not be negative");"left"in s||(s.left=0),"top"in s||(s.top=0),"transformMatrix"in s||(s.left-=n.width?n.width/2:0,s.top-=n.height?n.height/2:0);var o=new t.Circle(r(s,n));return o.cx=parseFloat(e.getAttribute("cx"))||0,o.cy=parseFloat(e.getAttribute("cy"))||0,o},t.Circle.fromObject=function(e){return new t.Circle(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={});if(t.Triangle){t.warn("fabric.Triangle is already defined");return}t.Triangle=t.util.createClass(t.Object,{type:"triangle",initialize:function(e){e=e||{},this.callSuper("initialize",e),this.set("width",e.width||100).set("height",e.height||100)},_render:function(e){var t=this.width/2,n=this.height/2;e.beginPath(),e.moveTo(-t,n),e.lineTo(0,-n),e.lineTo(t,n),e.closePath(),this._renderFill(e),this._renderStroke(e)},_renderDashedStroke:function(e){var n=this.width/2,r=this.height/2;e.beginPath(),t.util.drawDashedLine(e,-n,r,0,-r,this.strokeDashArray),t.util.drawDashedLine(e,0,-r,n,r,this.strokeDashArray),t.util.drawDashedLine(e,n,r,-n,r,this.strokeDashArray),e.closePath()},toSVG:function(e){var t=this._createBaseSVGMarkup(),n=this.width/2,r=this.height/2,i=[-n+" "+r,"0 "+ -r,n+" "+r].join(",");return t.push("<polygon ",'points="',i,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),e?e(t.join("")):t.join("")},complexity:function(){return 1}}),t.Triangle.fromObject=function(e){return new t.Triangle(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=Math.PI*2,r=t.util.object.extend;if(t.Ellipse){t.warn("fabric.Ellipse is already defined.");return}t.Ellipse=t.util.createClass(t.Object,{type:"ellipse",rx:0,ry:0,initialize:function(e){e=e||{},this.callSuper("initialize",e),this.set("rx",e.rx||0),this.set("ry",e.ry||0),this.set("width",this.get("rx")*2),this.set("height",this.get("ry")*2)},toObject:function(e){return r(this.callSuper("toObject",e),{rx:this.get("rx"),ry:this.get("ry")})},toSVG:function(e){var t=this._createBaseSVGMarkup();return t.push("<ellipse ",'rx="',this.get("rx"),'" ry="',this.get("ry"),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),e?e(t.join("")):t.join("")},render:function(e,t){if(this.rx===0||this.ry===0)return;return this.callSuper("render",e,t)},_render:function(e,t){e.beginPath(),e.globalAlpha=this.group?e.globalAlpha*this.opacity:this.opacity,e.save(),e.transform(1,0,0,this.ry/this.rx,0,0),e.arc(t?this.left:0,t?this.top*this.rx/this.ry:0,this.rx,0,n,!1),e.restore(),this._renderFill(e),this._renderStroke(e)},complexity:function(){return 1}}),t.Ellipse.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),t.Ellipse.fromElement=function(e,n){n||(n={});var i=t.parseAttributes(e,t.Ellipse.ATTRIBUTE_NAMES);"left"in i||(i.left=0),"top"in i||(i.top=0),"transformMatrix"in i||(i.left-=n.width?n.width/2:0,i.top-=n.height?n.height/2:0);var s=new t.Ellipse(r(i,n));return s.cx=parseFloat(e.getAttribute("cx"))||0,s.cy=parseFloat(e.getAttribute("cy"))||0,s},t.Ellipse.fromObject=function(e){return new t.Ellipse(e)}}(typeof exports!="undefined"?exports:this),function(e){function i(e){return e.left=e.left||0,e.top=e.top||0,e}var t=e.fabric||(e.fabric={}),n=t.util.object.extend;if(t.Rect){console.warn("fabric.Rect is already defined");return}var r=t.Object.prototype.stateProperties.concat();r.push("rx","ry","x","y"),t.Rect=t.util.createClass(t.Object,{stateProperties:r,type:"rect",rx:0,ry:0,x:0,y:0,strokeDashArray:null,initialize:function(e){e=e||{},this.callSuper("initialize",e),this._initRxRy(),this.x=e.x||0,this.y=e.y||0},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(e){if(this.width===1&&this.height===1){e.fillRect(0,0,1,1);return}var t=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,r=this.width,i=this.height,s=-r/2,o=-i/2,u=this.group&&this.group.type==="path-group",a=t!==0||n!==0,f=.4477152502;e.beginPath(),e.globalAlpha=u?e.globalAlpha*this.opacity:this.opacity,this.transformMatrix&&u&&e.translate(this.width/2+this.x,this.height/2+this.y),!this.transformMatrix&&u&&e.translate(-this.group.width/2+this.width/2+this.x,-this.group.height/2+this.height/2+this.y),e.moveTo(s+t,o),e.lineTo(s+r-t,o),a&&e.bezierCurveTo(s+r-f*t,o,s+r,o+f*n,s+r,o+n),e.lineTo(s+r,o+i-n),a&&e.bezierCurveTo(s+r,o+i-f*n,s+r-f*t,o+i,s+r-t,o+i),e.lineTo(s+t,o+i),a&&e.bezierCurveTo(s+f*t,o+i,s,o+i-f*n,s,o+i-n),e.lineTo(s,o+n),a&&e.bezierCurveTo(s,o+f*n,s+f*t,o,s+t,o),e.closePath(),this._renderFill(e),this._renderStroke(e)},_renderDashedStroke:function(e){var n=-this.width/2,r=-this.height/2,i=this.width,s=this.height;e.beginPath(),t.util.drawDashedLine(e,n,r,n+i,r,this.strokeDashArray),t.util.drawDashedLine(e,n+i,r,n+i,r+s,this.strokeDashArray),t.util.drawDashedLine(e,n+i,r+s,n,r+s,this.strokeDashArray),t.util.drawDashedLine(e,n,r+s,n,r,this.strokeDashArray),e.closePath()},_normalizeLeftTopProperties:function(e){return"left"in e&&this.set("left",e.left+this.getWidth()/2),this.set("x",e.left||0),"top"in e&&this.set("top",e.top+this.getHeight()/2),this.set("y",e.top||0),this},toObject:function(e){var t=n(this.callSuper("toObject",e),{rx:this.get("rx")||0,ry:this.get("ry")||0,x:this.get("x"),y:this.get("y")});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(e){var t=this._createBaseSVGMarkup();return t.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" rx="',this.get("rx"),'" ry="',this.get("ry"),'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),e?e(t.join("")):t.join("")},complexity:function(){return 1}}),t.Rect.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),t.Rect.fromElement=function(e,r){if(!e)return null;var s=t.parseAttributes(e,t.Rect.ATTRIBUTE_NAMES);s=i(s);var o=new t.Rect(n(r?t.util.object.clone(r):{},s));return o._normalizeLeftTopProperties(s),o},t.Rect.fromObject=function(e){return new t.Rect(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.toFixed;if(t.Polyline){t.warn("fabric.Polyline is already defined");return}t.Polyline=t.util.createClass(t.Object,{type:"polyline",points:null,initialize:function(e,t,n){t=t||{},this.set("points",e),this.callSuper("initialize",t),this._calcDimensions(n)},_calcDimensions:function(e){return t.Polygon.prototype._calcDimensions.call(this,e)},toObject:function(e){return t.Polygon.prototype.toObject.call(this,e)},toSVG:function(e){var t=[],r=this._createBaseSVGMarkup();for(var i=0,s=this.points.length;i<s;i++)t.push(n(this.points[i].x,2),",",n(this.points[i].y,2)," ");return r.push("<polyline ",'points="',t.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),e?e(r.join("")):r.join("")},_render:function(e){var t;e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y);for(var n=0,r=this.points.length;n<r;n++)t=this.points[n],e.lineTo(t.x,t.y);this._renderFill(e),this._renderStroke(e)},_renderDashedStroke:function(e){var n,r;e.beginPath();for(var i=0,s=this.points.length;i<s;i++)n=this.points[i],r=this.points[i+1]||n,t.util.drawDashedLine(e,n.x,n.y,r.x,r.y,this.strokeDashArray)},complexity:function(){return this.get("points").length}}),t.Polyline.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polyline.fromElement=function(e,n){if(!e)return null;n||(n={});var r=t.parsePointsAttribute(e.getAttribute("points")),i=t.parseAttributes(e,t.Polyline.ATTRIBUTE_NAMES);return"transformMatrix"in i||t.util.normalizePoints(r,n),new t.Polyline(r,t.util.object.extend(i,n),!0)},t.Polyline.fromObject=function(e){var n=e.points;return new t.Polyline(n,e,!0)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.array.min,i=t.util.array.max,s=t.util.toFixed;if(t.Polygon){t.warn("fabric.Polygon is already defined");return}t.Polygon=t.util.createClass(t.Object,{type:"polygon",points:null,initialize:function(e,t,n){t=t||{},this.points=e,this.callSuper("initialize",t),this._calcDimensions(n)},_calcDimensions:function(e){var t=this.points,n=r(t,"x"),s=r(t,"y"),o=i(t,"x"),u=i(t,"y");this.width=o-n||1,this.height=u-s||1,this.minX=n,this.minY=s;if(e)return;var a=this.width/2+this.minX,f=this.height/2+this.minY;this.points.forEach(function(e){e.x-=a,e.y-=f},this)},toObject:function(e){return n(this.callSuper("toObject",e),{points:this.points.concat()})},toSVG:function(e){var t=[],n=this._createBaseSVGMarkup();for(var r=0,i=this.points.length;r<i;r++)t.push(s(this.points[r].x,2),",",s(this.points[r].y,2)," ");return n.push("<polygon ",'points="',t.join(""),'" style="',this.getSvgStyles(),'" transform="',this.getSvgTransform(),'"/>'),e?e(n.join("")):n.join("")},_render:function(e){var t;e.beginPath(),e.globalAlpha=this.group?e.globalAlpha*this.opacity:this.opacity,e.moveTo(this.points[0].x,this.points[0].y);for(var n=0,r=this.points.length;n<r;n++)t=this.points[n],e.lineTo(t.x,t.y);this._renderFill(e);if(this.stroke||this.strokeDashArray)e.closePath(),this._renderStroke(e)},_renderDashedStroke:function(e){var n,r;e.beginPath();for(var i=0,s=this.points.length;i<s;i++)n=this.points[i],r=this.points[i+1]||this.points[0],t.util.drawDashedLine(e,n.x,n.y,r.x,r.y,this.strokeDashArray);e.closePath()},complexity:function(){return this.points.length}}),t.Polygon.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(),t.Polygon.fromElement=function(e,r){if(!e)return null;r||(r={});var i=t.parsePointsAttribute(e.getAttribute("points")),s=t.parseAttributes(e,t.Polygon.ATTRIBUTE_NAMES);return"transformMatrix"in s||t.util.normalizePoints(i,r),new t.Polygon(i,n(s,r),!0)},t.Polygon.fromObject=function(e){return new t.Polygon(e.points,e,!0)}}(typeof exports!="undefined"?exports:this),function(e){function f(e){return e[0]==="H"?e[1]:e[e.length-2]}function l(e){return e[0]==="V"?e[1]:e[e.length-1]}var t=e.fabric||(e.fabric={}),n=t.util.array.min,r=t.util.array.max,i=t.util.object.extend,s=Object.prototype.toString,o=t.util.drawArc,u={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},a={m:"l",M:"L"};if(t.Path){t.warn("fabric.Path is already defined");return}t.Path=t.util.createClass(t.Object,{type:"path",path:null,initialize:function(e,t){t=t||{},this.setOptions(t);if(!e)throw new Error("`path` argument is required");var n=s.call(e)==="[object Array]";this.path=n?e:e.match&&e.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(!this.path)return;n||(this.path=this._parsePath()),this._initializePath(t),t.sourcePath&&this.setSourcePath(t.sourcePath)},_initializePath:function(e){var t="width"in e&&e.width!=null,n="height"in e&&e.width!=null,r="left"in e,s="top"in e,o=r?this.left:0,u=s?this.top:0;!t||!n?(i(this,this._parseDimensions()),t&&(this.width=e.width),n&&(this.height=e.height)):(s||(this.top=this.height/2),r||(this.left=this.width/2)),this.pathOffset=this.pathOffset||this._calculatePathOffset(o,u)},_calculatePathOffset:function(e,t){return{x:this.left-e-this.width/2,y:this.top-t-this.height/2}},_render:function(e,t){var n,r=null,i=0,s=0,u=0,a=0,f=0,l=0,c,p,d,v,m=-(this.width/2+this.pathOffset.x),g=-(this.height/2+this.pathOffset.y);t&&(m+=this.width/2,g+=this.height/2);for(var y=0,b=this.path.length;y<b;++y){n=this.path[y];switch(n[0]){case"l":u+=n[1],a+=n[2],e.lineTo(u+m,a+g);break;case"L":u=n[1],a=n[2],e.lineTo(u+m,a+g);break;case"h":u+=n[1],e.lineTo(u+m,a+g);break;case"H":u=n[1],e.lineTo(u+m,a+g);break;case"v":a+=n[1],e.lineTo(u+m,a+g);break;case"V":a=n[1],e.lineTo(u+m,a+g);break;case"m":u+=n[1],a+=n[2],i=u,s=a,e.moveTo(u+m,a+g);break;case"M":u=n[1],a=n[2],i=u,s=a,e.moveTo(u+m,a+g);break;case"c":c=u+n[5],p=a+n[6],f=u+n[3],l=a+n[4],e.bezierCurveTo(u+n[1]+m,a+n[2]+g,f+m,l+g,c+m,p+g),u=c,a=p;break;case"C":u=n[5],a=n[6],f=n[3],l=n[4],e.bezierCurveTo(n[1]+m,n[2]+g,f+m,l+g,u+m,a+g);break;case"s":c=u+n[3],p=a+n[4],f=f?2*u-f:u,l=l?2*a-l:a,e.bezierCurveTo(f+m,l+g,u+n[1]+m,a+n[2]+g,c+m,p+g),f=u+n[1],l=a+n[2],u=c,a=p;break;case"S":c=n[3],p=n[4],f=2*u-f,l=2*a-l,e.bezierCurveTo(f+m,l+g,n[1]+m,n[2]+g,c+m,p+g),u=c,a=p,f=n[1],l=n[2];break;case"q":c=u+n[3],p=a+n[4],f=u+n[1],l=a+n[2],e.quadraticCurveTo(f+m,l+g,c+m,p+g),u=c,a=p;break;case"Q":c=n[3],p=n[4],e.quadraticCurveTo(n[1]+m,n[2]+g,c+m,p+g),u=c,a=p,f=n[1],l=n[2];break;case"t":c=u+n[1],p=a+n[2],r[0].match(/[QqTt]/)===null?(f=u,l=a):r[0]==="t"?(f=2*u-d,l=2*a-v):r[0]==="q"&&(f=2*u-f,l=2*a-l),d=f,v=l,e.quadraticCurveTo(f+m,l+g,c+m,p+g),u=c,a=p,f=u+n[1],l=a+n[2];break;case"T":c=n[1],p=n[2],f=2*u-f,l=2*a-l,e.quadraticCurveTo(f+m,l+g,c+m,p+g),u=c,a=p;break;case"a":o(e,u+m,a+g,[n[1],n[2],n[3],n[4],n[5],n[6]+u+m,n[7]+a+g]),u+=n[6],a+=n[7];break;case"A":o(e,u+m,a+g,[n[1],n[2],n[3],n[4],n[5],n[6]+m,n[7]+g]),u=n[6],a=n[7];break;case"z":case"Z":u=i,a=s,e.closePath()}r=n}},render:function(e,n){if(!this.visible)return;e.save(),n&&e.translate(-this.width/2,-this.height/2);var r=this.transformMatrix;r&&e.transform(r[0],r[1],r[2],r[3],r[4],r[5]),n||this.transform(e),this._setStrokeStyles(e),this._setFillStyles(e),this._setShadow(e),this.clipTo&&t.util.clipContext(this,e),e.beginPath(),e.globalAlpha=this.group?e.globalAlpha*this.opacity:this.opacity,this._render(e,n),this._renderFill(e),this._renderStroke(e),this.clipTo&&e.restore(),this._removeShadow(e),e.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(e){var t=i(this.callSuper("toObject",e),{path:this.path.map(function(e){return e.slice()}),pathOffset:this.pathOffset});return this.sourcePath&&(t.sourcePath=this.sourcePath),this.transformMatrix&&(t.transformMatrix=this.transformMatrix),t},toDatalessObject:function(e){var t=this.toObject(e);return this.sourcePath&&(t.path=this.sourcePath),delete t.sourcePath,t},toSVG:function(e){var t=[],n=this._createBaseSVGMarkup();for(var r=0,i=this.path.length;r<i;r++)t.push(this.path[r].join(" "));var s=t.join(" ");return n.push('<g transform="',this.group?"":this.getSvgTransform(),'">',"<path ",'d="',s,'" style="',this.getSvgStyles(),'" transform="translate(',-this.width/2," ",-this.height/2,")",'" stroke-linecap="round" ',"/>","</g>"),e?e(n.join("")):n.join("")},complexity:function(){return this.path.length},_parsePath:function(){var e=[],t=[],n,r,i=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/ig,s,o;for(var f=0,l,c=this.path.length;f<c;f++){n=this.path[f],o=n.slice(1).trim(),t.length=0;while(s=i.exec(o))t.push(s[0]);l=[n.charAt(0)];for(var h=0,p=t.length;h<p;h++)r=parseFloat(t[h]),isNaN(r)||l.push(r);var d=l[0],v=u[d.toLowerCase()],m=a[d]||d;if(l.length-1>v)for(var g=1,y=l.length;g<y;g+=v)e.push([d].concat(l.slice(g,g+v))),d=m;else e.push(l)}return e},_parseDimensions:function(){var e=[],t=[],i={};this.path.forEach(function(n,r){this._getCoordsFromCommand(n,r,e,t,i)},this);var s=n(e),o=n(t),u=r(e),a=r(t),f=u-s,l=a-o,c={left:this.left+(s+f/2),top:this.top+(o+l/2),width:f,height:l};return c},_getCoordsFromCommand:function(e,t,n,r,i){var s=!1;e[0]!=="H"&&(i.x=t===0?f(e):f(this.path[t-1])),e[0]!=="V"&&(i.y=t===0?l(e):l(this.path[t-1])),e[0]===e[0].toLowerCase()&&(s=!0);var o=this._getXY(e,s,i),u;u=parseInt(o.x,10),isNaN(u)||n.push(u),u=parseInt(o.y,10),isNaN(u)||r.push(u)},_getXY:function(e,t,n){var r=t?n.x+f(e):e[0]==="V"?n.x:f(e),i=t?n.y+l(e):e[0]==="H"?n.y:l(e);return{x:r,y:i}}}),t.Path.fromObject=function(e,n){typeof e.path=="string"?t.loadSVGFromURL(e.path,function(r){var i=r[0],s=e.path;delete e.path,t.util.object.extend(i,e),i.setSourcePath(s),n(i)}):n(new t.Path(e.path,e))},t.Path.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat(["d"]),t.Path.fromElement=function(e,n,r){var s=t.parseAttributes(e,t.Path.ATTRIBUTE_NAMES);n&&n(new t.Path(s.d,i(s,r)))},t.Path.async=!0}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.array.invoke,i=t.Object.prototype.toObject;if(t.PathGroup){t.warn("fabric.PathGroup is already defined");return}t.PathGroup=t.util.createClass(t.Path,{type:"path-group",fill:"",initialize:function(e,t){t=t||{},this.paths=e||[];for(var n=this.paths.length;n--;)this.paths[n].group=this;this.setOptions(t),t.widthAttr&&(this.scaleX=t.widthAttr/t.width),t.heightAttr&&(this.scaleY=t.heightAttr/t.height),this.setCoords(),t.sourcePath&&this.setSourcePath(t.sourcePath)},render:function(e){if(!this.visible)return;e.save();var n=this.transformMatrix;n&&e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this.transform(e),this._setShadow(e),this.clipTo&&t.util.clipContext(this,e);for(var r=0,i=this.paths.length;r<i;++r)this.paths[r].render(e,!0);this.clipTo&&e.restore(),this._removeShadow(e),e.restore()},_set:function(e,t){if(e==="fill"&&t&&this.isSameColor()){var n=this.paths.length;while(n--)this.paths[n]._set(e,t)}return this.callSuper("_set",e,t)},toObject:function(e){var t=n(i.call(this,e),{paths:r(this.getObjects(),"toObject",e)});return this.sourcePath&&(t.sourcePath=this.sourcePath),t},toDatalessObject:function(e){var t=this.toObject(e);return this.sourcePath&&(t.paths=this.sourcePath),t},toSVG:function(e){var t=this.getObjects(),n=["<g ",'style="',this.getSvgStyles(),'" ','transform="',this.getSvgTransform(),'" ',">"];for(var r=0,i=t.length;r<i;r++)n.push(t[r].toSVG(e));return n.push("</g>"),e?e(n.join("")):n.join("")},toString:function(){return"#<fabric.PathGroup ("+this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var e=(this.getObjects()[0].get("fill")||"").toLowerCase();return this.getObjects().every(function(t){return(t.get("fill")||"").toLowerCase()===e})},complexity:function(){return this.paths.reduce(function(e,t){return e+(t&&t.complexity?t.complexity():0)},0)},getObjects:function(){return this.paths}}),t.PathGroup.fromObject=function(e,n){typeof e.paths=="string"?t.loadSVGFromURL(e.paths,function(r){var i=e.paths;delete e.paths;var s=t.util.groupSVGElements(r,e,i);n(s)}):t.util.enlivenObjects(e.paths,function(r){delete e.paths,n(new t.PathGroup(r,e))})},t.PathGroup.async=!0}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.array.min,i=t.util.array.max,s=t.util.array.invoke;if(t.Group)return;var o={lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0};t.Group=t.util.createClass(t.Object,t.Collection,{type:"group",initialize:function(e,t){t=t||{},this._objects=e||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;this.originalState={},this.callSuper("initialize"),this._calcBounds(),this._updateObjectsCoords(),t&&n(this,t),this._setOpacityIfSame(),this.setCoords(),this.saveCoords()},_updateObjectsCoords:function(){this.forEachObject(this._updateObjectCoords,this)},_updateObjectCoords:function(e){var t=e.getLeft(),n=e.getTop();e.set({originalLeft:t,originalTop:n,left:t-this.left,top:n-this.top}),e.setCoords(),e.__origHasControls=e.hasControls,e.hasControls=!1},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(e){return this._restoreObjectsState(),e&&(this._objects.push(e),e.group=this),this.forEachObject(this._setObjectActive,this),this._calcBounds(),this._updateObjectsCoords(),this},_setObjectActive:function(e){e.set("active",!0),e.group=this},removeWithUpdate:function(e){return this._moveFlippedObject(e),this._restoreObjectsState(),this.forEachObject(this._setObjectActive,this),this.remove(e),this._calcBounds(),this._updateObjectsCoords(),this},_onObjectAdded:function(e){e.group=this},_onObjectRemoved:function(e){delete e.group,e.set("active",!1)},delegatedProperties:{fill:!0,opacity:!0,fontFamily:!0,fontWeight:!0,fontSize:!0,fontStyle:!0,lineHeight:!0,textDecoration:!0,textAlign:!0,backgroundColor:!0},_set:function(e,t){if(e in this.delegatedProperties){var n=this._objects.length;this[e]=t;while(n--)this._objects[n].set(e,t)}else this[e]=t},toObject:function(e){return n(this.callSuper("toObject",e),{objects:s(this._objects,"toObject",e)})},render:function(e){if(!this.visible)return;e.save(),this.clipTo&&t.util.clipContext(this,e);for(var n=0,r=this._objects.length;n<r;n++)this._renderObject(this._objects[n],e);this.clipTo&&e.restore(),e.restore()},_renderControls:function(e,t){this.callSuper("_renderControls",e,t);for(var n=0,r=this._objects.length;n<r;n++)this._objects[n]._renderControls(e)},_renderObject:function(e,t){var n=e.hasRotatingPoint;if(!e.visible)return;e.hasRotatingPoint=!1,e.render(t),e.hasRotatingPoint=n},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},_moveFlippedObject:function(e){var t=e.get("originX"),n=e.get("originY"),r=e.getCenterPoint();e.set({originX:"center",originY:"center",left:r.x,top:r.y}),this._toggleFlipping(e);var i=e.getPointByOrigin(t,n);return e.set({originX:t,originY:n,left:i.x,top:i.y}),this},_toggleFlipping:function(e){this.flipX&&(e.toggle("flipX"),e.set("left",-e.get("left")),e.setAngle(-e.getAngle())),this.flipY&&(e.toggle("flipY"),e.set("top",-e.get("top")),e.setAngle(-e.getAngle()))},_restoreObjectState:function(e){return this._setObjectPosition(e),e.setCoords(),e.hasControls=e.__origHasControls,delete e.__origHasControls,e.set("active",!1),e.setCoords(),delete e.group,this},_setObjectPosition:function(e){var t=this.getLeft(),n=this.getTop(),r=this._getRotatedLeftTop(e);e.set({angle:e.getAngle()+this.getAngle(),left:t+r.left,top:n+r.top,scaleX:e.get("scaleX")*this.get("scaleX"),scaleY:e.get("scaleY")*this.get("scaleY")})},_getRotatedLeftTop:function(e){var t=this.getAngle()*(Math.PI/180);return{left:-Math.sin(t)*e.getTop()*this.get("scaleY")+Math.cos(t)*e.getLeft()*this.get("scaleX"),top:Math.cos(t)*e.getTop()*this.get("scaleY")+Math.sin(t)*e.getLeft()*this.get("scaleX")}},destroy:function(){return this._objects.forEach(this._moveFlippedObject,this),this._restoreObjectsState()},saveCoords:function(){return this._originalLeft=this.get("left"),this._originalTop=this.get("top"),this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){return this.forEachObject(function(e){e.setCoords()}),this},_setOpacityIfSame:function(){var e=this.getObjects(),t=e[0]?e[0].get("opacity"):1,n=e.every(function(e){return e.get("opacity")===t});n&&(this.opacity=t)},_calcBounds:function(e){var t=[],n=[],r;for(var i=0,s=this._objects.length;i<s;++i){r=this._objects[i],r.setCoords();for(var o in r.oCoords)t.push(r.oCoords[o].x),n.push(r.oCoords[o].y)}this.set(this._getBounds(t,n,e))},_getBounds:function(e,n,s){var o=t.util.invertTransform(this.getViewportTransform()),u=t.util.transformPoint(new t.Point(r(e),r(n)),o),f=t.util.transformPoint(new t.Point(i(e),i(n)),o),l={width:f.x-u.x||0,height:f.y-u.y||0};return s||(l.left=(u.x+f.x)/2||0,l.top=(u.y+f.y)/2||0),l},toSVG:function(e){var t=["<g ",'transform="',this.getSvgTransform(),'">'];for(var n=0,r=this._objects.length;n<r;n++)t.push(this._objects[n].toSVG(e));return t.push("</g>"),e?e(t.join("")):t.join("")},get:function(e){if(e in o){if(this[e])return this[e];for(var t=0,n=this._objects.length;t<n;t++)if(this._objects[t][e])return!0;return!1}return e in this.delegatedProperties?this._objects[0]&&this._objects[0].get(e):this[e]}}),t.Group.fromObject=function(e,n){t.util.enlivenObjects(e.objects,function(r){delete e.objects,n&&n(new t.Group(r,e))})},t.Group.async=!0}(typeof exports!="undefined"?exports:this),function(e){var t=fabric.util.object.extend;e.fabric||(e.fabric={});if(e.fabric.Image){fabric.warn("fabric.Image is already defined.");return}fabric.Image=fabric.util.createClass(fabric.Object,{type:"image",crossOrigin:"",initialize:function(e,t){t||(t={}),this.filters=[],this.callSuper("initialize",t),this._initElement(e,t),this._initConfig(t),t.filters&&(this.filters=t.filters,this.applyFilters())},getElement:function(){return this._element},setElement:function(e,t){return this._element=e,this._originalElement=e,this._initConfig(),this.filters.length!==0&&this.applyFilters(t),this},setCrossOrigin:function(e){return this.crossOrigin=e,this._element.crossOrigin=e,this},getOriginalSize:function(){var e=this.getElement();return{width:e.width,height:e.height}},render:function(e,t){if(!this.visible)return;e.save();var n=this.transformMatrix,r=this.group&&this.group.type==="path-group";r&&e.translate(-this.group.width/2,-this.group.height/2),n&&e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),t||this.transform(e),r&&e.translate(this.width/2,this.height/2),this._setShadow(e),this.clipTo&&fabric.util.clipContext(this,e),this._render(e),this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),this._renderStroke(e),this.clipTo&&e.restore(),e.restore()},_stroke:function(e){e.save(),this._setStrokeStyles(e),e.beginPath(),e.strokeRect(-this.width/2,-this.height/2,this.width,this.height),e.closePath(),e.restore()},_renderDashedStroke:function(e){var t=-this.width/2,n=-this.height/2,r=this.width,i=this.height;e.save(),this._setStrokeStyles(e),e.beginPath(),fabric.util.drawDashedLine(e,t,n,t+r,n,this.strokeDashArray),fabric.util.drawDashedLine(e,t+r,n,t+r,n+i,this.strokeDashArray),fabric.util.drawDashedLine(e,t+r,n+i,t,n+i,this.strokeDashArray),fabric.util.drawDashedLine(e,t,n+i,t,n,this.strokeDashArray),e.closePath(),e.restore()},toObject:function(e){return t(this.callSuper("toObject",e),{src:this._originalElement.src||this._originalElement._src,filters:this.filters.map(function(e){return e&&e.toObject()}),crossOrigin:this.crossOrigin})},toSVG:function(e){var t=[];t.push('<g transform="',this.getSvgTransform(),'">','<image xlink:href="',this.getSvgSrc(),'" style="',this.getSvgStyles(),'" transform="translate('+ -this.width/2+" "+ -this.height/2+")",'" width="',this.width,'" height="',this.height,'" preserveAspectRatio="none"',"></image>");if(this.stroke||this.strokeDashArray){var n=this.fill;this.fill=null,t.push("<rect ",'x="',-1*this.width/2,'" y="',-1*this.height/2,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>'),this.fill=n}return t.push("</g>"),e?e(t.join("")):t.join("")},getSrc:function(){if(this.getElement())return this.getElement().src||this.getElement()._src},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(e,t){this.constructor.fromObject(this.toObject(t),e)},applyFilters:function(e){if(!this._originalElement)return;if(this.filters.length===0){this._element=this._originalElement,e&&e();return}var t=this._originalElement,n=fabric.util.createCanvasElement(),r=fabric.util.createImage(),i=this;return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0,t.width,t.height),this.filters.forEach(function(e){e&&e.applyTo(n)}),r.width=t.width,r.height=t.height,fabric.isLikelyNode?(r.src=n.toBuffer(undefined,fabric.Image.pngCompression),i._element=r,e&&e()):(r.onload=function(){i._element=r,e&&e(),r.onload=n=t=null},r.src=n.toDataURL("image/png")),this},_render:function(e){this._element&&e.drawImage(this._element,-this.width/2,-this.height/2,this.width,this.height)},_resetWidthHeight:function(){var e=this.getElement();this.set("width",e.width),this.set("height",e.height)},_initElement:function(e){this.setElement(fabric.util.getById(e)),fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(e){e||(e={}),this.setOptions(e),this._setWidthHeight(e),this._element&&this.crossOrigin&&(this._element.crossOrigin=this.crossOrigin)},_initFilters:function(e,t){e.filters&&e.filters.length?fabric.util.enlivenObjects(e.filters,function(e){t&&t(e)},"fabric.Image.filters"):t&&t()},_setWidthHeight:function(e){this.width="width"in e?e.width:this.getElement()?this.getElement().width||0:0,this.height="height"in e?e.height:this.getElement()?this.getElement().height||0:0},complexity:function(){return 1}}),fabric.Image.CSS_CANVAS="canvas-img",fabric.Image.prototype.getSvgSrc=fabric.Image.prototype.getSrc,fabric.Image.fromObject=function(e,t){fabric.util.loadImage(e.src,function(n){fabric.Image.prototype._initFilters.call(e,e,function(r){e.filters=r||[];var i=new fabric.Image(n,e);t&&t(i)})},null,e.crossOrigin)},fabric.Image.fromURL=function(e,t,n){fabric.util.loadImage(e,function(e){t(new fabric.Image(e,n))},null,n&&n.crossOrigin)},fabric.Image.ATTRIBUTE_NAMES=fabric.SHARED_ATTRIBUTES.concat("x y width height xlink:href".split(" ")),fabric.Image.fromElement=function(e,n,r){var i=fabric.parseAttributes(e,fabric.Image.ATTRIBUTE_NAMES);fabric.Image.fromURL(i["xlink:href"],n,t(r?fabric.util.object.clone(r):{},i))},fabric.Image.async=!0,fabric.Image.pngCompression=1}(typeof exports!="undefined"?exports:this),fabric.util.object.extend(fabric.Object.prototype,{_getAngleValueForStraighten:function(){var e=this.getAngle()%360;return e>0?Math.round((e-1)/90)*90:Math.round(e/90)*90},straighten:function(){return this.setAngle(this._getAngleValueForStraighten()),this},fxStraighten:function(e){e=e||{};var t=function(){},n=e.onComplete||t,r=e.onChange||t,i=this;return fabric.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(e){i.setAngle(e),r()},onComplete:function(){i.setCoords(),n()},onStart:function(){i.set("active",!1)}}),this}}),fabric.util.object.extend(fabric.StaticCanvas.prototype,{straightenObject:function(e){return e.straighten(),this.renderAll(),this},fxStraightenObject:function(e){return e.fxStraighten({onChange:this.renderAll.bind(this)}),this}}),fabric.Image.filters=fabric.Image.filters||{},fabric.Image.filters.BaseFilter=fabric.util.createClass({type:"BaseFilter",toObject:function(){return{type:this.type}},toJSON:function(){return this.toObject()}}),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Brightness=t.util.createClass(t.Image.filters.BaseFilter,{type:"Brightness",initialize:function(e){e=e||{},this.brightness=e.brightness||0},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.brightness;for(var s=0,o=r.length;s<o;s+=4)r[s]+=i,r[s+1]+=i,r[s+2]+=i;t.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{brightness:this.brightness})}}),t.Image.filters.Brightness.fromObject=function(e){return new t.Image.filters.Brightness(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Convolute=t.util.createClass(t.Image.filters.BaseFilter,{type:"Convolute",initialize:function(e){e=e||{},this.opaque=e.opaque,this.matrix=e.matrix||[0,0,0,0,1,0,0,0,0];var n=t.util.createCanvasElement();this.tmpCtx=n.getContext("2d")},_createImageData:function(e,t){return this.tmpCtx.createImageData(e,t)},applyTo:function(e){var t=this.matrix,n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height),i=Math.round(Math.sqrt(t.length)),s=Math.floor(i/2),o=r.data,u=r.width,a=r.height,f=u,l=a,c=this._createImageData(f,l),h=c.data,p=this.opaque?1:0;for(var d=0;d<l;d++)for(var v=0;v<f;v++){var m=d,g=v,y=(d*f+v)*4,b=0,w=0,E=0,S=0;for(var x=0;x<i;x++)for(var T=0;T<i;T++){var N=m+x-s,C=g+T-s;if(N<0||N>a||C<0||C>u)continue;var k=(N*u+C)*4,L=t[x*i+T];b+=o[k]*L,w+=o[k+1]*L,E+=o[k+2]*L,S+=o[k+3]*L}h[y]=b,h[y+1]=w,h[y+2]=E,h[y+3]=S+p*(255-S)}n.putImageData(c,0,0)},toObject:function(){return n(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),t.Image.filters.Convolute.fromObject=function(e){return new t.Image.filters.Convolute(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.GradientTransparency=t.util.createClass(t.Image.filters.BaseFilter,{type:"GradientTransparency",initialize:function(e){e=e||{},this.threshold=e.threshold||100},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.threshold,s=r.length;for(var o=0,u=r.length;o<u;o+=4)r[o+3]=i+255*(s-o)/s;t.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{threshold:this.threshold})}}),t.Image.filters.GradientTransparency.fromObject=function(e){return new t.Image.filters.GradientTransparency(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={});t.Image.filters.Grayscale=t.util.createClass(t.Image.filters.BaseFilter,{type:"Grayscale",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=n.width*n.height*4,s=0,o;while(s<i)o=(r[s]+r[s+1]+r[s+2])/3,r[s]=o,r[s+1]=o,r[s+2]=o,s+=4;t.putImageData(n,0,0)}}),t.Image.filters.Grayscale.fromObject=function(){return new t.Image.filters.Grayscale}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={});t.Image.filters.Invert=t.util.createClass(t.Image.filters.BaseFilter,{type:"Invert",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=r.length,s;for(s=0;s<i;s+=4)r[s]=255-r[s],r[s+1]=255-r[s+1],r[s+2]=255-r[s+2];t.putImageData(n,0,0)}}),t.Image.filters.Invert.fromObject=function(){return new t.Image.filters.Invert}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Mask=t.util.createClass(t.Image.filters.BaseFilter,{type:"Mask",initialize:function(e){e=e||{},this.mask=e.mask,this.channel=[0,1,2,3].indexOf(e.channel)>-1?e.channel:0},applyTo:function(e){if(!this.mask)return;var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height),i=r.data,s=this.mask.getElement(),o=t.util.createCanvasElement(),u=this.channel,a,f=r.width*r.height*4;o.width=s.width,o.height=s.height,o.getContext("2d").drawImage(s,0,0,s.width,s.height);var l=o.getContext("2d").getImageData(0,0,s.width,s.height),c=l.data;for(a=0;a<f;a+=4)i[a+3]=c[a+u];n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{mask:this.mask.toObject(),channel:this.channel})}}),t.Image.filters.Mask.fromObject=function(e,n){t.util.loadImage(e.mask.src,function(r){e.mask=new t.Image(r,e.mask),n&&n(new t.Image.filters.Mask(e))})},t.Image.filters.Mask.async=!0}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Noise=t.util.createClass(t.Image.filters.BaseFilter,{type:"Noise",initialize:function(e){e=e||{},this.noise=e.noise||0},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.noise,s;for(var o=0,u=r.length;o<u;o+=4)s=(.5-Math.random())*i,r[o]+=s,r[o+1]+=s,r[o+2]+=s;t.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{noise:this.noise})}}),t.Image.filters.Noise.fromObject=function(e){return new t.Image.filters.Noise(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Pixelate=t.util.createClass(t.Image.filters.BaseFilter,{type:"Pixelate",initialize:function(e){e=e||{},this.blocksize=e.blocksize||4},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=n.height,s=n.width,o,u,a,f,l,c,h;for(u=0;u<i;u+=this.blocksize)for(a=0;a<s;a+=this.blocksize){o=u*4*s+a*4,f=r[o],l=r[o+1],c=r[o+2],h=r[o+3];for(var p=u,d=u+this.blocksize;p<d;p++)for(var v=a,m=a+this.blocksize;v<m;v++)o=p*4*s+v*4,r[o]=f,r[o+1]=l,r[o+2]=c,r[o+3]=h}t.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{blocksize:this.blocksize})}}),t.Image.filters.Pixelate.fromObject=function(e){return new t.Image.filters.Pixelate(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.RemoveWhite=t.util.createClass(t.Image.filters.BaseFilter,{type:"RemoveWhite",initialize:function(e){e=e||{},this.threshold=e.threshold||30,this.distance=e.distance||20},applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=this.threshold,s=this.distance,o=255-i,u=Math.abs,a,f,l;for(var c=0,h=r.length;c<h;c+=4)a=r[c],f=r[c+1],l=r[c+2],a>o&&f>o&&l>o&&u(a-f)<s&&u(a-l)<s&&u(f-l)<s&&(r[c+3]=1);t.putImageData(n,0,0)},toObject:function(){return n(this.callSuper("toObject"),{threshold:this.threshold,distance:this.distance})}}),t.Image.filters.RemoveWhite.fromObject=function(e){return new t.Image.filters.RemoveWhite(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={});t.Image.filters.Sepia=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=r.length,s,o;for(s=0;s<i;s+=4)o=.3*r[s]+.59*r[s+1]+.11*r[s+2],r[s]=o+100,r[s+1]=o+50,r[s+2]=o+255;t.putImageData(n,0,0)}}),t.Image.filters.Sepia.fromObject=function(){return new t.Image.filters.Sepia}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={});t.Image.filters.Sepia2=t.util.createClass(t.Image.filters.BaseFilter,{type:"Sepia2",applyTo:function(e){var t=e.getContext("2d"),n=t.getImageData(0,0,e.width,e.height),r=n.data,i=r.length,s,o,u,a;for(s=0;s<i;s+=4)o=r[s],u=r[s+1],a=r[s+2],r[s]=(o*.393+u*.769+a*.189)/1.351,r[s+1]=(o*.349+u*.686+a*.168)/1.203,r[s+2]=(o*.272+u*.534+a*.131)/2.14;t.putImageData(n,0,0)}}),t.Image.filters.Sepia2.fromObject=function(){return new t.Image.filters.Sepia2}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Tint=t.util.createClass(t.Image.filters.BaseFilter,{type:"Tint",initialize:function(e){e=e||{},this.color=e.color||"#000000",this.opacity=typeof e.opacity!="undefined"?e.opacity:(new t.Color(this.color)).getAlpha()},applyTo:function(e){var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height),i=r.data,s=i.length,o,u,a,f,l,c,h,p,d;d=(new t.Color(this.color)).getSource(),u=d[0]*this.opacity,a=d[1]*this.opacity,f=d[2]*this.opacity,p=1-this.opacity;for(o=0;o<s;o+=4)l=i[o],c=i[o+1],h=i[o+2],i[o]=u+l*p,i[o+1]=a+c*p,i[o+2]=f+h*p;n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{color:this.color,opacity:this.opacity})}}),t.Image.filters.Tint.fromObject=function(e){return new t.Image.filters.Tint(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend;t.Image.filters.Multiply=t.util.createClass(t.Image.filters.BaseFilter,{type:"Multiply",initialize:function(e){e=e||{},this.color=e.color||"#000000"},applyTo:function(e){var n=e.getContext("2d"),r=n.getImageData(0,0,e.width,e.height),i=r.data,s=i.length,o,u;u=(new t.Color(this.color)).getSource();for(o=0;o<s;o+=4)i[o]*=u[0]/255,i[o+1]*=u[1]/255,i[o+2]*=u[2]/255;n.putImageData(r,0,0)},toObject:function(){return n(this.callSuper("toObject"),{color:this.color})}}),t.Image.filters.Multiply.fromObject=function(e){return new t.Image.filters.Multiply(e)}}(typeof exports!="undefined"?exports:this),function(e){var t=e.fabric||(e.fabric={}),n=t.util.object.extend,r=t.util.object.clone,i=t.util.toFixed,s=t.StaticCanvas.supports("setLineDash");if(t.Text){t.warn("fabric.Text is already defined");return}var o=t.Object.prototype.stateProperties.concat();o.push("fontFamily","fontWeight","fontSize","text","textDecoration","textAlign","fontStyle","lineHeight","textBackgroundColor","useNative","path"),t.Text=t.util.createClass(t.Object,{_dimensionAffectingProps:{fontSize:!0,fontWeight:!0,fontFamily:!0,textDecoration:!0,fontStyle:!0,lineHeight:!0,stroke:!0,strokeWidth:!0,text:!0},_reNewline:/\r?\n/,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textAlign:"left",fontStyle:"",lineHeight:1.3,textBackgroundColor:"",path:null,useNative:!0,stateProperties:o,stroke:null,shadow:null,initialize:function(e,t){t=t||{},this.text=e,this.__skipDimension=!0,this.setOptions(t),this.__skipDimension=!1,this._initDimensions()},_initDimensions:function(){if(this.__skipDimension)return;var e=t.util.createCanvasElement();this._render(e.getContext("2d"))},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_render:function(e){typeof Cufon=="undefined"||this.useNative===!0?this._renderViaNative(e):this._renderViaCufon(e)},_renderViaNative:function(e){var n=this.text.split(this._reNewline);this._setTextStyles(e),this.width=this._getTextWidth(e,n),this.height=this._getTextHeight(e,n),this.clipTo&&t.util.clipContext(this,e),this._renderTextBackground(e,n),this._translateForTextAlign(e),this._renderText(e,n),this.textAlign!=="left"&&this.textAlign!=="justify"&&e.restore(),this._renderTextDecoration(e,n),this.clipTo&&e.restore(),this._setBoundaries(e,n),this._totalLineHeight=0},_renderText:function(e,t){e.save(),this._setShadow(e),this._renderTextFill(e,t),this._renderTextStroke(e,t),this._removeShadow(e),e.restore()},_translateForTextAlign:function(e){this.textAlign!=="left"&&this.textAlign!=="justify"&&(e.save(),e.translate(this.textAlign==="center"?this.width/2:this.width,0))},_setBoundaries:function(e,t){this._boundaries=[];for(var n=0,r=t.length;n<r;n++){var i=this._getLineWidth(e,t[n]),s=this._getLineLeftOffset(i);this._boundaries.push({height:this.fontSize*this.lineHeight,width:i,left:s})}},_setTextStyles:function(e){this._setFillStyles(e),this._setStrokeStyles(e),e.textBaseline="alphabetic",this.skipTextAlign||(e.textAlign=this.textAlign),e.font=this._getFontDeclaration()},_getTextHeight:function(e,t){return this.fontSize*t.length*this.lineHeight},_getTextWidth:function(e,t){var n=e.measureText(t[0]||"|").width;for(var r=1,i=t.length;r<i;r++){var s=e.measureText(t[r]).width;s>n&&(n=s)}return n},_renderChars:function(e,t,n,r,i){t[e](n,r,i)},_renderTextLine:function(e,t,n,r,i,s){i-=this.fontSize/4;if(this.textAlign!=="justify"){this._renderChars(e,t,n,r,i,s);return}var o=t.measureText(n).width,u=this.width;if(u>o){var a=n.split(/\s+/),f=t.measureText(n.replace(/\s+/g,"")).width,l=u-f,c=a.length-1,h=l/c,p=0;for(var d=0,v=a.length;d<v;d++)this._renderChars(e,t,a[d],r+p,i,s),p+=t.measureText(a[d]).width+h}else this._renderChars(e,t,n,r,i,s)},_getLeftOffset:function(){return t.isLikelyNode?0:-this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextFill:function(e,t){if(!this.fill&&!this._skipFillStrokeCheck)return;this._boundaries=[];var n=0;for(var r=0,i=t.length;r<i;r++){var s=this._getHeightOfLine(e,r,t);n+=s,this._renderTextLine("fillText",e,t[r],this._getLeftOffset(),this._getTopOffset()+n,r)}},_renderTextStroke:function(e,t){if((!this.stroke||this.strokeWidth===0)&&!this._skipFillStrokeCheck)return;var n=0;e.save(),this.strokeDashArray&&(1&this.strokeDashArray.length&&this.strokeDashArray.push.apply(this.strokeDashArray,this.strokeDashArray),s&&e.setLineDash(this.strokeDashArray)),e.beginPath();for(var r=0,i=t.length;r<i;r++){var o=this._getHeightOfLine(e,r,t);n+=o,this._renderTextLine("strokeText",e,t[r],this._getLeftOffset(),this._getTopOffset()+n,r)}e.closePath(),e.restore()},_getHeightOfLine:function(){return this.fontSize*this.lineHeight},_renderTextBackground:function(e,t){this._renderTextBoxBackground(e),this._renderTextLinesBackground(e,t)},_renderTextBoxBackground:function(e){if(!this.backgroundColor)return;e.save(),e.fillStyle=this.backgroundColor,e.fillRect(this._getLeftOffset(),this._getTopOffset(),this.width,this.height),e.restore()},_renderTextLinesBackground:function(e,t){if(!this.textBackgroundColor)return;e.save(),e.fillStyle=this.textBackgroundColor;for(var n=0,r=t.length;n<r;n++)if(t[n]!==""){var i=this._getLineWidth(e,t[n]),s=this._getLineLeftOffset(i);e.fillRect(this._getLeftOffset()+s,this._getTopOffset()+n*this.fontSize*this.lineHeight,i,this.fontSize*this.lineHeight)}e.restore()},_getLineLeftOffset:function(e){return this.textAlign==="center"?(this.width-e)/2:this.textAlign==="right"?this.width-e:0},_getLineWidth:function(e,t){return this.textAlign==="justify"?this.width:e.measureText(t).width},_renderTextDecoration:function(e,t){function i(i){for(var s=0,o=t.length;s<o;s++){var u=r._getLineWidth(e,t[s]),a=r._getLineLeftOffset(u);e.fillRect(r._getLeftOffset()+a,~~(i+s*r._getHeightOfLine(e,s,t)-n),u,1)}}if(!this.textDecoration)return;var n=this._getTextHeight(e,t)/2,r=this;this.textDecoration.indexOf("underline")>-1&&i(this.fontSize*this.lineHeight),this.textDecoration.indexOf("line-through")>-1&&i(this.fontSize*this.lineHeight-this.fontSize/2),this.textDecoration.indexOf("overline")>-1&&i(this.fontSize*this.lineHeight-this.fontSize)},_getFontDeclaration:function(){return[t.isLikelyNode?this.fontWeight:this.fontStyle,t.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",t.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},render:function(e,t){if(!this.visible)return;e.save(),this._transform(e,t);var n=this.transformMatrix,r=this.group&&this.group.type==="path-group";r&&e.translate(-this.group.width/2,-this.group.height/2),n&&e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),r&&e.translate(this.left,this.top),this._render(e),e.restore()},toObject:function(e){var t=n(this.callSuper("toObject",e),{text:this.text,fontSize:this.fontSize,fontWeight:this.fontWeight,fontFamily:this.fontFamily,fontStyle:this.fontStyle,lineHeight:this.lineHeight,textDecoration:this.textDecoration,textAlign:this.textAlign,path:this.path,textBackgroundColor:this.textBackgroundColor,useNative:this.useNative});return this.includeDefaultValues||this._removeDefaultValues(t),t},toSVG:function(e){var t=[],n=this.text.split(this._reNewline),r=this._getSVGLeftTopOffsets(n),i=this._getSVGTextAndBg(r.lineTop,r.textLeft,n),s=this._getSVGShadows(r.lineTop,n);return r.textTop+=this._fontAscent?this._fontAscent/5*this.lineHeight:0,this._wrapSVGTextAndBg(t,i,s,r),e?e(t.join("")):t.join("")},_getSVGLeftTopOffsets:function(e){var t=this.useNative?this.fontSize*this.lineHeight:-this._fontAscent-this._fontAscent/5*this.lineHeight,n=-(this.width/2),r=this.useNative?this.fontSize-1:this.height/2-e.length*this.fontSize-this._totalLineHeight;return{textLeft:n,textTop:r,lineTop:t}},_wrapSVGTextAndBg:function(e,t,n,r){e.push('<g transform="',this.getSvgTransform(),'">',t.textBgRects.join(""),"<text ",this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",this.textDecoration?'text-decoration="'+this.textDecoration+'" ':"",'style="',this.getSvgStyles(),'" ','transform="translate(',i(r.textLeft,2)," ",i(r.textTop,2),')">',n.join(""),t.textSpans.join(""),"</text>","</g>")},_getSVGShadows:function(e,n){var r=[],s,o,u=1;if(!this.shadow||!this._boundaries)return r;for(s=0,o=n.length;s<o;s++)if(n[s]!==""){var f=this._boundaries&&this._boundaries[s]?this._boundaries[s].left:0;r.push('<tspan x="',i(f+u+this.shadow.offsetX,2),s===0||this.useNative?'" y':'" dy','="',i(this.useNative?e*s-this.height/2+this.shadow.offsetY:e+(s===0?this.shadow.offsetY:0),2),'" ',this._getFillAttributes(this.shadow.color),">",t.util.string.escapeXml(n[s]),"</tspan>"),u=1}else u++;return r},_getSVGTextAndBg:function(e,t,n){var r=[],i=[],s=1;this._setSVGBg(i);for(var o=0,u=n.length;o<u;o++){n[o]!==""?(this._setSVGTextLineText(n[o],o,r,e,s,i),s=1):s++;if(!this.textBackgroundColor||!this._boundaries)continue;this._setSVGTextLineBg(i,o,t,e)}return{textSpans:r,textBgRects:i}},_setSVGTextLineText:function(e,n,r,s,o){var u=this._boundaries&&this._boundaries[n]?i(this._boundaries[n].left,2):0;r.push('<tspan x="',u,'" ',n===0||this.useNative?"y":"dy",'="',i(this.useNative?s*n-this.height/2:s*o,2),'" ',this._getFillAttributes(this.fill),">",t.util.string.escapeXml(e),"</tspan>")},_setSVGTextLineBg:function(e,t,n,r){e.push("<rect ",this._getFillAttributes(this.textBackgroundColor),' x="',i(n+this._boundaries[t].left,2),'" y="',i(r*t-this.height/2,2),'" width="',i(this._boundaries[t].width,2),'" height="',i(this._boundaries[t].height,2),'"></rect>')},_setSVGBg:function(e){this.backgroundColor&&this._boundaries&&e.push("<rect ",this._getFillAttributes(this.backgroundColor),' x="',i(-this.width/2,2),'" y="',i(-this.height/2,2),'" width="',i(this.width,2),'" height="',i(this.height,2),'"></rect>')},_getFillAttributes:function(e){var n=e&&typeof e=="string"?new t.Color(e):"";return!n||!n.getSource()||n.getAlpha()===1?'fill="'+e+'"':'opacity="'+n.getAlpha()+'" fill="'+n.setAlpha(1).toRgb()+'"'},_set:function(e,t){e==="fontFamily"&&this.path&&(this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,"$1"+t+"$3")),this.callSuper("_set",e,t),e in this._dimensionAffectingProps&&(this._initDimensions(),this.setCoords())},complexity:function(){return 1}}),t.Text.ATTRIBUTE_NAMES=t.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size text-decoration text-anchor".split(" ")),t.Text.DEFAULT_SVG_FONT_SIZE=16,t.Text.fromElement=function(e,n){if(!e)return null;var r=t.parseAttributes(e,t.Text.ATTRIBUTE_NAMES);n=t.util.object.extend(n?t.util.object.clone(n):{},r),"dx"in r&&(n.left+=r.dx),"dy"in r&&(n.top+=r.dy),"fontSize"in n||(n.fontSize=t.Text.DEFAULT_SVG_FONT_SIZE),n.originX||(n.originX="left");var i=new t.Text(e.textContent,n),s=0;return i.originX==="left"&&(s=i.getWidth()/2),i.originX==="right"&&(s=-i.getWidth()/2),i.set({left:i.getLeft()+s,top:i.getTop()-i.getHeight()/2}),i},t.Text.fromObject=function(e){return new t.Text(e.text,r(e))},t.util.createAccessors(t.Text)}(typeof exports!="undefined"?exports:this),function(){var e=fabric.util.object.clone;fabric.IText=fabric.util.createClass(fabric.Text,fabric.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"#333",cursorDelay:1e3,cursorDuration:600,styles:null,caching:!0,_skipFillStrokeCheck:!0,_reSpace:/\s|\n/,_fontSizeFraction:4,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,_charWidthsCache:{},initialize:function(e,t){this.styles=t?t.styles||{}:{},this.callSuper("initialize",e,t),this.initBehavior(),fabric.IText.instances.push(this),this.__lineWidths={},this.__lineHeights={},this.__lineOffsets={}},isEmptyStyles:function(){if(!this.styles)return!0;var e=this.styles;for(var t in e)for(var n in e[t])for(var r in e[t][n])return!1;return!0},setSelectionStart:function(e){this.selectionStart!==e&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})),this.selectionStart=e,this.hiddenTextarea&&(this.hiddenTextarea.selectionStart=e)},setSelectionEnd:function(e){this.selectionEnd!==e&&(this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})),this.selectionEnd=e,this.hiddenTextarea&&(this.hiddenTextarea.selectionEnd=e)},getSelectionStyles:function(e,t){if(arguments.length===2){var n=[];for(var r=e;r<t;r++)n.push(this.getSelectionStyles(r));return n}var i=this.get2DCursorLocation(e);return this.styles[i.lineIndex]?this.styles[i.lineIndex][i.charIndex]||{}:{}},setSelectionStyles:function(e){if(this.selectionStart===this.selectionEnd)this._extendStyles(this.selectionStart,e);else for(var t=this.selectionStart;t<this.selectionEnd;t++)this._extendStyles(t,e);return this},_extendStyles:function(e,t){var n=this.get2DCursorLocation(e);this.styles[n.lineIndex]||(this.styles[n.lineIndex]={}),this.styles[n.lineIndex][n.charIndex]||(this.styles[n.lineIndex][n.charIndex]={}),fabric.util.object.extend(this.styles[n.lineIndex][n.charIndex],t)},_render:function(e){this.callSuper("_render",e),this.ctx=e,this.isEditing&&this.renderCursorOrSelection()},renderCursorOrSelection:function(){if(!this.active)return;var e=this.text.split(""),t;this.selectionStart===this.selectionEnd?(t=this._getCursorBoundaries(e,"cursor"),this.renderCursor(t)):(t=this._getCursorBoundaries(e,"selection"),this.renderSelection(e,t))},get2DCursorLocation:function(e){typeof e=="undefined"&&(e=this.selectionStart);var t=this.text.slice(0,e),n=t.split(this._reNewline);return{lineIndex:n.length-1,charIndex:n[n.length-1].length}},getCurrentCharStyle:function(e,t){var n=this.styles[e]&&this.styles[e][t===0?0:t-1];return{fontSize:n&&n.fontSize||this.fontSize,fill:n&&n.fill||this.fill,textBackgroundColor:n&&n.textBackgroundColor||this.textBackgroundColor,textDecoration:n&&n.textDecoration||this.textDecoration,fontFamily:n&&n.fontFamily||this.fontFamily,fontWeight:n&&n.fontWeight||this.fontWeight,fontStyle:n&&n.fontStyle||this.fontStyle,stroke:n&&n.stroke||this.stroke,strokeWidth:n&&n.strokeWidth||this.strokeWidth}},getCurrentCharFontSize:function(e,t){return this.styles[e]&&this.styles[e][t===0?0:t-1]&&this.styles[e][t===0?0:t-1].fontSize||this.fontSize},getCurrentCharColor:function(e,t){return this.styles[e]&&this.styles[e][t===0?0:t-1]&&this.styles[e][t===0?0:t-1].fill||this.cursorColor},_getCursorBoundaries:function(e,t){var n=this.get2DCursorLocation(),r=this.text.split(this._reNewline),i=Math.round(this._getLeftOffset()),s=-this.height/2,o=this._getCursorBoundariesOffsets(e,t,n,r);return{left:i,top:s,leftOffset:o.left+o.lineLeft,topOffset:o.top}},_getCursorBoundariesOffsets:function(e,t,n,r){var i=0,s=0,o=0,u=0,a=t==="cursor"?this._getHeightOfLine(this.ctx,0)-this.getCurrentCharFontSize(n.lineIndex,n.charIndex):0;for(var f=0;f<this.selectionStart;f++){if(e[f]==="\n"){u=0;var l=s+(t==="cursor"?1:0);a+=this._getCachedLineHeight(l),s++,o=0}else u+=this._getWidthOfChar(this.ctx,e[f],s,o),o++;i=this._getCachedLineOffset(s,r)}return this._clearCache(),{top:a,left:u,lineLeft:i}},_clearCache:function(){this.__lineWidths={},this.__lineHeights={},this.__lineOffsets={}},_getCachedLineHeight:function(e){return this.__lineHeights[e]||(this.__lineHeights[e]=this._getHeightOfLine(this.ctx,e))},_getCachedLineWidth:function(e,t){return this.__lineWidths[e]||(this.__lineWidths[e]=this._getWidthOfLine(this.ctx,e,t))},_getCachedLineOffset:function(e,t){var n=this._getCachedLineWidth(e,t);return this.__lineOffsets[e]||(this.__lineOffsets[e]=this._getLineLeftOffset(n))},renderCursor:function(e){var t=this.ctx;t.save();var n=this.get2DCursorLocation(),r=n.lineIndex,i=n.charIndex,s=this.getCurrentCharFontSize(r,i),o=r===0&&i===0?this._getCachedLineOffset(r,this.text.split(this._reNewline)):e.leftOffset;t.fillStyle=this.getCurrentCharColor(r,i),t.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,t.fillRect(e.left+o,e.top+e.topOffset,this.cursorWidth/this.scaleX,s),t.restore()},renderSelection:function(e,t){var n=this.ctx;n.save(),n.fillStyle=this.selectionColor;var r=this.get2DCursorLocation(this.selectionStart),i=this.get2DCursorLocation(this.selectionEnd),s=r.lineIndex,o=i.lineIndex,u=this.text.split(this._reNewline);for(var a=s;a<=o;a++){var f=this._getCachedLineOffset(a,u)||0,l=this._getCachedLineHeight(a),c=0;if(a===s)for(var h=0,p=u[a].length;h<p;h++)h>=r.charIndex&&(a!==o||h<i.charIndex)&&(c+=this._getWidthOfChar(n,u[a][h],a,h)),h<r.charIndex&&(f+=this._getWidthOfChar(n,u[a][h],a,h));else if(a>s&&a<o)c+=this._getCachedLineWidth(a,u)||5;else if(a===o)for(var d=0,v=i.charIndex;d<v;d++)c+=this._getWidthOfChar(n,u[a][d],a,d);n.fillRect(t.left+f,t.top+t.topOffset,c,l),t.topOffset+=l}n.restore()},_renderChars:function(e,t,n,r,i,s){if(this.isEmptyStyles())return this._renderCharsFast(e,t,n,r,i);this.skipTextAlign=!0,r-=this.textAlign==="center"?this.width/2:this.textAlign==="right"?this.width:0;var o=this.text.split(this._reNewline),u=this._getWidthOfLine(t,s,o),a=this._getHeightOfLine(t,s,o),f=this._getLineLeftOffset(u),l=n.split(""),c,h="";r+=f||0,t.save();for(var p=0,d=l.length;p<=d;p++){c=c||this.getCurrentCharStyle(s,p);var v=this.getCurrentCharStyle(s,p+1);if(this._hasStyleChanged(c,v)||p===d)this._renderChar(e,t,s,p-1,h,r,i,a),h="",c=v;h+=l[p]}t.restore()},_renderCharsFast:function(e,t,n,r,i){this.skipTextAlign=!1,e==="fillText"&&this.fill&&this.callSuper("_renderChars",e,t,n,r,i),e==="strokeText"&&this.stroke&&this.callSuper("_renderChars",e,t,n,r,i)},_renderChar:function(e,t,n,r,i,s,o,u){var a,f,l;if(this.styles&&this.styles[n]&&(a=this.styles[n][r])){var c=a.stroke||this.stroke,h=a.fill||this.fill;t.save(),f=this._applyCharStylesGetWidth(t,i,n,r,a),l=this._getHeightOfChar(t,i,n,r),h&&t.fillText(i,s,o),c&&t.strokeText(i,s,o),this._renderCharDecoration(t,a,s,o,f,u,l),t.restore(),t.translate(f,0)}else e==="strokeText"&&this.stroke&&t[e](i,s,o),e==="fillText"&&this.fill&&t[e](i,s,o),f=this._applyCharStylesGetWidth(t,i,n,r),this._renderCharDecoration(t,null,s,o,f,u),t.translate(t.measureText(i).width,0)},_hasStyleChanged:function(e,t){return e.fill!==t.fill||e.fontSize!==t.fontSize||e.textBackgroundColor!==t.textBackgroundColor||e.textDecoration!==t.textDecoration||e.fontFamily!==t.fontFamily||e.fontWeight!==t.fontWeight||e.fontStyle!==t.fontStyle||e.stroke!==t.stroke||e.strokeWidth!==t.strokeWidth},_renderCharDecoration:function(e,t,n,r,i,s,o){var u=t?t.textDecoration||this.textDecoration:this.textDecoration,a=(t?t.fontSize:null)||this.fontSize;if(!u)return;u.indexOf("underline")>-1&&this._renderCharDecorationAtOffset(e,n,r+this.fontSize/this._fontSizeFraction,i,0,this.fontSize/20),u.indexOf("line-through")>-1&&this._renderCharDecorationAtOffset(e,n,r+this.fontSize/this._fontSizeFraction,i,o/2,a/20),u.indexOf("overline")>-1&&this._renderCharDecorationAtOffset(e,n,r,i,s-this.fontSize/this._fontSizeFraction,this.fontSize/20)},_renderCharDecorationAtOffset:function(e,t,n,r,i,s){e.fillRect(t,n-i,r,s)},_renderTextLine:function(e,t,n,r,i,s){i+=this.fontSize/4,this.callSuper("_renderTextLine",e,t,n,r,i,s)},_renderTextDecoration:function(e,t){if(this.isEmptyStyles())return this.callSuper("_renderTextDecoration",e,t)},_renderTextLinesBackground:function(e,t){if(!this.textBackgroundColor&&!this.styles)return;e.save(),this.textBackgroundColor&&(e.fillStyle=this.textBackgroundColor);var n=0,r=this.fontSize/this._fontSizeFraction;for(var i=0,s=t.length;i<s;i++){var o=this._getHeightOfLine(e,i,t);if(t[i]===""){n+=o;continue}var u=this._getWidthOfLine(e,i,t),a=this._getLineLeftOffset(u);this.textBackgroundColor&&(e.fillStyle=this.textBackgroundColor,e.fillRect(this._getLeftOffset()+a,this._getTopOffset()+n+r,u,o));if(this.styles[i])for(var f=0,l=t[i].length;f<l;f++)if(this.styles[i]&&this.styles[i][f]&&this.styles[i][f].textBackgroundColor){var c=t[i][f];e.fillStyle=this.styles[i][f].textBackgroundColor,e.fillRect(this._getLeftOffset()+a+this._getWidthOfCharsAt(e,i,f,t),this._getTopOffset()+n+r,this._getWidthOfChar(e,c,i,f,t)+1,o)}n+=o}e.restore()},_getCacheProp:function(e,t){return e+t.fontFamily+t.fontSize+t.fontWeight+t.fontStyle+t.shadow},_applyCharStylesGetWidth:function(t,n,r,i,s){var o=s||this.styles[r]&&this.styles[r][i];o?o=e(o):o={},this._applyFontStyles(o);var u=this._getCacheProp(n,o);if(this.isEmptyStyles()&&this._charWidthsCache[u]&&this.caching)return this._charWidthsCache[u];typeof o.shadow=="string"&&(o.shadow=new fabric.Shadow(o.shadow));var f=o.fill||this.fill;return t.fillStyle=f.toLive?f.toLive(t):f,o.stroke&&(t.strokeStyle=o.stroke&&o.stroke.toLive?o.stroke.toLive(t):o.stroke),t.lineWidth=o.strokeWidth||this.strokeWidth,t.font=this._getFontDeclaration.call(o),this._setShadow.call(o,t),this.caching?(this._charWidthsCache[u]||(this._charWidthsCache[u]=t.measureText(n).width),this._charWidthsCache[u]):t.measureText(n).width},_applyFontStyles:function(e){e.fontFamily||(e.fontFamily=this.fontFamily),e.fontSize||(e.fontSize=this.fontSize),e.fontWeight||(e.fontWeight=this.fontWeight),e.fontStyle||(e.fontStyle=this.fontStyle)},_getStyleDeclaration:function(t,n){return this.styles[t]&&this.styles[t][n]?e(this.styles[t][n]):{}},_getWidthOfChar:function(e,t,n,r){var i=this._getStyleDeclaration(n,r);this._applyFontStyles(i);var s=this._getCacheProp(t,i);if(this._charWidthsCache[s]&&this.caching)return this._charWidthsCache[s];if(e){e.save();var o=this._applyCharStylesGetWidth(e,t,n,r);return e.restore(),o}},_getHeightOfChar:function(e,t,n,r){return this.styles[n]&&this.styles[n][r]?this.styles[n][r].fontSize||this.fontSize:this.fontSize},_getWidthOfCharAt:function(e,t,n,r){r=r||this.text.split(this._reNewline);var i=r[t].split("")[n];return this._getWidthOfChar(e,i,t,n)},_getHeightOfCharAt:function(e,t,n,r){r=r||this.text.split(this._reNewline);var i=r[t].split("")[n];return this._getHeightOfChar(e,i,t,n)},_getWidthOfCharsAt:function(e,t,n,r){var i=0;for(var s=0;s<n;s++)i+=this._getWidthOfCharAt(e,t,s,r);return i},_getWidthOfLine:function(e,t,n){return this._getWidthOfCharsAt(e,t,n[t].length,n)},_getTextWidth:function(e,t){if(this.isEmptyStyles())return this.callSuper("_getTextWidth",e,t);var n=this._getWidthOfLine(e,0,t);for(var r=1,i=t.length;r<i;r++){var s=this._getWidthOfLine(e,r,t);s>n&&(n=s)}return n},_getHeightOfLine:function(e,t,n){n=n||this.text.split(this._reNewline);var r=this._getHeightOfChar(e,n[t][0],t,0),i=n[t],s=i.split("");for(var o=1,u=s.length;o<u;o++){var a=this._getHeightOfChar(e,s[o],t,o);a>r&&(r=a)}return r*this.lineHeight},_getTextHeight:function(e,t){var n=0;for(var r=0,i=t.length;r<i;r++)n+=this._getHeightOfLine(e,r,t);return n},_getTopOffset:function(){var e=fabric.Text.prototype._getTopOffset.call(this);return e-this.fontSize/this._fontSizeFraction},_renderTextBoxBackground:function(e){if(!this.backgroundColor)return;e.save(),e.fillStyle=this.backgroundColor,e.fillRect(this._getLeftOffset(),this._getTopOffset()+this.fontSize/this._fontSizeFraction,this.width,this.height),e.restore()},toObject:function(t){return fabric.util.object.extend(this.callSuper("toObject",t),{styles:e(this.styles)})}}),fabric.IText.fromObject=function(t){return new fabric.IText(t.text,e(t))},fabric.IText.instances=[]}(),function(){var e=fabric.util.object.clone;fabric.util.object.extend(fabric.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation()},initSelectedHandler:function(){this.on("selected",function(){var e=this;setTimeout(function(){e.selected=!0},100)})},initAddedHandler:function(){this.on("added",function(){this.canvas&&!this.canvas._hasITextHandlers&&(this.canvas._hasITextHandlers=!0,this._initCanvasHandlers())})},_initCanvasHandlers:function(){this.canvas.on("selection:cleared",function(){fabric.IText.prototype.exitEditingOnOthers.call()}),this.canvas.on("mouse:up",function(){fabric.IText.instances.forEach(function(e){e.__isMousedown=!1})}),this.canvas.on("object:selected",function(e){fabric.IText.prototype.exitEditingOnOthers.call(e.target)})},_tick:function(){var e=this;if(this._abortCursorAnimation)return;this.animate("_currentCursorOpacity",1,{duration:this.cursorDuration,onComplete:function(){e._onTickComplete()},onChange:function(){e.canvas&&e.canvas.renderAll()},abort:function(){return e._abortCursorAnimation}})},_onTickComplete:function(){if(this._abortCursorAnimation)return;var e=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){e.animate("_currentCursorOpacity",0,{duration:this.cursorDuration/2,onComplete:function(){e._tick()},onChange:function(){e.canvas&&e.canvas.renderAll()},abort:function(){return e._abortCursorAnimation}})},100)},initDelayedCursor:function(e){var t=this,n=e?0:this.cursorDelay;e&&(this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),this._currentCursorOpacity=1,this.canvas&&this.canvas.renderAll()),this._cursorTimeout2&&clearTimeout(this._cursorTimeout2),this._cursorTimeout2=setTimeout(function(){t._abortCursorAnimation=!1,t._tick()},n)},abortCursorAnimation:function(){this._abortCursorAnimation=!0,clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,this.canvas&&this.canvas.renderAll();var e=this;setTimeout(function(){e._abortCursorAnimation=!1},10)},selectAll:function(){this.selectionStart=0,this.selectionEnd=this.text.length,this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},getSelectedText:function(){return this.text.slice(this.selectionStart,this.selectionEnd)},findWordBoundaryLeft:function(e){var t=0,n=e-1;if(this._reSpace.test(this.text.charAt(n)))while(this._reSpace.test(this.text.charAt(n)))t++,n--;while(/\S/.test(this.text.charAt(n))&&n>-1)t++,n--;return e-t},findWordBoundaryRight:function(e){var t=0,n=e;if(this._reSpace.test(this.text.charAt(n)))while(this._reSpace.test(this.text.charAt(n)))t++,n++;while(/\S/.test(this.text.charAt(n))&&n<this.text.length)t++,n++;return e+t},findLineBoundaryLeft:function(e){var t=0,n=e-1;while(!/\n/.test(this.text.charAt(n))&&n>-1)t++,n--;return e-t},findLineBoundaryRight:function(e){var t=0,n=e;while(!/\n/.test(this.text.charAt(n))&&n<this.text.length)t++,n++;return e+t},getNumNewLinesInSelectedText:function(){var e=this.getSelectedText(),t=0;for(var n=0,r=e.split(""),i=r.length;n<i;n++)r[n]==="\n"&&t++;return t},searchWordBoundary:function(e,t){var n=this._reSpace.test(this.text.charAt(e))?e-1:e,r=this.text.charAt(n),i=/[ \n\.,;!\?\-]/;while(!i.test(r)&&n>0&&n<this.text.length)n+=t,r=this.text.charAt(n);return i.test(r)&&r!=="\n"&&(n+=t===1?0:1),n},selectWord:function(e){var t=this.searchWordBoundary(e,-1),n=this.searchWordBoundary(e,1);this.setSelectionStart(t),this.setSelectionEnd(n),this.initDelayedCursor(!0)},selectLine:function(e){var t=this.findLineBoundaryLeft(e),n=this.findLineBoundaryRight(e);this.setSelectionStart(t),this.setSelectionEnd(n),this.initDelayedCursor(!0)},enterEditing:function(){if(this.isEditing||!this.editable)return;return this.exitEditingOnOthers(),this.isEditing=!0,this.initHiddenTextarea(),this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._tick(),this.canvas&&this.canvas.renderAll(),this.fire("editing:entered"),this.canvas&&this.canvas.fire("text:editing:entered",{target:this}),this},exitEditingOnOthers:function(){fabric.IText.instances.forEach(function(e){e.selected=!1,e.isEditing&&e.exitEditing()},this)},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},_updateTextarea:function(){if(!this.hiddenTextarea)return;this.hiddenTextarea.value=this.text,this.hiddenTextarea.selectionStart=this.selectionStart},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){if(!this._savedProps)return;this.hoverCursor=this._savedProps.overCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor)},exitEditing:function(){return this.selected=!1,this.isEditing=!1,this.selectable=!0,this.selectionEnd=this.selectionStart,this.hiddenTextarea&&this.canvas&&this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this.fire("editing:exited"),this.canvas&&this.canvas.fire("text:editing:exited",{target:this}),this},_removeExtraneousStyles:function(){var e=this.text.split(this._reNewline);for(var t in this.styles)e[t]||delete this.styles[t]},_removeCharsFromTo:function(e,t){var n=t;while(n!==e){var r=this.get2DCursorLocation(n).charIndex;n--;var i=this.get2DCursorLocation(n).charIndex,s=i>r;s?this.removeStyleObject(s,n+1):this.removeStyleObject(this.get2DCursorLocation(n).charIndex===0,n)}this.text=this.text.slice(0,e)+this.text.slice(t)},insertChars:function(e){var t=this.text.slice(this.selectionStart,this.selectionStart+1)==="\n";this.text=this.text.slice(0,this.selectionStart)+e+this.text.slice(this.selectionEnd),this.selectionStart===this.selectionEnd&&this.insertStyleObjects(e,t,this.copiedStyles),this.selectionStart+=e.length,this.selectionEnd=this.selectionStart,this.canvas&&this.canvas.renderAll().renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},insertNewlineStyleObject:function(t,n,r){this.shiftLineStyles(t,1),this.styles[t+1]||(this.styles[t+1]={});var i=this.styles[t][n-1],s={};if(r)s[0]=e(i),this.styles[t+1]=s;else{for(var o in this.styles[t])parseInt(o,10)>=n&&(s[parseInt(o,10)-n]=this.styles[t][o],delete this.styles[t][o]);this.styles[t+1]=s}},insertCharStyleObject:function(t,n,r){var i=this.styles[t],s=e(i);n===0&&!r&&(n=1);for(var o in s){var u=parseInt(o,10);u>=n&&(i[u+1]=s[u])}this.styles[t][n]=r||e(i[n-1])},insertStyleObjects:function(e,t,n){if(this.isEmptyStyles())return;var r=this.get2DCursorLocation(),i=r.lineIndex,s=r.charIndex;this.styles[i]||(this.styles[i]={}),e==="\n"?this.insertNewlineStyleObject(i,s,t):n?this._insertStyles(n):this.insertCharStyleObject(i,s)},_insertStyles:function(e){for(var t=0,n=e.length;t<n;t++){var r=this.get2DCursorLocation(this.selectionStart+t),i=r.lineIndex,s=r.charIndex;this.insertCharStyleObject(i,s,e[t])}},shiftLineStyles:function(t,n){var r=e(this.styles);for(var i in this.styles){var s=parseInt(i,10);s>t&&(this.styles[s+n]=r[s])}},removeStyleObject:function(t,n){var r=this.get2DCursorLocation(n),i=r.lineIndex,s=r.charIndex;if(t){var o=this.text.split(this._reNewline),u=o[i-1],f=u?u.length:0;this.styles[i-1]||(this.styles[i-1]={});for(s in this.styles[i])this.styles[i-1][parseInt(s,10)+f]=this.styles[i][s];this.shiftLineStyles(i,-1)}else{var l=this.styles[i];if(l){var c=this.selectionStart===this.selectionEnd?-1:0;delete l[s+c]}var h=e(l);for(var p in h){var d=parseInt(p,10);d>=s&&d!==0&&(l[d-1]=h[d],delete l[d])}}},insertNewline:function(){this.insertChars("\n")}})}(),fabric.util.object.extend(fabric.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+(new Date),this.__lastLastClickTime=+(new Date),this.__lastPointer={},this.on("mousedown",this.onMouseDown.bind(this))},onMouseDown:function(e){this.__newClickTime=+(new Date);var t=this.canvas.getPointer(e.e);this.isTripleClick(t)?(this.fire("tripleclick",e),this._stopEvent(e.e)):this.isDoubleClick(t)&&(this.fire("dblclick",e),this._stopEvent(e.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=t,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected},isDoubleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y&&this.__lastIsEditing},isTripleClick:function(e){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===e.x&&this.__lastPointer.y===e.y},_stopEvent:function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},initCursorSelectionHandlers:function(){this.initSelectedHandler(),this.initMousedownHandler(),this.initMousemoveHandler(),this.initMouseupHandler(),this.initClicks()},initClicks:function(){this.on("dblclick",function(e){this.selectWord(this.getSelectionStartFromPointer(e.e))}),this.on("tripleclick",function(e){this.selectLine(this.getSelectionStartFromPointer(e.e))})},initMousedownHandler:function(){this.on("mousedown",function(e){var t=this.canvas.getPointer(e.e);this.__mousedownX=t.x,this.__mousedownY=t.y,this.__isMousedown=!0,this.hiddenTextarea&&this.canvas&&this.canvas.wrapperEl.appendChild(this.hiddenTextarea),this.selected&&this.setCursorByClick(e.e),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.initDelayedCursor(!0))})},initMousemoveHandler:function(){this.on("mousemove",function(e){if(!this.__isMousedown||!this.isEditing)return;var t=this.getSelectionStartFromPointer(e.e);t>=this.__selectionStartOnMouseDown?(this.setSelectionStart(this.__selectionStartOnMouseDown),this.setSelectionEnd(t)):(this.setSelectionStart(t),this.setSelectionEnd(this.__selectionStartOnMouseDown))})},_isObjectMoved:function(e){var t=this.canvas.getPointer(e);return this.__mousedownX!==t.x||this.__mousedownY!==t.y},initMouseupHandler:function(){this.on("mouseup",function(e){this.__isMousedown=!1;if(this._isObjectMoved(e.e))return;this.__lastSelected&&(this.enterEditing(),this.initDelayedCursor(!0)),this.selected=!0})},setCursorByClick:function(e){var t=this.getSelectionStartFromPointer(e);e.shiftKey?t<this.selectionStart?(this.setSelectionEnd(this.selectionStart),this.setSelectionStart(t)):this.setSelectionEnd(t):(this.setSelectionStart(t),this.setSelectionEnd(t))},_getLocalRotatedPointer:function(e){var t=this.canvas.getPointer(e),n=new fabric.Point(t.x,t.y),r=new fabric.Point(this.left,this.top),i=fabric.util.rotatePoint(n,r,fabric.util.degreesToRadians(-this.angle));return this.getLocalPointer(e,i)},getSelectionStartFromPointer:function(e){var t=this._getLocalRotatedPointer(e),n=this.text.split(this._reNewline),r=0,i=0,s=0,o=0,u;for(var a=0,f=n.length;a<f;a++){s+=this._getHeightOfLine(this.ctx,a)*this.scaleY;var l=this._getWidthOfLine(this.ctx,a,n),c=this._getLineLeftOffset(l);i=c*this.scaleX,this.flipX&&(n[a]=n[a].split("").reverse().join(""));for(var h=0,p=n[a].length;h<p;h++){var d=n[a][h];r=i,i+=this._getWidthOfChar(this.ctx,d,a,this.flipX?p-h:h)*this.scaleX;if(s<=t.y||i<=t.x){o++;continue}return this._getNewSelectionStartFromOffset(t,r,i,o+a,p)}if(t.y<s)return this._getNewSelectionStartFromOffset(t,r,i,o+a,p,h)}if(typeof u=="undefined")return this.text.length},_getNewSelectionStartFromOffset:function(e,t,n,r,i,s){var o=e.x-t,u=n-e.x,a=u>o?0:1,f=r+a;return this.flipX&&(f=i-f),f>this.text.length&&(f=this.text.length),s===i&&f--,f}}),fabric.util.object.extend(fabric.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=fabric.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.style.cssText="position: absolute; top: 0; left: -9999px",fabric.document.body.appendChild(this.hiddenTextarea),fabric.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),fabric.util.addListener(this.hiddenTextarea,"keypress",this.onKeyPress.bind(this)),fabric.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),fabric.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(fabric.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},_keysMap:{8:"removeChars",13:"insertNewline",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown",46:"forwardDelete"},_ctrlKeysMap:{65:"selectAll",88:"cut"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(e){if(!this.isEditing)return;if(e.keyCode in this._keysMap)this[this._keysMap[e.keyCode]](e);else{if(!(e.keyCode in this._ctrlKeysMap&&(e.ctrlKey||e.metaKey)))return;this[this._ctrlKeysMap[e.keyCode]](e)}e.stopPropagation(),this.canvas&&this.canvas.renderAll()},forwardDelete:function(e){this.selectionStart===this.selectionEnd&&this.moveCursorRight(e),this.removeChars(e)},copy:function(e){var t=this.getSelectedText(),n=this._getClipboardData(e);n&&n.setData("text",t),this.copiedText=t,this.copiedStyles=this.getSelectionStyles(this.selectionStart,this.selectionEnd)},paste:function(e){var t=null,n=this._getClipboardData(e);n?t=n.getData("text"):t=this.copiedText,t&&this.insertChars(t)},cut:function(e){if(this.selectionStart===this.selectionEnd)return;this.copy(),this.removeChars(e)},_getClipboardData:function(e){return e&&(e.clipboardData||fabric.window.clipboardData)},onKeyPress:function(e){if(!this.isEditing||e.metaKey||e.ctrlKey||e.keyCode===8||e.keyCode===13)return;this.insertChars(String.fromCharCode(e.which)),e.stopPropagation()},getDownCursorOffset:function(e,t){var n=t?this.selectionEnd:this.selectionStart,r=this.text.split(this._reNewline),i,s,o=this.text.slice(0,n),u=this.text.slice(n),a=o.slice(o.lastIndexOf("\n")+1),f=u.match(/(.*)\n?/)[1],l=(u.match(/.*\n(.*)\n?/)||{})[1]||"",c=this.get2DCursorLocation(n);if(c.lineIndex===r.length-1||e.metaKey)return this.text.length-n;var h=this._getWidthOfLine(this.ctx,c.lineIndex,r);s=this._getLineLeftOffset(h);var p=s,d=c.lineIndex;for(var v=0,m=a.length;v<m;v++)i=a[v],p+=this._getWidthOfChar(this.ctx,i,d,v);var g=this._getIndexOnNextLine(c,l,p,r);return f.length+1+g},_getIndexOnNextLine:function(e,t,n,r){var i=e.lineIndex+1,s=this._getWidthOfLine(this.ctx,i,r),o=this._getLineLeftOffset(s),u=o,a=0,f;for(var l=0,c=t.length;l<c;l++){var h=t[l],p=this._getWidthOfChar(this.ctx,h,i,l);u+=p;if(u>n){f=!0;var d=u-p,v=u,m=Math.abs(d-n),g=Math.abs(v-n);a=g<m?l+1:l;break}}return f||(a=t.length),a},moveCursorDown:function(e){this.abortCursorAnimation(),this._currentCursorOpacity=1;var t=this.getDownCursorOffset(e,this._selectionDirection==="right");e.shiftKey?this.moveCursorDownWithShift(t):this.moveCursorDownWithoutShift(t),this.initDelayedCursor()},moveCursorDownWithoutShift:function(e){this._selectionDirection="right",this.selectionStart+=e,this.selectionStart>this.text.length&&(this.selectionStart=this.text.length),this.selectionEnd=this.selectionStart},moveCursorDownWithShift:function(e){if(this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd){this.selectionStart+=e,this._selectionDirection="left";return}this._selectionDirection="right",this.selectionEnd+=e,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length)},getUpCursorOffset:function(e,t){var n=t?this.selectionEnd:this.selectionStart,r=this.get2DCursorLocation(n);if(r.lineIndex===0||e.metaKey)return n;var i=this.text.slice(0,n),s=i.slice(i.lastIndexOf("\n")+1),o=(i.match(/\n?(.*)\n.*$/)||{})[1]||"",u=this.text.split(this._reNewline),a,f=this._getWidthOfLine(this.ctx,r.lineIndex,u),l=this._getLineLeftOffset(f),c=l,h=r.lineIndex;for(var p=0,d=s.length;p<d;p++)a=s[p],c+=this._getWidthOfChar(this.ctx,a,h,p);var v=this._getIndexOnPrevLine(r,o,c,u);return o.length-v+s.length},_getIndexOnPrevLine:function(e,t,n,r){var i=e.lineIndex-1,s=this._getWidthOfLine(this.ctx,i,r),o=this._getLineLeftOffset(s),u=o,a=0,f;for(var l=0,c=t.length;l<c;l++){var h=t[l],p=this._getWidthOfChar(this.ctx,h,i,l);u+=p;if(u>n){f=!0;var d=u-p,v=u,m=Math.abs(d-n),g=Math.abs(v-n);a=g<m?l:l-1;break}}return f||(a=t.length-1),a},moveCursorUp:function(e){this.abortCursorAnimation(),this._currentCursorOpacity=1;var t=this.getUpCursorOffset(e,this._selectionDirection==="right");e.shiftKey?this.moveCursorUpWithShift(t):this.moveCursorUpWithoutShift(t),this.initDelayedCursor()},moveCursorUpWithShift:function(e){if(this.selectionStart===this.selectionEnd)this.selectionStart-=e;else{if(this._selectionDirection==="right"){this.selectionEnd-=e,this._selectionDirection="right";return}this.selectionStart-=e}this.selectionStart<0&&(this.selectionStart=0),this._selectionDirection="left"},moveCursorUpWithoutShift:function(e){this.selectionStart===this.selectionEnd&&(this.selectionStart-=e),this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd=this.selectionStart,this._selectionDirection="left"},moveCursorLeft:function(e){if(this.selectionStart===0&&this.selectionEnd===0)return;this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorLeftWithShift(e):this.moveCursorLeftWithoutShift(e),this.initDelayedCursor()},_move:function(e,t,n){e.altKey?this[t]=this["findWordBoundary"+n](this[t]):e.metaKey?this[t]=this["findLineBoundary"+n](this[t]):this[t]+=n==="Left"?-1:1},_moveLeft:function(e,t){this._move(e,t,"Left")},_moveRight:function(e,t){this._move(e,t,"Right")},moveCursorLeftWithoutShift:function(e){this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this._moveLeft(e,"selectionStart"),this.selectionEnd=this.selectionStart},moveCursorLeftWithShift:function(e){this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(e,"selectionEnd"):(this._selectionDirection="left",this._moveLeft(e,"selectionStart"),this.text.charAt(this.selectionStart)==="\n"&&this.selectionStart--,this.selectionStart<0&&(this.selectionStart=0))},moveCursorRight:function(e){if(this.selectionStart>=this.text.length&&this.selectionEnd>=this.text.length)return;this.abortCursorAnimation(),this._currentCursorOpacity=1,e.shiftKey?this.moveCursorRightWithShift(e):this.moveCursorRightWithoutShift(e),this.initDelayedCursor()},moveCursorRightWithShift:function(e){this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(e,"selectionStart"):(this._selectionDirection="right",this._moveRight(e,"selectionEnd"),this.text.charAt(this.selectionEnd-1)==="\n"&&this.selectionEnd++,this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length))},moveCursorRightWithoutShift:function(e){this._selectionDirection="right",this.selectionStart===this.selectionEnd?(this._moveRight(e,"selectionStart"),this.selectionEnd=this.selectionStart):(this.selectionEnd+=this.getNumNewLinesInSelectedText(),this.selectionEnd>this.text.length&&(this.selectionEnd=this.text.length),this.selectionStart=this.selectionEnd)},removeChars:function(e){this.selectionStart===this.selectionEnd?this._removeCharsNearCursor(e):this._removeCharsFromTo(this.selectionStart,this.selectionEnd),this.selectionEnd=this.selectionStart,this._removeExtraneousStyles(),this.canvas&&this.canvas.renderAll().renderAll(),this.setCoords(),this.fire("changed"),this.canvas&&this.canvas.fire("text:changed",{target:this})},_removeCharsNearCursor:function(e){if(this.selectionStart!==0)if(e.metaKey){var t=this.findLineBoundaryLeft(this.selectionStart);this._removeCharsFromTo(t,this.selectionStart),this.selectionStart=t}else if(e.altKey){var n=this.findWordBoundaryLeft(this.selectionStart);this._removeCharsFromTo(n,this.selectionStart),this.selectionStart=n}else{var r=this.text.slice(this.selectionStart-1,this.selectionStart)==="\n";this.removeStyleObject(r),this.selectionStart--,this.text=this.text.slice(0,this.selectionStart)+this.text.slice(this.selectionStart+1)}}}),fabric.util.object.extend(fabric.IText.prototype,{_setSVGTextLineText:function(e,t,n,r,i,s){this.styles[t]?this._setSVGTextLineChars(e,t,n,r,i,s):this.callSuper("_setSVGTextLineText",e,t,n,r,i)},_setSVGTextLineChars:function(e,t,n,r,i,s){var o=t===0||this.useNative?"y":"dy",u=e.split(""),a=0,f=this._getSVGLineLeftOffset(t),l=this._getSVGLineTopOffset(t),c=this._getHeightOfLine(this.ctx,t);for(var h=0,p=u.length;h<p;h++){var d=this.styles[t][h]||{};n.push(this._createTextCharSpan(u[h],d,f,l,o,a));var v=this._getWidthOfChar(this.ctx,u[h],t,h);d.textBackgroundColor&&s.push(this._createTextCharBg(d,f,l,c,v,a)),a+=v}},_getSVGLineLeftOffset:function(e){return this._boundaries&&this._boundaries[e]?fabric.util.toFixed(this._boundaries[e].left,2):0},_getSVGLineTopOffset:function(e){var t=0;for(var n=0;n<=e;n++)t+=this._getHeightOfLine(this.ctx,n);return t-this.height/2},_createTextCharBg:function(e,t,n,r,i,s){return['<rect fill="',e.textBackgroundColor,'" transform="translate(',-this.width/2," ",-this.height+r,")",'" x="',t+s,'" y="',n+r,'" width="',i,'" height="',r,'"></rect>'].join("")},_createTextCharSpan:function(e,t,n,r,i,s){var o=this.getSvgStyles.call(fabric.util.object.extend({visible:!0,fill:this.fill,stroke:this.stroke,type:"text"},t));return['<tspan x="',n+s,'" ',i,'="',r,'" ',t.fontFamily?'font-family="'+t.fontFamily.replace(/"/g,"'")+'" ':"",t.fontSize?'font-size="'+t.fontSize+'" ':"",t.fontStyle?'font-style="'+t.fontStyle+'" ':"",t.fontWeight?'font-weight="'+t.fontWeight+'" ':"",t.textDecoration?'text-decoration="'+t.textDecoration+'" ':"",'style="',o,'">',fabric.util.string.escapeXml(e),"</tspan>"].join("")}}),function(){function request(e,t,n){var r=URL.parse(e);r.port||(r.port=r.protocol.indexOf("https:")===0?443:80);var i=r.port===443?HTTPS:HTTP,s=i.request({hostname:r.hostname,port:r.port,path:r.path,method:"GET"},function(e){var r="";t&&e.setEncoding(t),e.on("end",function(){n(r)}),e.on("data",function(t){e.statusCode===200&&(r+=t)})});s.on("error",function(e){e.errno===process.ECONNREFUSED?fabric.log("ECONNREFUSED: connection refused to "+r.hostname+":"+r.port):fabric.log(e.message)}),s.end()}function requestFs(e,t){var n=require("fs");n.readFile(e,function(e,n){if(e)throw fabric.log(e),e;t(n)})}if(typeof document!="undefined"&&typeof window!="undefined")return;var DOMParser=require("xmldom").DOMParser,URL=require("url"),HTTP=require("http"),HTTPS=require("https"),Canvas=require("canvas"),Image=require("canvas").Image;fabric.util.loadImage=function(e,t,n){function r(r){i.src=new Buffer(r,"binary"),i._src=e,t&&t.call(n,i)}var i=new Image;e&&(e instanceof Buffer||e.indexOf("data")===0)?(i.src=i._src=e,t&&t.call(n,i)):e&&e.indexOf("http")!==0?requestFs(e,r):e?request(e,"binary",r):t&&t.call(n,e)},fabric.loadSVGFromURL=function(e,t,n){e=e.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim(),e.indexOf("http")!==0?requestFs(e,function(e){fabric.loadSVGFromString(e.toString(),t,n)}):request(e,"",function(e){fabric.loadSVGFromString(e,t,n)})},fabric.loadSVGFromString=function(e,t,n){var r=(new DOMParser).parseFromString(e);fabric.parseSVGDocument(r.documentElement,function(e,n){t&&t(e,n)},n)},fabric.util.getScript=function(url,callback){request(url,"",function(body){eval(body),callback&&callback()})},fabric.Image.fromObject=function(e,t){fabric.util.loadImage(e.src,function(n){var r=new fabric.Image(n);r._initConfig(e),r._initFilters(e,function(e){r.filters=e||[],t&&t(r)})})},fabric.createCanvasForNode=function(e,t,n,r){r=r||n;var i=fabric.document.createElement("canvas"),s=new Canvas(e||600,t||600,r);i.style={},i.width=s.width,i.height=s.height;var o=fabric.Canvas||fabric.StaticCanvas,u=new o(i,n);return u.contextContainer=s.getContext("2d"),u.nodeCanvas=s,u.Font=Canvas.Font,u},fabric.StaticCanvas.prototype.createPNGStream=function(){return this.nodeCanvas.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(e){return this.nodeCanvas.createJPEGStream(e)};var origSetWidth=fabric.StaticCanvas.prototype.setWidth;fabric.StaticCanvas.prototype.setWidth=function(e){return origSetWidth.call(this,e),this.nodeCanvas.width=e,this},fabric.Canvas&&(fabric.Canvas.prototype.setWidth=fabric.StaticCanvas.prototype.setWidth);var origSetHeight=fabric.StaticCanvas.prototype.setHeight;fabric.StaticCanvas.prototype.setHeight=function(e){return origSetHeight.call(this,e),this.nodeCanvas.height=e,this},fabric.Canvas&&(fabric.Canvas.prototype.setHeight=fabric.StaticCanvas.prototype.setHeight)}(),window.fabric=fabric;var exports=exports||{};exports.fabric=fabric,typeof define=="function"&&define.amd&&define("fabric",[],function(){return fabric}),define("tweenjs",[],function(){return this.createjs=this.createjs||{},function(){var e=function(e,t,n){this.initialize(e,t,n)},t=e.prototype;t.type=null,t.target=null,t.currentTarget=null,t.eventPhase=0,t.bubbles=!1,t.cancelable=!1,t.timeStamp=0,t.defaultPrevented=!1,t.propagationStopped=!1,t.immediatePropagationStopped=!1,t.removed=!1,t.initialize=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=(new Date).getTime()},t.preventDefault=function(){this.defaultPrevented=!0},t.stopPropagation=function(){this.propagationStopped=!0},t.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},t.remove=function(){this.removed=!0},t.clone=function(){return new e(this.type,this.bubbles,this.cancelable)},t.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=e}(),this.createjs=this.createjs||{},function(){var e=function(){},t=e.prototype;e.initialize=function(e){e.addEventListener=t.addEventListener,e.on=t.on,e.removeEventListener=e.off=t.removeEventListener,e.removeAllEventListeners=t.removeAllEventListeners,e.hasEventListener=t.hasEventListener,e.dispatchEvent=t.dispatchEvent,e._dispatchEvent=t._dispatchEvent,e.willTrigger=t.willTrigger},t._listeners=null,t._captureListeners=null,t.initialize=function(){},t.addEventListener=function(e,t,n){var r;r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var i=r[e];return i&&this.removeEventListener(e,t,n),i=r[e],i?i.push(t):r[e]=[t],t},t.on=function(e,t,n,r,i,s){return t.handleEvent&&(n=n||t,t=t.handleEvent),n=n||this,this.addEventListener(e,function(e){t.call(n,e,i),r&&e.remove()},s)},t.removeEventListener=function(e,t,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[e];if(i)for(var s=0,o=i.length;o>s;s++)if(i[s]==t){1==o?delete r[e]:i.splice(s,1);break}}},t.off=t.removeEventListener,t.removeAllEventListeners=function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null},t.dispatchEvent=function(e,t){if("string"==typeof e){var n=this._listeners;if(!n||!n[e])return!1;e=new createjs.Event(e)}if(e.target=t||this,e.bubbles&&this.parent){for(var r=this,i=[r];r.parent;)i.push(r=r.parent);var s,o=i.length;for(s=o-1;s>=0&&!e.propagationStopped;s--)i[s]._dispatchEvent(e,1+(0==s));for(s=1;o>s&&!e.propagationStopped;s++)i[s]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented},t.hasEventListener=function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])},t.willTrigger=function(e){for(var t=this;t;){if(t.hasEventListener(e))return!0;t=t.parent}return!1},t.toString=function(){return"[EventDispatcher]"},t._dispatchEvent=function(e,t){var n,r=1==t?this._captureListeners:this._listeners;if(e&&r){var i=r[e.type];if(!i||!(n=i.length))return;e.currentTarget=this,e.eventPhase=t,e.removed=!1,i=i.slice();for(var s=0;n>s&&!e.immediatePropagationStopped;s++){var o=i[s];o.handleEvent?o.handleEvent(e):o(e),e.removed&&(this.off(e.type,o,1==t),e.removed=!1)}}},createjs.EventDispatcher=e}(),this.createjs=this.createjs||{},function(){createjs.indexOf=function(e,t){for(var n=0,r=e.length;r>n;n++)if(t===e[n])return n;return-1}}(),this.createjs=this.createjs||{},function(){var e=function(){throw"UID cannot be instantiated"};e._nextID=0,e.get=function(){return e._nextID++},createjs.UID=e}(),this.createjs=this.createjs||{},function(){var e=function(){throw"Ticker cannot be instantiated."};e.RAF_SYNCHED="synched",e.RAF="raf",e.TIMEOUT="timeout",e.useRAF=!1,e.timingMode=null,e.maxDelta=0,e.removeEventListener=null,e.removeAllEventListeners=null,e.dispatchEvent=null,e.hasEventListener=null,e._listeners=null,createjs.EventDispatcher.initialize(e),e._addEventListener=e.addEventListener,e.addEventListener=function(){return!e._inited&&e.init(),e._addEventListener.apply(e,arguments)},e._paused=!1,e._inited=!1,e._startTime=0,e._pausedTime=0,e._ticks=0,e._pausedTicks=0,e._interval=50,e._lastTime=0,e._times=null,e._tickTimes=null,e._timerId=null,e._raf=!0,e.init=function(){e._inited||(e._inited=!0,e._times=[],e._tickTimes=[],e._startTime=e._getTime(),e._times.push(e._lastTime=0),e.setInterval(e._interval))},e.reset=function(){if(e._raf){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame;t&&t(e._timerId)}else clearTimeout(e._timerId);e.removeAllEventListeners("tick")},e.setInterval=function(t){e._interval=t,e._inited&&e._setupTick()},e.getInterval=function(){return e._interval},e.setFPS=function(t){e.setInterval(1e3/t)},e.getFPS=function(){return 1e3/e._interval},e.getMeasuredTickTime=function(t){var n=0,r=e._tickTimes;if(r.length<1)return-1;t=Math.min(r.length,t||0|e.getFPS());for(var i=0;t>i;i++)n+=r[i];return n/t},e.getMeasuredFPS=function(t){var n=e._times;return n.length<2?-1:(t=Math.min(n.length-1,t||0|e.getFPS()),1e3/((n[0]-n[t])/t))},e.setPaused=function(t){e._paused=t},e.getPaused=function(){return e._paused},e.getTime=function(t){return e._getTime()-e._startTime-(t?e._pausedTime:0)},e.getEventTime=function(t){return(e._lastTime||e._startTime)-(t?e._pausedTime:0)},e.getTicks=function(t){return e._ticks-(t?e._pausedTicks:0)},e._handleSynch=function(){var t=e._getTime()-e._startTime;e._timerId=null,e._setupTick(),t-e._lastTime>=.97*(e._interval-1)&&e._tick()},e._handleRAF=function(){e._timerId=null,e._setupTick(),e._tick()},e._handleTimeout=function(){e._timerId=null,e._setupTick(),e._tick()},e._setupTick=function(){if(null==e._timerId){var t=e.timingMode||e.useRAF&&e.RAF_SYNCHED;if(t==e.RAF_SYNCHED||t==e.RAF){var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(n)return e._timerId=n(t==e.RAF?e._handleRAF:e._handleSynch),e._raf=!0,void 0}e._raf=!1,e._timerId=setTimeout(e._handleTimeout,e._interval)}},e._tick=function(){var t=e._getTime()-e._startTime,n=t-e._lastTime,r=e._paused;if(e._ticks++,r&&(e._pausedTicks++,e._pausedTime+=n),e._lastTime=t,e.hasEventListener("tick")){var i=new createjs.Event("tick"),s=e.maxDelta;i.delta=s&&n>s?s:n,i.paused=r,i.time=t,i.runTime=t-e._pausedTime,e.dispatchEvent(i)}for(e._tickTimes.unshift(e._getTime()-t);e._tickTimes.length>100;)e._tickTimes.pop();for(e._times.unshift(t);e._times.length>100;)e._times.pop()};var t=window.performance&&(performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow);e._getTime=function(){return t&&t.call(performance)||(new Date).getTime()},createjs.Ticker=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n,r,i,s,o,u,a,f){this.initialize(e,t,n,r,i,s,o,u,a,f)},t=e.prototype=new createjs.Event;t.stageX=0,t.stageY=0,t.rawX=0,t.rawY=0,t.nativeEvent=null,t.pointerID=0,t.primary=!1,t.addEventListener=null,t.removeEventListener=null,t.removeAllEventListeners=null,t.dispatchEvent=null,t.hasEventListener=null,t._listeners=null,createjs.EventDispatcher.initialize(t),t._get_localX=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).x},t._get_localY=function(){return this.currentTarget.globalToLocal(this.rawX,this.rawY).y};try{Object.defineProperties(t,{localX:{get:t._get_localX},localY:{get:t._get_localY}})}catch(n){}t.Event_initialize=t.initialize,t.initialize=function(e,t,n,r,i,s,o,u,a,f){this.Event_initialize(e,t,n),this.stageX=r,this.stageY=i,this.nativeEvent=s,this.pointerID=o,this.primary=u,this.rawX=null==a?r:a,this.rawY=null==f?i:f},t.clone=function(){return new e(this.type,this.bubbles,this.cancelable,this.stageX,this.stageY,this.target,this.nativeEvent,this.pointerID,this.primary,this.rawX,this.rawY)},t.toString=function(){return"[MouseEvent (type="+this.type+" stageX="+this.stageX+" stageY="+this.stageY+")]"},createjs.MouseEvent=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n,r,i,s){this.initialize(e,t,n,r,i,s)},t=e.prototype;e.identity=null,e.DEG_TO_RAD=Math.PI/180,t.a=1,t.b=0,t.c=0,t.d=1,t.tx=0,t.ty=0,t.alpha=1,t.shadow=null,t.compositeOperation=null,t.initialize=function(e,t,n,r,i,s){return this.a=null==e?1:e,this.b=t||0,this.c=n||0,this.d=null==r?1:r,this.tx=i||0,this.ty=s||0,this},t.prepend=function(e,t,n,r,i,s){var o=this.tx;if(1!=e||0!=t||0!=n||1!=r){var u=this.a,a=this.c;this.a=u*e+this.b*n,this.b=u*t+this.b*r,this.c=a*e+this.d*n,this.d=a*t+this.d*r}return this.tx=o*e+this.ty*n+i,this.ty=o*t+this.ty*r+s,this},t.append=function(e,t,n,r,i,s){var o=this.a,u=this.b,a=this.c,f=this.d;return this.a=e*o+t*a,this.b=e*u+t*f,this.c=n*o+r*a,this.d=n*u+r*f,this.tx=i*o+s*a+this.tx,this.ty=i*u+s*f+this.ty,this},t.prependMatrix=function(e){return this.prepend(e.a,e.b,e.c,e.d,e.tx,e.ty),this.prependProperties(e.alpha,e.shadow,e.compositeOperation),this},t.appendMatrix=function(e){return this.append(e.a,e.b,e.c,e.d,e.tx,e.ty),this.appendProperties(e.alpha,e.shadow,e.compositeOperation),this},t.prependTransform=function(t,n,r,i,s,o,u,f,l){if(s%360)var c=s*e.DEG_TO_RAD,h=Math.cos(c),p=Math.sin(c);else h=1,p=0;return(f||l)&&(this.tx-=f,this.ty-=l),o||u?(o*=e.DEG_TO_RAD,u*=e.DEG_TO_RAD,this.prepend(h*r,p*r,-p*i,h*i,0,0),this.prepend(Math.cos(u),Math.sin(u),-Math.sin(o),Math.cos(o),t,n)):this.prepend(h*r,p*r,-p*i,h*i,t,n),this},t.appendTransform=function(t,n,r,i,s,o,u,f,l){if(s%360)var c=s*e.DEG_TO_RAD,h=Math.cos(c),p=Math.sin(c);else h=1,p=0;return o||u?(o*=e.DEG_TO_RAD,u*=e.DEG_TO_RAD,this.append(Math.cos(u),Math.sin(u),-Math.sin(o),Math.cos(o),t,n),this.append(h*r,p*r,-p*i,h*i,0,0)):this.append(h*r,p*r,-p*i,h*i,t,n),(f||l)&&(this.tx-=f*this.a+l*this.c,this.ty-=f*this.b+l*this.d),this},t.rotate=function(e){var t=Math.cos(e),n=Math.sin(e),r=this.a,i=this.c,s=this.tx;return this.a=r*t-this.b*n,this.b=r*n+this.b*t,this.c=i*t-this.d*n,this.d=i*n+this.d*t,this.tx=s*t-this.ty*n,this.ty=s*n+this.ty*t,this},t.skew=function(t,n){return t*=e.DEG_TO_RAD,n*=e.DEG_TO_RAD,this.append(Math.cos(n),Math.sin(n),-Math.sin(t),Math.cos(t),0,0),this},t.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},t.translate=function(e,t){return this.tx+=e,this.ty+=t,this},t.identity=function(){return this.alpha=this.a=this.d=1,this.b=this.c=this.tx=this.ty=0,this.shadow=this.compositeOperation=null,this},t.invert=function(){var e=this.a,t=this.b,n=this.c,r=this.d,i=this.tx,s=e*r-t*n;return this.a=r/s,this.b=-t/s,this.c=-n/s,this.d=e/s,this.tx=(n*this.ty-r*i)/s,this.ty=-(e*this.ty-t*i)/s,this},t.isIdentity=function(){return 0==this.tx&&0==this.ty&&1==this.a&&0==this.b&&0==this.c&&1==this.d},t.transformPoint=function(e,t,n){return n=n||{},n.x=e*this.a+t*this.c+this.tx,n.y=e*this.b+t*this.d+this.ty,n},t.decompose=function(t){null==t&&(t={}),t.x=this.tx,t.y=this.ty,t.scaleX=Math.sqrt(this.a*this.a+this.b*this.b),t.scaleY=Math.sqrt(this.c*this.c+this.d*this.d);var n=Math.atan2(-this.c,this.d),r=Math.atan2(this.b,this.a);return n==r?(t.rotation=r/e.DEG_TO_RAD,this.a<0&&this.d>=0&&(t.rotation+=t.rotation<=0?180:-180),t.skewX=t.skewY=0):(t.skewX=n/e.DEG_TO_RAD,t.skewY=r/e.DEG_TO_RAD),t},t.reinitialize=function(e,t,n,r,i,s,o,u,a){return this.initialize(e,t,n,r,i,s),this.alpha=null==o?1:o,this.shadow=u,this.compositeOperation=a,this},t.copy=function(e){return this.reinitialize(e.a,e.b,e.c,e.d,e.tx,e.ty,e.alpha,e.shadow,e.compositeOperation)},t.appendProperties=function(e,t,n){return this.alpha*=e,this.shadow=t||this.shadow,this.compositeOperation=n||this.compositeOperation,this},t.prependProperties=function(e,t,n){return this.alpha*=e,this.shadow=this.shadow||t,this.compositeOperation=this.compositeOperation||n,this},t.clone=function(){return(new e).copy(this)},t.toString=function(){return"[Matrix2D (a="+this.a+" b="+this.b+" c="+this.c+" d="+this.d+" tx="+this.tx+" ty="+this.ty+")]"},e.identity=new e,createjs.Matrix2D=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t){this.initialize(e,t)},t=e.prototype;t.x=0,t.y=0,t.initialize=function(e,t){return this.x=null==e?0:e,this.y=null==t?0:t,this},t.copy=function(e){return this.initialize(e.x,e.y)},t.clone=function(){return new e(this.x,this.y)},t.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},createjs.Point=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n,r){this.initialize(e,t,n,r)},t=e.prototype;t.x=0,t.y=0,t.width=0,t.height=0,t.initialize=function(e,t,n,r){return this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0,this},t.copy=function(e){return this.initialize(e.x,e.y,e.width,e.height)},t.clone=function(){return new e(this.x,this.y,this.width,this.height)},t.toString=function(){return"[Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")]"},createjs.Rectangle=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n,r,i,s,o){this.initialize(e,t,n,r,i,s,o)},t=e.prototype;t.target=null,t.overLabel=null,t.outLabel=null,t.downLabel=null,t.play=!1,t._isPressed=!1,t._isOver=!1,t.initialize=function(e,t,n,r,i,s,o){e.addEventListener&&(this.target=e,e.cursor="pointer",this.overLabel=null==n?"over":n,this.outLabel=null==t?"out":t,this.downLabel=null==r?"down":r,this.play=i,this.setEnabled(!0),this.handleEvent({}),s&&(o&&(s.actionsEnabled=!1,s.gotoAndStop&&s.gotoAndStop(o)),e.hitArea=s))},t.setEnabled=function(e){var t=this.target;e?(t.addEventListener("rollover",this),t.addEventListener("rollout",this),t.addEventListener("mousedown",this),t.addEventListener("pressup",this)):(t.removeEventListener("rollover",this),t.removeEventListener("rollout",this),t.removeEventListener("mousedown",this),t.removeEventListener("pressup",this))},t.toString=function(){return"[ButtonHelper]"},t.handleEvent=function(e){var t,n=this.target,r=e.type;"mousedown"==r?(this._isPressed=!0,t=this.downLabel):"pressup"==r?(this._isPressed=!1,t=this._isOver?this.overLabel:this.outLabel):"rollover"==r?(this._isOver=!0,t=this._isPressed?this.downLabel:this.overLabel):(this._isOver=!1,t=this._isPressed?this.overLabel:this.outLabel),this.play?n.gotoAndPlay&&n.gotoAndPlay(t):n.gotoAndStop&&n.gotoAndStop(t)},createjs.ButtonHelper=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n,r){this.initialize(e,t,n,r)},t=e.prototype;e.identity=null,t.color=null,t.offsetX=0,t.offsetY=0,t.blur=0,t.initialize=function(e,t,n,r){this.color=e,this.offsetX=t,this.offsetY=n,this.blur=r},t.toString=function(){return"[Shadow]"},t.clone=function(){return new e(this.color,this.offsetX,this.offsetY,this.blur)},e.identity=new e("transparent",0,0,0),createjs.Shadow=e}(),this.createjs=this.createjs||{},function(){var e=function(e){this.initialize(e)},t=e.prototype=new createjs.EventDispatcher;t.complete=!0,t.framerate=0,t._animations=null,t._frames=null,t._images=null,t._data=null,t._loadCount=0,t._frameHeight=0,t._frameWidth=0,t._numFrames=0,t._regX=0,t._regY=0,t.initialize=function(e){var t,n,r,i;if(null!=e){if(this.framerate=e.framerate||0,e.images&&(n=e.images.length)>0)for(i=this._images=[],t=0;n>t;t++){var s=e.images[t];if("string"==typeof s){var o=s;s=document.createElement("img"),s.src=o}i.push(s),s.getContext||s.complete||(this._loadCount++,this.complete=!1,function(e){s.onload=function(){e._handleImageLoad()}}(this))}if(null!=e.frames)if(e.frames instanceof Array)for(this._frames=[],i=e.frames,t=0,n=i.length;n>t;t++){var u=i[t];this._frames.push({image:this._images[u[4]?u[4]:0],rect:new createjs.Rectangle(u[0],u[1],u[2],u[3]),regX:u[5]||0,regY:u[6]||0})}else r=e.frames,this._frameWidth=r.width,this._frameHeight=r.height,this._regX=r.regX||0,this._regY=r.regY||0,this._numFrames=r.count,0==this._loadCount&&this._calculateFrames();if(this._animations=[],null!=(r=e.animations)){this._data={};var a;for(a in r){var f={name:a},l=r[a];if("number"==typeof l)i=f.frames=[l];else if(l instanceof Array)if(1==l.length)f.frames=[l[0]];else for(f.speed=l[3],f.next=l[2],i=f.frames=[],t=l[0];t<=l[1];t++)i.push(t);else{f.speed=l.speed,f.next=l.next;var c=l.frames;i=f.frames="number"==typeof c?[c]:c.slice(0)}(f.next===!0||void 0===f.next)&&(f.next=a),(f.next===!1||i.length<2&&f.next==a)&&(f.next=null),f.speed||(f.speed=1),this._animations.push(a),this._data[a]=f}}}},t.getNumFrames=function(e){if(null==e)return this._frames?this._frames.length:this._numFrames;var t=this._data[e];return null==t?0:t.frames.length},t.getAnimations=function(){return this._animations.slice(0)},t.getAnimation=function(e){return this._data[e]},t.getFrame=function(e){var t;return this._frames&&(t=this._frames[e])?t:null},t.getFrameBounds=function(e,t){var n=this.getFrame(e);return n?(t||new createjs.Rectangle).initialize(-n.regX,-n.regY,n.rect.width,n.rect.height):null},t.toString=function(){return"[SpriteSheet]"},t.clone=function(){var t=new e;return t.complete=this.complete,t._animations=this._animations,t._frames=this._frames,t._images=this._images,t._data=this._data,t._frameHeight=this._frameHeight,t._frameWidth=this._frameWidth,t._numFrames=this._numFrames,t._loadCount=this._loadCount,t},t._handleImageLoad=function(){0==--this._loadCount&&(this._calculateFrames(),this.complete=!0,this.dispatchEvent("complete"))},t._calculateFrames=function(){if(!this._frames&&0!=this._frameWidth){this._frames=[];for(var e=0,t=this._frameWidth,n=this._frameHeight,r=0,i=this._images;r<i.length;r++){for(var s=i[r],o=0|s.width/t,u=0|s.height/n,a=this._numFrames>0?Math.min(this._numFrames-e,o*u):o*u,f=0;a>f;f++)this._frames.push({image:s,rect:new createjs.Rectangle(f%o*t,(0|f/o)*n,t,n),regX:this._regX,regY:this._regY});e+=a}this._numFrames=e}},createjs.SpriteSheet=e}(),this.createjs=this.createjs||{},function(){function e(e,t,n){this.f=e,this.params=t,this.path=null==n?!0:n}e.prototype.exec=function(e){this.f.apply(e,this.params)};var t=function(){this.initialize()},n=t.prototype;t.getRGB=function(e,t,n,r){return null!=e&&null==n&&(r=t,n=255&e,t=255&e>>8,e=255&e>>16),null==r?"rgb("+e+","+t+","+n+")":"rgba("+e+","+t+","+n+","+r+")"},t.getHSL=function(e,t,n,r){return null==r?"hsl("+e%360+","+t+"%,"+n+"%)":"hsla("+e%360+","+t+"%,"+n+"%,"+r+")"},t.Command=e,t.BASE_64={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25,a:26,b:27,c:28,d:29,e:30,f:31,g:32,h:33,i:34,j:35,k:36,l:37,m:38,n:39,o:40,p:41,q:42,r:43,s:44,t:45,u:46,v:47,w:48,x:49,y:50,z:51,0:52,1:53,2:54,3:55,4:56,5:57,6:58,7:59,8:60,9:61,"+":62,"/":63},t.STROKE_CAPS_MAP=["butt","round","square"],t.STROKE_JOINTS_MAP=["miter","round","bevel"];var r=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");if(r.getContext){var i=t._ctx=r.getContext("2d");t.beginCmd=new e(i.beginPath,[],!1),t.fillCmd=new e(i.fill,[],!1),t.strokeCmd=new e(i.stroke,[],!1),r.width=r.height=1}n._strokeInstructions=null,n._strokeStyleInstructions=null,n._strokeIgnoreScale=!1,n._fillInstructions=null,n._fillMatrix=null,n._instructions=null,n._oldInstructions=null,n._activeInstructions=null,n._active=!1,n._dirty=!1,n.initialize=function(){this.clear(),this._ctx=t._ctx},n.isEmpty=function(){return!(this._instructions.length||this._oldInstructions.length||this._activeInstructions.length)},n.draw=function(e){this._dirty&&this._updateInstructions();for(var t=this._instructions,n=0,r=t.length;r>n;n++)t[n].exec(e)},n.drawAsPath=function(e){this._dirty&&this._updateInstructions();for(var t,n=this._instructions,r=0,i=n.length;i>r;r++)((t=n[r]).path||0==r)&&t.exec(e)},n.moveTo=function(t,n){return this._activeInstructions.push(new e(this._ctx.moveTo,[t,n])),this},n.lineTo=function(t,n){return this._dirty=this._active=!0,this._activeInstructions.push(new e(this._ctx.lineTo,[t,n])),this},n.arcTo=function(t,n,r,i,s){return this._dirty=this._active=!0,this._activeInstructions.push(new e(this._ctx.arcTo,[t,n,r,i,s])),this},n.arc=function(t,n,r,i,s,o){return this._dirty=this._active=!0,null==o&&(o=!1),this._activeInstructions.push(new e(this._ctx.arc,[t,n,r,i,s,o])),this},n.quadraticCurveTo=function(t,n,r,i){return this._dirty=this._active=!0,this._activeInstructions.push(new e(this._ctx.quadraticCurveTo,[t,n,r,i])),this},n.bezierCurveTo=function(t,n,r,i,s,o){return this._dirty=this._active=!0,this._activeInstructions.push(new e(this._ctx.bezierCurveTo,[t,n,r,i,s,o])),this},n.rect=function(t,n,r,i){return this._dirty=this._active=!0,this._activeInstructions.push(new e(this._ctx.rect,[t,n,r,i])),this},n.closePath=function(){return this._active&&(this._dirty=!0,this._activeInstructions.push(new e(this._ctx.closePath,[]))),this},n.clear=function(){return this._instructions=[],this._oldInstructions=[],this._activeInstructions=[],this._strokeStyleInstructions=this._strokeInstructions=this._fillInstructions=this._fillMatrix=null,this._active=this._dirty=this._strokeIgnoreScale=!1,this},n.beginFill=function(t){return this._active&&this._newPath(),this._fillInstructions=t?[new e(this._setProp,["fillStyle",t],!1)]:null,this._fillMatrix=null,this},n.beginLinearGradientFill=function(t,n,r,i,s,o){this._active&&this._newPath();for(var u=this._ctx.createLinearGradient(r,i,s,o),f=0,l=t.length;l>f;f++)u.addColorStop(n[f],t[f]);return this._fillInstructions=[new e(this._setProp,["fillStyle",u],!1)],this._fillMatrix=null,this},n.beginRadialGradientFill=function(t,n,r,i,s,o,u,f){this._active&&this._newPath();for(var l=this._ctx.createRadialGradient(r,i,s,o,u,f),c=0,h=t.length;h>c;c++)l.addColorStop(n[c],t[c]);return this._fillInstructions=[new e(this._setProp,["fillStyle",l],!1)],this._fillMatrix=null,this},n.beginBitmapFill=function(t,n,r){this._active&&this._newPath(),n=n||"";var i=this._ctx.createPattern(t,n);return this._fillInstructions=[new e(this._setProp,["fillStyle",i],!1)],this._fillMatrix=r?[r.a,r.b,r.c,r.d,r.tx,r.ty]:null,this},n.endFill=function(){return this.beginFill()},n.setStrokeStyle=function(n,r,i,s,o){return this._active&&this._newPath(),this._strokeStyleInstructions=[new e(this._setProp,["lineWidth",null==n?"1":n],!1),new e(this._setProp,["lineCap",null==r?"butt":isNaN(r)?r:t.STROKE_CAPS_MAP[r]],!1),new e(this._setProp,["lineJoin",null==i?"miter":isNaN(i)?i:t.STROKE_JOINTS_MAP[i]],!1),new e(this._setProp,["miterLimit",null==s?"10":s],!1)],this._strokeIgnoreScale=o,this},n.beginStroke=function(t){return this._active&&this._newPath(),this._strokeInstructions=t?[new e(this._setProp,["strokeStyle",t],!1)]:null,this},n.beginLinearGradientStroke=function(t,n,r,i,s,o){this._active&&this._newPath();for(var u=this._ctx.createLinearGradient(r,i,s,o),f=0,l=t.length;l>f;f++)u.addColorStop(n[f],t[f]);return this._strokeInstructions=[new e(this._setProp,["strokeStyle",u],!1)],this},n.beginRadialGradientStroke=function(t,n,r,i,s,o,u,f){this._active&&this._newPath();for(var l=this._ctx.createRadialGradient(r,i,s,o,u,f),c=0,h=t.length;h>c;c++)l.addColorStop(n[c],t[c]);return this._strokeInstructions=[new e(this._setProp,["strokeStyle",l],!1)],this},n.beginBitmapStroke=function(t,n){this._active&&this._newPath(),n=n||"";var r=this._ctx.createPattern(t,n);return this._strokeInstructions=[new e(this._setProp,["strokeStyle",r],!1)],this},n.endStroke=function(){return this.beginStroke(),this},n.curveTo=n.quadraticCurveTo,n.drawRect=n.rect,n.drawRoundRect=function(e,t,n,r,i){return this.drawRoundRectComplex(e,t,n,r,i,i,i,i),this},n.drawRoundRectComplex=function(t,n,r,i,s,o,u,f){var l=(i>r?r:i)/2,c=0,h=0,p=0,d=0;0>s&&(s*=c=-1),s>l&&(s=l),0>o&&(o*=h=-1),o>l&&(o=l),0>u&&(u*=p=-1),u>l&&(u=l),0>f&&(f*=d=-1),f>l&&(f=l),this._dirty=this._active=!0;var v=this._ctx.arcTo,m=this._ctx.lineTo;return this._activeInstructions.push(new e(this._ctx.moveTo,[t+r-o,n]),new e(v,[t+r+o*h,n-o*h,t+r,n+o,o]),new e(m,[t+r,n+i-u]),new e(v,[t+r+u*p,n+i+u*p,t+r-u,n+i,u]),new e(m,[t+f,n+i]),new e(v,[t-f*d,n+i+f*d,t,n+i-f,f]),new e(m,[t,n+s]),new e(v,[t-s*c,n-s*c,t+s,n,s]),new e(this._ctx.closePath)),this},n.drawCircle=function(e,t,n){return this.arc(e,t,n,0,2*Math.PI),this},n.drawEllipse=function(t,n,r,i){this._dirty=this._active=!0;var s=.5522848,o=r/2*s,u=i/2*s,f=t+r,l=n+i,c=t+r/2,h=n+i/2;return this._activeInstructions.push(new e(this._ctx.moveTo,[t,h]),new e(this._ctx.bezierCurveTo,[t,h-u,c-o,n,c,n]),new e(this._ctx.bezierCurveTo,[c+o,n,f,h-u,f,h]),new e(this._ctx.bezierCurveTo,[f,h+u,c+o,l,c,l]),new e(this._ctx.bezierCurveTo,[c-o,l,t,h+u,t,h])),this},n.inject=function(t,n){return this._dirty=this._active=!0,this._activeInstructions.push(new e(t,[n])),this},n.drawPolyStar=function(t,n,r,i,s,o){this._dirty=this._active=!0,null==s&&(s=0),s=1-s,null==o?o=0:o/=180/Math.PI;var u=Math.PI/i;this._activeInstructions.push(new e(this._ctx.moveTo,[t+Math.cos(o)*r,n+Math.sin(o)*r]));for(var f=0;i>f;f++)o+=u,1!=s&&this._activeInstructions.push(new e(this._ctx.lineTo,[t+Math.cos(o)*r*s,n+Math.sin(o)*r*s])),o+=u,this._activeInstructions.push(new e(this._ctx.lineTo,[t+Math.cos(o)*r,n+Math.sin(o)*r]));return this},n.decodePath=function(e){for(var n=[this.moveTo,this.lineTo,this.quadraticCurveTo,this.bezierCurveTo,this.closePath],r=[2,2,4,6,0],i=0,s=e.length,o=[],u=0,a=0,f=t.BASE_64;s>i;){var l=e.charAt(i),c=f[l],h=c>>3,p=n[h];if(!p||3&c)throw"bad path data (@"+i+"): "+l;var d=r[h];h||(u=a=0),o.length=0,i++;for(var v=(1&c>>2)+2,m=0;d>m;m++){var g=f[e.charAt(i)],y=g>>5?-1:1;g=(31&g)<<6|f[e.charAt(i+1)],3==v&&(g=g<<6|f[e.charAt(i+2)]),g=y*g/10,m%2?u=g+=u:a=g+=a,o[m]=g,i+=v}p.apply(this,o)}return this},n.clone=function(){var e=new t;return e._instructions=this._instructions.slice(),e._activeInstructions=this._activeInstructions.slice(),e._oldInstructions=this._oldInstructions.slice(),this._fillInstructions&&(e._fillInstructions=this._fillInstructions.slice()),this._strokeInstructions&&(e._strokeInstructions=this._strokeInstructions.slice()),this._strokeStyleInstructions&&(e._strokeStyleInstructions=this._strokeStyleInstructions.slice()),e._active=this._active,e._dirty=this._dirty,e._fillMatrix=this._fillMatrix,e._strokeIgnoreScale=this._strokeIgnoreScale,e},n.toString=function(){return"[Graphics]"},n.mt=n.moveTo,n.lt=n.lineTo,n.at=n.arcTo,n.bt=n.bezierCurveTo,n.qt=n.quadraticCurveTo,n.a=n.arc,n.r=n.rect,n.cp=n.closePath,n.c=n.clear,n.f=n.beginFill,n.lf=n.beginLinearGradientFill,n.rf=n.beginRadialGradientFill,n.bf=n.beginBitmapFill,n.ef=n.endFill,n.ss=n.setStrokeStyle,n.s=n.beginStroke,n.ls=n.beginLinearGradientStroke,n.rs=n.beginRadialGradientStroke,n.bs=n.beginBitmapStroke,n.es=n.endStroke,n.dr=n.drawRect,n.rr=n.drawRoundRect,n.rc=n.drawRoundRectComplex,n.dc=n.drawCircle,n.de=n.drawEllipse,n.dp=n.drawPolyStar,n.p=n.decodePath,n._updateInstructions=function(){this._instructions=this._oldInstructions.slice(),this._instructions.push(t.beginCmd),this._appendInstructions(this._fillInstructions),this._appendInstructions(this._strokeInstructions),this._appendInstructions(this._strokeInstructions&&this._strokeStyleInstructions),this._appendInstructions(this._activeInstructions),this._fillInstructions&&this._appendDraw(t.fillCmd,this._fillMatrix),this._strokeInstructions&&this._appendDraw(t.strokeCmd,this._strokeIgnoreScale&&[1,0,0,1,0,0])},n._appendInstructions=function(e){e&&this._instructions.push.apply(this._instructions,e)},n._appendDraw=function(t,n){n?this._instructions.push(new e(this._ctx.save,[],!1),new e(this._ctx.transform,n,!1),t,new e(this._ctx.restore,[],!1)):this._instructions.push(t)},n._newPath=function(){this._dirty&&this._updateInstructions(),this._oldInstructions=this._instructions,this._activeInstructions=[],this._active=this._dirty=!1},n._setProp=function(e,t){this[e]=t},createjs.Graphics=t}(),this.createjs=this.createjs||{},function(){var e=function(){this.initialize()},t=e.prototype=new createjs.EventDispatcher;e._MOUSE_EVENTS=["click","dblclick","mousedown","mouseout","mouseover","pressmove","pressup","rollout","rollover"],e.suppressCrossDomainErrors=!1;var n=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");n.getContext&&(e._hitTestCanvas=n,e._hitTestContext=n.getContext("2d"),n.width=n.height=1),e._nextCacheID=1,t.alpha=1,t.cacheCanvas=null,t.id=-1,t.mouseEnabled=!0,t.tickEnabled=!0,t.name=null,t.parent=null,t.regX=0,t.regY=0,t.rotation=0,t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.shadow=null,t.visible=!0,t.x=0,t.y=0,t.compositeOperation=null,t.snapToPixel=!1,t.filters=null,t.cacheID=0,t.mask=null,t.hitArea=null,t.cursor=null,t._cacheOffsetX=0,t._cacheOffsetY=0,t._cacheScale=1,t._cacheDataURLID=0,t._cacheDataURL=null,t._matrix=null,t._rectangle=null,t._bounds=null,t.initialize=function(){this.id=createjs.UID.get(),this._matrix=new createjs.Matrix2D,this._rectangle=new createjs.Rectangle},t.isVisible=function(){return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY)},t.draw=function(e,t){var n=this.cacheCanvas;if(t||!n)return!1;var r,i=this._cacheScale,s=this._cacheOffsetX,o=this._cacheOffsetY;return(r=this._applyFilterBounds(s,o,0,0))&&(s=r.x,o=r.y),e.drawImage(n,s,o,n.width/i,n.height/i),!0},t.updateContext=function(e){var t,n=this.mask,r=this;n&&n.graphics&&!n.graphics.isEmpty()&&(t=n.getMatrix(n._matrix),e.transform(t.a,t.b,t.c,t.d,t.tx,t.ty),n.graphics.drawAsPath(e),e.clip(),t.invert(),e.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)),t=r._matrix.identity().appendTransform(r.x,r.y,r.scaleX,r.scaleY,r.rotation,r.skewX,r.skewY,r.regX,r.regY),createjs.Stage._snapToPixelEnabled&&r.snapToPixel?e.transform(t.a,t.b,t.c,t.d,0|t.tx+.5,0|t.ty+.5):e.transform(t.a,t.b,t.c,t.d,t.tx,t.ty),e.globalAlpha*=r.alpha,r.compositeOperation&&(e.globalCompositeOperation=r.compositeOperation),r.shadow&&this._applyShadow(e,r.shadow)},t.cache=function(e,t,n,r,i){i=i||1,this.cacheCanvas||(this.cacheCanvas=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),this._cacheWidth=n,this._cacheHeight=r,this._cacheOffsetX=e,this._cacheOffsetY=t,this._cacheScale=i,this.updateCache()},t.updateCache=function(t){var n,r=this.cacheCanvas,i=this._cacheScale,s=this._cacheOffsetX*i,o=this._cacheOffsetY*i,u=this._cacheWidth,f=this._cacheHeight;if(!r)throw"cache() must be called before updateCache()";var l=r.getContext("2d");(n=this._applyFilterBounds(s,o,u,f))&&(s=n.x,o=n.y,u=n.width,f=n.height),u=Math.ceil(u*i),f=Math.ceil(f*i),u!=r.width||f!=r.height?(r.width=u,r.height=f):t||l.clearRect(0,0,u+1,f+1),l.save(),l.globalCompositeOperation=t,l.setTransform(i,0,0,i,-s,-o),this.draw(l,!0),this._applyFilters(),l.restore(),this.cacheID=e._nextCacheID++},t.uncache=function(){this._cacheDataURL=this.cacheCanvas=null,this.cacheID=this._cacheOffsetX=this._cacheOffsetY=0,this._cacheScale=1},t.getCacheDataURL=function(){return this.cacheCanvas?(this.cacheID!=this._cacheDataURLID&&(this._cacheDataURL=this.cacheCanvas.toDataURL()),this._cacheDataURL):null},t.getStage=function(){for(var e=this;e.parent;)e=e.parent;return e instanceof createjs.Stage?e:null},t.localToGlobal=function(e,t){var n=this.getConcatenatedMatrix(this._matrix);return null==n?null:(n.append(1,0,0,1,e,t),new createjs.Point(n.tx,n.ty))},t.globalToLocal=function(e,t){var n=this.getConcatenatedMatrix(this._matrix);return null==n?null:(n.invert(),n.append(1,0,0,1,e,t),new createjs.Point(n.tx,n.ty))},t.localToLocal=function(e,t,n){var r=this.localToGlobal(e,t);return n.globalToLocal(r.x,r.y)},t.setTransform=function(e,t,n,r,i,s,o,u,a){return this.x=e||0,this.y=t||0,this.scaleX=null==n?1:n,this.scaleY=null==r?1:r,this.rotation=i||0,this.skewX=s||0,this.skewY=o||0,this.regX=u||0,this.regY=a||0,this},t.getMatrix=function(e){var t=this;return(e?e.identity():new createjs.Matrix2D).appendTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY).appendProperties(t.alpha,t.shadow,t.compositeOperation)},t.getConcatenatedMatrix=function(e){e?e.identity():e=new createjs.Matrix2D;for(var t=this;null!=t;)e.prependTransform(t.x,t.y,t.scaleX,t.scaleY,t.rotation,t.skewX,t.skewY,t.regX,t.regY).prependProperties(t.alpha,t.shadow,t.compositeOperation),t=t.parent;return e},t.hitTest=function(t,n){var r=e._hitTestContext;r.setTransform(1,0,0,1,-t,-n),this.draw(r);var i=this._testHit(r);return r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,2,2),i},t.set=function(e){for(var t in e)this[t]=e[t];return this},t.getBounds=function(){if(this._bounds)return this._rectangle.copy(this._bounds);var e=this.cacheCanvas;if(e){var t=this._cacheScale;return this._rectangle.initialize(this._cacheOffsetX,this._cacheOffsetY,e.width/t,e.height/t)}return null},t.getTransformedBounds=function(){return this._getBounds()},t.setBounds=function(e,t,n,r){null==e&&(this._bounds=e),this._bounds=(this._bounds||new createjs.Rectangle).initialize(e,t,n,r)},t.clone=function(){var t=new e;return this.cloneProps(t),t},t.toString=function(){return"[DisplayObject (name="+this.name+")]"},t.cloneProps=function(e){e.alpha=this.alpha,e.name=this.name,e.regX=this.regX,e.regY=this.regY,e.rotation=this.rotation,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.shadow=this.shadow,e.skewX=this.skewX,e.skewY=this.skewY,e.visible=this.visible,e.x=this.x,e.y=this.y,e._bounds=this._bounds,e.mouseEnabled=this.mouseEnabled,e.compositeOperation=this.compositeOperation},t._applyShadow=function(e,t){t=t||Shadow.identity,e.shadowColor=t.color,e.shadowOffsetX=t.offsetX,e.shadowOffsetY=t.offsetY,e.shadowBlur=t.blur},t._tick=function(e){var t=this._listeners;if(t&&t.tick){var n=new createjs.Event("tick");n.params=e,this._dispatchEvent(n,this,2)}},t._testHit=function(t){try{var n=t.getImageData(0,0,1,1).data[3]>1}catch(r){if(!e.suppressCrossDomainErrors)throw"An error has occurred. This is most likely due to security restrictions on reading canvas pixel data with local or cross-domain images."}return n},t._applyFilters=function(){if(this.filters&&0!=this.filters.length&&this.cacheCanvas)for(var e=this.filters.length,t=this.cacheCanvas.getContext("2d"),n=this.cacheCanvas.width,r=this.cacheCanvas.height,i=0;e>i;i++)this.filters[i].applyFilter(t,0,0,n,r)},t._applyFilterBounds=function(e,t,n,r){var i,s,o=this.filters;if(!o||!(s=o.length))return null;for(var u=0;s>u;u++){var a=this.filters[u],f=a.getBounds&&a.getBounds();f&&(i||(i=this._rectangle.initialize(e,t,n,r)),i.x+=f.x,i.y+=f.y,i.width+=f.width,i.height+=f.height)}return i},t._getBounds=function(e,t){return this._transformBounds(this.getBounds(),e,t)},t._transformBounds=function(e,t,n){if(!e)return e;var r=e.x,i=e.y,s=e.width,o=e.height,u=n?this._matrix.identity():this.getMatrix(this._matrix);(r||i)&&u.appendTransform(0,0,1,1,0,0,0,-r,-i),t&&u.prependMatrix(t);var a=s*u.a,f=s*u.b,l=o*u.c,c=o*u.d,h=u.tx,p=u.ty,d=h,v=h,m=p,g=p;return(r=a+h)<d?d=r:r>v&&(v=r),(r=a+l+h)<d?d=r:r>v&&(v=r),(r=l+h)<d?d=r:r>v&&(v=r),(i=f+p)<m?m=i:i>g&&(g=i),(i=f+c+p)<m?m=i:i>g&&(g=i),(i=c+p)<m?m=i:i>g&&(g=i),e.initialize(d,m,v-d,g-m)},t._hasMouseEventListener=function(){for(var t=e._MOUSE_EVENTS,n=0,r=t.length;r>n;n++)if(this.hasEventListener(t[n]))return!0;return!!this.cursor},createjs.DisplayObject=e}(),this.createjs=this.createjs||{},function(){var e=function(){this.initialize()},t=e.prototype=new createjs.DisplayObject;t.children=null,t.mouseChildren=!0,t.tickChildren=!0,t.DisplayObject_initialize=t.initialize,t.initialize=function(){this.DisplayObject_initialize(),this.children=[]},t.isVisible=function(){var e=this.cacheCanvas||this.children.length;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&e)},t.DisplayObject_draw=t.draw,t.draw=function(e,t){if(this.DisplayObject_draw(e,t))return!0;for(var n=this.children.slice(0),r=0,i=n.length;i>r;r++){var s=n[r];s.isVisible()&&(e.save(),s.updateContext(e),s.draw(e),e.restore())}return!0},t.addChild=function(e){if(null==e)return e;var t=arguments.length;if(t>1){for(var n=0;t>n;n++)this.addChild(arguments[n]);return arguments[t-1]}return e.parent&&e.parent.removeChild(e),e.parent=this,this.children.push(e),e},t.addChildAt=function(e,t){var n=arguments.length,r=arguments[n-1];if(0>r||r>this.children.length)return arguments[n-2];if(n>2){for(var i=0;n-1>i;i++)this.addChildAt(arguments[i],r+i);return arguments[n-2]}return e.parent&&e.parent.removeChild(e),e.parent=this,this.children.splice(t,0,e),e},t.removeChild=function(e){var t=arguments.length;if(t>1){for(var n=!0,r=0;t>r;r++)n=n&&this.removeChild(arguments[r]);return n}return this.removeChildAt(createjs.indexOf(this.children,e))},t.removeChildAt=function(e){var t=arguments.length;if(t>1){for(var n=[],r=0;t>r;r++)n[r]=arguments[r];n.sort(function(e,t){return t-e});for(var i=!0,r=0;t>r;r++)i=i&&this.removeChildAt(n[r]);return i}if(0>e||e>this.children.length-1)return!1;var s=this.children[e];return s&&(s.parent=null),this.children.splice(e,1),!0},t.removeAllChildren=function(){for(var e=this.children;e.length;)e.pop().parent=null},t.getChildAt=function(e){return this.children[e]},t.getChildByName=function(e){for(var t=this.children,n=0,r=t.length;r>n;n++)if(t[n].name==e)return t[n];return null},t.sortChildren=function(e){this.children.sort(e)},t.getChildIndex=function(e){return createjs.indexOf(this.children,e)},t.getNumChildren=function(){return this.children.length},t.swapChildrenAt=function(e,t){var n=this.children,r=n[e],i=n[t];r&&i&&(n[e]=i,n[t]=r)},t.swapChildren=function(e,t){for(var n,r,i=this.children,s=0,o=i.length;o>s&&(i[s]==e&&(n=s),i[s]==t&&(r=s),null==n||null==r);s++);s!=o&&(i[n]=t,i[r]=e)},t.setChildIndex=function(e,t){var n=this.children,r=n.length;if(!(e.parent!=this||0>t||t>=r)){for(var i=0;r>i&&n[i]!=e;i++);i!=r&&i!=t&&(n.splice(i,1),n.splice(t,0,e))}},t.contains=function(e){for(;e;){if(e==this)return!0;e=e.parent}return!1},t.hitTest=function(e,t){return null!=this.getObjectUnderPoint(e,t)},t.getObjectsUnderPoint=function(e,t){var n=[],r=this.localToGlobal(e,t);return this._getObjectsUnderPoint(r.x,r.y,n),n},t.getObjectUnderPoint=function(e,t){var n=this.localToGlobal(e,t);return this._getObjectsUnderPoint(n.x,n.y)},t.DisplayObject_getBounds=t.getBounds,t.getBounds=function(){return this._getBounds(null,!0)},t.getTransformedBounds=function(){return this._getBounds()},t.clone=function(t){var n=new e;if(this.cloneProps(n),t)for(var r=n.children=[],i=0,s=this.children.length;s>i;i++){var o=this.children[i].clone(t);o.parent=n,r.push(o)}return n},t.toString=function(){return"[Container (name="+this.name+")]"},t.DisplayObject__tick=t._tick,t._tick=function(e){if(this.tickChildren)for(var t=this.children.length-1;t>=0;t--){var n=this.children[t];n.tickEnabled&&n._tick&&n._tick(e)}this.DisplayObject__tick(e)},t._getObjectsUnderPoint=function(t,n,r,i,s){var o=createjs.DisplayObject._hitTestContext,u=this._matrix;s=s||i&&this._hasMouseEventListener();for(var f=this.children,l=f.length,c=l-1;c>=0;c--){var h=f[c],p=h.hitArea;if(h.visible&&(p||h.isVisible())&&(!i||h.mouseEnabled))if(!p&&h instanceof e){var d=h._getObjectsUnderPoint(t,n,r,i,s);if(!r&&d)return i&&!this.mouseChildren?this:d}else{if(!s&&!h._hasMouseEventListener())continue;if(h.getConcatenatedMatrix(u),p&&(u.appendTransform(p.x,p.y,p.scaleX,p.scaleY,p.rotation,p.skewX,p.skewY,p.regX,p.regY),u.alpha=p.alpha),o.globalAlpha=u.alpha,o.setTransform(u.a,u.b,u.c,u.d,u.tx-t,u.ty-n),(p||h).draw(o),!this._testHit(o))continue;if(o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,2,2),!r)return i&&!this.mouseChildren?this:h;r.push(h)}}return null},t._getBounds=function(e,t){var n=this.DisplayObject_getBounds();if(n)return this._transformBounds(n,e,t);var r,i,s,o,u=t?this._matrix.identity():this.getMatrix(this._matrix);e&&u.prependMatrix(e);for(var a=this.children.length,f=0;a>f;f++){var l=this.children[f];if(l.visible&&(n=l._getBounds(u))){var c=n.x,h=n.y,p=c+n.width,d=h+n.height;(r>c||null==r)&&(r=c),(p>i||null==i)&&(i=p),(s>h||null==s)&&(s=h),(d>o||null==o)&&(o=d)}}return null==i?null:this._rectangle.initialize(r,s,i-r,o-s)},createjs.Container=e}(),this.createjs=this.createjs||{},function(){var e=function(e){this.initialize(e)},t=e.prototype=new createjs.Container;e._snapToPixelEnabled=!1,t.autoClear=!0,t.canvas=null,t.mouseX=0,t.mouseY=0,t.snapToPixelEnabled=!1,t.mouseInBounds=!1,t.tickOnUpdate=!0,t.mouseMoveOutside=!1,t.nextStage=null,t._pointerData=null,t._pointerCount=0,t._primaryPointerID=null,t._mouseOverIntervalID=null,t.Container_initialize=t.initialize,t.initialize=function(e){this.Container_initialize(),this.canvas="string"==typeof e?document.getElementById(e):e,this._pointerData={},this.enableDOMEvents(!0)},t.update=function(){if(this.canvas){this.tickOnUpdate&&(this.dispatchEvent("tickstart"),this.tickEnabled&&this._tick(arguments.length?arguments:null),this.dispatchEvent("tickend")),this.dispatchEvent("drawstart"),e._snapToPixelEnabled=this.snapToPixelEnabled,this.autoClear&&this.clear();var t=this.canvas.getContext("2d");t.save(),this.updateContext(t),this.draw(t,!1),t.restore(),this.dispatchEvent("drawend")}},t.handleEvent=function(e){"tick"==e.type&&this.update(e)},t.clear=function(){if(this.canvas){var e=this.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,this.canvas.width+1,this.canvas.height+1)}},t.toDataURL=function(e,t){t||(t="image/png");var n,r=this.canvas.getContext("2d"),i=this.canvas.width,s=this.canvas.height;if(e){n=r.getImageData(0,0,i,s);var o=r.globalCompositeOperation;r.globalCompositeOperation="destination-over",r.fillStyle=e,r.fillRect(0,0,i,s)}var u=this.canvas.toDataURL(t);return e&&(r.clearRect(0,0,i+1,s+1),r.putImageData(n,0,0),r.globalCompositeOperation=o),u},t.enableMouseOver=function(e){if(this._mouseOverIntervalID&&(clearInterval(this._mouseOverIntervalID),this._mouseOverIntervalID=null,0==e&&this._testMouseOver(!0)),null==e)e=20;else if(0>=e)return;var t=this;this._mouseOverIntervalID=setInterval(function(){t._testMouseOver()},1e3/Math.min(50,e))},t.enableDOMEvents=function(e){null==e&&(e=!0);var t,n,r=this._eventListeners;if(!e&&r){for(t in r)n=r[t],n.t.removeEventListener(t,n.f,!1);this._eventListeners=null}else if(e&&!r&&this.canvas){var i=window.addEventListener?window:document,s=this;r=this._eventListeners={},r.mouseup={t:i,f:function(e){s._handleMouseUp(e)}},r.mousemove={t:i,f:function(e){s._handleMouseMove(e)}},r.dblclick={t:this.canvas,f:function(e){s._handleDoubleClick(e)}},r.mousedown={t:this.canvas,f:function(e){s._handleMouseDown(e)}};for(t in r)n=r[t],n.t.addEventListener(t,n.f,!1)}},t.clone=function(){var t=new e(null);return this.cloneProps(t),t},t.toString=function(){return"[Stage (name="+this.name+")]"},t._getElementRect=function(e){var t;try{t=e.getBoundingClientRect()}catch(n){t={top:e.offsetTop,left:e.offsetLeft,width:e.offsetWidth,height:e.offsetHeight}}var r=(window.pageXOffset||document.scrollLeft||0)-(document.clientLeft||document.body.clientLeft||0),i=(window.pageYOffset||document.scrollTop||0)-(document.clientTop||document.body.clientTop||0),s=window.getComputedStyle?getComputedStyle(e):e.currentStyle,o=parseInt(s.paddingLeft)+parseInt(s.borderLeftWidth),u=parseInt(s.paddingTop)+parseInt(s.borderTopWidth),a=parseInt(s.paddingRight)+parseInt(s.borderRightWidth),f=parseInt(s.paddingBottom)+parseInt(s.borderBottomWidth);return{left:t.left+r+o,right:t.right+r-a,top:t.top+i+u,bottom:t.bottom+i-f}},t._getPointerData=function(e){var t=this._pointerData[e];return t||(t=this._pointerData[e]={x:0,y:0},null==this._primaryPointerID&&(this._primaryPointerID=e),(null==this._primaryPointerID||-1==this._primaryPointerID)&&(this._primaryPointerID=e)),t},t._handleMouseMove=function(e){e||(e=window.event),this._handlePointerMove(-1,e,e.pageX,e.pageY)},t._handlePointerMove=function(e,t,n,r){if(this.canvas){var i=this._getPointerData(e),s=i.inBounds;if(this._updatePointerPosition(e,t,n,r),s||i.inBounds||this.mouseMoveOutside){-1==e&&i.inBounds==!s&&this._dispatchMouseEvent(this,s?"mouseleave":"mouseenter",!1,e,i,t),this._dispatchMouseEvent(this,"stagemousemove",!1,e,i,t),this._dispatchMouseEvent(i.target,"pressmove",!0,e,i,t);var o=i.event;o&&o.hasEventListener("mousemove")&&o.dispatchEvent(new createjs.MouseEvent("mousemove",!1,!1,i.x,i.y,t,e,e==this._primaryPointerID,i.rawX,i.rawY),i.target),this.nextStage&&this.nextStage._handlePointerMove(e,t,n,r)}}},t._updatePointerPosition=function(e,t,n,r){var i=this._getElementRect(this.canvas);n-=i.left,r-=i.top;var s=this.canvas.width,o=this.canvas.height;n/=(i.right-i.left)/s,r/=(i.bottom-i.top)/o;var u=this._getPointerData(e);(u.inBounds=n>=0&&r>=0&&s-1>=n&&o-1>=r)?(u.x=n,u.y=r):this.mouseMoveOutside&&(u.x=0>n?0:n>s-1?s-1:n,u.y=0>r?0:r>o-1?o-1:r),u.posEvtObj=t,u.rawX=n,u.rawY=r,e==this._primaryPointerID&&(this.mouseX=u.x,this.mouseY=u.y,this.mouseInBounds=u.inBounds)},t._handleMouseUp=function(e){this._handlePointerUp(-1,e,!1)},t._handlePointerUp=function(e,t,n){var r=this._getPointerData(e);this._dispatchMouseEvent(this,"stagemouseup",!1,e,r,t);var i=r.target;i&&(this._getObjectsUnderPoint(r.x,r.y,null,!0)==i&&this._dispatchMouseEvent(i,"click",!0,e,r,t),this._dispatchMouseEvent(i,"pressup",!0,e,r,t));var s=r.event;s&&s.hasEventListener("mouseup")&&s.dispatchEvent(new createjs.MouseEvent("mouseup",!1,!1,r.x,r.y,t,e,e==this._primaryPointerID,r.rawX,r.rawY),i),n?(e==this._primaryPointerID&&(this._primaryPointerID=null),delete this._pointerData[e]):r.event=r.target=null,this.nextStage&&this.nextStage._handlePointerUp(e,t,n)},t._handleMouseDown=function(e){this._handlePointerDown(-1,e,e.pageX,e.pageY)},t._handlePointerDown=function(e,t,n,r){null!=r&&this._updatePointerPosition(e,t,n,r);var i=this._getPointerData(e);this._dispatchMouseEvent(this,"stagemousedown",!1,e,i,t),i.target=this._getObjectsUnderPoint(i.x,i.y,null,!0),i.event=this._dispatchMouseEvent(i.target,"mousedown",!0,e,i,t),this.nextStage&&this.nextStage._handlePointerDown(e,t,n,r)},t._testMouseOver=function(e){if(-1==this._primaryPointerID&&(e||this.mouseX!=this._mouseOverX||this.mouseY!=this._mouseOverY||!this.mouseInBounds)){var t,n,r,i,s=this._getPointerData(-1),o=s.posEvtObj,u=-1,a="";(e||this.mouseInBounds&&o&&o.target==this.canvas)&&(t=this._getObjectsUnderPoint(this.mouseX,this.mouseY,null,!0),this._mouseOverX=this.mouseX,this._mouseOverY=this.mouseY);var f=this._mouseOverTarget||[],l=f[f.length-1],c=this._mouseOverTarget=[];for(n=t;n;)c.unshift(n),null!=n.cursor&&(a=n.cursor),n=n.parent;for(this.canvas.style.cursor=a,r=0,i=c.length;i>r&&c[r]==f[r];r++)u=r;for(l!=t&&this._dispatchMouseEvent(l,"mouseout",!0,-1,s,o),r=f.length-1;r>u;r--)this._dispatchMouseEvent(f[r],"rollout",!1,-1,s,o);for(r=c.length-1;r>u;r--)this._dispatchMouseEvent(c[r],"rollover",!1,-1,s,o);l!=t&&this._dispatchMouseEvent(t,"mouseover",!0,-1,s,o)}},t._handleDoubleClick=function(e){var t=this._getPointerData(-1),n=this._getObjectsUnderPoint(t.x,t.y,null,!0);this._dispatchMouseEvent(n,"dblclick",!0,-1,t,e),this.nextStage&&this.nextStage._handleDoubleClick(e)},t._dispatchMouseEvent=function(e,t,n,r,i,s){if(e&&(n||e.hasEventListener(t))){var o=new createjs.MouseEvent(t,n,!1,i.x,i.y,s,r,r==this._primaryPointerID,i.rawX,i.rawY);return e.dispatchEvent(o),o}},createjs.Stage=e}(),this.createjs=this.createjs||{},function(){var e=function(e){this.initialize(e)},t=e.prototype=new createjs.DisplayObject;t.image=null,t.snapToPixel=!0,t.sourceRect=null,t.DisplayObject_initialize=t.initialize,t.initialize=function(e){this.DisplayObject_initialize(),"string"==typeof e?(this.image=document.createElement("img"),this.image.src=e):this.image=e},t.isVisible=function(){var e=this.cacheCanvas||this.image&&(this.image.complete||this.image.getContext||this.image.readyState>=2);return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&e)},t.DisplayObject_draw=t.draw,t.draw=function(e,t){if(this.DisplayObject_draw(e,t))return!0;var n=this.sourceRect;return n?e.drawImage(this.image,n.x,n.y,n.width,n.height,0,0,n.width,n.height):e.drawImage(this.image,0,0),!0},t.DisplayObject_getBounds=t.getBounds,t.getBounds=function(){var e=this.DisplayObject_getBounds();if(e)return e;var t=this.sourceRect||this.image,n=this.image&&(this.image.complete||this.image.getContext||this.image.readyState>=2);return n?this._rectangle.initialize(0,0,t.width,t.height):null},t.clone=function(){var t=new e(this.image);return this.sourceRect&&(t.sourceRect=this.sourceRect.clone()),this.cloneProps(t),t},t.toString=function(){return"[Bitmap (name="+this.name+")]"},createjs.Bitmap=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t){this.initialize(e,t)},t=e.prototype=new createjs.DisplayObject;t.currentFrame=0,t.currentAnimation=null,t.paused=!0,t.spriteSheet=null,t.snapToPixel=!0,t.offset=0,t.currentAnimationFrame=0,t.framerate=0,t._advanceCount=0,t._animation=null,t._currentFrame=null,t.DisplayObject_initialize=t.initialize,t.initialize=function(e,t){this.DisplayObject_initialize(),this.spriteSheet=e,t&&this.gotoAndPlay(t)},t.isVisible=function(){var e=this.cacheCanvas||this.spriteSheet.complete;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&e)},t.DisplayObject_draw=t.draw,t.draw=function(e,t){if(this.DisplayObject_draw(e,t))return!0;this._normalizeFrame();var n=this.spriteSheet.getFrame(0|this._currentFrame);if(!n)return!1;var r=n.rect;return e.drawImage(n.image,r.x,r.y,r.width,r.height,-n.regX,-n.regY,r.width,r.height),!0},t.play=function(){this.paused=!1},t.stop=function(){this.paused=!0},t.gotoAndPlay=function(e){this.paused=!1,this._goto(e)},t.gotoAndStop=function(e){this.paused=!0,this._goto(e)},t.advance=function(e){var t=this._animation&&this._animation.speed||1,n=this.framerate||this.spriteSheet.framerate,r=n&&null!=e?e/(1e3/n):1;this._animation?this.currentAnimationFrame+=r*t:this._currentFrame+=r*t,this._normalizeFrame()},t.DisplayObject_getBounds=t.getBounds,t.getBounds=function(){return this.DisplayObject_getBounds()||this.spriteSheet.getFrameBounds(this.currentFrame,this._rectangle)},t.clone=function(){var t=new e(this.spriteSheet);return this.cloneProps(t),t},t.toString=function(){return"[Sprite (name="+this.name+")]"},t.DisplayObject__tick=t._tick,t._tick=function(e){this.paused||this.advance(e&&e[0]&&e[0].delta),this.DisplayObject__tick(e)},t._normalizeFrame=function(){var e,t=this._animation,n=this.paused,r=this._currentFrame,i=this.currentAnimationFrame;if(t)if(e=t.frames.length,(0|i)>=e){var s=t.next;if(!this._dispatchAnimationEnd(t,r,n,s,e-1)){if(s)return this._goto(s,i-e);this.paused=!0,i=this.currentAnimationFrame=t.frames.length-1,this._currentFrame=t.frames[i]}}else this._currentFrame=t.frames[0|i];else if(e=this.spriteSheet.getNumFrames(),r>=e&&!this._dispatchAnimationEnd(t,r,n,e-1)&&(this._currentFrame-=e)>=e)return this._normalizeFrame();this.currentFrame=0|this._currentFrame},t._dispatchAnimationEnd=function(e,t,n,r,i){var s=e?e.name:null;if(this.hasEventListener("animationend")){var o=new createjs.Event("animationend");o.name=s,o.next=r,this.dispatchEvent(o)}var u=this._animation!=e||this._currentFrame!=t;return u||n||!this.paused||(this.currentAnimationFrame=i,u=!0),u},t.DisplayObject_cloneProps=t.cloneProps,t.cloneProps=function(e){this.DisplayObject_cloneProps(e),e.currentFrame=this.currentFrame,e._currentFrame=this._currentFrame,e.currentAnimation=this.currentAnimation,e.paused=this.paused,e._animation=this._animation,e.currentAnimationFrame=this.currentAnimationFrame,e.framerate=this.framerate},t._goto=function(e,t){if(isNaN(e)){var n=this.spriteSheet.getAnimation(e);n&&(this.currentAnimationFrame=t||0,this._animation=n,this.currentAnimation=e,this._normalizeFrame())}else this.currentAnimationFrame=0,this.currentAnimation=this._animation=null,this._currentFrame=e,this._normalizeFrame()},createjs.Sprite=e}(),this.createjs=this.createjs||{},function(){var e="BitmapAnimation is deprecated in favour of Sprite. See VERSIONS file for info on changes.";if(!createjs.Sprite)throw e;(createjs.BitmapAnimation=function(t){console.log(e),this.initialize(t)}).prototype=new createjs.Sprite}(),this.createjs=this.createjs||{},function(){var e=function(e){this.initialize(e)},t=e.prototype=new createjs.DisplayObject;t.graphics=null,t.DisplayObject_initialize=t.initialize,t.initialize=function(e){this.DisplayObject_initialize(),this.graphics=e?e:new createjs.Graphics},t.isVisible=function(){var e=this.cacheCanvas||this.graphics&&!this.graphics.isEmpty();return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&e)},t.DisplayObject_draw=t.draw,t.draw=function(e,t){return this.DisplayObject_draw(e,t)?!0:(this.graphics.draw(e),!0)},t.clone=function(t){var n=new e(t&&this.graphics?this.graphics.clone():this.graphics);return this.cloneProps(n),n},t.toString=function(){return"[Shape (name="+this.name+")]"},createjs.Shape=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n){this.initialize(e,t,n)},t=e.prototype=new createjs.DisplayObject,n=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");n.getContext&&(e._workingContext=n.getContext("2d"),n.width=n.height=1),e.H_OFFSETS={start:0,left:0,center:-0.5,end:-1,right:-1},e.V_OFFSETS={top:0,hanging:-0.01,middle:-0.4,alphabetic:-0.8,ideographic:-0.85,bottom:-1},t.text="",t.font=null,t.color=null,t.textAlign="left",t.textBaseline="top",t.maxWidth=null,t.outline=0,t.lineHeight=0,t.lineWidth=null,t.DisplayObject_initialize=t.initialize,t.initialize=function(e,t,n){this.DisplayObject_initialize(),this.text=e,this.font=t,this.color=n},t.isVisible=function(){var e=this.cacheCanvas||null!=this.text&&""!==this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&e)},t.DisplayObject_draw=t.draw,t.draw=function(e,t){if(this.DisplayObject_draw(e,t))return!0;var n=this.color||"#000";return this.outline?(e.strokeStyle=n,e.lineWidth=1*this.outline):e.fillStyle=n,this._drawText(this._prepContext(e)),!0},t.getMeasuredWidth=function(){return this._prepContext(e._workingContext).measureText(this.text).width},t.getMeasuredLineHeight=function(){return 1.2*this._prepContext(e._workingContext).measureText("M").width},t.getMeasuredHeight=function(){return this._drawText(null,{}).height},t.DisplayObject_getBounds=t.getBounds,t.getBounds=function(){var t=this.DisplayObject_getBounds();if(t)return t;if(null==this.text||""==this.text)return null;var n=this._drawText(null,{}),r=this.maxWidth&&this.maxWidth<n.width?this.maxWidth:n.width,i=r*e.H_OFFSETS[this.textAlign||"left"],s=this.lineHeight||this.getMeasuredLineHeight(),o=s*e.V_OFFSETS[this.textBaseline||"top"];return this._rectangle.initialize(i,o,r,n.height)},t.clone=function(){var t=new e(this.text,this.font,this.color);return this.cloneProps(t),t},t.toString=function(){return"[Text (text="+(this.text.length>20?this.text.substr(0,17)+"...":this.text)+")]"},t.DisplayObject_cloneProps=t.cloneProps,t.cloneProps=function(e){this.DisplayObject_cloneProps(e),e.textAlign=this.textAlign,e.textBaseline=this.textBaseline,e.maxWidth=this.maxWidth,e.outline=this.outline,e.lineHeight=this.lineHeight,e.lineWidth=this.lineWidth},t._prepContext=function(e){return e.font=this.font,e.textAlign=this.textAlign||"left",e.textBaseline=this.textBaseline||"top",e},t._drawText=function(t,n){var r=!!t;r||(t=this._prepContext(e._workingContext));for(var i=this.lineHeight||this.getMeasuredLineHeight(),s=0,o=0,u=String(this.text).split(/(?:\r\n|\r|\n)/),f=0,l=u.length;l>f;f++){var c=u[f],h=null;if(null!=this.lineWidth&&(h=t.measureText(c).width)>this.lineWidth){var p=c.split(/(\s)/);c=p[0],h=t.measureText(c).width;for(var d=1,v=p.length;v>d;d+=2){var m=t.measureText(p[d]+p[d+1]).width;h+m>this.lineWidth?(r&&this._drawTextLine(t,c,o*i),h>s&&(s=h),c=p[d+1],h=t.measureText(c).width,o++):(c+=p[d]+p[d+1],h+=m)}}r&&this._drawTextLine(t,c,o*i),n&&null==h&&(h=t.measureText(c).width),h>s&&(s=h),o++}return n&&(n.count=o,n.width=s,n.height=o*i),n},t._drawTextLine=function(e,t,n){this.outline?e.strokeText(t,0,n,this.maxWidth||65535):e.fillText(t,0,n,this.maxWidth||65535)},createjs.Text=e}(),this.createjs=this.createjs||{},function(){function e(e,t){this.initialize(e,t)}var t=e.prototype=new createjs.DisplayObject;t.text="",t.spriteSheet=null,t.lineHeight=0,t.letterSpacing=0,t.spaceWidth=0,t.DisplayObject_initialize=t.initialize,t.initialize=function(e,t){this.DisplayObject_initialize(),this.text=e,this.spriteSheet=t},t.DisplayObject_draw=t.draw,t.draw=function(e,t){return this.DisplayObject_draw(e,t)?!0:(this._drawText(e),void 0)},t.isVisible=function(){var e=this.cacheCanvas||this.spriteSheet&&this.spriteSheet.complete&&this.text;return!!(this.visible&&this.alpha>0&&0!=this.scaleX&&0!=this.scaleY&&e)},t.getBounds=function(){var e=this._rectangle;return this._drawText(null,e),e.width?e:null},t._getFrame=function(e,t){var n,r=t.getAnimation(e);return r||(e!=(n=e.toUpperCase())||e!=(n=e.toLowerCase())||(n=null),n&&(r=t.getAnimation(n))),r&&t.getFrame(r.frames[0])},t._getLineHeight=function(e){var t=this._getFrame("1",e)||this._getFrame("T",e)||this._getFrame("L",e)||e.getFrame(0);return t?t.rect.height:1},t._getSpaceWidth=function(e){var t=this._getFrame("1",e)||this._getFrame("l",e)||this._getFrame("e",e)||this._getFrame("a",e)||e.getFrame(0);return t?t.rect.width:1},t._drawText=function(e,t){var n,r,i,s=0,o=0,u=this.spaceWidth,a=this.lineHeight,f=this.spriteSheet,l=!!this._getFrame(" ",f);l||0!=u||(u=this._getSpaceWidth(f)),0==a&&(a=this._getLineHeight(f));for(var c=0,h=0,p=this.text.length;p>h;h++){var d=this.text.charAt(h);if(l||" "!=d)if("\n"!=d&&"\r"!=d){var v=this._getFrame(d,f);if(v){var m=v.rect;i=v.regX,n=m.width,e&&e.drawImage(v.image,m.x,m.y,n,r=m.height,s-i,o-v.regY,n,r),s+=n+this.letterSpacing}}else"\r"==d&&"\n"==this.text.charAt(h+1)&&h++,s-i>c&&(c=s-i),s=0,o+=a;else s+=u}s-i>c&&(c=s-i),t&&(t.width=c-this.letterSpacing,t.height=o+a)},createjs.BitmapText=e}(),this.createjs=this.createjs||{},function(){var e=function(){throw"SpriteSheetUtils cannot be instantiated"},t=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");t.getContext&&(e._workingCanvas=t,e._workingContext=t.getContext("2d"),t.width=t.height=1),e.addFlippedFrames=function(t,n,r,i){if(n||r||i){var s=0;n&&e._flip(t,++s,!0,!1),r&&e._flip(t,++s,!1,!0),i&&e._flip(t,++s,!0,!0)}},e.extractFrame=function(t,n){isNaN(n)&&(n=t.getAnimation(n).frames[0]);var r=t.getFrame(n);if(!r)return null;var i=r.rect,s=e._workingCanvas;s.width=i.width,s.height=i.height,e._workingContext.drawImage(r.image,i.x,i.y,i.width,i.height,0,0,i.width,i.height);var o=document.createElement("img");return o.src=s.toDataURL("image/png"),o},e.mergeAlpha=function(e,t,n){n||(n=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas")),n.width=Math.max(t.width,e.width),n.height=Math.max(t.height,e.height);var r=n.getContext("2d");return r.save(),r.drawImage(e,0,0),r.globalCompositeOperation="destination-in",r.drawImage(t,0,0),r.restore(),n},e._flip=function(t,n,r,i){for(var s=t._images,o=e._workingCanvas,u=e._workingContext,f=s.length/n,l=0;f>l;l++){var c=s[l];c.__tmp=l,u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,o.width+1,o.height+1),o.width=c.width,o.height=c.height,u.setTransform(r?-1:1,0,0,i?-1:1,r?c.width:0,i?c.height:0),u.drawImage(c,0,0);var h=document.createElement("img");h.src=o.toDataURL("image/png"),h.width=c.width,h.height=c.height,s.push(h)}var p=t._frames,d=p.length/n;for(l=0;d>l;l++){c=p[l];var v=c.rect.clone();h=s[c.image.__tmp+f*n];var m={image:h,rect:v,regX:c.regX,regY:c.regY};r&&(v.x=h.width-v.x-v.width,m.regX=v.width-c.regX),i&&(v.y=h.height-v.y-v.height,m.regY=v.height-c.regY),p.push(m)}var g="_"+(r?"h":"")+(i?"v":""),y=t._animations,b=t._data,w=y.length/n;for(l=0;w>l;l++){var E=y[l];c=b[E];var S={name:E+g,speed:c.speed,next:c.next,frames:[]};c.next&&(S.next+=g),p=c.frames;for(var x=0,T=p.length;T>x;x++)S.frames.push(p[x]+d*n);b[S.name]=S,y.push(S.name)}},createjs.SpriteSheetUtils=e}(),this.createjs=this.createjs||{},function(){var e=function(){this.initialize()},t=e.prototype=new createjs.EventDispatcher;e.ERR_DIMENSIONS="frame dimensions exceed max spritesheet dimensions",e.ERR_RUNNING="a build is already running",t.maxWidth=2048,t.maxHeight=2048,t.spriteSheet=null,t.scale=1,t.padding=1,t.timeSlice=.3,t.progress=-1,t._frames=null,t._animations=null,t._data=null,t._nextFrameIndex=0,t._index=0,t._timerID=null,t._scale=1,t.initialize=function(){this._frames=[],this._animations={}},t.addFrame=function(t,n,r,i,s,o){if(this._data)throw e.ERR_RUNNING;var u=n||t.bounds||t.nominalBounds;return!u&&t.getBounds&&(u=t.getBounds()),u?(r=r||1,this._frames.push({source:t,sourceRect:u,scale:r,funct:i,params:s,scope:o,index:this._frames.length,height:u.height*r})-1):null},t.addAnimation=function(t,n,r,i){if(this._data)throw e.ERR_RUNNING;this._animations[t]={frames:n,next:r,frequency:i}},t.addMovieClip=function(t,n,r){if(this._data)throw e.ERR_RUNNING;var i=t.frameBounds,s=n||t.bounds||t.nominalBounds;if(!s&&t.getBounds&&(s=t.getBounds()),!s&&!i)return null;for(var o=this._frames.length,u=t.timeline.duration,f=0;u>f;f++){var l=i&&i[f]?i[f]:s;this.addFrame(t,l,r,function(e){var t=this.actionsEnabled;this.actionsEnabled=!1,this.gotoAndStop(e),this.actionsEnabled=t},[f],t)}var c=t.timeline._labels,h=[];for(var p in c)h.push({index:c[p],label:p});if(h.length){h.sort(function(e,t){return e.index-t.index});for(var f=0,d=h.length;d>f;f++){for(var v=h[f].label,m=o+h[f].index,g=o+(f==d-1?u:h[f+1].index),y=[],b=m;g>b;b++)y.push(b);this.addAnimation(v,y,!0)}}},t.build=function(){if(this._data)throw e.ERR_RUNNING;for(this._startBuild();this._drawNext(););return this._endBuild(),this.spriteSheet},t.buildAsync=function(t){if(this._data)throw e.ERR_RUNNING;this.timeSlice=t,this._startBuild();var n=this;this._timerID=setTimeout(function(){n._run()},50-50*Math.max(.01,Math.min(.99,this.timeSlice||.3)))},t.stopAsync=function(){clearTimeout(this._timerID),this._data=null},t.clone=function(){throw"SpriteSheetBuilder cannot be cloned."},t.toString=function(){return"[SpriteSheetBuilder]"},t._startBuild=function(){var t=this.padding||0;this.progress=0,this.spriteSheet=null,this._index=0,this._scale=this.scale;var n=[];this._data={images:[],frames:n,animations:this._animations};var r=this._frames.slice();if(r.sort(function(e,t){return e.height<=t.height?-1:1}),r[r.length-1].height+2*t>this.maxHeight)throw e.ERR_DIMENSIONS;for(var i=0,s=0,o=0;r.length;){var u=this._fillRow(r,i,o,n,t);if(u.w>s&&(s=u.w),i+=u.h,!u.h||!r.length){var f=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas");f.width=this._getSize(s,this.maxWidth),f.height=this._getSize(i,this.maxHeight),this._data.images[o]=f,u.h||(s=i=0,o++)}}},t._getSize=function(e,t){for(var n=4;Math.pow(2,++n)<e;);return Math.min(t,Math.pow(2,n))},t._fillRow=function(t,n,r,i,s){var o=this.maxWidth,u=this.maxHeight;n+=s;for(var f=u-n,l=s,c=0,h=t.length-1;h>=0;h--){var p=t[h],d=this._scale*p.scale,v=p.sourceRect,m=p.source,g=Math.floor(d*v.x-s),y=Math.floor(d*v.y-s),b=Math.ceil(d*v.height+2*s),w=Math.ceil(d*v.width+2*s);if(w>o)throw e.ERR_DIMENSIONS;b>f||l+w>o||(p.img=r,p.rect=new createjs.Rectangle(l,n,w,b),c=c||b,t.splice(h,1),i[p.index]=[l,n,w,b,r,Math.round(-g+d*m.regX-s),Math.round(-y+d*m.regY-s)],l+=w)}return{w:l,h:c}},t._endBuild=function(){this.spriteSheet=new createjs.SpriteSheet(this._data),this._data=null,this.progress=1,this.dispatchEvent("complete")},t._run=function(){for(var e=50*Math.max(.01,Math.min(.99,this.timeSlice||.3)),t=(new Date).getTime()+e,n=!1;t>(new Date).getTime();)if(!this._drawNext()){n=!0;break}if(n)this._endBuild();else{var r=this;this._timerID=setTimeout(function(){r._run()},50-e)}var i=this.progress=this._index/this._frames.length;if(this.hasEventListener("progress")){var s=new createjs.Event("progress");s.progress=i,this.dispatchEvent(s)}},t._drawNext=function(){var e=this._frames[this._index],t=e.scale*this._scale,n=e.rect,r=e.sourceRect,i=this._data.images[e.img],s=i.getContext("2d");return e.funct&&e.funct.apply(e.scope,e.params),s.save(),s.beginPath(),s.rect(n.x,n.y,n.width,n.height),s.clip(),s.translate(Math.ceil(n.x-r.x*t),Math.ceil(n.y-r.y*t)),s.scale(t,t),e.source.draw(s),s.restore(),++this._index<this._frames.length},createjs.SpriteSheetBuilder=e}(),this.createjs=this.createjs||{},function(){var e=function(e){this.initialize(e)},t=e.prototype=new createjs.DisplayObject;t.htmlElement=null,t._oldMtx=null,t._visible=!1,t.DisplayObject_initialize=t.initialize,t.initialize=function(e){"string"==typeof e&&(e=document.getElementById(e)),this.DisplayObject_initialize(),this.mouseEnabled=!1,this.htmlElement=e;var t=e.style;t.position="absolute",t.transformOrigin=t.WebkitTransformOrigin=t.msTransformOrigin=t.MozTransformOrigin=t.OTransformOrigin="0% 0%"},t.isVisible=function(){return null!=this.htmlElement},t.draw=function(){return this.visible&&(this._visible=!0),!0},t.cache=function(){},t.uncache=function(){},t.updateCache=function(){},t.hitTest=function(){},t.localToGlobal=function(){},t.globalToLocal=function(){},t.localToLocal=function(){},t.clone=function(){throw"DOMElement cannot be cloned."},t.toString=function(){return"[DOMElement (name="+this.name+")]"},t.DisplayObject__tick=t._tick,t._tick=function(e){var t=this.getStage();this._visible=!1,t&&t.on("drawend",this._handleDrawEnd,this,!0),this.DisplayObject__tick(e)},t._handleDrawEnd=function(){var e=this.htmlElement;if(e){var t=e.style,n=this._visible?"visible":"hidden";if(n!=t.visibility&&(t.visibility=n),this._visible){var r=this.getConcatenatedMatrix(this._matrix),i=this._oldMtx,s=1e4;if(i&&i.alpha==r.alpha||(t.opacity=""+(0|r.alpha*s)/s,i&&(i.alpha=r.alpha)),!i||i.tx!=r.tx||i.ty!=r.ty||i.a!=r.a||i.b!=r.b||i.c!=r.c||i.d!=r.d){var o="matrix("+(0|r.a*s)/s+","+(0|r.b*s)/s+","+(0|r.c*s)/s+","+(0|r.d*s)/s+","+(0|r.tx+.5);t.transform=t.WebkitTransform=t.OTransform=t.msTransform=o+","+(0|r.ty+.5)+")",t.MozTransform=o+"px,"+(0|r.ty+.5)+"px)",this._oldMtx=i?i.copy(r):r.clone()}}}},createjs.DOMElement=e}(),this.createjs=this.createjs||{},function(){var e=function(){this.initialize()},t=e.prototype;t.initialize=function(){},t.getBounds=function(){return null},t.applyFilter=function(){},t.toString=function(){return"[Filter]"},t.clone=function(){return new e},createjs.Filter=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n){this.initialize(e,t,n)},t=e.prototype=new createjs.Filter;t.initialize=function(e,t,n){(isNaN(e)||0>e)&&(e=0),this.blurX=0|e,(isNaN(t)||0>t)&&(t=0),this.blurY=0|t,(isNaN(n)||1>n)&&(n=1),this.quality=0|n},t.blurX=0,t.blurY=0,t.quality=1,t.mul_table=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265,497,469,443,421,25,191,365,349,335,161,155,149,9,278,269,261,505,245,475,231,449,437,213,415,405,395,193,377,369,361,353,345,169,331,325,319,313,307,301,37,145,285,281,69,271,267,263,259,509,501,493,243,479,118,465,459,113,446,55,435,429,423,209,413,51,403,199,393,97,3,379,375,371,367,363,359,355,351,347,43,85,337,333,165,327,323,5,317,157,311,77,305,303,75,297,294,73,289,287,71,141,279,277,275,68,135,67,133,33,262,260,129,511,507,503,499,495,491,61,121,481,477,237,235,467,232,115,457,227,451,7,445,221,439,218,433,215,427,425,211,419,417,207,411,409,203,202,401,399,396,197,49,389,387,385,383,95,189,47,187,93,185,23,183,91,181,45,179,89,177,11,175,87,173,345,343,341,339,337,21,167,83,331,329,327,163,81,323,321,319,159,79,315,313,39,155,309,307,153,305,303,151,75,299,149,37,295,147,73,291,145,289,287,143,285,71,141,281,35,279,139,69,275,137,273,17,271,135,269,267,133,265,33,263,131,261,130,259,129,257,1],t.shg_table=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13,14,14,14,14,10,13,14,14,14,13,13,13,9,14,14,14,15,14,15,14,15,15,14,15,15,15,14,15,15,15,15,15,14,15,15,15,15,15,15,12,14,15,15,13,15,15,15,15,16,16,16,15,16,14,16,16,14,16,13,16,16,16,15,16,13,16,15,16,14,9,16,16,16,16,16,16,16,16,16,13,14,16,16,15,16,16,10,16,15,16,14,16,16,14,16,16,14,16,16,14,15,16,16,16,14,15,14,15,13,16,16,15,17,17,17,17,17,17,14,15,17,17,16,16,17,16,15,17,16,17,11,17,16,17,16,17,16,17,17,16,17,17,16,17,17,16,16,17,17,17,16,14,17,17,17,17,15,16,14,16,15,16,13,16,15,16,14,16,15,16,12,16,15,16,17,17,17,17,17,13,16,15,17,17,17,16,15,17,17,17,16,15,17,17,14,16,17,17,16,17,17,16,15,17,16,14,17,16,15,17,16,17,17,16,17,15,16,17,14,17,16,15,17,16,17,13,17,16,17,17,16,17,14,17,16,17,16,17,16,17,9],t.getBounds=function(){var e=.5*Math.pow(this.quality,.6);return new createjs.Rectangle(-this.blurX*e,-this.blurY*e,2*this.blurX*e,2*this.blurY*e)},t.applyFilter=function(e,t,n,r,i,s,o,u){s=s||e,null==o&&(o=t),null==u&&(u=n);try{var a=e.getImageData(t,n,r,i)}catch(f){return!1}var l=this.blurX/2;if(isNaN(l)||0>l)return!1;l|=0;var c=this.blurY/2;if(isNaN(c)||0>c)return!1;if(c|=0,0==l&&0==c)return!1;var h=this.quality;(isNaN(h)||1>h)&&(h=1),h|=0,h>3&&(h=3),1>h&&(h=1);var t,n,p,d,v,m,g,y,b,w,E,S,x,T,N,C=a.data,k=l+l+1,L=c+c+1,A=r-1,O=i-1,M=l+1,_=c+1,D={r:0,b:0,g:0,a:0,next:null},P=D;for(p=1;k>p;p++)P=P.next={r:0,b:0,g:0,a:0,next:null};P.next=D;var H={r:0,b:0,g:0,a:0,next:null},B=H;for(p=1;L>p;p++)B=B.next={r:0,b:0,g:0,a:0,next:null};B.next=H;for(var j=null;h-->0;){g=m=0;var F=this.mul_table[l],I=this.shg_table[l];for(n=i;--n>-1;){for(y=M*(S=C[m]),b=M*(x=C[m+1]),w=M*(T=C[m+2]),E=M*(N=C[m+3]),P=D,p=M;--p>-1;)P.r=S,P.g=x,P.b=T,P.a=N,P=P.next;for(p=1;M>p;p++)d=m+((p>A?A:p)<<2),y+=P.r=C[d],b+=P.g=C[d+1],w+=P.b=C[d+2],E+=P.a=C[d+3],P=P.next;for(j=D,t=0;r>t;t++)C[m++]=y*F>>>I,C[m++]=b*F>>>I,C[m++]=w*F>>>I,C[m++]=E*F>>>I,d=g+((d=t+l+1)<A?d:A)<<2,y-=j.r-(j.r=C[d]),b-=j.g-(j.g=C[d+1]),w-=j.b-(j.b=C[d+2]),E-=j.a-(j.a=C[d+3]),j=j.next;g+=r}for(F=this.mul_table[c],I=this.shg_table[c],t=0;r>t;t++){for(m=t<<2,y=_*(S=C[m]),b=_*(x=C[m+1]),w=_*(T=C[m+2]),E=_*(N=C[m+3]),B=H,p=0;_>p;p++)B.r=S,B.g=x,B.b=T,B.a=N,B=B.next;for(v=r,p=1;c>=p;p++)m=v+t<<2,y+=B.r=C[m],b+=B.g=C[m+1],w+=B.b=C[m+2],E+=B.a=C[m+3],B=B.next,O>p&&(v+=r);if(m=t,j=H,h>0)for(n=0;i>n;n++)d=m<<2,C[d+3]=N=E*F>>>I,N>0?(C[d]=y*F>>>I,C[d+1]=b*F>>>I,C[d+2]=w*F>>>I):C[d]=C[d+1]=C[d+2]=0,d=t+((d=n+_)<O?d:O)*r<<2,y-=j.r-(j.r=C[d]),b-=j.g-(j.g=C[d+1]),w-=j.b-(j.b=C[d+2]),E-=j.a-(j.a=C[d+3]),j=j.next,m+=r;else for(n=0;i>n;n++)d=m<<2,C[d+3]=N=E*F>>>I,N>0?(N=255/N,C[d]=(y*F>>>I)*N,C[d+1]=(b*F>>>I)*N,C[d+2]=(w*F>>>I)*N):C[d]=C[d+1]=C[d+2]=0,d=t+((d=n+_)<O?d:O)*r<<2,y-=j.r-(j.r=C[d]),b-=j.g-(j.g=C[d+1]),w-=j.b-(j.b=C[d+2]),E-=j.a-(j.a=C[d+3]),j=j.next,m+=r}}return s.putImageData(a,o,u),!0},t.clone=function(){return new e(this.blurX,this.blurY,this.quality)},t.toString=function(){return"[BlurFilter]"},createjs.BlurFilter=e}(),this.createjs=this.createjs||{},function(){var e=function(e){this.initialize(e)},t=e.prototype=new createjs.Filter;t.initialize=function(e){this.alphaMap=e},t.alphaMap=null,t._alphaMap=null,t._mapData=null,t.applyFilter=function(e,t,n,r,i,s,o,u){if(!this.alphaMap)return!0;if(!this._prepAlphaMap())return!1;s=s||e,null==o&&(o=t),null==u&&(u=n);try{var a=e.getImageData(t,n,r,i)}catch(f){return!1}for(var l=a.data,c=this._mapData,h=l.length,p=0;h>p;p+=4)l[p+3]=c[p]||0;return s.putImageData(a,o,u),!0},t.clone=function(){return new e(this.alphaMap)},t.toString=function(){return"[AlphaMapFilter]"},t._prepAlphaMap=function(){if(!this.alphaMap)return!1;if(this.alphaMap==this._alphaMap&&this._mapData)return!0;this._mapData=null;var e,t=this._alphaMap=this.alphaMap,n=t;t instanceof HTMLCanvasElement?e=n.getContext("2d"):(n=createjs.createCanvas?createjs.createCanvas():document.createElement("canvas"),n.width=t.width,n.height=t.height,e=n.getContext("2d"),e.drawImage(t,0,0));try{var r=e.getImageData(0,0,t.width,t.height)}catch(i){return!1}return this._mapData=r.data,!0},createjs.AlphaMapFilter=e}(),this.createjs=this.createjs||{},function(){var e=function(e){this.initialize(e)},t=e.prototype=new createjs.Filter;t.initialize=function(e){this.mask=e},t.mask=null,t.applyFilter=function(e,t,n,r,i,s,o,u){return this.mask?(s=s||e,null==o&&(o=t),null==u&&(u=n),s.save(),s.globalCompositeOperation="destination-in",s.drawImage(this.mask,o,u),s.restore(),!0):!0},t.clone=function(){return new e(this.mask)},t.toString=function(){return"[AlphaMaskFilter]"},createjs.AlphaMaskFilter=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n,r,i,s,o,u){this.initialize(e,t,n,r,i,s,o,u)},t=e.prototype=new createjs.Filter;t.redMultiplier=1,t.greenMultiplier=1,t.blueMultiplier=1,t.alphaMultiplier=1,t.redOffset=0,t.greenOffset=0,t.blueOffset=0,t.alphaOffset=0,t.initialize=function(e,t,n,r,i,s,o,u){this.redMultiplier=null!=e?e:1,this.greenMultiplier=null!=t?t:1,this.blueMultiplier=null!=n?n:1,this.alphaMultiplier=null!=r?r:1,this.redOffset=i||0,this.greenOffset=s||0,this.blueOffset=o||0,this.alphaOffset=u||0},t.applyFilter=function(e,t,n,r,i,s,o,u){s=s||e,null==o&&(o=t),null==u&&(u=n);try{var a=e.getImageData(t,n,r,i)}catch(f){return!1}for(var l=a.data,c=l.length,h=0;c>h;h+=4)l[h]=l[h]*this.redMultiplier+this.redOffset,l[h+1]=l[h+1]*this.greenMultiplier+this.greenOffset,l[h+2]=l[h+2]*this.blueMultiplier+this.blueOffset,l[h+3]=l[h+3]*this.alphaMultiplier+this.alphaOffset;return s.putImageData(a,o,u),!0},t.toString=function(){return"[ColorFilter]"},t.clone=function(){return new e(this.redMultiplier,this.greenMultiplier,this.blueMultiplier,this.alphaMultiplier,this.redOffset,this.greenOffset,this.blueOffset,this.alphaOffset)},createjs.ColorFilter=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n,r){this.initialize(e,t,n,r)},t=e.prototype;e.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10],e.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],e.LENGTH=e.IDENTITY_MATRIX.length,t.initialize=function(e,t,n,r){return this.reset(),this.adjustColor(e,t,n,r),this},t.reset=function(){return this.copyMatrix(e.IDENTITY_MATRIX)},t.adjustColor=function(e,t,n,r){return this.adjustHue(r),this.adjustContrast(t),this.adjustBrightness(e),this.adjustSaturation(n)},t.adjustBrightness=function(e){return 0==e||isNaN(e)?this:(e=this._cleanValue(e,255),this._multiplyMatrix([1,0,0,0,e,0,1,0,0,e,0,0,1,0,e,0,0,0,1,0,0,0,0,0,1]),this)},t.adjustContrast=function(t){if(0==t||isNaN(t))return this;t=this._cleanValue(t,100);var n;return 0>t?n=127+127*(t/100):(n=t%1,n=0==n?e.DELTA_INDEX[t]:e.DELTA_INDEX[t<<0]*(1-n)+e.DELTA_INDEX[(t<<0)+1]*n,n=127*n+127),this._multiplyMatrix([n/127,0,0,0,.5*(127-n),0,n/127,0,0,.5*(127-n),0,0,n/127,0,.5*(127-n),0,0,0,1,0,0,0,0,0,1]),this},t.adjustSaturation=function(e){if(0==e||isNaN(e))return this;e=this._cleanValue(e,100);var t=1+(e>0?3*e/100:e/100),n=.3086,r=.6094,i=.082;return this._multiplyMatrix([n*(1-t)+t,r*(1-t),i*(1-t),0,0,n*(1-t),r*(1-t)+t,i*(1-t),0,0,n*(1-t),r*(1-t),i*(1-t)+t,0,0,0,0,0,1,0,0,0,0,0,1]),this},t.adjustHue=function(e){if(0==e||isNaN(e))return this;e=this._cleanValue(e,180)/180*Math.PI;var t=Math.cos(e),n=Math.sin(e),r=.213,i=.715,s=.072;return this._multiplyMatrix([r+t*(1-r)+n*-r,i+t*-i+n*-i,s+t*-s+n*(1-s),0,0,r+t*-r+.143*n,i+t*(1-i)+.14*n,s+t*-s+n*-0.283,0,0,r+t*-r+n*-(1-r),i+t*-i+n*i,s+t*(1-s)+n*s,0,0,0,0,0,1,0,0,0,0,0,1]),this},t.concat=function(t){return t=this._fixMatrix(t),t.length!=e.LENGTH?this:(this._multiplyMatrix(t),this)},t.clone=function(){return(new e).copyMatrix(this)},t.toArray=function(){for(var t=[],n=0,r=e.LENGTH;r>n;n++)t[n]=this[n];return t},t.copyMatrix=function(t){for(var n=e.LENGTH,r=0;n>r;r++)this[r]=t[r];return this},t.toString=function(){return"[ColorMatrix]"},t._multiplyMatrix=function(e){for(var t=[],n=0;5>n;n++){for(var r=0;5>r;r++)t[r]=this[r+5*n];for(var r=0;5>r;r++){for(var i=0,s=0;5>s;s++)i+=e[r+5*s]*t[s];this[r+5*n]=i}}},t._cleanValue=function(e,t){return Math.min(t,Math.max(-t,e))},t._fixMatrix=function(t){return t instanceof e&&(t=t.toArray()),t.length<e.LENGTH?t=t.slice(0,t.length).concat(e.IDENTITY_MATRIX.slice(t.length,e.LENGTH)):t.length>e.LENGTH&&(t=t.slice(0,e.LENGTH)),t},createjs.ColorMatrix=e}(),this.createjs=this.createjs||{},function(){var e=function(e){this.initialize(e)},t=e.prototype=new createjs.Filter;t.matrix=null,t.initialize=function(e){this.matrix=e},t.applyFilter=function(e,t,n,r,i,s,o,u){s=s||e,null==o&&(o=t),null==u&&(u=n);try{var a=e.getImageData(t,n,r,i)}catch(f){return!1}for(var l,c,h,p,d=a.data,v=d.length,m=this.matrix,g=m[0],y=m[1],b=m[2],w=m[3],E=m[4],S=m[5],x=m[6],T=m[7],N=m[8],C=m[9],k=m[10],L=m[11],A=m[12],O=m[13],M=m[14],_=m[15],D=m[16],P=m[17],H=m[18],B=m[19],j=0;v>j;j+=4)l=d[j],c=d[j+1],h=d[j+2],p=d[j+3],d[j]=l*g+c*y+h*b+p*w+E,d[j+1]=l*S+c*x+h*T+p*N+C,d[j+2]=l*k+c*L+h*A+p*O+M,d[j+3]=l*_+c*D+h*P+p*H+B;return s.putImageData(a,o,u),!0},t.toString=function(){return"[ColorMatrixFilter]"},t.clone=function(){return new e(this.matrix)},createjs.ColorMatrixFilter=e}(),this.createjs=this.createjs||{},function(){var e=function(){throw"Touch cannot be instantiated"};e.isSupported=function(){return"ontouchstart"in window||window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>0||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>0},e.enable=function(t,n,r){return t&&t.canvas&&e.isSupported()?(t.__touch={pointers:{},multitouch:!n,preventDefault:!r,count:0},"ontouchstart"in window?e._IOS_enable(t):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&e._IE_enable(t),!0):!1},e.disable=function(t){t&&("ontouchstart"in window?e._IOS_disable(t):(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&e._IE_disable(t))},e._IOS_enable=function(t){var n=t.canvas,r=t.__touch.f=function(n){e._IOS_handleEvent(t,n)};n.addEventListener("touchstart",r,!1),n.addEventListener("touchmove",r,!1),n.addEventListener("touchend",r,!1),n.addEventListener("touchcancel",r,!1)},e._IOS_disable=function(e){var t=e.canvas;if(t){var n=e.__touch.f;t.removeEventListener("touchstart",n,!1),t.removeEventListener("touchmove",n,!1),t.removeEventListener("touchend",n,!1),t.removeEventListener("touchcancel",n,!1)}},e._IOS_handleEvent=function(e,t){if(e){e.__touch.preventDefault&&t.preventDefault&&t.preventDefault();for(var n=t.changedTouches,r=t.type,i=0,s=n.length;s>i;i++){var o=n[i],u=o.identifier;o.target==e.canvas&&("touchstart"==r?this._handleStart(e,u,t,o.pageX,o.pageY):"touchmove"==r?this._handleMove(e,u,t,o.pageX,o.pageY):("touchend"==r||"touchcancel"==r)&&this._handleEnd(e,u,t))}}},e._IE_enable=function(t){var n=t.canvas,r=t.__touch.f=function(n){e._IE_handleEvent(t,n)};void 0===window.navigator.pointerEnabled?(n.addEventListener("MSPointerDown",r,!1),window.addEventListener("MSPointerMove",r,!1),window.addEventListener("MSPointerUp",r,!1),window.addEventListener("MSPointerCancel",r,!1),t.__touch.preventDefault&&(n.style.msTouchAction="none")):(n.addEventListener("pointerdown",r,!1),window.addEventListener("pointermove",r,!1),window.addEventListener("pointerup",r,!1),window.addEventListener("pointercancel",r,!1),t.__touch.preventDefault&&(n.style.touchAction="none")),t.__touch.activeIDs={}},e._IE_disable=function(e){var t=e.__touch.f;void 0===window.navigator.pointerEnabled?(window.removeEventListener("MSPointerMove",t,!1),window.removeEventListener("MSPointerUp",t,!1),window.removeEventListener("MSPointerCancel",t,!1),e.canvas&&e.canvas.removeEventListener("MSPointerDown",t,!1)):(window.removeEventListener("pointermove",t,!1),window.removeEventListener("pointerup",t,!1),window.removeEventListener("pointercancel",t,!1),e.canvas&&e.canvas.removeEventListener("pointerdown",t,!1))},e._IE_handleEvent=function(e,t){if(e){e.__touch.preventDefault&&t.preventDefault&&t.preventDefault();var n=t.type,r=t.pointerId,i=e.__touch.activeIDs;if("MSPointerDown"==n||"pointerdown"==n){if(t.srcElement!=e.canvas)return;i[r]=!0,this._handleStart(e,r,t,t.pageX,t.pageY)}else i[r]&&("MSPointerMove"==n||"pointermove"==n?this._handleMove(e,r,t,t.pageX,t.pageY):("MSPointerUp"==n||"MSPointerCancel"==n||"pointerup"==n||"pointercancel"==n)&&(delete i[r],this._handleEnd(e,r,t)))}},e._handleStart=function(e,t,n,r,i){var s=e.__touch;if(s.multitouch||!s.count){var o=s.pointers;o[t]||(o[t]=!0,s.count++,e._handlePointerDown(t,n,r,i))}},e._handleMove=function(e,t,n,r,i){e.__touch.pointers[t]&&e._handlePointerMove(t,n,r,i)},e._handleEnd=function(e,t,n){var r=e.__touch,i=r.pointers;i[t]&&(r.count--,e._handlePointerUp(t,n,!0),delete i[t])},createjs.Touch=e}(),this.createjs=this.createjs||{},function(){var e=createjs.EaselJS=createjs.EaselJS||{};e.version="0.7.1",e.buildDate="Thu, 12 Dec 2013 23:33:39 GMT"}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n){this.initialize(e,t,n)},t=e.prototype;t.type=null,t.target=null,t.currentTarget=null,t.eventPhase=0,t.bubbles=!1,t.cancelable=!1,t.timeStamp=0,t.defaultPrevented=!1,t.propagationStopped=!1,t.immediatePropagationStopped=!1,t.removed=!1,t.initialize=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=(new Date).getTime()},t.preventDefault=function(){this.defaultPrevented=!0},t.stopPropagation=function(){this.propagationStopped=!0},t.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},t.remove=function(){this.removed=!0},t.clone=function(){return new e(this.type,this.bubbles,this.cancelable)},t.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=e}(),this.createjs=this.createjs||{},function(){var e=function(){},t=e.prototype;e.initialize=function(e){e.addEventListener=t.addEventListener,e.on=t.on,e.removeEventListener=e.off=t.removeEventListener,e.removeAllEventListeners=t.removeAllEventListeners,e.hasEventListener=t.hasEventListener,e.dispatchEvent=t.dispatchEvent,e._dispatchEvent=t._dispatchEvent,e.willTrigger=t.willTrigger},t._listeners=null,t._captureListeners=null,t.initialize=function(){},t.addEventListener=function(e,t,n){var r;r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var i=r[e];return i&&this.removeEventListener(e,t,n),i=r[e],i?i.push(t):r[e]=[t],t},t.on=function(e,t,n,r,i,s){return t.handleEvent&&(n=n||t,t=t.handleEvent),n=n||this,this.addEventListener(e,function(e){t.call(n,e,i),r&&e.remove()},s)},t.removeEventListener=function(e,t,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[e];if(i)for(var s=0,o=i.length;o>s;s++)if(i[s]==t){1==o?delete r[e]:i.splice(s,1);break}}},t.off=t.removeEventListener,t.removeAllEventListeners=function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null},t.dispatchEvent=function(e,t){if("string"==typeof e){var n=this._listeners;if(!n||!n[e])return!1;e=new createjs.Event(e)}if(e.target=t||this,e.bubbles&&this.parent){for(var r=this,i=[r];r.parent;)i.push(r=r.parent);var s,o=i.length;for(s=o-1;s>=0&&!e.propagationStopped;s--)i[s]._dispatchEvent(e,1+(0==s));for(s=1;o>s&&!e.propagationStopped;s++)i[s]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented},t.hasEventListener=function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])},t.willTrigger=function(e){for(var t=this;t;){if(t.hasEventListener(e))return!0;t=t.parent}return!1},t.toString=function(){return"[EventDispatcher]"},t._dispatchEvent=function(e,t){var n,r=1==t?this._captureListeners:this._listeners;if(e&&r){var i=r[e.type];if(!i||!(n=i.length))return;e.currentTarget=this,e.eventPhase=t,e.removed=!1,i=i.slice();for(var s=0;n>s&&!e.immediatePropagationStopped;s++){var o=i[s];o.handleEvent?o.handleEvent(e):o(e),e.removed&&(this.off(e.type,o,1==t),e.removed=!1)}}},createjs.EventDispatcher=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n){this.initialize(e,t,n)},t=e.prototype=new createjs.EventDispatcher;e.NONE=0,e.LOOP=1,e.REVERSE=2,e.IGNORE={},e._tweens=[],e._plugins={},e.get=function(t,n,r,i){return i&&e.removeTweens(t),new e(t,n,r)},e.tick=function(t,n){for(var r=e._tweens.slice(),i=r.length-1;i>=0;i--){var s=r[i];n&&!s.ignoreGlobalPause||s._paused||s.tick(s._useTicks?1:t)}},e.handleEvent=function(e){"tick"==e.type&&this.tick(e.delta,e.paused)},e.removeTweens=function(t){if(t.tweenjs_count){for(var n=e._tweens,r=n.length-1;r>=0;r--)n[r]._target==t&&(n[r]._paused=!0,n.splice(r,1));t.tweenjs_count=0}},e.removeAllTweens=function(){for(var t=e._tweens,n=0,r=t.length;r>n;n++){var i=t[n];i.paused=!0,i.target.tweenjs_count=0}t.length=0},e.hasActiveTweens=function(t){return t?t.tweenjs_count:e._tweens&&!!e._tweens.length},e.installPlugin=function(t,n){var r=t.priority;null==r&&(t.priority=r=0);for(var i=0,s=n.length,o=e._plugins;s>i;i++){var u=n[i];if(o[u]){for(var f=o[u],l=0,c=f.length;c>l&&!(r<f[l].priority);l++);o[u].splice(l,0,t)}else o[u]=[t]}},e._register=function(t,n){var r=t._target,i=e._tweens;if(n)r&&(r.tweenjs_count=r.tweenjs_count?r.tweenjs_count+1:1),i.push(t),!e._inited&&createjs.Ticker&&(createjs.Ticker.addEventListener("tick",e),e._inited=!0);else{r&&r.tweenjs_count--;for(var s=i.length;s--;)if(i[s]==t)return i.splice(s,1),void 0}},t.ignoreGlobalPause=!1,t.loop=!1,t.duration=0,t.pluginData=null,t.target=null,t.position=null,t.passive=!1,t._paused=!1,t._curQueueProps=null,t._initQueueProps=null,t._steps=null,t._actions=null,t._prevPosition=0,t._stepPosition=0,t._prevPos=-1,t._target=null,t._useTicks=!1,t._inited=!1,t.initialize=function(t,n,r){this.target=this._target=t,n&&(this._useTicks=n.useTicks,this.ignoreGlobalPause=n.ignoreGlobalPause,this.loop=n.loop,n.onChange&&this.addEventListener("change",n.onChange),n.override&&e.removeTweens(t)),this.pluginData=r||{},this._curQueueProps={},this._initQueueProps={},this._steps=[],this._actions=[],n&&n.paused?this._paused=!0:e._register(this,!0),n&&null!=n.position&&this.setPosition(n.position,e.NONE)},t.wait=function(e,t){if(null==e||0>=e)return this;var n=this._cloneProps(this._curQueueProps);return this._addStep({d:e,p0:n,e:this._linearEase,p1:n,v:t})},t.to=function(e,t,n){return(isNaN(t)||0>t)&&(t=0),this._addStep({d:t||0,p0:this._cloneProps(this._curQueueProps),e:n,p1:this._cloneProps(this._appendQueueProps(e))})},t.call=function(e,t,n){return this._addAction({f:e,p:t?t:[this],o:n?n:this._target})},t.set=function(e,t){return this._addAction({f:this._set,o:this,p:[e,t?t:this._target]})},t.play=function(e){return e||(e=this),this.call(e.setPaused,[!1],e)},t.pause=function(e){return e||(e=this),this.call(e.setPaused,[!0],e)},t.setPosition=function(e,t){0>e&&(e=0),null==t&&(t=1);var n=e,r=!1;if(n>=this.duration&&(this.loop?n%=this.duration:(n=this.duration,r=!0)),n==this._prevPos)return r;var i=this._prevPos;if(this.position=this._prevPos=n,this._prevPosition=e,this._target)if(r)this._updateTargetProps(null,1);else if(this._steps.length>0){for(var s=0,o=this._steps.length;o>s&&!(this._steps[s].t>n);s++);var u=this._steps[s-1];this._updateTargetProps(u,(this._stepPosition=n-u.t)/u.d)}return 0!=t&&this._actions.length>0&&(this._useTicks?this._runActions(n,n):1==t&&i>n?(i!=this.duration&&this._runActions(i,this.duration),this._runActions(0,n,!0)):this._runActions(i,n)),r&&this.setPaused(!0),this.dispatchEvent("change"),r},t.tick=function(e){this._paused||this.setPosition(this._prevPosition+e)},t.setPaused=function(t){return this._paused=!!t,e._register(this,!t),this},t.w=t.wait,t.t=t.to,t.c=t.call,t.s=t.set,t.toString=function(){return"[Tween]"},t.clone=function(){throw"Tween can not be cloned."},t._updateTargetProps=function(t,n){var r,i,s,o,u,f;if(t||1!=n){if(this.passive=!!t.v,this.passive)return;t.e&&(n=t.e(n,0,1,1)),r=t.p0,i=t.p1}else this.passive=!1,r=i=this._curQueueProps;for(var l in this._initQueueProps){null==(o=r[l])&&(r[l]=o=this._initQueueProps[l]),null==(u=i[l])&&(i[l]=u=o),s=o==u||0==n||1==n||"number"!=typeof o?1==n?u:o:o+(u-o)*n;var c=!1;if(f=e._plugins[l])for(var h=0,p=f.length;p>h;h++){var d=f[h].tween(this,l,s,r,i,n,!!t&&r==i,!t);d==e.IGNORE?c=!0:s=d}c||(this._target[l]=s)}},t._runActions=function(e,t,n){var r=e,i=t,s=-1,o=this._actions.length,u=1;for(e>t&&(r=t,i=e,s=o,o=u=-1);(s+=u)!=o;){var a=this._actions[s],f=a.t;(f==i||f>r&&i>f||n&&f==e)&&a.f.apply(a.o,a.p)}},t._appendQueueProps=function(t){var n,r,i,s,o;for(var u in t)if(void 0===this._initQueueProps[u]){if(r=this._target[u],n=e._plugins[u])for(i=0,s=n.length;s>i;i++)r=n[i].init(this,u,r);this._initQueueProps[u]=this._curQueueProps[u]=void 0===r?null:r}else r=this._curQueueProps[u];for(var u in t){if(r=this._curQueueProps[u],n=e._plugins[u])for(o=o||{},i=0,s=n.length;s>i;i++)n[i].step&&n[i].step(this,u,r,t[u],o);this._curQueueProps[u]=t[u]}return o&&this._appendQueueProps(o),this._curQueueProps},t._cloneProps=function(e){var t={};for(var n in e)t[n]=e[n];return t},t._addStep=function(e){return e.d>0&&(this._steps.push(e),e.t=this.duration,this.duration+=e.d),this},t._addAction=function(e){return e.t=this.duration,this._actions.push(e),this},t._set=function(e,t){for(var n in e)t[n]=e[n]},createjs.Tween=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n){this.initialize(e,t,n)},t=e.prototype=new createjs.EventDispatcher;t.ignoreGlobalPause=!1,t.duration=0,t.loop=!1,t.position=null,t._paused=!1,t._tweens=null,t._labels=null,t._labelList=null,t._prevPosition=0,t._prevPos=-1,t._useTicks=!1,t.initialize=function(e,t,n){this._tweens=[],n&&(this._useTicks=n.useTicks,this.loop=n.loop,this.ignoreGlobalPause=n.ignoreGlobalPause,n.onChange&&this.addEventListener("change",n.onChange)),e&&this.addTween.apply(this,e),this.setLabels(t),n&&n.paused?this._paused=!0:createjs.Tween._register(this,!0),n&&null!=n.position&&this.setPosition(n.position,createjs.Tween.NONE)},t.addTween=function(e){var t=arguments.length;if(t>1){for(var n=0;t>n;n++)this.addTween(arguments[n]);return arguments[0]}return 0==t?null:(this.removeTween(e),this._tweens.push(e),e.setPaused(!0),e._paused=!1,e._useTicks=this._useTicks,e.duration>this.duration&&(this.duration=e.duration),this._prevPos>=0&&e.setPosition(this._prevPos,createjs.Tween.NONE),e)},t.removeTween=function(e){var t=arguments.length;if(t>1){for(var n=!0,r=0;t>r;r++)n=n&&this.removeTween(arguments[r]);return n}if(0==t)return!1;for(var i=this._tweens,r=i.length;r--;)if(i[r]==e)return i.splice(r,1),e.duration>=this.duration&&this.updateDuration(),!0;return!1},t.addLabel=function(e,t){this._labels[e]=t;var n=this._labelList;if(n){for(var r=0,i=n.length;i>r&&!(t<n[r].position);r++);n.splice(r,0,{label:e,position:t})}},t.setLabels=function(e){this._labels=e?e:{}},t.getLabels=function(){var e=this._labelList;if(!e){e=this._labelList=[];var t=this._labels;for(var n in t)e.push({label:n,position:t[n]});e.sort(function(e,t){return e.position-t.position})}return e},t.getCurrentLabel=function(){var e=this.getLabels(),t=this.position,n=e.length;if(n){for(var r=0;n>r&&!(t<e[r].position);r++);return 0==r?null:e[r-1].label}return null},t.gotoAndPlay=function(e){this.setPaused(!1),this._goto(e)},t.gotoAndStop=function(e){this.setPaused(!0),this._goto(e)},t.setPosition=function(e,t){0>e&&(e=0);var n=this.loop?e%this.duration:e,r=!this.loop&&e>=this.duration;if(n==this._prevPos)return r;this._prevPosition=e,this.position=this._prevPos=n;for(var i=0,s=this._tweens.length;s>i;i++)if(this._tweens[i].setPosition(n,t),n!=this._prevPos)return!1;return r&&this.setPaused(!0),this.dispatchEvent("change"),r},t.setPaused=function(e){this._paused=!!e,createjs.Tween._register(this,!e)},t.updateDuration=function(){this.duration=0;for(var e=0,t=this._tweens.length;t>e;e++){var n=this._tweens[e];n.duration>this.duration&&(this.duration=n.duration)}},t.tick=function(e){this.setPosition(this._prevPosition+e)},t.resolve=function(e){var t=parseFloat(e);return isNaN(t)&&(t=this._labels[e]),t},t.toString=function(){return"[Timeline]"},t.clone=function(){throw"Timeline can not be cloned."},t._goto=function(e){var t=this.resolve(e);null!=t&&this.setPosition(t)},createjs.Timeline=e}(),this.createjs=this.createjs||{},function(){var e=function(){throw"Ease cannot be instantiated."};e.linear=function(e){return e},e.none=e.linear,e.get=function(e){return-1>e&&(e=-1),e>1&&(e=1),function(t){return 0==e?t:0>e?t*(t*-e+1+e):t*((2-t)*e+(1-e))}},e.getPowIn=function(e){return function(t){return Math.pow(t,e)}},e.getPowOut=function(e){return function(t){return 1-Math.pow(1-t,e)}},e.getPowInOut=function(e){return function(t){return(t*=2)<1?.5*Math.pow(t,e):1-.5*Math.abs(Math.pow(2-t,e))}},e.quadIn=e.getPowIn(2),e.quadOut=e.getPowOut(2),e.quadInOut=e.getPowInOut(2),e.cubicIn=e.getPowIn(3),e.cubicOut=e.getPowOut(3),e.cubicInOut=e.getPowInOut(3),e.quartIn=e.getPowIn(4),e.quartOut=e.getPowOut(4),e.quartInOut=e.getPowInOut(4),e.quintIn=e.getPowIn(5),e.quintOut=e.getPowOut(5),e.quintInOut=e.getPowInOut(5),e.sineIn=function(e){return 1-Math.cos(e*Math.PI/2)},e.sineOut=function(e){return Math.sin(e*Math.PI/2)},e.sineInOut=function(e){return-0.5*(Math.cos(Math.PI*e)-1)},e.getBackIn=function(e){return function(t){return t*t*((e+1)*t-e)}},e.backIn=e.getBackIn(1.7),e.getBackOut=function(e){return function(t){return--t*t*((e+1)*t+e)+1}},e.backOut=e.getBackOut(1.7),e.getBackInOut=function(e){return e*=1.525,function(t){return(t*=2)<1?.5*t*t*((e+1)*t-e):.5*((t-=2)*t*((e+1)*t+e)+2)}},e.backInOut=e.getBackInOut(1.7),e.circIn=function(e){return-(Math.sqrt(1-e*e)-1)},e.circOut=function(e){return Math.sqrt(1- --e*e)},e.circInOut=function(e){return(e*=2)<1?-0.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},e.bounceIn=function(t){return 1-e.bounceOut(1-t)},e.bounceOut=function(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},e.bounceInOut=function(t){return.5>t?.5*e.bounceIn(2*t):.5*e.bounceOut(2*t-1)+.5},e.getElasticIn=function(e,t){var n=2*Math.PI;return function(r){if(0==r||1==r)return r;var i=t/n*Math.asin(1/e);return-(e*Math.pow(2,10*(r-=1))*Math.sin((r-i)*n/t))}},e.elasticIn=e.getElasticIn(1,.3),e.getElasticOut=function(e,t){var n=2*Math.PI;return function(r){if(0==r||1==r)return r;var i=t/n*Math.asin(1/e);return e*Math.pow(2,-10*r)*Math.sin((r-i)*n/t)+1}},e.elasticOut=e.getElasticOut(1,.3),e.getElasticInOut=function(e,t){var n=2*Math.PI;return function(r){var i=t/n*Math.asin(1/e);return(r*=2)<1?-0.5*e*Math.pow(2,10*(r-=1))*Math.sin((r-i)*n/t):.5*e*Math.pow(2,-10*(r-=1))*Math.sin((r-i)*n/t)+1}},e.elasticInOut=e.getElasticInOut(1,.3*1.5),createjs.Ease=e}(),this.createjs=this.createjs||{},function(){var e=function(){throw"MotionGuidePlugin cannot be instantiated."};e.priority=0,e._rotOffS,e._rotOffE,e._rotNormS,e._rotNormE,e.install=function(){return createjs.Tween.installPlugin(e,["guide","x","y","rotation"]),createjs.Tween.IGNORE},e.init=function(e,t,n){var r=e.target;return r.hasOwnProperty("x")||(r.x=0),r.hasOwnProperty("y")||(r.y=0),r.hasOwnProperty("rotation")||(r.rotation=0),"rotation"==t&&(e.__needsRot=!0),"guide"==t?null:n},e.step=function(t,n,r,i,s){if("rotation"==n&&(t.__rotGlobalS=r,t.__rotGlobalE=i,e.testRotData(t,s)),"guide"!=n)return i;var o,u=i;u.hasOwnProperty("path")||(u.path=[]);var f=u.path;if(u.hasOwnProperty("end")||(u.end=1),u.hasOwnProperty("start")||(u.start=r&&r.hasOwnProperty("end")&&r.path===f?r.end:0),u.hasOwnProperty("_segments")&&u._length)return i;var l=f.length,c=10;if(l>=6&&0==(l-2)%4){u._segments=[],u._length=0;for(var h=2;l>h;h+=4){for(var p,d,v=f[h-2],m=f[h-1],g=f[h+0],y=f[h+1],b=f[h+2],w=f[h+3],E=v,S=m,x=0,T=[],N=1;c>=N;N++){var C=N/c,k=1-C;p=k*k*v+2*k*C*g+C*C*b,d=k*k*m+2*k*C*y+C*C*w,x+=T[T.push(Math.sqrt((o=p-E)*o+(o=d-S)*o))-1],E=p,S=d}u._segments.push(x),u._segments.push(T),u._length+=x}o=u.orient,u.orient=!0;var L={};return e.calc(u,u.start,L),t.__rotPathS=Number(L.rotation.toFixed(5)),e.calc(u,u.end,L),t.__rotPathE=Number(L.rotation.toFixed(5)),u.orient=!1,e.calc(u,u.end,s),u.orient=o,u.orient?(t.__guideData=u,e.testRotData(t,s),i):i}throw"invalid 'path' data, please see documentation for valid paths"},e.testRotData=function(e,t){if(void 0===e.__rotGlobalS||void 0===e.__rotGlobalE){if(e.__needsRot)return;e.__rotGlobalS=e.__rotGlobalE=void 0!==e._curQueueProps.rotation?e._curQueueProps.rotation:t.rotation=e.target.rotation||0}if(void 0!==e.__guideData){var n=e.__guideData,r=e.__rotGlobalE-e.__rotGlobalS,i=e.__rotPathE-e.__rotPathS,s=r-i;if("auto"==n.orient)s>180?s-=360:-180>s&&(s+=360);else if("cw"==n.orient){for(;0>s;)s+=360;0==s&&r>0&&180!=r&&(s+=360)}else if("ccw"==n.orient){for(s=r-(i>180?360-i:i);s>0;)s-=360;0==s&&0>r&&-180!=r&&(s-=360)}n.rotDelta=s,n.rotOffS=e.__rotGlobalS-e.__rotPathS,e.__rotGlobalS=e.__rotGlobalE=e.__guideData=e.__needsRot=void 0}},e.tween=function(t,n,r,i,s,o,u){var f=s.guide;if(void 0==f||f===i.guide)return r;if(f.lastRatio!=o){var l=(f.end-f.start)*(u?f.end:o)+f.start;switch(e.calc(f,l,t.target),f.orient){case"cw":case"ccw":case"auto":t.target.rotation+=f.rotOffS+f.rotDelta*o;break;case"fixed":default:t.target.rotation+=f.rotOffS}f.lastRatio=o}return"rotation"!=n||f.orient&&"false"!=f.orient?t.target[n]:r},e.calc=function(t,n,r){void 0==t._segments&&e.validate(t),void 0==r&&(r={x:0,y:0,rotation:0});for(var i=t._segments,s=t.path,o=t._length*n,u=i.length-2,f=0;o>i[f]&&u>f;)o-=i[f],f+=2;var l=i[f+1],c=0;for(u=l.length-1;o>l[c]&&u>c;)o-=l[c],c++;var h=c/++u+o/(u*l[c]);f=2*f+2;var p=1-h;return r.x=p*p*s[f-2]+2*p*h*s[f+0]+h*h*s[f+2],r.y=p*p*s[f-1]+2*p*h*s[f+1]+h*h*s[f+3],t.orient&&(r.rotation=57.2957795*Math.atan2((s[f+1]-s[f-1])*p+(s[f+3]-s[f+1])*h,(s[f+0]-s[f-2])*p+(s[f+2]-s[f+0])*h)),r},createjs.MotionGuidePlugin=e}(),this.createjs=this.createjs||{},function(){var e=createjs.TweenJS=createjs.TweenJS||{};e.version="0.5.1",e.buildDate="Thu, 12 Dec 2013 23:33:38 GMT"}(),this.createjs}),define("vas-editor/runtime/timeline",["jquery","fabric","tweenjs","core/db","core/config"],function(e,t,n,r,i){var s=function(e){n.Timeline.call(this),this.canvas=e,this.audioElement=null,this.audioTween=null,this.gotoAndStop(0),window.t=this};return s.prototype=Object.create(n.Timeline.prototype),s.prototype.gotoAndPlay=function(e){var t=function(){n.Timeline.prototype.gotoAndPlay.call(this,e);if(!this.audioElement)return;this.audioElement.currentTime=e/1e3,this.audioElement.paused&&this.audioElement.play()}.bind(this);e==0?this.rewindAudio(t):t()},s.prototype.gotoAndStop=function(e){var t=function(){n.Timeline.prototype.gotoAndStop.call(this,e);if(!this.audioElement)return;this.audioElement.paused||this.audioElement.pause(),this.audioElement.currentTime=e/1e3}.bind(this);e==0?this.rewindAudio(t):t()},s.prototype.setPaused=function(e){n.Timeline.prototype.setPaused.call(this,e);if(!this.audioElement)return;e?this.audioElement.pause():this.audioElement.play()},s.prototype.rewindAudio=function(e){if(this.audioElement){var t=function(n){this.audioElement.removeEventListener("canplaythrough",t),this.audioElement.pause(),e&&e()}.bind(this);this.audioElement.addEventListener("canplaythrough",t),this.audioElement.load()}else e&&e()},s.prototype.buildTween=function(e,t){var r=0,i=!0,s=n.Tween.get(e,{override:!0,paused:!0,position:0});for(var o=0;o<t.length;o++){var u=t[o],a=u.at;if(a==undefined){console.warn("Unexpected tween definition",u);continue}if(a<r){console.warn("Unexpected position going bacwards on tween definition",u);continue}i?(i=!1,s.to(u,0),a>0&&s.wait(a)):s.to(u,a-r,n.Ease[u.easing||"linear"]),r=a}return s},s.prototype.setupAudio=function(e,t){this.audioElement&&(this.audioElement.src="",this.canvas.getElement().parentNode.removeChild(this.audioElement),this.removeTween(this.audioTween));if(!e){this.audioElement.src="",this.audioElement=null,this.audioTween&&(this.removeTween(this.audioTween),this.audioTween=null);return}this.audioElement=document.createElement("audio"),this.audioElement.loop="",this.audioElement.preload="auto",this.canvas.getElement().parentNode.appendChild(this.audioElement);var r=document.createElement("source");this.audioElement.canPlayType("audio/ogg;")?(r.type="audio/ogg",r.src=e+".ogg"):this.audioElement.canPlayType("audio/mpeg;")?(r.type="audio/mpeg",r.src=e+".mp3"):(r.type="audio/x-wav",r.src=e+".wav"),this.audioElement.appendChild(r);var i=function(e){var r=Math.round(this.audioElement.duration*1e3);this.audioTween=n.Tween.get({},{override:!0,paused:!0,position:0}).wait(r).to({},0),this.addTween(this.audioTween),t&&t(!0),this.audioElement.removeEventListener("canplaythrough",i)}.bind(this);this.audioElement.addEventListener("canplaythrough",i),this.audioElement.addEventListener("error",function(e){t&&t(!1)}.bind(this)),this.audioElement.load(),this.audioElement.pause()},s.prototype.initWithJSON=function(e,t){for(var n=0;n<t.length;n++){var r=new s.Element(e[n]);this.addTween(this.buildTween(r,t[n]))}this.gotoAndStop(0)},s.prototype.clear=function(){for(var e=0;e<this._tweens.length;e++)this.removeTween(this._tweens[e]);this.gotoAndStop(0)},s.Element=function(e){this.__object=e,this.__propertyNames||(this.__propertyNames=["progression","visible","stroke","fill","strokeWidth","opacity","left","top","scaleX","scaleY","angle"]),this.__object.__pathProgression=1,this.__object.path&&(this.__object.__pathElements=this.__object.path.slice(0)),this.__onUpdate=null;var t={};t.progression={get:function(){return this.__object.path?this.__object.__pathProgression:0}.bind(this),set:function(e){if(!this.__object.path)return;e<0&&(e=0),e>1&&(e=1);var t=this.__object.__pathElements.length,n=parseInt(e*(t-1));this.__object.path=this.__object.__pathElements.slice(0,n),this.__object.__pathProgression=e,this.__onUpdate&&this.__onUpdate("progression",e)}.bind(this)};for(var n=0;n<this.__propertyNames.length;n++){if(this.__propertyNames[n]=="progression")continue;var r=this.__propertyNames[n][0].toUpperCase()+this.__propertyNames[n].substr(1);t[this.__propertyNames[n]]={get:function(e){return function(){return this.__object["get"+e]()}}(r).bind(this),set:function(e){return function(t){this.__object["set"+e](t),this.__onUpdate&&this.__onUpdate()}}(r).bind(this),configurable:!0}}Object.defineProperties(this,t)},s}),define("vas-editor/runtime/hotspots",["jquery","core/ui"],function(e,t){var n=function(e){this.hostDOM=e,this.hotspotElms=[],this.depth=0};return n.prototype.clear=function(e){this.hotspotElms=[],this.hostDOM.empty()},n.prototype.loadJSON=function(e){for(var t=0;t<e.length;t++)this.addHotspot(e[t])},n.prototype.getDepth=function(){return this.hotspotElms.length},n.prototype.setProgression=function(e){for(var t=0;t<this.hotspotElms.length;t++)e==null||t<e?(this.hotspotElms[t].removeClass("active"),this.hotspotElms[t].addClass("visible")):t==e?(this.hotspotElms[t].addClass("active"),this.hotspotElms[t].addClass("visible")):(this.hotspotElms[t].removeClass("active"),this.hotspotElms[t].removeClass("visible"))},n.prototype.addHotspot=function(t){var n=e('<div class="hotspot"></div>'),r=e("<h1></h1>");return n.append(r),this.hostDOM.append(n),n.click(function(e){e.preventDefault(),e.stopPropagation()}.bind(this)),n.css({left:t.x-e(n).width()/2,top:t.y-e(n).height()/2}),r.text(t.short),this.hotspotElms.push(n),n},n.prototype.clear=function(){this.hostDOM.empty(),this.hotspotElms=[]},n}),define("vas-editor/runtime/canvas",["jquery","fabric","tweenjs","core/util/event_base","vas-editor/runtime/timeline","vas-editor/runtime/hotspots"],function(e,t,n,r,i,s){var o=function(o){r.call(this),this.hostDOM=o,this.canvasDOM=e("<canvas></canvas>"),this.hostDOM.append(this.canvasDOM),this.canvasDOM.attr({width:800,height:450}),t.Object.prototype.transparentCorners=!1,this.canvasFabric=new t.StaticCanvas(e(this.canvasDOM)[0]),n.Ticker.setPaused(!0);var u=!1;this.timeline=new i(this.canvasFabric),this.timeline.addEventListener("change",function(){this.canvasFabric.renderAll(),this.timeline.position>=this.timeline.duration?u&&(this.trigger("animationCompleted"),this.timeline.setPaused(!0),u=!1):u||(this.trigger("animationStarted"),u=!0)}.bind(this)),this.hotspotsDOM=e('<div class="hotspots"></div>'),this.hostDOM.append(this.hotspotsDOM),this.hotspots=new s(this.hotspotsDOM);var a=this,f=Date.now(),l=function(){setTimeout(function(){requestAnimationFrame(function(){var e=Date.now(),t=e-f;f=e,a.timeline.tick(t),l()})},25)};l()};return o.prototype=Object.create(r.prototype),o.prototype.loadJSON=function(e,t){var n=function(){this.timeline.initWithJSON(this.canvasFabric.getObjects(),e.scene.tweens),this.canvasFabric.renderAll(),e.narration?this.timeline.setupAudio(e.narration.audio_url,t):t&&t()}.bind(this);this.canvasFabric.clear(),this.timeline.clear(),this.hotspots.clear(),this.hotspots.loadJSON(e.spots),this.canvasFabric.loadFromJSON(e.scene.canvas,n)},o}),define("vas-basic/components/explain/blackboard",["jquery","core/registry","core/base/components","vas-editor/runtime/canvas"],function(e,t,n,r){var i=function(e){n.ExplainScreen.call(this,e),this.canvas=new r(e),this.canvas.on("animationCompleted",function(){this.trigger("animationCompleted")}.bind(this)),this.canvas.on("animationStarted",function(){this.trigger("animationStarted")}.bind(this))};i.prototype=Object.create(n.ExplainScreen.prototype),i.prototype.onAnimationUpdated=function(e,t){this.canvas.loadJSON(e,function(e){this.canvas.hotspots.setProgression(1),this.canvas.timeline.setPaused(!0),t&&t()}.bind(this))},i.prototype.onAnimationStart=function(){this.canvas.timeline.gotoAndPlay(0)},i.prototype.onAnimationStop=function(){this.canvas.timeline.gotoAndStop(this.canvas.timeline.duration)},i.prototype.onWillShow=function(e){this.canvas.timeline.gotoAndStop(10),this.canvas.timeline.gotoAndStop(0),e()},i.prototype.onWillHide=function(e){this.canvas.timeline.gotoAndStop(0),e()},t.registerComponent("explain.blackboard",i,1)}),define("vas-basic/components/explain/machine",["jquery","core/registry","core/base/components"],function(e,t,n){var r=0,i=1,s=2,o=function(){this.lineMin=0,this.lineMax=0,this.lines={},this.normalizeList=[]};o.prototype.clear=function(){this.lineMin=0,this.lineMax=0,this.lines={},this.normalizeList=[]},o.prototype.normalize=function(){for(var e=0;e<this.normalizeList.length;e++)this.normalizeList[e].y-=this.lineMin},o.prototype.getClearLine=function(e,t,n){t<this.lineMin&&(this.lineMin=t),t>this.lineMax&&(this.lineMax=t);if(this.lines[t]==undefined)return this.lines[t]=new u(this,t,e),this.lines[t];if(n){for(var r=this.lineMin-1;r<t;r++)this.lines[r+1].y--,this.lines[r]=this.lines[r+1];this.lines[t]=new u(this,t,e)}else{for(var r=this.lineMax+1;r>t;r--)this.lines[r-1].y++,this.lines[r]=this.lines[r-1];this.lines[t]=new u(this,t,e)}return this.lines[t]},o.prototype.getFirstLine=function(){return this.lines[0]==undefined&&(this.lines[0]=new u(this,0)),this.lines[0]};var u=function(e,t,n){this.grid=e,this.forkDepth=0,this.y=t||0,this.x=n||0};u.prototype.forward=function(e){this.forkDepth=0,this.x+=e||1},u.prototype.stackNode=function(e,t){if(t===!1)return e.x=this.x,e.y=this.y,this;if(this.forkDepth==0)return e.x=this.x,e.y=this.y,this.grid.normalizeList.push(e),this.forkDepth++,this;var n=this.forkDepth%2==0?1:-1,r=Math.ceil(this.forkDepth/2)*n;this.forkDepth++;var i=this.grid.getClearLine(this.x,this.y+r,n<0);return i.stackNode(e)};var a=function(t){n.ExplainScreen.call(this,t),this.lines=[],this.links=[],this.lineMin=0,this.width=0,this.height=0,window.md=this,this.grid=new o,t.addClass("machine-diagram"),this.host=t,this.iconsHost=e('<div class="icons"></div>'),this.focusBar=e('<div class="focus-bar"></div>'),this.iconsHost.append(this.focusBar),t.append(this.iconsHost)};a.prototype=Object.create(n.ExplainScreen.prototype),a.prototype.onResize=function(e,t){this.hostWidth=e,this.hostHeight=t,this.update()},a.prototype.onMachineLayoutDefined=function(t){var n=this;this.collapse=[],this.links=[],this.objects=t,this.objectByID={},this.lines=[],this.focusNode=null,this.rootNode=null;var r=null;for(var i=0;i<t.length;i++){var s=t[i];r||(r=s),s.parent||(this.rootNode=s),s.visible=s.visible==undefined?!0:s.visible,s.children=[];var o=e('<div class="icon"></div>'),u=e("<a></a>"),a=e("<div></div>");o.append(u),o.append(a),u.attr("title",s.title),u.attr("href","about:"+s.id),u.addClass(s.icon),a.html(s["short"]),u.click(function(t){t.stopPropagation(),t.preventDefault();var r=e(this).attr("href").split(":")[1];n.trigger("focusProcess",r),n.setFocus(r)}),s.invert&&u.addClass("invert"),s.element=o,s.visible||o.hide(),this.iconsHost.append(o),this.objectByID[s.id]=s}this.rootNode||(this.rootNode=this.firstNode);for(var i=0;i<t.length;i++){var s=t[i];if(s==this.rootNode)continue;var f=this.objectByID[s.parent];f.children.push(s);var l=e('<div class="line"></div>');this.iconsHost.append(l),this.links.push({from:f,to:s,collapse:!1,element:l});if(s["to"]!=undefined){var l=e('<div class="line"></div>');this.iconsHost.append(l),this.links.push({from:s,to:this.objectByID[s.to],collapse:!0,element:l})}}this.focusNode=this.rootNode,this.updateGrid(),this.updateDOM(),this.update()},a.prototype.updateGrid=function(){var e=function(t,n){n.visible&&t.forward();var r=[];for(var i=0;i<n.children.length;i++)r.push(t.stackNode(n.children[i],n.children[i].visible));for(var i=0;i<n.children.length;i++)e(r[i],n.children[i])};this.grid.clear();var t=this.grid.getFirstLine();t.stackNode(this.rootNode),e(t,this.rootNode),this.grid.normalize()},a.prototype.updateDOM=function(){this.width=0,this.height=0;var e=64,t=84,n=20;for(var o=0;o<this.objects.length;o++){var u=this.objects[o],a=(e+n)*u.x,f=t*(u.y+Math.abs(this.lineMin));u.element.css({left:a,top:f}),u.visible?u.element.fadeIn(200):u.element.fadeOut(200);if(u.visible){var l=u.element.width(),c=u.element.height();f+c>this.height&&(this.height=f+c),a+l>this.width&&(this.width=a+l)}}for(var o=0;o<this.links.length;o++){var a=this.links[o],h=(e+n)*a.from.x,p=t*(a.from.y-this.lineMin),d=(e+n)*a.to.x,v=t*(a.to.y-this.lineMin),m=r;a.collapse?m=s:a.from.y!=a.to.y&&(m=i);var g=a.element.removeClass().addClass("line");m==r?(g.addClass("pos-straight"),g.css({left:h+e,width:d-h-e,height:0,top:p+t/4})):m==i?(g.addClass("pos-branch"),v>p?(g.addClass("pos-down"),g.css({left:h+e/2,top:p+t,height:v-p-t*3/4,width:d-h-e/2-5})):g.css({left:h+e/2,top:v+t/4,height:p-v-t/2+5,width:d-h-e/2-5})):m==s&&(g.addClass("pos-collapse"),v>p?(g.addClass("pos-down"),g.css({left:h+e,top:p+t/4,height:v-p-t/2+5,width:d-h-e/2-5})):g.css({left:h+e,top:p,height:p-v-t*3/4,width:d-h-e/2-5})),a.from.visible&&a.to.visible?g.fadeIn(200):!a.from.visible&&!a.to.visible?g.fadeOut(200):m==r?(g.fadeIn(200),g.addClass("dashed")):g.fadeOut(200)}},a.prototype.setState=function(t){e.each(t,function(e,t){this.objectByID[e].visible=!!t}.bind(this)),this.updateGrid(),this.updateDOM(),this.update()},a.prototype.setFocus=function(e){if(this.objectByID[e]==undefined)return;this.focusNode&&this.focusNode.element.find("a").removeClass("focus"),this.focusNode=this.objectByID[e],this.focusNode.element.find("a").addClass("focus"),this.update()},a.prototype.update=function(){var e=this.hostWidth,t=this.hostHeight,n=e/2,r=t/2,i=0,s=0;this.focusNode!=undefined&&this.focusNode.visible&&(n=parseInt(this.focusNode.element.css("left")),r=parseInt(this.focusNode.element.css("top")),i=this.focusNode.element.width(),s=this.focusNode.element.height());var o=(t-this.height)/2,u=(e-this.width)/2,a=0,f=0;u+n-i/2<e/3?a=e/3-(u+n-i/2):u+n+i/2>e*2/3&&(a=e*2/3-(u+n+i/2)),o+r<10?f=10-(o+r):o+r+s>t-10&&(f=t-10-(o+r+s)),u+=a,o+=f,this.iconsHost.css({left:u,top:o}),i==0?this.focusBar.fadeOut(200):(this.focusBar.fadeIn(200),this.focusBar.css({left:n,top:-o,width:i,height:t-Math.min(0,o)}))},t.registerComponent("explain.machine",a,1)}),define("vas-basic/components/explain/physics",["jquery","core/registry","core/base/components"],function(e,t,n){var r=function(e){n.ExplainScreen.call(this,e)};r.prototype=Object.create(n.ExplainScreen.prototype),t.registerComponent("explain.physics",r,1)}),define("vas-basic/components/explain/book",["jquery","core/registry","core/base/components","core/db"],function(e,t,n,r){var i=function(t){n.ExplainScreen.call(this,t),this.elmHeader=e('<div class="header"></div>'),this.elmTitle=e('<span class="title">Book</span>'),this.elmCloseBtn=e('<a href="do:close" class="close"><span class="uicon uicon-x"></span></a>'),this.elmHeader.append(e('<span class="bullet"></span>')),this.elmHeader.append(this.elmTitle),this.elmHeader.append(this.elmCloseBtn),t.append(this.elmHeader),this.elmBody=e('<div class="body"></div>'),t.append(this.elmBody),this.elmFooter=e('<div class="footer"></div>'),t.append(this.elmFooter),this.elmCloseBtn.click(function(e){e.preventDefault(),e.stopPropagation()}.bind(this))};i.prototype=Object.create(n.ExplainScreen.prototype),i.prototype.onBookDefined=function(e){this.bookID=e},i.prototype.onWillShow=function(e){this.hostDOM.css("display","block"),setTimeout(function(){this.hostDOM.addClass("visible"),setTimeout(e,200)}.bind(this),10)},i.prototype.onWillHide=function(e){this.hostDOM.removeClass("visible"),setTimeout(function(){this.hostDOM.css("display","none"),e()}.bind(this),200)},t.registerComponent("explain.book",i,1)}),define("vas-basic/infoblock/tunable",["jquery","core/registry","core/base/data_widget"],function(e,t,n){var r=function(e){n.call(this,e),this.element=$('<div class="body-more"></div>'),e.append(this.element),this.bodyDOM=$('<div class="body"></div>'),this.moreLinks=$('<div class="more"></div>'),this.element.append(this.bodyDOM),this.element.append(this.moreLinks)};r.prototype=Object.create(n.prototype),r.prototype.onMetaUpdate=function(e){this.bodyDOM.empty(),this.bodyDOM.append($("<div>"+e.info.desc+"</div>")),this.moreLinks.empty();var t=$('<a href="do:show-more"><span class="uicon uicon-explain"></span> Explain this ...</a>');t.click(function(t){t.preventDefault(),t.stopPropagation(),this.trigger("explain",e.info.book)}.bind(this)),this.moreLinks.append(t)},t.registerComponent("infoblock.tunable",r,1)}),define("vas-basic/infoblock/observable",["jquery","core/registry","core/base/data_widget"],function(e,t,n){var r=function(e){n.call(this,e),this.element=$('<div class="body-more"></div>'),e.append(this.element),this.bodyDOM=$('<div class="body"></div>'),this.moreLinks=$('<div class="more"></div>'),this.element.append(this.bodyDOM),this.element.append(this.moreLinks),this.tabHost=$('<div class="tabs tabs-right"></div>'),this.tabBody=$('<div class="tabs-body"></div>'),this.tabButtons=$('<div class="tabs-buttons"></div>'),this.bodyDOM.append(this.tabHost),this.tabHost.append(this.tabBody),this.tabHost.append(this.tabButtons),this.histogramTabs=[],this.registerTab("dataviz.histogram","uicon-plot-sideside")};r.prototype=Object.create(n.prototype),r.prototype.selectTab=function(e){for(var t=0;t<this.histogramTabs.length;t++)t==e?(this.histogramTabs[t].com.show(),this.histogramTabs[t].elmButton.addClass("active"),this.histogramTabs[t].elmBody.show()):(this.histogramTabs[t].com.hide(),this.histogramTabs[t].elmButton.removeClass("active"),this.histogramTabs[t].elmBody.hide())},r.prototype.registerTab=function(e,n){var r=$('<a href="do:'+e+'"><span class="uicon '+n+'"></span></a>'),i=this.histogramTabs.length;this.tabButtons.append(r),r.click(function(e){e.preventDefault(),e.stopPropagation(),this.selectTab(i)}.bind(this));var s=$('<div class="tab"></div>');this.tabBody.append(s);var o=t.instanceComponent(e,s);if(!o){s.remove(),r.remove(),console.error("ObservableBody: Could not instantiate histogram tab from component '"+e+"'");return}this.forwardVisualEvents(o),this.adoptEvents(o),this.histogramTabs.length==0?(s.show(),r.addClass("active"),o.show()):(s.hide(),o.hide()),this.histogramTabs.push({elmButton:r,elmBody:s,com:o})},r.prototype.onUpdate=function(e){for(var t=0;t<this.histogramTabs.length;t++)this.histogramTabs[t].com.onUpdate(e)},r.prototype.onMetaUpdate=function(e){this.moreLinks.empty();var t=$('<a href="do:pin-this"><span class="uicon uicon-pin"></span> Pin this ...</a>');t.click(function(e){e.preventDefault(),e.stopPropagation(),this.trigger("pin")}.bind(this)),this.moreLinks.append(t);var t=$('<a href="do:show-more"><span class="uicon uicon-explain"></span> Explain this ...</a>');t.click(function(t){t.preventDefault(),t.stopPropagation(),this.trigger("explain",e.info.book)}.bind(this)),this.moreLinks.append(t)},r.prototype.onResize=function(e,t){this.width=e,this.height=t;for(var n=0;n<this.histogramTabs.length;n++)this.histogramTabs[n].com.onResize(this.tabBody.width()-18,this.tabBody.height()-20)},t.registerComponent("infoblock.observable",r,1)}),define("vas-basic/infoblock/book",["jquery","core/registry","core/base/data_widget","core/db"],function(e,t,n,r){var i=function(e){n.call(this,e),this.element=$('<div class="body-more"></div>'),e.append(this.element),this.bodyDOM=$('<div class="body tabular"></div>'),this.moreLinks=$('<div class="more"></div>'),this.element.append(this.bodyDOM),this.element.append(this.moreLinks),this.tabs=[]};i.prototype=Object.create(n.prototype),i.prototype.clearTabs=function(){this.tabs=[],this.bodyDOM.empty(),this.moreLinks.empty()},i.prototype.createTab=function(e,t,n){var r=$("<div></div>"),i=$('<a href="do:show-more">'+t+"</a>"),s=this.tabs.length;i.click(function(e){return function(t){t.preventDefault(),t.stopPropagation(),n?n():this.selectTab(e)}}(s).bind(this)),r.append(e),this.bodyDOM.append(r),this.moreLinks.append(i),s==0?i.addClass("active"):r.hide(),this.tabs.push({tab:r,tabBtn:i})},i.prototype.selectTab=function(e){for(var t=0;t<this.tabs.length;t++)t==e?(this.tabs[t].tab.show(),this.tabs[t].tabBtn.addClass("active")):(this.tabs[t].tab.hide(),this.tabs[t].tabBtn.removeClass("active"))},i.prototype.onMetaUpdate=function(e){this.clearTabs();var t=r.openDatabase("books");t.get(e.info.book,function(t,n){if(t!=null){var r=$("<div>"+t.info.description+"</div>");this.createTab(r,'<span class="uicon uicon-explain"></span> Description');if(t.games&&t.games.length>0){var i=$("<div></div>");for(var s=0;s<t.games.length;s++){var o=t.games[s],u=o.color?"; background-color: "+o.color+"":"",a=$('<a target="_blank" class="tile-row" href="'+o.url+'" title="'+o.title+'">'+'<div class="icon" style="background-image: url('+(o.icon||"static/img/icon-game.png")+")"+u+'"></div>'+'<div class="text">'+o.title+"</div></a>"+"</a>");i.append(a)}this.createTab(i,'<span class="uicon uicon-game"></span> Understand')}if(t.material&&t.material.length>0){var f=$("<div></div>");for(var s=0;s<t.material.length;s++){var l=t.material[s],u=l.color?"; background-color: "+l.color+"":"",a=$('<a target="_blank" class="tile-row" href="'+l.url+'" title="'+l.title+'">'+'<div class="icon" style="background-image: url('+(l.icon||"static/img/icon-resource.png")+")"+u+'"></div>'+'<div class="text">'+l.title+"</div></a>"+"</a>");f.append(a)}this.createTab(f,'<span class="uicon uicon-find"></span> Research')}}else{var r=$("<div>Could not find book #"+e.info.book+" in the database!</div>");this.createTab(r,'<span class="uicon uicon-warning"></span> Error &nbsp;')}}.bind(this))},t.registerComponent("infoblock.book",i,1)}),define("vas-basic/dataviz/histogram",["jquery","d3","core/registry","core/base/data_widget"],function(e,t,n,r){var i=function(e){r.call(this,e),this.margin={left:40,top:10,bottom:10,right:10,title:5},this.legend={bullet:5,height:16,titleMargin:5},this.errorBars={bulletSize:2},this.svg=t.select(this.hostDOM[0]).append("svg").attr("class","dv-plot dv-invert"),this.svgPlot=this.svg.append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svgLegend=this.svgPlot.append("g").attr("class","legend")};i.prototype=Object.create(r.prototype),i.prototype.yScaleNonZero=function(e){return e==0?this.height-this.margin.top-this.margin.bottom:this.yScale(e)},i.prototype.getLeastUsedRegion=function(e,t){var n=[];for(var r=0;r<e.length;r++)n.push(0);for(var i=0;i<t.length;i++){var s=t[i].data;for(var r=0;r<s.length;r++){var o=this.xScale(s[r][3]),u=this.yScaleNonZero(s[r][0]);for(var a=0;a<e.length;a++)if(o>=e[a][0]&&o<=e[a][0]+e[a][2]&&u>=e[a][1]&&u<=e[a][1]+e[a][3]){n[a]+=1;break}}}var f=n[0],l=0;for(var r=0;r<n.length;r++)n[r]<f&&(f=n[r],l=r);return l},i.prototype.regen=function(){if(this.data!=null){var e=this.data.getBounds(),n=this.ref.data.getBounds(),r=Math.min(e[0],n[0]),i=Math.max(e[1],n[1]),s=Math.min(e[2],n[2]),o=Math.max(e[3],n[3]),u=Math.min(e[4],n[4]),a=this.width-this.margin.left-this.margin.right,f=this.height-this.margin.top-this.margin.bottom,l=t.scale.linear,c=t.scale.log;this.xScale=l().range([0,a]).domain([r,i]).clamp(!0),this.xAxis=t.svg.axis().scale(this.xScale).orient("bottom"),this.yScale=c().range([f,0]).domain([s,o]).clamp(!0),this.yAxis=t.svg.axis().scale(this.yScale).orient("left");var h=[{id:"plot-ref",legend:"Reference Data",color:"#00ffff",data:this.ref.data.values},{id:"plot-sim",legend:"Simulation Data",color:"#ff0000",data:this.data.values}],p=this,d=t.svg.line().x(function(e,t){return p.xScale(e[3])}).y(function(e,t){return p.yScaleNonZero(e[0])});for(var v=0;v<h.length;v++){var m=h[v],g=this.svgPlot.select("g.plot#"+m.id);g.empty()&&(g=this.svgPlot.append("g").attr("class","plot").attr("id",m.id));var y=g.selectAll("path.plot-line").data([m.data]);y.enter().append("svg:path").attr("class","plot-line").attr("stroke",m.color),y.attr("d",d).attr("stroke",m.color),y.exit().remove();var y=g.selectAll("path.plot-bullet").data(m.data);y.enter().append("svg:path").attr("class","plot-bullet").attr("stroke",m.color),y.attr("transform",function(e,t){return"translate("+p.xScale(e[3])+","+p.yScaleNonZero(e[0])+")"}).attr("d",function(e,t){var n=p.errorBars.bulletSize/2,r="M"+ -n+","+ -n+"L"+n+","+ -n+"L"+n+","+n+"L"+ -n+","+n+"Z",i=p.yScaleNonZero(e[0])-p.yScaleNonZero(e[0]+e[1]),s=p.yScaleNonZero(e[0]-e[2])-p.yScaleNonZero(e[0]),o="M"+ -n+","+ -i+"L"+n+","+ -i+"Z"+"M0,"+ -i+"L0,"+ -n+"Z",u="M"+ -n+","+s+"L"+n+","+s+"Z"+"M0,"+s+"L0,"+n+"Z";return o+u+r}).attr("stroke",m.color)}this.xAxisGraphic=this.svgPlot.append("g").attr("class","x axis").attr("transform","translate(0,"+f+")").call(this.xAxis),this.yAxisGraphic=this.svgPlot.append("g").attr("class","y axis").call(this.yAxis),this.xAxisGraphic.call(this.xAxis),this.yAxisGraphic.call(this.yAxis);var b=a/2,w=f/2,E=this.legend.bullet,S=this.getLeastUsedRegion([[0,0,b,w],[b,0,b,w],[0,w,b,w],[b,w,b,w]],h),x=!1,T=0,N=0,C=1;S==0?(T=this.legend.titleMargin*2+20,N=20):S==1?(x=!0,T=a,N=20):S==2?(C=-1,T=this.legend.titleMargin*2+20,N=f-this.legend.titleMargin*2-20):S==3&&(x=!0,C=-1,T=a,N=f-this.legend.titleMargin*2-20),this.svgLegend.attr("transform","translate("+T+","+N+")");var y=this.svgLegend.selectAll("g.legend-entry").data(h),k=y.enter().append("g").attr("class","legend-entry");x?(k.append("path").attr("d","M"+ -E+","+ -E/2+"L0,"+ -E/2+"L0,"+E/2+"L"+ -E+","+E/2+"Z"),k.append("text").attr("transform","translate("+(-E-4)+",0)").style("dominant-baseline","middle").style("text-anchor","end")):(k.append("path").attr("d","M"+E+","+ -E/2+"L0,"+ -E/2+"L0,"+E/2+"L"+E+","+E/2+"Z"),k.append("text").attr("transform","translate("+(E+4)+",0)").style("dominant-baseline","middle").style("text-anchor","start")),y.attr("transform",function(e,t){return"translate(0,"+C*t*p.legend.height+")"}),y.selectAll("text").text(function(e,t){return e.legend+(e.data.interpolated?" [Estimate]":"")}),y.selectAll("path").attr("fill",function(e,t){var n=e.color;return typeof e.color=="object"&&(e.data.interpolated?n=e.color[1]:n=e.color[0]),n}),y.exit().remove()}},i.prototype.onUpdate=function(e){e?(this.data=e.data,this.ref=e.ref):(this.data=null,this.ref=null),this.regen()},i.prototype.onMetaUpdate=function(e){},i.prototype.onResize=function(e,t){this.width=e,this.height=t,this.svg.attr("width",e).attr("height",t),this.regen()},n.registerComponent("dataviz.histogram",i,1)}),define(["vas-basic/components/screen_explain","vas-basic/components/screen_home","vas-basic/components/screen_running","vas-basic/components/screen_tuning","vas-basic/components/screen_progress","vas-basic/components/screen_login","vas-basic/components/screen_results","vas-basic/components/nav_mini","vas-basic/components/tvhead_agent","vas-basic/components/backdrop_explain","vas-basic/components/backdrop_home","vas-basic/components/backdrop_running","vas-basic/components/backdrop_tuning","vas-basic/components/backdrop_progress","vas-basic/components/backdrop_login","vas-basic/components/backdrop_results","vas-basic/components/tuning/tunable","vas-basic/components/tuning/observable","vas-basic/components/tuning/status-tune","vas-basic/components/tuning/status-observe","vas-basic/components/tuning/pin","vas-basic/components/running/observable","vas-basic/components/running/status","vas-basic/components/onscreen","vas-basic/components/explain/blackboard","vas-basic/components/explain/machine","vas-basic/components/explain/physics","vas-basic/components/explain/book","vas-basic/infoblock/tunable","vas-basic/infoblock/observable","vas-basic/infoblock/book","vas-basic/dataviz/histogram"]),define("three",[],function(){var e={REVISION:"67"};return self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!self.requestAnimationFrame;++n)self.requestAnimationFrame=self[t[n]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[n]+"CancelAnimationFrame"]||self[t[n]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=self.setTimeout(function(){t(n+r)},r);return e=n+r,i}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),e.CullFaceNone=0,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.FrontFaceDirectionCW=0,e.FrontFaceDirectionCCW=1,e.BasicShadowMap=0,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.FrontSide=0,e.BackSide=1,e.DoubleSide=2,e.NoShading=0,e.FlatShading=1,e.SmoothShading=2,e.NoColors=0,e.FaceColors=1,e.VertexColors=2,e.NoBlending=0,e.NormalBlending=1,e.AdditiveBlending=2,e.SubtractiveBlending=3,e.MultiplyBlending=4,e.CustomBlending=5,e.AddEquation=100,e.SubtractEquation=101,e.ReverseSubtractEquation=102,e.ZeroFactor=200,e.OneFactor=201,e.SrcColorFactor=202,e.OneMinusSrcColorFactor=203,e.SrcAlphaFactor=204,e.OneMinusSrcAlphaFactor=205,e.DstAlphaFactor=206,e.OneMinusDstAlphaFactor=207,e.DstColorFactor=208,e.OneMinusDstColorFactor=209,e.SrcAlphaSaturateFactor=210,e.MultiplyOperation=0,e.MixOperation=1,e.AddOperation=2,e.UVMapping=function(){},e.CubeReflectionMapping=function(){},e.CubeRefractionMapping=function(){},e.SphericalReflectionMapping=function(){},e.SphericalRefractionMapping=function(){},e.RepeatWrapping=1e3,e.ClampToEdgeWrapping=1001,e.MirroredRepeatWrapping=1002,e.NearestFilter=1003,e.NearestMipMapNearestFilter=1004,e.NearestMipMapLinearFilter=1005,e.LinearFilter=1006,e.LinearMipMapNearestFilter=1007,e.LinearMipMapLinearFilter=1008,e.UnsignedByteType=1009,e.ByteType=1010,e.ShortType=1011,e.UnsignedShortType=1012,e.IntType=1013,e.UnsignedIntType=1014,e.FloatType=1015,e.UnsignedShort4444Type=1016,e.UnsignedShort5551Type=1017,e.UnsignedShort565Type=1018,e.AlphaFormat=1019,e.RGBFormat=1020,e.RGBAFormat=1021,e.LuminanceFormat=1022,e.LuminanceAlphaFormat=1023,e.RGB_S3TC_DXT1_Format=2001,e.RGBA_S3TC_DXT1_Format=2002,e.RGBA_S3TC_DXT3_Format=2003,e.RGBA_S3TC_DXT5_Format=2004,e.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},e.Color.prototype={constructor:e.Color,r:1,g:1,b:1,set:function(t){return t instanceof e.Color?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(0===t)this.r=this.g=this.b=n;else{var r=function(e,t,n){return 0>n&&(n+=1),1<n&&(n-=1),n<1/6?e+6*(t-e)*n:.5>n?t:n<2/3?e+6*(t-e)*(2/3-n):e};t=.5>=n?n*(1+t):n+t-n*t,n=2*n-t,this.r=r(n,t,e+1/3),this.g=r(n,t,e),this.b=r(n,t,e-1/3)}return this},setStyle:function(t){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(t))return t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(t),this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this;if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(t))return t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(t),this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this;if(/^\#([0-9a-f]{6})$/i.test(t))return t=/^\#([0-9a-f]{6})$/i.exec(t),this.setHex(parseInt(t[1],16)),this;if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(t))return t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(t),this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this;if(/^(\w+)$/i.test(t))return this.setHex(e.ColorKeywords[t]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e=e||{h:0,s:0,l:0};var t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),s=Math.min(t,n,r),o,u=(s+i)/2;if(s===i)s=o=0;else{var a=i-s,s=.5>=u?a/(i+s):a/(2-i-s);switch(i){case t:o=(n-r)/a+(n<r?6:0);break;case n:o=(r-t)/a+2;break;case r:o=(t-n)/a+4}o/=6}return e.h=o,e.s=s,e.l=u,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new e.Color).setRGB(this.r,this.g,this.b)}},e.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},e.Quaternion=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1},e.Quaternion.prototype={constructor:e.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this.onChangeCallback(),this},setFromEuler:function(t,n){if(0==t instanceof e.Euler)throw Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var r=Math.cos(t._x/2),i=Math.cos(t._y/2),s=Math.cos(t._z/2),o=Math.sin(t._x/2),u=Math.sin(t._y/2),a=Math.sin(t._z/2);return"XYZ"===t.order?(this._x=o*i*s+r*u*a,this._y=r*u*s-o*i*a,this._z=r*i*a+o*u*s,this._w=r*i*s-o*u*a):"YXZ"===t.order?(this._x=o*i*s+r*u*a,this._y=r*u*s-o*i*a,this._z=r*i*a-o*u*s,this._w=r*i*s+o*u*a):"ZXY"===t.order?(this._x=o*i*s-r*u*a,this._y=r*u*s+o*i*a,this._z=r*i*a+o*u*s,this._w=r*i*s-o*u*a):"ZYX"===t.order?(this._x=o*i*s-r*u*a,this._y=r*u*s+o*i*a,this._z=r*i*a-o*u*s,this._w=r*i*s+o*u*a):"YZX"===t.order?(this._x=o*i*s+r*u*a,this._y=r*u*s+o*i*a,this._z=r*i*a-o*u*s,this._w=r*i*s-o*u*a):"XZY"===t.order&&(this._x=o*i*s-r*u*a,this._y=r*u*s-o*i*a,this._z=r*i*a+o*u*s,this._w=r*i*s+o*u*a),!1!==n&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0];e=t[4];var r=t[8],i=t[1],s=t[5],o=t[9],u=t[2],a=t[6],t=t[10],f=n+s+t;return 0<f?(n=.5/Math.sqrt(f+1),this._w=.25/n,this._x=(a-o)*n,this._y=(r-u)*n,this._z=(i-e)*n):n>s&&n>t?(n=2*Math.sqrt(1+n-s-t),this._w=(a-o)/n,this._x=.25*n,this._y=(e+i)/n,this._z=(r+u)/n):s>t?(n=2*Math.sqrt(1+s-n-t),this._w=(r-u)/n,this._x=(e+i)/n,this._y=.25*n,this._z=(o+a)/n):(n=2*Math.sqrt(1+t-n-s),this._w=(i-e)/n,this._x=(r+u)/n,this._y=(o+a)/n,this._z=.25*n),this.onChangeCallback(),this},setFromUnitVectors:function(){var t,n;return function(r,i){return void 0===t&&(t=new e.Vector3),n=r.dot(i)+1,1e-6>n?(n=0,Math.abs(r.x)>Math.abs(r.z)?t.set(-r.y,r.x,0):t.set(0,-r.z,r.y)):t.crossVectors(r,i),this._x=t.x,this._y=t.y,this._z=t.z,this._w=n,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,s=e._w,o=t._x,u=t._y,a=t._z,f=t._w;return this._x=n*f+s*o+r*a-i*u,this._y=r*f+s*u+i*o-n*a,this._z=i*f+s*a+n*u-r*o,this._w=s*f-n*o-r*u-i*a,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var n=this._x,r=this._y,i=this._z,s=this._w,o=s*e._w+n*e._x+r*e._y+i*e._z;0>o?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e);if(1<=o)return this._w=s,this._x=n,this._y=r,this._z=i,this;var u=Math.acos(o),a=Math.sqrt(1-o*o);return.001>Math.abs(a)?(this._w=.5*(s+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this):(o=Math.sin((1-t)*u)/a,u=Math.sin(t*u)/a,this._w=s*o+this._w*u,this._x=n*o+this._x*u,this._y=r*o+this._y*u,this._z=i*o+this._z*u,this.onChangeCallback(),this)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new e.Quaternion(this._x,this._y,this._z,this._w)}},e.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)},e.Vector2=function(e,t){this.x=e||0,this.y=t||0},e.Vector2.prototype={constructor:e.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e):this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var t,n;return function(r,i){return void 0===t&&(t=new e.Vector2,n=new e.Vector2),t.set(r,r),n.set(i,i),this.clamp(t,n)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return e=this.y-e.y,t*t+e*e},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new e.Vector2(this.x,this.y)}},e.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},e.Vector3.prototype={constructor:e.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var t;return function(n){return 0==n instanceof e.Euler&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),void 0===t&&(t=new e.Quaternion),this.applyQuaternion(t.setFromEuler(n)),this}}(),applyAxisAngle:function(){var t;return function(n,r){return void 0===t&&(t=new e.Quaternion),this.applyQuaternion(t.setFromAxisAngle(n,r)),this}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[3]*n+e[6]*r,this.y=e[1]*t+e[4]*n+e[7]*r,this.z=e[2]*t+e[5]*n+e[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[4]*n+e[8]*r+e[12],this.y=e[1]*t+e[5]*n+e[9]*r+e[13],this.z=e[2]*t+e[6]*n+e[10]*r+e[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z;e=e.elements;var i=1/(e[3]*t+e[7]*n+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*n+e[8]*r+e[12])*i,this.y=(e[1]*t+e[5]*n+e[9]*r+e[13])*i,this.z=(e[2]*t+e[6]*n+e[10]*r+e[14])*i,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z;e=e.w;var u=e*t+s*r-o*n,a=e*n+o*t-i*r,f=e*r+i*n-s*t,t=-i*t-s*n-o*r;return this.x=u*e+t*-i+a*-o-f*-s,this.y=a*e+t*-s+f*-i-u*-o,this.z=f*e+t*-o+u*-s-a*-i,this},transformDirection:function(e){var t=this.x,n=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[4]*n+e[8]*r,this.y=e[1]*t+e[5]*n+e[9]*r,this.z=e[2]*t+e[6]*n+e[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e,this.z*=e):this.z=this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var t,n;return function(r,i){return void 0===t&&(t=new e.Vector3,n=new e.Vector3),t.set(r,r,r),n.set(i,i,i),this.clamp(t,n)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,s=t.x,o=t.y,u=t.z;return this.x=r*u-i*o,this.y=i*s-n*u,this.z=n*o-r*s,this},projectOnVector:function(){var t,n;return function(r){return void 0===t&&(t=new e.Vector3),t.copy(r).normalize(),n=this.dot(t),this.copy(t).multiplyScalar(n)}}(),projectOnPlane:function(){var t;return function(n){return void 0===t&&(t=new e.Vector3),t.copy(this).projectOnVector(n),this.sub(t)}}(),reflect:function(){var t;return function(n){return void 0===t&&(t=new e.Vector3),this.sub(t.copy(n).multiplyScalar(2*this.dot(n)))}}(),angleTo:function(t){return t=this.dot(t)/(this.length()*t.length()),Math.acos(e.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return e=this.z-e.z,t*t+n*n+e*e},setEulerFromRotationMatrix:function(e,t){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(e,t){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length();return e=this.set(e.elements[8],e.elements[9],e.elements[10]).length(),this.x=t,this.y=n,this.z=e,this},setFromMatrixColumn:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new e.Vector3(this.x,this.y,this.z)}},e.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1},e.Vector4.prototype={constructor:e.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w;return e=e.elements,this.x=e[0]*t+e[4]*n+e[8]*r+e[12]*i,this.y=e[1]*t+e[5]*n+e[9]*r+e[13]*i,this.z=e[2]*t+e[6]*n+e[10]*r+e[14]*i,this.w=e[3]*t+e[7]*n+e[11]*r+e[15]*i,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.z=this.y=this.x=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r;e=e.elements;var i=e[0];r=e[4];var s=e[8],o=e[1],u=e[5],a=e[9];n=e[2],t=e[6];var f=e[10];return.01>Math.abs(r-o)&&.01>Math.abs(s-n)&&.01>Math.abs(a-t)?.1>Math.abs(r+o)&&.1>Math.abs(s+n)&&.1>Math.abs(a+t)&&.1>Math.abs(i+u+f-3)?(this.set(1,0,0,0),this):(e=Math.PI,i=(i+1)/2,u=(u+1)/2,f=(f+1)/2,r=(r+o)/4,s=(s+n)/4,a=(a+t)/4,i>u&&i>f?.01>i?(t=0,r=n=.707106781):(t=Math.sqrt(i),n=r/t,r=s/t):u>f?.01>u?(t=.707106781,n=0,r=.707106781):(n=Math.sqrt(u),t=r/n,r=a/n):.01>f?(n=t=.707106781,r=0):(r=Math.sqrt(f),t=s/r,n=a/r),this.set(t,n,r,e),this):(e=Math.sqrt((t-a)*(t-a)+(s-n)*(s-n)+(o-r)*(o-r)),.001>Math.abs(e)&&(e=1),this.x=(t-a)/e,this.y=(s-n)/e,this.z=(o-r)/e,this.w=Math.acos((i+u+f-1)/2),this)},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var t,n;return function(r,i){return void 0===t&&(t=new e.Vector4,n=new e.Vector4),t.set(r,r,r,r),n.set(i,i,i,i),this.clamp(t,n)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new e.Vector4(this.x,this.y,this.z,this.w)}},e.Euler=function(t,n,r,i){this._x=t||0,this._y=n||0,this._z=r||0,this._order=i||e.Euler.DefaultOrder},e.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),e.Euler.DefaultOrder="XYZ",e.Euler.prototype={constructor:e.Euler,_x:0,_y:0,_z:0,_order:e.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(t,n){var r=e.Math.clamp,i=t.elements,s=i[0],o=i[4],u=i[8],a=i[1],f=i[5],l=i[9],c=i[2],h=i[6],i=i[10];return n=n||this._order,"XYZ"===n?(this._y=Math.asin(r(u,-1,1)),.99999>Math.abs(u)?(this._x=Math.atan2(-l,i),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(h,f),this._z=0)):"YXZ"===n?(this._x=Math.asin(-r(l,-1,1)),.99999>Math.abs(l)?(this._y=Math.atan2(u,i),this._z=Math.atan2(a,f)):(this._y=Math.atan2(-c,s),this._z=0)):"ZXY"===n?(this._x=Math.asin(r(h,-1,1)),.99999>Math.abs(h)?(this._y=Math.atan2(-c,i),this._z=Math.atan2(-o,f)):(this._y=0,this._z=Math.atan2(a,s))):"ZYX"===n?(this._y=Math.asin(-r(c,-1,1)),.99999>Math.abs(c)?(this._x=Math.atan2(h,i),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-o,f))):"YZX"===n?(this._z=Math.asin(r(a,-1,1)),.99999>Math.abs(a)?(this._x=Math.atan2(-l,f),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(u,i))):"XZY"===n?(this._z=Math.asin(-r(o,-1,1)),.99999>Math.abs(o)?(this._x=Math.atan2(h,f),this._y=Math.atan2(u,s)):(this._x=Math.atan2(-l,i),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+n),this._order=n,this.onChangeCallback(),this},setFromQuaternion:function(t,n,r){var i=e.Math.clamp,s=t.x*t.x,o=t.y*t.y,u=t.z*t.z,a=t.w*t.w;return n=n||this._order,"XYZ"===n?(this._x=Math.atan2(2*(t.x*t.w-t.y*t.z),a-s-o+u),this._y=Math.asin(i(2*(t.x*t.z+t.y*t.w),-1,1)),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),a+s-o-u)):"YXZ"===n?(this._x=Math.asin(i(2*(t.x*t.w-t.y*t.z),-1,1)),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),a-s-o+u),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),a-s+o-u)):"ZXY"===n?(this._x=Math.asin(i(2*(t.x*t.w+t.y*t.z),-1,1)),this._y=Math.atan2(2*(t.y*t.w-t.z*t.x),a-s-o+u),this._z=Math.atan2(2*(t.z*t.w-t.x*t.y),a-s+o-u)):"ZYX"===n?(this._x=Math.atan2(2*(t.x*t.w+t.z*t.y),a-s-o+u),this._y=Math.asin(i(2*(t.y*t.w-t.x*t.z),-1,1)),this._z=Math.atan2(2*(t.x*t.y+t.z*t.w),a+s-o-u)):"YZX"===n?(this._x=Math.atan2(2*(t.x*t.w-t.z*t.y),a-s+o-u),this._y=Math.atan2(2*(t.y*t.w-t.x*t.z),a+s-o-u),this._z=Math.asin(i(2*(t.x*t.y+t.z*t.w),-1,1))):"XZY"===n?(this._x=Math.atan2(2*(t.x*t.w+t.y*t.z),a-s+o-u),this._y=Math.atan2(2*(t.x*t.z+t.y*t.w),a+s-o-u),this._z=Math.asin(i(2*(t.z*t.w-t.x*t.y),-1,1))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+n),this._order=n,!1!==r&&this.onChangeCallback(),this},reorder:function(){var t=new e.Quaternion;return function(e){t.setFromEuler(this),this.setFromQuaternion(t,e)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new e.Euler(this._x,this._y,this._z,this._order)}},e.Line3=function(t,n){this.start=void 0!==t?t:new e.Vector3,this.end=void 0!==n?n:new e.Vector3},e.Line3.prototype={constructor:e.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(t){return(t||new e.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return(t||new e.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,n){var r=n||new e.Vector3;return this.delta(r).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var t=new e.Vector3,n=new e.Vector3;return function(r,i){t.subVectors(r,this.start),n.subVectors(this.end,this.start);var s=n.dot(n),s=n.dot(t)/s;return i&&(s=e.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(t,n,r){return t=this.closestPointToPointParameter(t,n),r=r||new e.Vector3,this.delta(r).multiplyScalar(t).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new e.Line3).copy(this)}},e.Box2=function(t,n){this.min=void 0!==t?t:new e.Vector2(Infinity,Infinity),this.max=void 0!==n?n:new e.Vector2(-Infinity,-Infinity)},e.Box2.prototype={constructor:e.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var n=1,r=e.length;n<r;n++)t=e[n],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new e.Vector2;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(t){return(t||new e.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new e.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(t,n){return(n||new e.Vector2).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(t,n){return(n||new e.Vector2).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new e.Vector2;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new e.Box2).copy(this)}},e.Box3=function(t,n){this.min=void 0!==t?t:new e.Vector3(Infinity,Infinity,Infinity),this.max=void 0!==n?n:new e.Vector3(-Infinity,-Infinity,-Infinity)},e.Box3.prototype={constructor:e.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},addPoint:function(e){return e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var t=1,n=e.length;t<n;t++)this.addPoint(e[t])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var t=new e.Vector3;return function(e,n){var r=t.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}}(),setFromObject:function(){var t=new e.Vector3;return function(e){var n=this;return e.updateMatrixWorld(!0),this.makeEmpty(),e.traverse(function(e){if(void 0!==e.geometry&&void 0!==e.geometry.vertices)for(var r=e.geometry.vertices,i=0,s=r.length;i<s;i++)t.copy(r[i]),t.applyMatrix4(e.matrixWorld),n.expandByPoint(t)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(t){return(t||new e.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(t){return(t||new e.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(t,n){return(n||new e.Vector3).set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(t,n){return(n||new e.Vector3).copy(t).clamp(this.min,this.max)},distanceToPoint:function(){var t=new e.Vector3;return function(e){return t.copy(e).clamp(this.min,this.max).sub(e).length()}}(),getBoundingSphere:function(){var t=new e.Vector3;return function(n){return n=n||new e.Sphere,n.center=this.center(),n.radius=.5*this.size(t).length(),n}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var t=[new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3,new e.Vector3];return function(e){return t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.makeEmpty(),this.setFromPoints(t),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new e.Box3).copy(this)}},e.Matrix3=function(e,t,n,r,i,s,o,u,a){var f=this.elements=new Float32Array(9);f[0]=void 0!==e?e:1,f[3]=t||0,f[6]=n||0,f[1]=r||0,f[4]=void 0!==i?i:1,f[7]=s||0,f[2]=o||0,f[5]=u||0,f[8]=void 0!==a?a:1},e.Matrix3.prototype={constructor:e.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;return f[0]=e,f[3]=t,f[6]=n,f[1]=r,f[4]=i,f[7]=s,f[2]=o,f[5]=u,f[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var t=new e.Vector3;return function(e,n,r){void 0===n&&(n=0),void 0===r&&(r=e.length);for(var i=0;i<r;i+=3,n+=3)t.x=e[n],t.y=e[n+1],t.z=e[n+2],t.applyMatrix3(this),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z;return e}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],e=e[8];return t*s*e-t*o*a-n*i*e+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4],n=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(0===n){if(t)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){var t=this.elements;return new e.Matrix3(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8])}},e.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements=new Float32Array(16);m[0]=void 0!==e?e:1,m[4]=t||0,m[8]=n||0,m[12]=r||0,m[1]=i||0,m[5]=void 0!==s?s:1,m[9]=o||0,m[13]=u||0,m[2]=a||0,m[6]=f||0,m[10]=void 0!==l?l:1,m[14]=c||0,m[3]=h||0,m[7]=p||0,m[11]=d||0,m[15]=void 0!==v?v:1},e.Matrix4.prototype={constructor:e.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements;return e=e.elements,t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(){var t=new e.Vector3;return function(e){var n=this.elements;e=e.elements;var r=1/t.set(e[0],e[1],e[2]).length(),i=1/t.set(e[4],e[5],e[6]).length(),s=1/t.set(e[8],e[9],e[10]).length();return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,this}}(),makeRotationFromEuler:function(t){0==t instanceof e.Euler&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var n=this.elements,r=t.x,i=t.y,s=t.z,o=Math.cos(r),r=Math.sin(r),u=Math.cos(i),i=Math.sin(i),a=Math.cos(s),s=Math.sin(s);if("XYZ"===t.order){t=o*a;var f=o*s,l=r*a,c=r*s;n[0]=u*a,n[4]=-u*s,n[8]=i,n[1]=f+l*i,n[5]=t-c*i,n[9]=-r*u,n[2]=c-t*i,n[6]=l+f*i,n[10]=o*u}else"YXZ"===t.order?(t=u*a,f=u*s,l=i*a,c=i*s,n[0]=t+c*r,n[4]=l*r-f,n[8]=o*i,n[1]=o*s,n[5]=o*a,n[9]=-r,n[2]=f*r-l,n[6]=c+t*r,n[10]=o*u):"ZXY"===t.order?(t=u*a,f=u*s,l=i*a,c=i*s,n[0]=t-c*r,n[4]=-o*s,n[8]=l+f*r,n[1]=f+l*r,n[5]=o*a,n[9]=c-t*r,n[2]=-o*i,n[6]=r,n[10]=o*u):"ZYX"===t.order?(t=o*a,f=o*s,l=r*a,c=r*s,n[0]=u*a,n[4]=l*i-f,n[8]=t*i+c,n[1]=u*s,n[5]=c*i+t,n[9]=f*i-l,n[2]=-i,n[6]=r*u,n[10]=o*u):"YZX"===t.order?(t=o*u,f=o*i,l=r*u,c=r*i,n[0]=u*a,n[4]=c-t*s,n[8]=l*s+f,n[1]=s,n[5]=o*a,n[9]=-r*a,n[2]=-i*a,n[6]=f*s+l,n[10]=t-c*s):"XZY"===t.order&&(t=o*u,f=o*i,l=r*u,c=r*i,n[0]=u*a,n[4]=-s,n[8]=i*a,n[1]=t*s+c,n[5]=o*a,n[9]=f*s-l,n[2]=l*s-f,n[6]=r*a,n[10]=c*s+t);return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i;e=n*o;var f=n*u,n=n*a,l=r*u,r=r*a,i=i*a,o=s*o,u=s*u,s=s*a;return t[0]=1-(l+i),t[4]=f-s,t[8]=n+u,t[1]=f+s,t[5]=1-(e+i),t[9]=r-o,t[2]=n-u,t[6]=r+o,t[10]=1-(e+l),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Vector3;return function(e,i,s){var o=this.elements;return r.subVectors(e,i).normalize(),0===r.length()&&(r.z=1),t.crossVectors(s,r).normalize(),0===t.length()&&(r.x+=1e-4,t.crossVectors(s,r).normalize()),n.crossVectors(r,t),o[0]=t.x,o[4]=n.x,o[8]=r.x,o[1]=t.y,o[5]=n.y,o[9]=r.y,o[2]=t.z,o[6]=n.z,o[10]=r.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],n=n[15],w=r[0],E=r[4],S=r[8],x=r[12],T=r[1],N=r[5],C=r[9],k=r[13],L=r[2],A=r[6],O=r[10],M=r[14],_=r[3],D=r[7],P=r[11],r=r[15];return i[0]=s*w+o*T+u*L+a*_,i[4]=s*E+o*N+u*A+a*D,i[8]=s*S+o*C+u*O+a*P,i[12]=s*x+o*k+u*M+a*r,i[1]=f*w+l*T+c*L+h*_,i[5]=f*E+l*N+c*A+h*D,i[9]=f*S+l*C+c*O+h*P,i[13]=f*x+l*k+c*M+h*r,i[2]=p*w+d*T+v*L+m*_,i[6]=p*E+d*N+v*A+m*D,i[10]=p*S+d*C+v*O+m*P,i[14]=p*x+d*k+v*M+m*r,i[3]=g*w+y*T+b*L+n*_,i[7]=g*E+y*N+b*A+n*D,i[11]=g*S+y*C+b*O+n*P,i[15]=g*x+y*k+b*M+n*r,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var t=new e.Vector3;return function(e,n,r){void 0===n&&(n=0),void 0===r&&(r=e.length);for(var i=0;i<r;i+=3,n+=3)t.x=e[n],t.y=e[n+1],t.z=e[n+2],t.applyMatrix4(this),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z;return e}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14];return e[3]*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+e[7]*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+e[11]*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+e[15]*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var t=new e.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var e=this.elements;return t.set(e[12],e[13],e[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[12],a=r[1],f=r[5],l=r[9],c=r[13],h=r[2],p=r[6],d=r[10],v=r[14],m=r[3],g=r[7],y=r[11],r=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*r+f*d*r,n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*r-s*d*r,n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*r+s*l*r,n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*r-a*d*r,n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*r+i*d*r,n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*r-i*l*r,n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v,n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*r+a*p*r,n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*r-i*p*r,n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*r+i*f*r,n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v,n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y,n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y,n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y,n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d,n=i*n[0]+a*n[4]+h*n[8]+m*n[12];if(0==n){if(t)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},translate:function(e){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,r=e.y;return e=e.z,t[0]*=n,t[4]*=r,t[8]*=e,t[1]*=n,t[5]*=r,t[9]*=e,t[2]*=n,t[6]*=r,t[10]*=e,t[3]*=n,t[7]*=r,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var t=new e.Vector3,n=new e.Matrix4;return function(e,r,i){var s=this.elements,o=t.set(s[0],s[1],s[2]).length(),u=t.set(s[4],s[5],s[6]).length(),f=t.set(s[8],s[9],s[10]).length();0>this.determinant()&&(o=-o),e.x=s[12],e.y=s[13],e.z=s[14],n.elements.set(this.elements),e=1/o;var s=1/u,l=1/f;return n.elements[0]*=e,n.elements[1]*=e,n.elements[2]*=e,n.elements[4]*=s,n.elements[5]*=s,n.elements[6]*=s,n.elements[8]*=l,n.elements[9]*=l,n.elements[10]*=l,r.setFromRotationMatrix(n),i.x=o,i.y=u,i.z=f,this}}(),makeFrustum:function(e,t,n,r,i,s){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-n),o[9]=(r+n)/(r-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(s+i)/(s-i),o[14]=-2*s*i/(s-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(t,n,r,i){t=r*Math.tan(e.Math.degToRad(.5*t));var s=-t;return this.makeFrustum(s*n,t*n,s,t,r,i)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-((t+e)/u),o[1]=0,o[5]=2/a,o[9]=0,o[13]=-((n+r)/a),o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-((s+i)/f),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var t=this.elements;return new e.Matrix4(t[0],t[4],t[8],t[12],t[1],t[5],t[9],t[13],t[2],t[6],t[10],t[14],t[3],t[7],t[11],t[15])}},e.Ray=function(t,n){this.origin=void 0!==t?t:new e.Vector3,this.direction=void 0!==n?n:new e.Vector3},e.Ray.prototype={constructor:e.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(t,n){return(n||new e.Vector3).copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var t=new e.Vector3;return function(e){return this.origin.copy(this.at(e,t)),this}}(),closestPointToPoint:function(t,n){var r=n||new e.Vector3;r.subVectors(t,this.origin);var i=r.dot(this.direction);return 0>i?r.copy(this.origin):r.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(){var t=new e.Vector3;return function(e){var n=t.subVectors(e,this.origin).dot(this.direction);return 0>n?this.origin.distanceTo(e):(t.copy(this.direction).multiplyScalar(n).add(this.origin),t.distanceTo(e))}}(),distanceSqToSegment:function(e,t,n,r){var i=e.clone().add(t).multiplyScalar(.5),s=t.clone().sub(e).normalize(),o=.5*e.distanceTo(t),u=this.origin.clone().sub(i);e=-this.direction.dot(s),t=u.dot(this.direction);var a=-u.dot(s),f=u.lengthSq(),l=Math.abs(1-e*e),c,h;return 0<=l?(u=e*a-t,c=e*t-a,h=o*l,0<=u?c>=-h?c<=h?(o=1/l,u*=o,c*=o,e=u*(u+e*c+2*t)+c*(e*u+c+2*a)+f):(c=o,u=Math.max(0,-(e*c+t)),e=-u*u+c*(c+2*a)+f):(c=-o,u=Math.max(0,-(e*c+t)),e=-u*u+c*(c+2*a)+f):c<=-h?(u=Math.max(0,-(-e*o+t)),c=0<u?-o:Math.min(Math.max(-o,-a),o),e=-u*u+c*(c+2*a)+f):c<=h?(u=0,c=Math.min(Math.max(-o,-a),o),e=c*(c+2*a)+f):(u=Math.max(0,-(e*o+t)),c=0<u?o:Math.min(Math.max(-o,-a),o),e=-u*u+c*(c+2*a)+f)):(c=0<e?-o:o,u=Math.max(0,-(e*c+t)),e=-u*u+c*(c+2*a)+f),n&&n.copy(this.direction.clone().multiplyScalar(u).add(this.origin)),r&&r.copy(s.clone().multiplyScalar(c).add(i)),e},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0==t?0==e.distanceToPoint(this.origin)?0:null:(e=-(this.origin.dot(e.normal)+e.constant)/t,0<=e?e:null)},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},isIntersectionBox:function(){var t=new e.Vector3;return function(e){return null!==this.intersectBox(e,t)}}(),intersectBox:function(e,t){var n,r,i,s,o;r=1/this.direction.x,s=1/this.direction.y,o=1/this.direction.z;var u=this.origin;0<=r?(n=(e.min.x-u.x)*r,r*=e.max.x-u.x):(n=(e.max.x-u.x)*r,r*=e.min.x-u.x),0<=s?(i=(e.min.y-u.y)*s,s*=e.max.y-u.y):(i=(e.max.y-u.y)*s,s*=e.min.y-u.y);if(n>s||i>r)return null;if(i>n||n!==n)n=i;if(s<r||r!==r)r=s;0<=o?(i=(e.min.z-u.z)*o,o*=e.max.z-u.z):(i=(e.max.z-u.z)*o,o*=e.min.z-u.z);if(n>o||i>r)return null;if(i>n||n!==n)n=i;if(o<r||r!==r)r=o;return 0>r?null:this.at(0<=n?n:r,t)},intersectTriangle:function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Vector3,i=new e.Vector3;return function(e,s,o,u,f){n.subVectors(s,e),r.subVectors(o,e),i.crossVectors(n,r),s=this.direction.dot(i);if(0<s){if(u)return null;u=1}else{if(!(0>s))return null;u=-1,s=-s}return t.subVectors(this.origin,e),e=u*this.direction.dot(r.crossVectors(t,r)),0>e?null:(o=u*this.direction.dot(n.cross(t)),0>o||e+o>s?null:(e=-u*t.dot(i),0>e?null:this.at(e/s,f)))}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new e.Ray).copy(this)}},e.Sphere=function(t,n){this.center=void 0!==t?t:new e.Vector3,this.radius=void 0!==n?n:0},e.Sphere.prototype={constructor:e.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var t=new e.Box3;return function(e,n){var r=this.center;void 0!==n?r.copy(n):t.setFromPoints(e).center(r);for(var i=0,s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(t,n){var r=this.center.distanceToSquared(t),i=n||new e.Vector3;return i.copy(t),r>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(t){return t=t||new e.Box3,t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new e.Sphere).copy(this)}},e.Frustum=function(t,n,r,i,s,o){this.planes=[void 0!==t?t:new e.Plane,void 0!==n?n:new e.Plane,void 0!==r?r:new e.Plane,void 0!==i?i:new e.Plane,void 0!==s?s:new e.Plane,void 0!==o?o:new e.Plane]},e.Frustum.prototype={constructor:e.Frustum,set:function(e,t,n,r,i,s){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},copy:function(e){for(var t=this.planes,n=0;6>n;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements;e=n[0];var r=n[1],i=n[2],s=n[3],o=n[4],u=n[5],a=n[6],f=n[7],l=n[8],c=n[9],h=n[10],p=n[11],d=n[12],v=n[13],m=n[14],n=n[15];return t[0].setComponents(s-e,f-o,p-l,n-d).normalize(),t[1].setComponents(s+e,f+o,p+l,n+d).normalize(),t[2].setComponents(s+r,f+u,p+c,n+v).normalize(),t[3].setComponents(s-r,f-u,p-c,n-v).normalize(),t[4].setComponents(s-i,f-a,p-h,n-m).normalize(),t[5].setComponents(s+i,f+a,p+h,n+m).normalize(),this},intersectsObject:function(){var t=new e.Sphere;return function(e){var n=e.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),t.copy(n.boundingSphere),t.applyMatrix4(e.matrixWorld),this.intersectsSphere(t)}}(),intersectsSphere:function(e){var t=this.planes,n=e.center;e=-e.radius;for(var r=0;6>r;r++)if(t[r].distanceToPoint(n)<e)return!1;return!0},intersectsBox:function(){var t=new e.Vector3,n=new e.Vector3;return function(e){for(var r=this.planes,i=0;6>i;i++){var s=r[i];t.x=0<s.normal.x?e.min.x:e.max.x,n.x=0<s.normal.x?e.max.x:e.min.x,t.y=0<s.normal.y?e.min.y:e.max.y,n.y=0<s.normal.y?e.max.y:e.min.y,t.z=0<s.normal.z?e.min.z:e.max.z,n.z=0<s.normal.z?e.max.z:e.min.z;var o=s.distanceToPoint(t),s=s.distanceToPoint(n);if(0>o&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;6>n;n++)if(0>t[n].distanceToPoint(e))return!1;return!0},clone:function(){return(new e.Frustum).copy(this)}},e.Plane=function(t,n){this.normal=void 0!==t?t:new e.Vector3(1,0,0),this.constant=void 0!==n?n:0},e.Plane.prototype={constructor:e.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var t=new e.Vector3,n=new e.Vector3;return function(e,r,i){return r=t.subVectors(i,r).cross(n.subVectors(e,r)).normalize(),this.setFromNormalAndCoplanarPoint(r,e),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(t,n){var r=this.distanceToPoint(t);return(n||new e.Vector3).copy(this.normal).multiplyScalar(r)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);return e=this.distanceToPoint(e.end),0>t&&0<e||0>e&&0<t},intersectLine:function(){var t=new e.Vector3;return function(n,r){var i=r||new e.Vector3,s=n.delta(t),o=this.normal.dot(s);if(0!=o)return o=-(n.start.dot(this.normal)+this.constant)/o,0>o||1<o?void 0:i.copy(s).multiplyScalar(o).add(n.start);if(0==this.distanceToPoint(n.start))return i.copy(n.start)}}(),coplanarPoint:function(t){return(t||new e.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Matrix3;return function(e,i){var s=i||r.getNormalMatrix(e),s=t.copy(this.normal).applyMatrix3(s),o=this.coplanarPoint(n);return o.applyMatrix4(e),this.setFromNormalAndCoplanarPoint(s,o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new e.Plane).copy(this)}},e.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=Array(36),n=0,r;return function(){for(var i=0;36>i;i++)8==i||13==i||18==i||23==i?t[i]="-":14==i?t[i]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),r=n&15,n>>=4,t[i]=e[19==i?r&3|8:r]);return t.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:0<e?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e}},e.Spline=function(t){function n(e,t,n,r,i,s,o){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t}this.points=t;var r=[],i={x:0,y:0,z:0},s,o,u,a,f,l,c,h,p;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return s=(this.points.length-1)*e,o=Math.floor(s),u=s-o,r[0]=0===o?o:o-1,r[1]=o,r[2]=o>this.points.length-2?this.points.length-1:o+1,r[3]=o>this.points.length-3?this.points.length-1:o+2,l=this.points[r[0]],c=this.points[r[1]],h=this.points[r[2]],p=this.points[r[3]],a=u*u,f=u*a,i.x=n(l.x,c.x,h.x,p.x,u,a,f),i.y=n(l.y,c.y,h.y,p.y,u,a,f),i.z=n(l.z,c.z,h.z,p.z,u,a,f),i},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(t){var n,r,i,s=n=n=0,o=new e.Vector3,u=new e.Vector3,a=[],f=0;a[0]=0,t||(t=100),r=this.points.length*t,o.copy(this.points[0]);for(t=1;t<r;t++)n=t/r,i=this.getPoint(n),u.copy(i),f+=u.distanceTo(o),o.copy(i),n*=this.points.length-1,n=Math.floor(n),n!=s&&(a[n]=f,s=n);return a[a.length]=f,{chunks:a,total:f}},this.reparametrizeByArcLength=function(t){var n,r,i,s,o,u,a=[],f=new e.Vector3,l=this.getLength();a.push(f.copy(this.points[0]).clone());for(n=1;n<this.points.length;n++){r=l.chunks[n]-l.chunks[n-1],u=Math.ceil(t*r/l.total),s=(n-1)/(this.points.length-1),o=n/(this.points.length-1);for(r=1;r<u-1;r++)i=s+1/u*r*(o-s),i=this.getPoint(i),a.push(f.copy(i).clone());a.push(f.copy(this.points[n]).clone())}this.points=a}},e.Triangle=function(t,n,r){this.a=void 0!==t?t:new e.Vector3,this.b=void 0!==n?n:new e.Vector3,this.c=void 0!==r?r:new e.Vector3},e.Triangle.normal=function(){var t=new e.Vector3;return function(n,r,i,s){return s=s||new e.Vector3,s.subVectors(i,r),t.subVectors(n,r),s.cross(t),n=s.lengthSq(),0<n?s.multiplyScalar(1/Math.sqrt(n)):s.set(0,0,0)}}(),e.Triangle.barycoordFromPoint=function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Vector3;return function(i,s,o,u,f){t.subVectors(u,s),n.subVectors(o,s),r.subVectors(i,s),i=t.dot(t),s=t.dot(n),o=t.dot(r);var l=n.dot(n);u=n.dot(r);var h=i*l-s*s;return f=f||new e.Vector3,0==h?f.set(-2,-1,-1):(h=1/h,l=(l*o-s*u)*h,i=(i*u-s*o)*h,f.set(1-l-i,i,l))}}(),e.Triangle.containsPoint=function(){var t=new e.Vector3;return function(n,r,i,s){return n=e.Triangle.barycoordFromPoint(n,r,i,s,t),0<=n.x&&0<=n.y&&1>=n.x+n.y}}(),e.Triangle.prototype={constructor:e.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var t=new e.Vector3,n=new e.Vector3;return function(){return t.subVectors(this.c,this.b),n.subVectors(this.a,this.b),.5*t.cross(n).length()}}(),midpoint:function(t){return(t||new e.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(t){return e.Triangle.normal(this.a,this.b,this.c,t)},plane:function(t){return(t||new e.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(t,n){return e.Triangle.barycoordFromPoint(t,this.a,this.b,this.c,n)},containsPoint:function(t){return e.Triangle.containsPoint(t,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new e.Triangle).copy(this)}},e.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},e.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},e.Clock.prototype={constructor:e.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e}},e.EventDispatcher=function(){},e.EventDispatcher.prototype={constructor:e.EventDispatcher,apply:function(t){t.addEventListener=e.EventDispatcher.prototype.addEventListener,t.hasEventListener=e.EventDispatcher.prototype.hasEventListener,t.removeEventListener=e.EventDispatcher.prototype.removeEventListener,t.dispatchEvent=e.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=[],r=t.length,i=0;i<r;i++)n[i]=t[i];for(i=0;i<r;i++)n[i].call(this,e)}}}},function(e){e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n),this.near=r||0,this.far=i||Infinity};var t=new e.Sphere,n=new e.Ray;new e.Plane,new e.Vector3;var r=new e.Vector3,i=new e.Matrix4,s=function(e,t){return e.distance-t.distance},o=new e.Vector3,u=new e.Vector3,a=new e.Vector3,f=function(s,l,p){if(s instanceof e.Sprite){r.setFromMatrixPosition(s.matrixWorld);var v=l.ray.distanceToPoint(r);if(v>s.scale.x)return p;p.push({distance:v,point:s.position,face:null,object:s})}else if(s instanceof e.LOD)r.setFromMatrixPosition(s.matrixWorld),v=l.ray.origin.distanceTo(r),f(s.getObjectForDistance(v),l,p);else if(s instanceof e.Mesh){var m=s.geometry;null===m.boundingSphere&&m.computeBoundingSphere(),t.copy(m.boundingSphere),t.applyMatrix4(s.matrixWorld);if(!1===l.ray.isIntersectionSphere(t))return p;i.getInverse(s.matrixWorld),n.copy(l.ray).applyMatrix4(i);if(null!==m.boundingBox&&!1===n.isIntersectionBox(m.boundingBox))return p;if(m instanceof e.BufferGeometry){var y=s.material;if(void 0===y)return p;var w=m.attributes,E,S,x=l.precision;if(void 0!==w.index){var T=w.index.array,N=w.position.array,C=m.offsets;0===C.length&&(C=[{start:0,count:N.length,index:0}]);for(var L=0,A=C.length;L<A;++L)for(var w=C[L].start,O=C[L].index,m=w,M=w+C[L].count;m<M;m+=3){w=O+T[m],E=O+T[m+1],S=O+T[m+2],o.set(N[3*w],N[3*w+1],N[3*w+2]),u.set(N[3*E],N[3*E+1],N[3*E+2]),a.set(N[3*S],N[3*S+1],N[3*S+2]);var _=y.side===e.BackSide?n.intersectTriangle(a,u,o,!0):n.intersectTriangle(o,u,a,y.side!==e.DoubleSide);null!==_&&(_.applyMatrix4(s.matrixWorld),v=l.ray.origin.distanceTo(_),v<x||v<l.near||v>l.far||p.push({distance:v,point:_,indices:[w,E,S],face:null,faceIndex:null,object:s}))}}else for(N=w.position.array,m=0,M=w.position.array.length;m<M;m+=3)w=m,E=m+1,S=m+2,o.set(N[3*w],N[3*w+1],N[3*w+2]),u.set(N[3*E],N[3*E+1],N[3*E+2]),a.set(N[3*S],N[3*S+1],N[3*S+2]),_=y.side===e.BackSide?n.intersectTriangle(a,u,o,!0):n.intersectTriangle(o,u,a,y.side!==e.DoubleSide),null!==_&&(_.applyMatrix4(s.matrixWorld),v=l.ray.origin.distanceTo(_),v<x||v<l.near||v>l.far||p.push({distance:v,point:_,indices:[w,E,S],face:null,faceIndex:null,object:s}))}else if(m instanceof e.Geometry)for(N=s.material instanceof e.MeshFaceMaterial,C=!0===N?s.material.materials:null,x=l.precision,T=m.vertices,L=0,A=m.faces.length;L<A;L++)if(O=m.faces[L],y=!0===N?C[O.materialIndex]:s.material,void 0!==y){w=T[O.a],E=T[O.b],S=T[O.c];if(!0===y.morphTargets){v=m.morphTargets,_=s.morphTargetInfluences,o.set(0,0,0),u.set(0,0,0),a.set(0,0,0);for(var M=0,D=v.length;M<D;M++){var P=_[M];if(0!==P){var H=v[M].vertices;o.x+=(H[O.a].x-w.x)*P,o.y+=(H[O.a].y-w.y)*P,o.z+=(H[O.a].z-w.z)*P,u.x+=(H[O.b].x-E.x)*P,u.y+=(H[O.b].y-E.y)*P,u.z+=(H[O.b].z-E.z)*P,a.x+=(H[O.c].x-S.x)*P,a.y+=(H[O.c].y-S.y)*P,a.z+=(H[O.c].z-S.z)*P}}o.add(w),u.add(E),a.add(S),w=o,E=u,S=a}_=y.side===e.BackSide?n.intersectTriangle(S,E,w,!0):n.intersectTriangle(w,E,S,y.side!==e.DoubleSide),null!==_&&(_.applyMatrix4(s.matrixWorld),v=l.ray.origin.distanceTo(_),v<x||v<l.near||v>l.far||p.push({distance:v,point:_,face:O,faceIndex:L,object:s}))}}else if(s instanceof e.Line){x=l.linePrecision,y=x*x,m=s.geometry,null===m.boundingSphere&&m.computeBoundingSphere(),t.copy(m.boundingSphere),t.applyMatrix4(s.matrixWorld);if(!1===l.ray.isIntersectionSphere(t))return p;i.getInverse(s.matrixWorld),n.copy(l.ray).applyMatrix4(i);if(m instanceof e.Geometry)for(T=m.vertices,x=T.length,w=new e.Vector3,E=new e.Vector3,S=s.type===e.LineStrip?1:2,m=0;m<x-1;m+=S)n.distanceSqToSegment(T[m],T[m+1],E,w)>y||(v=n.origin.distanceTo(E),v<l.near||v>l.far||p.push({distance:v,point:w.clone().applyMatrix4(s.matrixWorld),face:null,faceIndex:null,object:s}))}},l=function(e,t,n){e=e.getDescendants();for(var r=0,i=e.length;r<i;r++)f(e[r],t,n)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(e,t){var n=[];return!0===t&&l(e,this,n),f(e,this,n),n.sort(s),n},e.Raycaster.prototype.intersectObjects=function(e,t){for(var n=[],r=0,i=e.length;r<i;r++)f(e[r],this,n),!0===t&&l(e[r],this,n);return n.sort(s),n}}(e),e.Object3D=function(){this.id=e.Object3DIdCount++,this.uuid=e.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=new e.Vector3(0,1,0),this.position=new e.Vector3;var t=this;Object.defineProperties(this,{rotation:{enumerable:!0,value:(new e.Euler).onChange(function(){t.quaternion.setFromEuler(t.rotation,!1)})},quaternion:{enumerable:!0,value:(new e.Quaternion).onChange(function(){t.rotation.setFromQuaternion(t.quaternion,void 0,!1)})},scale:{enumerable:!0,value:new e.Vector3(1,1,1)}}),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new e.Matrix4,this.matrixWorld=new e.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},e.Object3D.prototype={constructor:e.Object3D,get eulerOrder(){return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var t=new e.Quaternion;return function(e,n){return t.setFromAxisAngle(e,n),this.quaternion.multiply(t),this}}(),rotateX:function(){var t=new e.Vector3(1,0,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateY:function(){var t=new e.Vector3(0,1,0);return function(e){return this.rotateOnAxis(t,e)}}(),rotateZ:function(){var t=new e.Vector3(0,0,1);return function(e){return this.rotateOnAxis(t,e)}}(),translateOnAxis:function(){var t=new e.Vector3;return function(e,n){return t.copy(e),t.applyQuaternion(this.quaternion),this.position.add(t.multiplyScalar(n)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var t=new e.Vector3(1,0,0);return function(e){return this.translateOnAxis(t,e)}}(),translateY:function(){var t=new e.Vector3(0,1,0);return function(e){return this.translateOnAxis(t,e)}}(),translateZ:function(){var t=new e.Vector3(0,0,1);return function(e){return this.translateOnAxis(t,e)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var t=new e.Matrix4;return function(e){return e.applyMatrix4(t.getInverse(this.matrixWorld))}}(),lookAt:function(){var t=new e.Matrix4;return function(e){t.lookAt(e,this.position,this.up),this.quaternion.setFromRotationMatrix(t)}}(),add:function(t){if(t===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(t instanceof e.Object3D){void 0!==t.parent&&t.parent.remove(t),t.parent=this,t.dispatchEvent({type:"added"}),this.children.push(t);for(var n=this;void 0!==n.parent;)n=n.parent;void 0!==n&&n instanceof e.Scene&&n.__addObject(t)}},remove:function(t){var n=this.children.indexOf(t);if(-1!==n){t.parent=void 0,t.dispatchEvent({type:"removed"}),this.children.splice(n,1);for(n=this;void 0!==n.parent;)n=n.parent;void 0!==n&&n instanceof e.Scene&&n.__removeObject(t)}},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.id===e||!0===t&&(i=i.getObjectById(e,t),void 0!==i))return i}},getObjectByName:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.name===e||!0===t&&(i=i.getObjectByName(e,t),void 0!==i))return i}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,n=this.children.length;t<n;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===e)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},clone:function(t,n){void 0===t&&(t=new e.Object3D),void 0===n&&(n=!0),t.name=this.name,t.up.copy(this.up),t.position.copy(this.position),t.quaternion.copy(this.quaternion),t.scale.copy(this.scale),t.renderDepth=this.renderDepth,t.rotationAutoUpdate=this.rotationAutoUpdate,t.matrix.copy(this.matrix),t.matrixWorld.copy(this.matrixWorld),t.matrixAutoUpdate=this.matrixAutoUpdate,t.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,t.visible=this.visible,t.castShadow=this.castShadow,t.receiveShadow=this.receiveShadow,t.frustumCulled=this.frustumCulled,t.userData=JSON.parse(JSON.stringify(this.userData));if(!0===n)for(var r=0;r<this.children.length;r++)t.add(this.children[r].clone());return t}},e.EventDispatcher.prototype.apply(e.Object3D.prototype),e.Object3DIdCount=0,e.Projector=function(){function t(){if(c===p){var t=new e.RenderableVertex;return h.push(t),p++,c++,t}return h[c++]}function n(){if(v===g){var t=new e.RenderableFace;return m.push(t),g++,v++,t}return m[v++]}function r(){if(b===E){var t=new e.RenderableLine;return w.push(t),E++,b++,t}return w[b++]}function i(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function s(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return 0<=i&&0<=s&&0<=o&&0<=u?!0:0>i&&0>s||0>o&&0>u?!1:(0>i?n=Math.max(n,i/(i-s)):0>s&&(r=Math.min(r,i/(i-s))),0>o?n=Math.max(n,o/(o-u)):0>u&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerp(t,n),t.lerp(e,1-r),!0))}var o,u,a=[],f=0,l,c,h=[],p=0,d,v,m=[],g=0,y,b,w=[],E=0,S,x,T=[],N=0,C={objects:[],lights:[],elements:[]},k=new e.Vector3,L=new e.Vector3,A=new e.Vector3,O=new e.Vector3,M=new e.Vector4,_=new e.Box3(new e.Vector3(-1,-1,-1),new e.Vector3(1,1,1)),D=new e.Box3,P=Array(3),H=new e.Matrix4,B=new e.Matrix4,j,F=new e.Matrix4,I=new e.Matrix3,q=new e.Frustum,R=new e.Vector4,U=new e.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),B.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(B)},this.unprojectVector=function(){var t=new e.Matrix4;return function(e,n){return t.getInverse(n.projectionMatrix),B.multiplyMatrices(n.matrixWorld,t),e.applyProjection(B)}}(),this.pickingRay=function(t,n){t.z=-1;var r=new e.Vector3(t.x,t.y,1);return this.unprojectVector(t,n),this.unprojectVector(r,n),r.sub(t).normalize(),new e.Raycaster(t,r)};var z=function(t){if(!1!==t.visible){if(t instanceof e.Light)C.lights.push(t);else if(t instanceof e.Mesh||t instanceof e.Line||t instanceof e.Sprite)if(!1===t.frustumCulled||!0===q.intersectsObject(t)){if(u===f){var n=new e.RenderableObject;a.push(n),f++,u++,o=n}else o=a[u++];o.id=t.id,o.object=t,null!==t.renderDepth?o.z=t.renderDepth:(O.setFromMatrixPosition(t.matrixWorld),O.applyProjection(B),o.z=O.z),C.objects.push(o)}for(var n=0,r=t.children.length;n<r;n++)z(t.children[n])}},W=new function(){var i=[],s=[],o=null,u=null,a=new e.Matrix3,f=function(e){var t=e.positionWorld,n=e.positionScreen;t.copy(e.position).applyMatrix4(j),n.copy(t).applyMatrix4(B),t=1/n.w,n.x*=t,n.y*=t,n.z*=t,e.visible=-1<=n.x&&1>=n.x&&-1<=n.y&&1>=n.y&&-1<=n.z&&1>=n.z},c=function(e,t,n){return!0===e.visible||!0===t.visible||!0===n.visible?!0:(P[0]=e.positionScreen,P[1]=t.positionScreen,P[2]=n.positionScreen,_.isIntersectionBox(D.setFromPoints(P)))},p=function(e,t,n){return 0>(n.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(n.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)};return{setObject:function(e){o=e,u=o.material,a.getNormalMatrix(o.matrixWorld),i.length=0,s.length=0},projectVertex:f,checkTriangleVisibility:c,checkBackfaceCulling:p,pushVertex:function(e,n,r){l=t(),l.position.set(e,n,r),f(l)},pushNormal:function(e,t,n){i.push(e,t,n)},pushUv:function(e,t){s.push(e,t)},pushLine:function(e,t){var n=h[e],i=h[t];y=r(),y.id=o.id,y.v1.copy(n),y.v2.copy(i),y.z=(n.positionScreen.z+i.positionScreen.z)/2,y.material=o.material,C.elements.push(y)},pushTriangle:function(t,r,f){var l=h[t],v=h[r],m=h[f];if(!1!==c(l,v,m)&&(u.side===e.DoubleSide||!0===p(l,v,m))){d=n(),d.id=o.id,d.v1.copy(l),d.v2.copy(v),d.v3.copy(m),d.z=(l.positionScreen.z+v.positionScreen.z+m.positionScreen.z)/3;for(l=0;3>l;l++)v=3*arguments[l],m=d.vertexNormalsModel[l],m.set(i[v],i[v+1],i[v+2]),m.applyMatrix3(a).normalize(),v=2*arguments[l],d.uvs[l].set(s[v],s[v+1]);d.vertexNormalsLength=3,d.material=o.material,C.elements.push(d)}}}};this.projectScene=function(o,a,f,l){var p,m,g,w,E,O,_,D;x=b=v=0,C.elements.length=0,!0===o.autoUpdate&&o.updateMatrixWorld(),void 0===a.parent&&a.updateMatrixWorld(),H.copy(a.matrixWorldInverse.getInverse(a.matrixWorld)),B.multiplyMatrices(a.projectionMatrix,H),q.setFromMatrix(B),u=0,C.objects.length=0,C.lights.length=0,z(o),!0===f&&C.objects.sort(i),o=0;for(f=C.objects.length;o<f;o++)if(p=C.objects[o].object,m=p.geometry,W.setObject(p),j=p.matrixWorld,c=0,p instanceof e.Mesh){if(m instanceof e.BufferGeometry){if(O=m.attributes,p=m.offsets,void 0!==O.position){_=O.position.array,m=0;for(w=_.length;m<w;m+=3)W.pushVertex(_[m],_[m+1],_[m+2]);if(void 0!==O.normal)for(D=O.normal.array,m=0,w=D.length;m<w;m+=3)W.pushNormal(D[m],D[m+1],D[m+2]);if(void 0!==O.uv)for(D=O.uv.array,m=0,w=D.length;m<w;m+=2)W.pushUv(D[m],D[m+1]);if(void 0!==O.index)if(O=O.index.array,0<p.length)for(o=0;o<p.length;o++)for(w=p[o],_=w.index,m=w.start,w=w.start+w.count;m<w;m+=3)W.pushTriangle(O[m]+_,O[m+1]+_,O[m+2]+_);else for(m=0,w=O.length;m<w;m+=3)W.pushTriangle(O[m],O[m+1],O[m+2]);else for(m=0,w=_.length/3;m<w;m+=3)W.pushTriangle(m,m+1,m+2)}}else if(m instanceof e.Geometry){g=m.vertices,w=m.faces,O=m.faceVertexUvs[0],I.getNormalMatrix(j),_=p.material instanceof e.MeshFaceMaterial,D=!0===_?p.material:null;for(var P=0,$=g.length;P<$;P++){var Z=g[P];W.pushVertex(Z.x,Z.y,Z.z)}P=0;for($=w.length;P<$;P++){g=w[P];var et=!0===_?D.materials[g.materialIndex]:p.material;if(void 0!==et){var tt=et.side,Z=h[g.a],nt=h[g.b],rt=h[g.c];if(!0===et.morphTargets){E=m.morphTargets;var it=p.morphTargetInfluences,st=Z.position,ot=nt.position,ut=rt.position;k.set(0,0,0),L.set(0,0,0),A.set(0,0,0);for(var at=0,ft=E.length;at<ft;at++){var lt=it[at];if(0!==lt){var ct=E[at].vertices;k.x+=(ct[g.a].x-st.x)*lt,k.y+=(ct[g.a].y-st.y)*lt,k.z+=(ct[g.a].z-st.z)*lt,L.x+=(ct[g.b].x-ot.x)*lt,L.y+=(ct[g.b].y-ot.y)*lt,L.z+=(ct[g.b].z-ot.z)*lt,A.x+=(ct[g.c].x-ut.x)*lt,A.y+=(ct[g.c].y-ut.y)*lt,A.z+=(ct[g.c].z-ut.z)*lt}}Z.position.add(k),nt.position.add(L),rt.position.add(A),W.projectVertex(Z),W.projectVertex(nt),W.projectVertex(rt)}if(!1!==W.checkTriangleVisibility(Z,nt,rt)){it=W.checkBackfaceCulling(Z,nt,rt);if(tt!==e.DoubleSide){if(tt===e.FrontSide&&!1===it)continue;if(tt===e.BackSide&&!0===it)continue}d=n(),d.id=p.id,d.v1.copy(Z),d.v2.copy(nt),d.v3.copy(rt),d.normalModel.copy(g.normal),!1!==it||tt!==e.BackSide&&tt!==e.DoubleSide||d.normalModel.negate(),d.normalModel.applyMatrix3(I).normalize(),E=g.vertexNormals,st=0;for(ot=Math.min(E.length,3);st<ot;st++)ut=d.vertexNormalsModel[st],ut.copy(E[st]),!1!==it||tt!==e.BackSide&&tt!==e.DoubleSide||ut.negate(),ut.applyMatrix3(I).normalize();d.vertexNormalsLength=E.length,tt=O[P];if(void 0!==tt)for(E=0;3>E;E++)d.uvs[E].copy(tt[E]);d.color=g.color,d.material=et,d.z=(Z.positionScreen.z+nt.positionScreen.z+rt.positionScreen.z)/3,C.elements.push(d)}}}}}else if(p instanceof e.Line){if(m instanceof e.BufferGeometry){if(O=m.attributes,void 0!==O.position){_=O.position.array,m=0;for(w=_.length;m<w;m+=3)W.pushVertex(_[m],_[m+1],_[m+2]);if(void 0!==O.index)for(O=O.index.array,m=0,w=O.length;m<w;m+=2)W.pushLine(O[m],O[m+1]);else for(m=0,w=_.length/3-1;m<w;m++)W.pushLine(m,m+1)}}else if(m instanceof e.Geometry&&(F.multiplyMatrices(B,j),g=p.geometry.vertices,0!==g.length))for(Z=t(),Z.positionScreen.copy(g[0]).applyMatrix4(F),m=p.type===e.LinePieces?2:1,P=1,$=g.length;P<$;P++)Z=t(),Z.positionScreen.copy(g[P]).applyMatrix4(F),0<(P+1)%m||(nt=h[c-2],R.copy(Z.positionScreen),U.copy(nt.positionScreen),!0===s(R,U)&&(R.multiplyScalar(1/R.w),U.multiplyScalar(1/U.w),y=r(),y.id=p.id,y.v1.positionScreen.copy(R),y.v2.positionScreen.copy(U),y.z=Math.max(R.z,U.z),y.material=p.material,p.material.vertexColors===e.VertexColors&&(y.vertexColors[0].copy(p.geometry.colors[P]),y.vertexColors[1].copy(p.geometry.colors[P-1])),C.elements.push(y)))}else p instanceof e.Sprite&&(M.set(j.elements[12],j.elements[13],j.elements[14],1),M.applyMatrix4(B),m=1/M.w,M.z*=m,-1<=M.z&&1>=M.z&&(x===N?(w=new e.RenderableSprite,T.push(w),N++,x++,S=w):S=T[x++],S.id=p.id,S.x=M.x*m,S.y=M.y*m,S.z=M.z,S.object=p,S.rotation=p.rotation,S.scale.x=p.scale.x*Math.abs(S.x-(M.x+a.projectionMatrix.elements[0])/(M.w+a.projectionMatrix.elements[12])),S.scale.y=p.scale.y*Math.abs(S.y-(M.y+a.projectionMatrix.elements[5])/(M.w+a.projectionMatrix.elements[13])),S.material=p.material,C.elements.push(S)));return!0===l&&C.elements.sort(i),C}},e.Face3=function(t,n,r,i,s,o){this.a=t,this.b=n,this.c=r,this.normal=i instanceof e.Vector3?i:new e.Vector3,this.vertexNormals=i instanceof Array?i:[],this.color=s instanceof e.Color?s:new e.Color,this.vertexColors=s instanceof Array?s:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0},e.Face3.prototype={constructor:e.Face3,clone:function(){var t=new e.Face3(this.a,this.b,this.c);t.normal.copy(this.normal),t.color.copy(this.color),t.materialIndex=this.materialIndex;var n,r;n=0;for(r=this.vertexNormals.length;n<r;n++)t.vertexNormals[n]=this.vertexNormals[n].clone();n=0;for(r=this.vertexColors.length;n<r;n++)t.vertexColors[n]=this.vertexColors[n].clone();n=0;for(r=this.vertexTangents.length;n<r;n++)t.vertexTangents[n]=this.vertexTangents[n].clone();return t}},e.Face4=function(t,n,r,i,s,o,u){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new e.Face3(t,n,r,s,o,u)},e.BufferAttribute=function(){},e.BufferAttribute.prototype={constructor:e.BufferAttribute,get length(){return this.array.length},set:function(e){this.array.set(e)},setX:function(e,t){this.array[e*this.itemSize]=t},setY:function(e,t){this.array[e*this.itemSize+1]=t},setZ:function(e,t){this.array[e*this.itemSize+2]=t},setXY:function(e,t,n){e*=this.itemSize,this.array[e]=t,this.array[e+1]=n},setXYZ:function(e,t,n,r){e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=r},setXYZW:function(e,t,n,r,i){e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i}},e.Int8Attribute=function(e,t){this.array=new Int8Array(e*t),this.itemSize=t},e.Int8Attribute.prototype=Object.create(e.BufferAttribute.prototype),e.Uint8Attribute=function(e,t){this.array=new Uint8Array(e*t),this.itemSize=t},e.Uint8Attribute.prototype=Object.create(e.BufferAttribute.prototype),e.Uint8ClampedAttribute=function(e,t){this.array=new Uint8ClampedArray(e*t),this.itemSize=t},e.Uint8ClampedAttribute.prototype=Object.create(e.BufferAttribute.prototype),e.Int16Attribute=function(e,t){this.array=new Int16Array(e*t),this.itemSize=t},e.Int16Attribute.prototype=Object.create(e.BufferAttribute.prototype),e.Uint16Attribute=function(e,t){this.array=new Uint16Array(e*t),this.itemSize=t},e.Uint16Attribute.prototype=Object.create(e.BufferAttribute.prototype),e.Int32Attribute=function(e,t){this.array=new Int32Array(e*t),this.itemSize=t},e.Int32Attribute.prototype=Object.create(e.BufferAttribute.prototype),e.Uint32Attribute=function(e,t){this.array=new Uint32Array(e*t),this.itemSize=t},e.Uint32Attribute.prototype=Object.create(e.BufferAttribute.prototype),e.Float32Attribute=function(e,t){this.array=new Float32Array(e*t),this.itemSize=t},e.Float32Attribute.prototype=Object.create(e.BufferAttribute.prototype),e.Float64Attribute=function(e,t){this.array=new Float64Array(e*t),this.itemSize=t},e.Float64Attribute.prototype=Object.create(e.BufferAttribute.prototype),e.BufferGeometry=function(){this.id=e.GeometryIdCount++,this.uuid=e.Math.generateUUID(),this.name="",this.attributes={},this.offsets=this.drawcalls=[],this.boundingSphere=this.boundingBox=null},e.BufferGeometry.prototype={constructor:e.BufferGeometry,addAttribute:function(t,n,r){0==n instanceof e.BufferAttribute?(console.warn("DEPRECATED: BufferGeometry's addAttribute() now expects ( name, attribute )."),this.attributes[t]={array:n,itemSize:r}):this.attributes[t]=n},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,n){this.drawcalls.push({start:e,count:t,index:void 0!==n?n:0})},applyMatrix:function(t){var n=this.attributes.position;void 0!==n&&(t.applyToVector3Array(n.array),n.needsUpdate=!0),n=this.attributes.normal,void 0!==n&&((new e.Matrix3).getNormalMatrix(t).applyToVector3Array(n.array),n.needsUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new e.Box3);var t=this.attributes.position.array;if(t){var n=this.boundingBox;3<=t.length&&(n.min.x=n.max.x=t[0],n.min.y=n.max.y=t[1],n.min.z=n.max.z=t[2]);for(var r=3,i=t.length;r<i;r+=3){var s=t[r],o=t[r+1],u=t[r+2];s<n.min.x?n.min.x=s:s>n.max.x&&(n.max.x=s),o<n.min.y?n.min.y=o:o>n.max.y&&(n.max.y=o),u<n.min.z?n.min.z=u:u>n.max.z&&(n.max.z=u)}}if(void 0===t||0===t.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){var t=new e.Box3,n=new e.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere);var r=this.attributes.position.array;if(r){t.makeEmpty();for(var i=this.boundingSphere.center,s=0,o=r.length;s<o;s+=3)n.set(r[s],r[s+1],r[s+2]),t.addPoint(n);t.center(i);for(var u=0,s=0,o=r.length;s<o;s+=3)n.set(r[s],r[s+1],r[s+2]),u=Math.max(u,i.distanceToSquared(n));this.boundingSphere.radius=Math.sqrt(u)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){if(this.attributes.position){var t,n,r,i;t=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(t)};else for(t=0,n=this.attributes.normal.array.length;t<n;t++)this.attributes.normal.array[t]=0;var s=this.attributes.position.array,o=this.attributes.normal.array,u,a,f,l,c,h,p=new e.Vector3,d=new e.Vector3,v=new e.Vector3,m=new e.Vector3,g=new e.Vector3;if(this.attributes.index){var y=this.attributes.index.array,b=0<this.offsets.length?this.offsets:[{start:0,count:y.length,index:0}];r=0;for(i=b.length;r<i;++r){n=b[r].start,u=b[r].count;var w=b[r].index;t=n;for(n+=u;t<n;t+=3)u=w+y[t],a=w+y[t+1],f=w+y[t+2],l=s[3*u],c=s[3*u+1],h=s[3*u+2],p.set(l,c,h),l=s[3*a],c=s[3*a+1],h=s[3*a+2],d.set(l,c,h),l=s[3*f],c=s[3*f+1],h=s[3*f+2],v.set(l,c,h),m.subVectors(v,d),g.subVectors(p,d),m.cross(g),o[3*u]+=m.x,o[3*u+1]+=m.y,o[3*u+2]+=m.z,o[3*a]+=m.x,o[3*a+1]+=m.y,o[3*a+2]+=m.z,o[3*f]+=m.x,o[3*f+1]+=m.y,o[3*f+2]+=m.z}}else for(t=0,n=s.length;t<n;t+=9)l=s[t],c=s[t+1],h=s[t+2],p.set(l,c,h),l=s[t+3],c=s[t+4],h=s[t+5],d.set(l,c,h),l=s[t+6],c=s[t+7],h=s[t+8],v.set(l,c,h),m.subVectors(v,d),g.subVectors(p,d),m.cross(g),o[t]=m.x,o[t+1]=m.y,o[t+2]=m.z,o[t+3]=m.x,o[t+4]=m.y,o[t+5]=m.z,o[t+6]=m.x,o[t+7]=m.y,o[t+8]=m.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeTangents:function(){function t(e,t,n){h=i[3*e],p=i[3*e+1],d=i[3*e+2],v=i[3*t],m=i[3*t+1],g=i[3*t+2],y=i[3*n],b=i[3*n+1],w=i[3*n+2],E=o[2*e],S=o[2*e+1],x=o[2*t],T=o[2*t+1],N=o[2*n],C=o[2*n+1],k=v-h,L=y-h,A=m-p,O=b-p,M=g-d,_=w-d,D=x-E,P=N-E,H=T-S,B=C-S,j=1/(D*B-P*H),F.set((B*k-H*L)*j,(B*A-H*O)*j,(B*M-H*_)*j),I.set((D*L-P*k)*j,(D*O-P*A)*j,(D*_-P*M)*j),f[e].add(F),f[t].add(F),f[n].add(F),l[e].add(I),l[t].add(I),l[n].add(I)}function n(e){K.x=s[3*e],K.y=s[3*e+1],K.z=s[3*e+2],Q.copy(K),Y=f[e],$.copy(Y),$.sub(K.multiplyScalar(K.dot(Y))).normalize(),J.crossVectors(Q,Y),Z=J.dot(l[e]),G=0>Z?-1:1,a[4*e]=$.x,a[4*e+1]=$.y,a[4*e+2]=$.z,a[4*e+3]=G}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var r=this.attributes.index.array,i=this.attributes.position.array,s=this.attributes.normal.array,o=this.attributes.uv.array,u=i.length/3;void 0===this.attributes.tangent&&(this.attributes.tangent={itemSize:4,array:new Float32Array(4*u)});for(var a=this.attributes.tangent.array,f=[],l=[],c=0;c<u;c++)f[c]=new e.Vector3,l[c]=new e.Vector3;var h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F=new e.Vector3,I=new e.Vector3,q,R,U,z,W,X=this.offsets,c=0;for(R=X.length;c<R;++c){q=X[c].start,U=X[c].count;var V=X[c].index,u=q;for(q+=U;u<q;u+=3)U=V+r[u],z=V+r[u+1],W=V+r[u+2],t(U,z,W)}var $=new e.Vector3,J=new e.Vector3,K=new e.Vector3,Q=new e.Vector3,G,Y,Z,c=0;for(R=X.length;c<R;++c)for(q=X[c].start,U=X[c].count,V=X[c].index,u=q,q+=U;u<q;u+=3)U=V+r[u],z=V+r[u+1],W=V+r[u+2],n(U),n(z),n(W)}},computeOffsets:function(e){var t=e;void 0===e&&(t=65535),Date.now(),e=this.attributes.index.array;for(var n=this.attributes.position.array,r=e.length/3,i=new Uint16Array(e.length),s=0,o=0,u=[{start:0,count:0,index:0}],a=u[0],f=0,l=0,c=new Int32Array(6),h=new Int32Array(n.length),p=new Int32Array(n.length),d=0;d<n.length;d++)h[d]=-1,p[d]=-1;for(n=0;n<r;n++){for(var v=l=0;3>v;v++)d=e[3*n+v],-1==h[d]?(c[2*v]=d,c[2*v+1]=-1,l++):h[d]<a.index?(c[2*v]=d,c[2*v+1]=-1,f++):(c[2*v]=d,c[2*v+1]=h[d]);if(o+l>a.index+t)for(a={start:s,count:0,index:o},u.push(a),l=0;6>l;l+=2)v=c[l+1],-1<v&&v<a.index&&(c[l+1]=-1);for(l=0;6>l;l+=2)d=c[l],v=c[l+1],-1===v&&(v=o++),h[d]=v,p[v]=d,i[s++]=v-a.index,a.count++}return this.reorderBuffers(i,p,o),this.offsets=u},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){for(var e=this.attributes.normal.array,t,n,r,i=0,s=e.length;i<s;i+=3)t=e[i],n=e[i+1],r=e[i+2],t=1/Math.sqrt(t*t+n*n+r*r),e[i]*=t,e[i+1]*=t,e[i+2]*=t},reorderBuffers:function(e,t,n){var r={},i=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],s;for(s in this.attributes)if("index"!=s)for(var o=this.attributes[s].array,u=0,a=i.length;u<a;u++){var f=i[u];if(o instanceof f){r[s]=new f(this.attributes[s].itemSize*n);break}}for(i=0;i<n;i++)for(s in o=t[i],this.attributes)if("index"!=s)for(var u=this.attributes[s].array,a=this.attributes[s].itemSize,f=r[s],l=0;l<a;l++)f[i*a+l]=u[o*a+l];this.attributes.index.array=e;for(s in this.attributes)"index"!=s&&(this.attributes[s].array=r[s],this.attributes[s].numItems=this.attributes[s].itemSize*n)},clone:function(){var t=new e.BufferGeometry,n=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],r;for(r in this.attributes){for(var i=this.attributes[r],s=i.array,o={itemSize:i.itemSize,array:null},i=0,u=n.length;i<u;i++){var a=n[i];if(s instanceof a){o.array=new a(s);break}}t.attributes[r]=o}i=0;for(u=this.offsets.length;i<u;i++)n=this.offsets[i],t.offsets.push({start:n.start,index:n.index,count:n.count});return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.EventDispatcher.prototype.apply(e.BufferGeometry.prototype),e.Geometry=function(){this.id=e.GeometryIdCount++,this.uuid=e.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},e.Geometry.prototype={constructor:e.Geometry,applyMatrix:function(t){for(var n=(new e.Matrix3).getNormalMatrix(t),r=0,i=this.vertices.length;r<i;r++)this.vertices[r].applyMatrix4(t);r=0;for(i=this.faces.length;r<i;r++){t=this.faces[r],t.normal.applyMatrix3(n).normalize();for(var s=0,o=t.vertexNormals.length;s<o;s++)t.vertexNormals[s].applyMatrix3(n).normalize()}this.boundingBox instanceof e.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof e.Sphere&&this.computeBoundingSphere()},computeFaceNormals:function(){for(var t=new e.Vector3,n=new e.Vector3,r=0,i=this.faces.length;r<i;r++){var s=this.faces[r],o=this.vertices[s.a],u=this.vertices[s.b];t.subVectors(this.vertices[s.c],u),n.subVectors(o,u),t.cross(n),t.normalize(),s.normal.copy(t)}},computeVertexNormals:function(t){var n,r,i;i=Array(this.vertices.length),n=0;for(r=this.vertices.length;n<r;n++)i[n]=new e.Vector3;if(t){var s,o,u,a=new e.Vector3,f=new e.Vector3;new e.Vector3,new e.Vector3,new e.Vector3,t=0;for(n=this.faces.length;t<n;t++)r=this.faces[t],s=this.vertices[r.a],o=this.vertices[r.b],u=this.vertices[r.c],a.subVectors(u,o),f.subVectors(s,o),a.cross(f),i[r.a].add(a),i[r.b].add(a),i[r.c].add(a)}else for(t=0,n=this.faces.length;t<n;t++)r=this.faces[t],i[r.a].add(r.normal),i[r.b].add(r.normal),i[r.c].add(r.normal);n=0;for(r=this.vertices.length;n<r;n++)i[n].normalize();t=0;for(n=this.faces.length;t<n;t++)r=this.faces[t],r.vertexNormals[0]=i[r.a].clone(),r.vertexNormals[1]=i[r.b].clone(),r.vertexNormals[2]=i[r.c].clone()},computeMorphNormals:function(){var t,n,r,i,s;r=0;for(i=this.faces.length;r<i;r++)for(s=this.faces[r],s.__originalFaceNormal?s.__originalFaceNormal.copy(s.normal):s.__originalFaceNormal=s.normal.clone(),s.__originalVertexNormals||(s.__originalVertexNormals=[]),t=0,n=s.vertexNormals.length;t<n;t++)s.__originalVertexNormals[t]?s.__originalVertexNormals[t].copy(s.vertexNormals[t]):s.__originalVertexNormals[t]=s.vertexNormals[t].clone();var o=new e.Geometry;o.faces=this.faces,t=0;for(n=this.morphTargets.length;t<n;t++){if(!this.morphNormals[t]){this.morphNormals[t]={},this.morphNormals[t].faceNormals=[],this.morphNormals[t].vertexNormals=[],s=this.morphNormals[t].faceNormals;var u=this.morphNormals[t].vertexNormals,a,f;r=0;for(i=this.faces.length;r<i;r++)a=new e.Vector3,f={a:new e.Vector3,b:new e.Vector3,c:new e.Vector3},s.push(a),u.push(f)}u=this.morphNormals[t],o.vertices=this.morphTargets[t].vertices,o.computeFaceNormals(),o.computeVertexNormals(),r=0;for(i=this.faces.length;r<i;r++)s=this.faces[r],a=u.faceNormals[r],f=u.vertexNormals[r],a.copy(s.normal),f.a.copy(s.vertexNormals[0]),f.b.copy(s.vertexNormals[1]),f.c.copy(s.vertexNormals[2])}r=0;for(i=this.faces.length;r<i;r++)s=this.faces[r],s.normal=s.__originalFaceNormal,s.vertexNormals=s.__originalVertexNormals},computeTangents:function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=[],b=[];r=new e.Vector3;var w=new e.Vector3,E=new e.Vector3,S=new e.Vector3,x=new e.Vector3;t=0;for(n=this.vertices.length;t<n;t++)y[t]=new e.Vector3,b[t]=new e.Vector3;t=0;for(n=this.faces.length;t<n;t++)s=this.faces[t],o=this.faceVertexUvs[0][t],i=s.a,g=s.b,s=s.c,u=this.vertices[i],a=this.vertices[g],f=this.vertices[s],l=o[0],c=o[1],h=o[2],o=a.x-u.x,p=f.x-u.x,d=a.y-u.y,v=f.y-u.y,a=a.z-u.z,u=f.z-u.z,f=c.x-l.x,m=h.x-l.x,c=c.y-l.y,l=h.y-l.y,h=1/(f*l-m*c),r.set((l*o-c*p)*h,(l*d-c*v)*h,(l*a-c*u)*h),w.set((f*p-m*o)*h,(f*v-m*d)*h,(f*u-m*a)*h),y[i].add(r),y[g].add(r),y[s].add(r),b[i].add(w),b[g].add(w),b[s].add(w);w=["a","b","c","d"],t=0;for(n=this.faces.length;t<n;t++)for(s=this.faces[t],r=0;r<Math.min(s.vertexNormals.length,3);r++)x.copy(s.vertexNormals[r]),i=s[w[r]],g=y[i],E.copy(g),E.sub(x.multiplyScalar(x.dot(g))).normalize(),S.crossVectors(s.vertexNormals[r],g),i=S.dot(b[i]),i=0>i?-1:1,s.vertexTangents[r]=new e.Vector4(E.x,E.y,E.z,i);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,n=0,r=t.length;n<r;n++)0<n&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new e.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new e.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,n,r){if(0==t instanceof e.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);else{var i,s=this.vertices.length,o=this.vertices,u=t.vertices,a=this.faces,f=t.faces,l=this.faceVertexUvs[0];t=t.faceVertexUvs[0],void 0===r&&(r=0),void 0!==n&&(i=(new e.Matrix3).getNormalMatrix(n));for(var c=0,h=u.length;c<h;c++){var p=u[c].clone();void 0!==n&&p.applyMatrix4(n),o.push(p)}c=0;for(h=f.length;c<h;c++){var u=f[c],d,v=u.vertexNormals,m=u.vertexColors,p=new e.Face3(u.a+s,u.b+s,u.c+s);p.normal.copy(u.normal),void 0!==i&&p.normal.applyMatrix3(i).normalize(),n=0;for(o=v.length;n<o;n++)d=v[n].clone(),void 0!==i&&d.applyMatrix3(i).normalize(),p.vertexNormals.push(d);p.color.copy(u.color),n=0;for(o=m.length;n<o;n++)d=m[n],p.vertexColors.push(d.clone());p.materialIndex=u.materialIndex+r,a.push(p)}c=0;for(h=t.length;c<h;c++)if(r=t[c],i=[],void 0!==r){n=0;for(o=r.length;n<o;n++)i.push(new e.Vector2(r[n].x,r[n].y));l.push(i)}}},mergeVertices:function(){var e={},t=[],n=[],r,i=Math.pow(10,4),s,o;s=0;for(o=this.vertices.length;s<o;s++)r=this.vertices[s],r=Math.round(r.x*i)+"_"+Math.round(r.y*i)+"_"+Math.round(r.z*i),void 0===e[r]?(e[r]=s,t.push(this.vertices[s]),n[s]=t.length-1):n[s]=n[e[r]];e=[],s=0;for(o=this.faces.length;s<o;s++)for(i=this.faces[s],i.a=n[i.a],i.b=n[i.b],i.c=n[i.c],i=[i.a,i.b,i.c],r=0;3>r;r++)if(i[r]==i[(r+1)%3]){e.push(s);break}for(s=e.length-1;0<=s;s--)for(i=e[s],this.faces.splice(i,1),n=0,o=this.faceVertexUvs.length;n<o;n++)this.faceVertexUvs[n].splice(i,1);return s=this.vertices.length-t.length,this.vertices=t,s},makeGroups:function(){var e=0;return function(t,n){var r,i,s,o,u={},f=this.morphTargets.length,l=this.morphNormals.length;this.geometryGroups={},r=0;for(i=this.faces.length;r<i;r++)s=this.faces[r],s=t?s.materialIndex:0,s in u||(u[s]={hash:s,counter:0}),o=u[s].hash+"_"+u[s].counter,o in this.geometryGroups||(this.geometryGroups[o]={faces3:[],materialIndex:s,vertices:0,numMorphTargets:f,numMorphNormals:l}),this.geometryGroups[o].vertices+3>n&&(u[s].counter+=1,o=u[s].hash+"_"+u[s].counter,o in this.geometryGroups||(this.geometryGroups[o]={faces3:[],materialIndex:s,vertices:0,numMorphTargets:f,numMorphNormals:l})),this.geometryGroups[o].faces3.push(r),this.geometryGroups[o].vertices+=3;this.geometryGroupsList=[];for(var c in this.geometryGroups)this.geometryGroups[c].id=e++,this.geometryGroupsList.push(this.geometryGroups[c])}}(),clone:function(){for(var t=new e.Geometry,n=this.vertices,r=0,i=n.length;r<i;r++)t.vertices.push(n[r].clone());n=this.faces,r=0;for(i=n.length;r<i;r++)t.faces.push(n[r].clone());n=this.faceVertexUvs[0],r=0;for(i=n.length;r<i;r++){for(var s=n[r],o=[],u=0,a=s.length;u<a;u++)o.push(new e.Vector2(s[u].x,s[u].y));t.faceVertexUvs[0].push(o)}return t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.EventDispatcher.prototype.apply(e.Geometry.prototype),e.GeometryIdCount=0,e.Camera=function(){e.Object3D.call(this),this.matrixWorldInverse=new e.Matrix4,this.projectionMatrix=new e.Matrix4},e.Camera.prototype=Object.create(e.Object3D.prototype),e.Camera.prototype.lookAt=function(){var t=new e.Matrix4;return function(e){t.lookAt(this.position,e,this.up),this.quaternion.setFromRotationMatrix(t)}}(),e.Camera.prototype.clone=function(t){return void 0===t&&(t=new e.Camera),e.Object3D.prototype.clone.call(this,t),t.matrixWorldInverse.copy(this.matrixWorldInverse),t.projectionMatrix.copy(this.projectionMatrix),t},e.OrthographicCamera=function(t,n,r,i,s,o){e.Camera.call(this),this.left=t,this.right=n,this.top=r,this.bottom=i,this.near=void 0!==s?s:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},e.OrthographicCamera.prototype=Object.create(e.Camera.prototype),e.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},e.OrthographicCamera.prototype.clone=function(){var t=new e.OrthographicCamera;return e.Camera.prototype.clone.call(this,t),t.left=this.left,t.right=this.right,t.top=this.top,t.bottom=this.bottom,t.near=this.near,t.far=this.far,t},e.PerspectiveCamera=function(t,n,r,i){e.Camera.call(this),this.fov=void 0!==t?t:50,this.aspect=void 0!==n?n:1,this.near=void 0!==r?r:.1,this.far=void 0!==i?i:2e3,this.updateProjectionMatrix()},e.PerspectiveCamera.prototype=Object.create(e.Camera.prototype),e.PerspectiveCamera.prototype.setLens=function(t,n){void 0===n&&(n=24),this.fov=2*e.Math.radToDeg(Math.atan(n/(2*t))),this.updateProjectionMatrix()},e.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},e.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var t=this.fullWidth/this.fullHeight,n=Math.tan(e.Math.degToRad(.5*this.fov))*this.near,r=-n,i=t*r,t=Math.abs(t*n-i),r=Math.abs(n-r);this.projectionMatrix.makeFrustum(i+this.x*t/this.fullWidth,i+(this.x+this.width)*t/this.fullWidth,n-(this.y+this.height)*r/this.fullHeight,n-this.y*r/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},e.PerspectiveCamera.prototype.clone=function(){var t=new e.PerspectiveCamera;return e.Camera.prototype.clone.call(this,t),t.fov=this.fov,t.aspect=this.aspect,t.near=this.near,t.far=this.far,t},e.Light=function(t){e.Object3D.call(this),this.color=new e.Color(t)},e.Light.prototype=Object.create(e.Object3D.prototype),e.Light.prototype.clone=function(t){return void 0===t&&(t=new e.Light),e.Object3D.prototype.clone.call(this,t),t.color.copy(this.color),t},e.AmbientLight=function(t){e.Light.call(this,t)},e.AmbientLight.prototype=Object.create(e.Light.prototype),e.AmbientLight.prototype.clone=function(){var t=new e.AmbientLight;return e.Light.prototype.clone.call(this,t),t},e.AreaLight=function(t,n){e.Light.call(this,t),this.normal=new e.Vector3(0,-1,0),this.right=new e.Vector3(1,0,0),this.intensity=void 0!==n?n:1,this.height=this.width=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},e.AreaLight.prototype=Object.create(e.Light.prototype),e.DirectionalLight=function(t,n){e.Light.call(this,t),this.position.set(0,1,0),this.target=new e.Object3D,this.intensity=void 0!==n?n:1,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new e.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},e.DirectionalLight.prototype=Object.create(e.Light.prototype),e.DirectionalLight.prototype.clone=function(){var t=new e.DirectionalLight;return e.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t.shadowCameraNear=this.shadowCameraNear,t.shadowCameraFar=this.shadowCameraFar,t.shadowCameraLeft=this.shadowCameraLeft,t.shadowCameraRight=this.shadowCameraRight,t.shadowCameraTop=this.shadowCameraTop,t.shadowCameraBottom=this.shadowCameraBottom,t.shadowCameraVisible=this.shadowCameraVisible,t.shadowBias=this.shadowBias,t.shadowDarkness=this.shadowDarkness,t.shadowMapWidth=this.shadowMapWidth,t.shadowMapHeight=this.shadowMapHeight,t.shadowCascade=this.shadowCascade,t.shadowCascadeOffset.copy(this.shadowCascadeOffset),t.shadowCascadeCount=this.shadowCascadeCount,t.shadowCascadeBias=this.shadowCascadeBias.slice(0),t.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),t.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),t.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),t.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),t},e.HemisphereLight=function(t,n,r){e.Light.call(this,t),this.position.set(0,100,0),this.groundColor=new e.Color(n),this.intensity=void 0!==r?r:1},e.HemisphereLight.prototype=Object.create(e.Light.prototype),e.HemisphereLight.prototype.clone=function(){var t=new e.HemisphereLight;return e.Light.prototype.clone.call(this,t),t.groundColor.copy(this.groundColor),t.intensity=this.intensity,t},e.PointLight=function(t,n,r){e.Light.call(this,t),this.intensity=void 0!==n?n:1,this.distance=void 0!==r?r:0},e.PointLight.prototype=Object.create(e.Light.prototype),e.PointLight.prototype.clone=function(){var t=new e.PointLight;return e.Light.prototype.clone.call(this,t),t.intensity=this.intensity,t.distance=this.distance,t},e.SpotLight=function(t,n,r,i,s){e.Light.call(this,t),this.position.set(0,1,0),this.target=new e.Object3D,this.intensity=void 0!==n?n:1,this.distance=void 0!==r?r:0,this.angle=void 0!==i?i:Math.PI/3,this.exponent=void 0!==s?s:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},e.SpotLight.prototype=Object.create(e.Light.prototype),e.SpotLight.prototype.clone=function(){var t=new e.SpotLight;return e.Light.prototype.clone.call(this,t),t.target=this.target.clone(),t.intensity=this.intensity,t.distance=this.distance,t.angle=this.angle,t.exponent=this.exponent,t.castShadow=this.castShadow,t.onlyShadow=this.onlyShadow,t.shadowCameraNear=this.shadowCameraNear,t.shadowCameraFar=this.shadowCameraFar,t.shadowCameraFov=this.shadowCameraFov,t.shadowCameraVisible=this.shadowCameraVisible,t.shadowBias=this.shadowBias,t.shadowDarkness=this.shadowDarkness,t.shadowMapWidth=this.shadowMapWidth,t.shadowMapHeight=this.shadowMapHeight,t},e.Cache=function(){this.files={}},e.Cache.prototype={constructor:e.Cache,add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},e.Loader=function(t){this.statusDomElement=(this.showStatus=t)?e.Loader.prototype.addStatusElement():null,this.imageLoader=new e.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},e.Loader.prototype={constructor:e.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1024).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(e,t){for(var n=[],r=0;r<e.length;++r)n[r]=this.createMaterial(e[r],t);return n},needsTangents:function(t){for(var n=0,r=t.length;n<r;n++)if(t[n]instanceof e.ShaderMaterial)return!0;return!1},createMaterial:function(t,n){function r(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function i(t,i,s,u,a,f,l){var h=/\.dds$/i.test(s),p=n+s;if(h){var d=e.ImageUtils.loadCompressedTexture(p);t[i]=d}else d=document.createElement("canvas"),t[i]=new e.Texture(d);t[i].sourceFile=s,u&&(t[i].repeat.set(u[0],u[1]),1!==u[0]&&(t[i].wrapS=e.RepeatWrapping),1!==u[1]&&(t[i].wrapT=e.RepeatWrapping)),a&&t[i].offset.set(a[0],a[1]),f&&(s={repeat:e.RepeatWrapping,mirror:e.MirroredRepeatWrapping},void 0!==s[f[0]]&&(t[i].wrapS=s[f[0]]),void 0!==s[f[1]]&&(t[i].wrapT=s[f[1]])),l&&(t[i].anisotropy=l),h||(d=t[i],o.imageLoader.crossOrigin=o.crossOrigin,o.imageLoader.load(p,function(t){if(!1===e.Math.isPowerOfTwo(t.width)||!1===e.Math.isPowerOfTwo(t.height)){var n=r(t.width),i=r(t.height);d.image.width=n,d.image.height=i,d.image.getContext("2d").drawImage(t,0,0,n,i)}else d.image=t;d.needsUpdate=!0}))}function s(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var o=this,u="MeshLambertMaterial",a={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(t.shading){var f=t.shading.toLowerCase();"phong"===f?u="MeshPhongMaterial":"basic"===f&&(u="MeshBasicMaterial")}void 0!==t.blending&&void 0!==e[t.blending]&&(a.blending=e[t.blending]);if(void 0!==t.transparent||1>t.opacity)a.transparent=t.transparent;return void 0!==t.depthTest&&(a.depthTest=t.depthTest),void 0!==t.depthWrite&&(a.depthWrite=t.depthWrite),void 0!==t.visible&&(a.visible=t.visible),void 0!==t.flipSided&&(a.side=e.BackSide),void 0!==t.doubleSided&&(a.side=e.DoubleSide),void 0!==t.wireframe&&(a.wireframe=t.wireframe),void 0!==t.vertexColors&&("face"===t.vertexColors?a.vertexColors=e.FaceColors:t.vertexColors&&(a.vertexColors=e.VertexColors)),t.colorDiffuse?a.color=s(t.colorDiffuse):t.DbgColor&&(a.color=t.DbgColor),t.colorSpecular&&(a.specular=s(t.colorSpecular)),t.colorAmbient&&(a.ambient=s(t.colorAmbient)),t.colorEmissive&&(a.emissive=s(t.colorEmissive)),t.transparency&&(a.opacity=t.transparency),t.specularCoef&&(a.shininess=t.specularCoef),t.mapDiffuse&&n&&i(a,"map",t.mapDiffuse,t.mapDiffuseRepeat,t.mapDiffuseOffset,t.mapDiffuseWrap,t.mapDiffuseAnisotropy),t.mapLight&&n&&i(a,"lightMap",t.mapLight,t.mapLightRepeat,t.mapLightOffset,t.mapLightWrap,t.mapLightAnisotropy),t.mapBump&&n&&i(a,"bumpMap",t.mapBump,t.mapBumpRepeat,t.mapBumpOffset,t.mapBumpWrap,t.mapBumpAnisotropy),t.mapNormal&&n&&i(a,"normalMap",t.mapNormal,t.mapNormalRepeat,t.mapNormalOffset,t.mapNormalWrap,t.mapNormalAnisotropy),t.mapSpecular&&n&&i(a,"specularMap",t.mapSpecular,t.mapSpecularRepeat,t.mapSpecularOffset,t.mapSpecularWrap,t.mapSpecularAnisotropy),t.mapBumpScale&&(a.bumpScale=t.mapBumpScale),t.mapNormal?(u=e.ShaderLib.normalmap,f=e.UniformsUtils.clone(u.uniforms),f.tNormal.value=a.normalMap,t.mapNormalFactor&&f.uNormalScale.value.set(t.mapNormalFactor,t.mapNormalFactor),a.map&&(f.tDiffuse.value=a.map,f.enableDiffuse.value=!0),a.specularMap&&(f.tSpecular.value=a.specularMap,f.enableSpecular.value=!0),a.lightMap&&(f.tAO.value=a.lightMap,f.enableAO.value=!0),f.diffuse.value.setHex(a.color),f.specular.value.setHex(a.specular),f.ambient.value.setHex(a.ambient),f.shininess.value=a.shininess,void 0!==a.opacity&&(f.opacity.value=a.opacity),u=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:f,lights:!0,fog:!0}),a.transparent&&(u.transparent=!0)):u=new e[u](a),void 0!==t.DbgName&&(u.name=t.DbgName),u}},e.XHRLoader=function(t){this.cache=new e.Cache,this.manager=void 0!==t?t:e.DefaultLoadingManager},e.XHRLoader.prototype={constructor:e.XHRLoader,load:function(e,t,n,r){var i=this,s=i.cache.get(e);void 0!==s?t(s):(s=new XMLHttpRequest,void 0!==t&&s.addEventListener("load",function(n){i.cache.add(e,n.target.responseText),t(n.target.responseText),i.manager.itemEnd(e)},!1),void 0!==n&&s.addEventListener("progress",function(e){n(e)},!1),void 0!==r&&s.addEventListener("error",function(e){r(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.open("GET",e,!0),s.send(null),i.manager.itemStart(e))},setCrossOrigin:function(e){this.crossOrigin=e}},e.ImageLoader=function(t){this.cache=new e.Cache,this.manager=void 0!==t?t:e.DefaultLoadingManager},e.ImageLoader.prototype={constructor:e.ImageLoader,load:function(e,t,n,r){var i=this,s=i.cache.get(e);if(void 0===s)return s=document.createElement("img"),void 0!==t&&s.addEventListener("load",function(n){i.cache.add(e,this),t(this),i.manager.itemEnd(e)},!1),void 0!==n&&s.addEventListener("progress",function(e){n(e)},!1),void 0!==r&&s.addEventListener("error",function(e){r(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.src=e,i.manager.itemStart(e),s;t(s)},setCrossOrigin:function(e){this.crossOrigin=e}},e.JSONLoader=function(t){e.Loader.call(this,t),this.withCredentials=!1},e.JSONLoader.prototype=Object.create(e.Loader.prototype),e.JSONLoader.prototype.load=function(e,t,n){n=n&&"string"==typeof n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},e.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest,o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(200===s.status||0===s.status){if(s.responseText){var u=JSON.parse(s.responseText);if(void 0!==u.metadata&&"scene"===u.metadata.type){console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}u=e.parse(u,r),n(u.geometry,u.materials)}else console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+s.status+")");else s.readyState===s.LOADING?i&&(0===o&&(o=s.getResponseHeader("Content-Length")),i({total:o,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&void 0!==i&&(o=s.getResponseHeader("Content-Length"))},s.open("GET",t,!0),s.withCredentials=this.withCredentials,s.send(null)},e.JSONLoader.prototype.parse=function(t,n){var r=new e.Geometry,i=void 0!==t.scale?1/t.scale:1;return function(n){var i,s,o,u,f,l,h,p,d,v,m,g,y,b=t.faces;l=t.vertices;var w=t.normals,E=t.colors,S=0;if(void 0!==t.uvs){for(i=0;i<t.uvs.length;i++)t.uvs[i].length&&S++;for(i=0;i<S;i++)r.faceVertexUvs[i]=[]}u=0;for(f=l.length;u<f;)i=new e.Vector3,i.x=l[u++]*n,i.y=l[u++]*n,i.z=l[u++]*n,r.vertices.push(i);u=0;for(f=b.length;u<f;)if(n=b[u++],d=n&1,o=n&2,i=n&8,h=n&16,v=n&32,l=n&64,n&=128,d){d=new e.Face3,d.a=b[u],d.b=b[u+1],d.c=b[u+3],m=new e.Face3,m.a=b[u+1],m.b=b[u+2],m.c=b[u+3],u+=4,o&&(o=b[u++],d.materialIndex=o,m.materialIndex=o),o=r.faces.length;if(i)for(i=0;i<S;i++)for(g=t.uvs[i],r.faceVertexUvs[i][o]=[],r.faceVertexUvs[i][o+1]=[],s=0;4>s;s++)p=b[u++],y=g[2*p],p=g[2*p+1],y=new e.Vector2(y,p),2!==s&&r.faceVertexUvs[i][o].push(y),0!==s&&r.faceVertexUvs[i][o+1].push(y);h&&(h=3*b[u++],d.normal.set(w[h++],w[h++],w[h]),m.normal.copy(d.normal));if(v)for(i=0;4>i;i++)h=3*b[u++],v=new e.Vector3(w[h++],w[h++],w[h]),2!==i&&d.vertexNormals.push(v),0!==i&&m.vertexNormals.push(v);l&&(l=b[u++],l=E[l],d.color.setHex(l),m.color.setHex(l));if(n)for(i=0;4>i;i++)l=b[u++],l=E[l],2!==i&&d.vertexColors.push(new e.Color(l)),0!==i&&m.vertexColors.push(new e.Color(l));r.faces.push(d),r.faces.push(m)}else{d=new e.Face3,d.a=b[u++],d.b=b[u++],d.c=b[u++],o&&(o=b[u++],d.materialIndex=o),o=r.faces.length;if(i)for(i=0;i<S;i++)for(g=t.uvs[i],r.faceVertexUvs[i][o]=[],s=0;3>s;s++)p=b[u++],y=g[2*p],p=g[2*p+1],y=new e.Vector2(y,p),r.faceVertexUvs[i][o].push(y);h&&(h=3*b[u++],d.normal.set(w[h++],w[h++],w[h]));if(v)for(i=0;3>i;i++)h=3*b[u++],v=new e.Vector3(w[h++],w[h++],w[h]),d.vertexNormals.push(v);l&&(l=b[u++],d.color.setHex(E[l]));if(n)for(i=0;3>i;i++)l=b[u++],d.vertexColors.push(new e.Color(E[l]));r.faces.push(d)}}(i),function(){var n=void 0!==t.influencesPerVertex?t.influencesPerVertex:2;if(t.skinWeights)for(var i=0,s=t.skinWeights.length;i<s;i+=n)r.skinWeights.push(new e.Vector4(t.skinWeights[i],1<n?t.skinWeights[i+1]:0,2<n?t.skinWeights[i+2]:0,3<n?t.skinWeights[i+3]:0));if(t.skinIndices)for(i=0,s=t.skinIndices.length;i<s;i+=n)r.skinIndices.push(new e.Vector4(t.skinIndices[i],1<n?t.skinIndices[i+1]:0,2<n?t.skinIndices[i+2]:0,3<n?t.skinIndices[i+3]:0));r.bones=t.bones,r.bones&&0<r.bones.length&&(r.skinWeights.length!==r.skinIndices.length||r.skinIndices.length!==r.vertices.length)&&console.warn("When skinning, number of vertices ("+r.vertices.length+"), skinIndices ("+r.skinIndices.length+"), and skinWeights ("+r.skinWeights.length+") should match."),r.animation=t.animation,r.animations=t.animations}(),function(n){if(void 0!==t.morphTargets){var i,s,o,u,f,l;i=0;for(s=t.morphTargets.length;i<s;i++)for(r.morphTargets[i]={},r.morphTargets[i].name=t.morphTargets[i].name,r.morphTargets[i].vertices=[],f=r.morphTargets[i].vertices,l=t.morphTargets[i].vertices,o=0,u=l.length;o<u;o+=3){var h=new e.Vector3;h.x=l[o]*n,h.y=l[o+1]*n,h.z=l[o+2]*n,f.push(h)}}if(void 0!==t.morphColors)for(i=0,s=t.morphColors.length;i<s;i++)for(r.morphColors[i]={},r.morphColors[i].name=t.morphColors[i].name,r.morphColors[i].colors=[],u=r.morphColors[i].colors,f=t.morphColors[i].colors,n=0,o=f.length;n<o;n+=3)l=new e.Color(16755200),l.setRGB(f[n],f[n+1],f[n+2]),u.push(l)}(i),r.computeFaceNormals(),r.computeBoundingSphere(),void 0===t.materials||0===t.materials.length?{geometry:r}:(i=this.initMaterials(t.materials,n),this.needsTangents(i)&&r.computeTangents(),{geometry:r,materials:i})},e.LoadingManager=function(e,t,n){var r=this,i=0,s=0;this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++},this.itemEnd=function(e){i++,void 0!==r.onProgress&&r.onProgress(e,i,s),i===s&&void 0!==r.onLoad&&r.onLoad()}},e.DefaultLoadingManager=new e.LoadingManager,e.BufferGeometryLoader=function(t){this.manager=void 0!==t?t:e.DefaultLoadingManager},e.BufferGeometryLoader.prototype={constructor:e.BufferGeometryLoader,load:function(t,n,r,i){var s=this;r=new e.XHRLoader,r.setCrossOrigin(this.crossOrigin),r.load(t,function(e){n(s.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(t){var n=new e.BufferGeometry,r=t.attributes,i=t.offsets;t=t.boundingSphere;for(var s in r){var o=r[s];n.attributes[s]={itemSize:o.itemSize,array:new self[o.type](o.array)}}return void 0!==i&&(n.offsets=JSON.parse(JSON.stringify(i))),void 0!==t&&(n.boundingSphere=new e.Sphere((new e.Vector3).fromArray(void 0!==t.center?t.center:[0,0,0]),t.radius)),n}},e.MaterialLoader=function(t){this.manager=void 0!==t?t:e.DefaultLoadingManager},e.MaterialLoader.prototype={constructor:e.MaterialLoader,load:function(t,n,r,i){var s=this;r=new e.XHRLoader,r.setCrossOrigin(this.crossOrigin),r.load(t,function(e){n(s.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(t){var n=new e[t.type];void 0!==t.color&&n.color.setHex(t.color),void 0!==t.ambient&&n.ambient.setHex(t.ambient),void 0!==t.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&n.specular.setHex(t.specular),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.vertexColors&&(n.vertexColors=t.vertexColors),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.side&&(n.side=t.side),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.wireframe&&(n.wireframe=t.wireframe);if(void 0!==t.materials)for(var r=0,i=t.materials.length;r<i;r++)n.materials.push(this.parse(t.materials[r]));return n}},e.ObjectLoader=function(t){this.manager=void 0!==t?t:e.DefaultLoadingManager},e.ObjectLoader.prototype={constructor:e.ObjectLoader,load:function(t,n,r,i){var s=this;r=new e.XHRLoader(s.manager),r.setCrossOrigin(this.crossOrigin),r.load(t,function(e){n(s.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),n=this.parseMaterials(e.materials);return this.parseObject(e.object,t,n)},parseGeometries:function(t){var n={};if(void 0!==t)for(var r=new e.JSONLoader,i=new e.BufferGeometryLoader,s=0,o=t.length;s<o;s++){var u,a=t[s];switch(a.type){case"PlaneGeometry":u=new e.PlaneGeometry(a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"CubeGeometry":u=new e.BoxGeometry(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":u=new e.CircleGeometry(a.radius,a.segments);break;case"CylinderGeometry":u=new e.CylinderGeometry(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded);break;case"SphereGeometry":u=new e.SphereGeometry(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"IcosahedronGeometry":u=new e.IcosahedronGeometry(a.radius,a.detail);break;case"TorusGeometry":u=new e.TorusGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":u=new e.TorusKnotGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.p,a.q,a.heightScale);break;case"BufferGeometry":u=i.parse(a.data);break;case"Geometry":u=r.parse(a.data).geometry}u.uuid=a.uuid,void 0!==a.name&&(u.name=a.name),n[a.uuid]=u}return n},parseMaterials:function(t){var n={};if(void 0!==t)for(var r=new e.MaterialLoader,i=0,s=t.length;i<s;i++){var o=t[i],u=r.parse(o);u.uuid=o.uuid,void 0!==o.name&&(u.name=o.name),n[o.uuid]=u}return n},parseObject:function(){var t=new e.Matrix4;return function(n,r,i){var s;switch(n.type){case"Scene":s=new e.Scene;break;case"PerspectiveCamera":s=new e.PerspectiveCamera(n.fov,n.aspect,n.near,n.far);break;case"OrthographicCamera":s=new e.OrthographicCamera(n.left,n.right,n.top,n.bottom,n.near,n.far);break;case"AmbientLight":s=new e.AmbientLight(n.color);break;case"DirectionalLight":s=new e.DirectionalLight(n.color,n.intensity);break;case"PointLight":s=new e.PointLight(n.color,n.intensity,n.distance);break;case"SpotLight":s=new e.SpotLight(n.color,n.intensity,n.distance,n.angle,n.exponent);break;case"HemisphereLight":s=new e.HemisphereLight(n.color,n.groundColor,n.intensity);break;case"Mesh":s=r[n.geometry];var o=i[n.material];void 0===s&&console.error("THREE.ObjectLoader: Undefined geometry "+n.geometry),void 0===o&&console.error("THREE.ObjectLoader: Undefined material "+n.material),s=new e.Mesh(s,o);break;case"Sprite":o=i[n.material],void 0===o&&console.error("THREE.ObjectLoader: Undefined material "+n.material),s=new e.Sprite(o);break;default:s=new e.Object3D}s.uuid=n.uuid,void 0!==n.name&&(s.name=n.name),void 0!==n.matrix?(t.fromArray(n.matrix),t.decompose(s.position,s.quaternion,s.scale)):(void 0!==n.position&&s.position.fromArray(n.position),void 0!==n.rotation&&s.rotation.fromArray(n.rotation),void 0!==n.scale&&s.scale.fromArray(n.scale)),void 0!==n.visible&&(s.visible=n.visible),void 0!==n.userData&&(s.userData=n.userData);if(void 0!==n.children)for(var u in n.children)s.add(this.parseObject(n.children[u],r,i));return s}}()},e.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",e.JSONLoader)},e.SceneLoader.prototype={constructor:e.SceneLoader,load:function(t,n,r,i){var s=this;r=new e.XHRLoader(s.manager),r.setCrossOrigin(this.crossOrigin),r.load(t,function(e){s.parse(JSON.parse(e),n,t)})},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(t,n,r){function i(e,t){return"relativeToHTML"==t?e:d+e}function s(){o(N.scene,k.objects)}function o(t,n){var r,s,u,a,l,c;for(c in n){var h=N.objects[c],d=n[c];if(void 0===h){if(d.type&&d.type in p.hierarchyHandlers){if(void 0===d.loading){r={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1};var y={},b;for(b in d)b in r||(y[b]=d[b]);m=N.materials[d.material],d.loading=!0,r=p.hierarchyHandlers[d.type].loaderObject,r.options?r.load(i(d.url,k.urlBaseType),f(c,t,m,d)):r.load(i(d.url,k.urlBaseType),f(c,t,m,d),y)}}else if(void 0!==d.geometry){if(v=N.geometries[d.geometry]){h=!1,m=N.materials[d.material],h=m instanceof e.ShaderMaterial,s=d.position,u=d.rotation,a=d.scale,r=d.matrix,l=d.quaternion,d.material||(m=new e.MeshFaceMaterial(N.face_materials[d.geometry])),m instanceof e.MeshFaceMaterial&&0===m.materials.length&&(m=new e.MeshFaceMaterial(N.face_materials[d.geometry]));if(m instanceof e.MeshFaceMaterial)for(y=0;y<m.materials.length;y++)h=h||m.materials[y]instanceof e.ShaderMaterial;h&&v.computeTangents(),d.skin?h=new e.SkinnedMesh(v,m):d.morph?(h=new e.MorphAnimMesh(v,m),void 0!==d.duration&&(h.duration=d.duration),void 0!==d.time&&(h.time=d.time),void 0!==d.mirroredLoop&&(h.mirroredLoop=d.mirroredLoop),m.morphNormals&&v.computeMorphNormals()):h=new e.Mesh(v,m),h.name=c,r?(h.matrixAutoUpdate=!1,h.matrix.set(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])):(h.position.fromArray(s),l?h.quaternion.fromArray(l):h.rotation.fromArray(u),h.scale.fromArray(a)),h.visible=d.visible,h.castShadow=d.castShadow,h.receiveShadow=d.receiveShadow,t.add(h),N.objects[c]=h}}else if("AmbientLight"===d.type||"PointLight"===d.type||"DirectionalLight"===d.type||"SpotLight"===d.type||"HemisphereLight"===d.type||"AreaLight"===d.type){y=d.color,r=d.intensity,s=d.distance,u=d.position,a=d.rotation;switch(d.type){case"AmbientLight":w=new e.AmbientLight(y);break;case"PointLight":w=new e.PointLight(y,r,s),w.position.fromArray(u);break;case"DirectionalLight":w=new e.DirectionalLight(y,r),w.position.fromArray(d.direction);break;case"SpotLight":w=new e.SpotLight(y,r,s,1),w.angle=d.angle,w.position.fromArray(u),w.target.set(u[0],u[1]-s,u[2]),w.target.applyEuler(new e.Euler(a[0],a[1],a[2],"XYZ"));break;case"HemisphereLight":w=new e.DirectionalLight(y,r,s),w.target.set(u[0],u[1]-s,u[2]),w.target.applyEuler(new e.Euler(a[0],a[1],a[2],"XYZ"));break;case"AreaLight":w=new e.AreaLight(y,r),w.position.fromArray(u),w.width=d.size,w.height=d.size_y}t.add(w),w.name=c,N.lights[c]=w,N.objects[c]=w}else"PerspectiveCamera"===d.type||"OrthographicCamera"===d.type?(s=d.position,u=d.rotation,l=d.quaternion,"PerspectiveCamera"===d.type?g=new e.PerspectiveCamera(d.fov,d.aspect,d.near,d.far):"OrthographicCamera"===d.type&&(g=new e.OrthographicCamera(d.left,d.right,d.top,d.bottom,d.near,d.far)),g.name=c,g.position.fromArray(s),void 0!==l?g.quaternion.fromArray(l):void 0!==u&&g.rotation.fromArray(u),t.add(g),N.cameras[c]=g,N.objects[c]=g):(s=d.position,u=d.rotation,a=d.scale,l=d.quaternion,h=new e.Object3D,h.name=c,h.position.fromArray(s),l?h.quaternion.fromArray(l):h.rotation.fromArray(u),h.scale.fromArray(a),h.visible=void 0!==d.visible?d.visible:!1,t.add(h),N.objects[c]=h,N.empties[c]=h);if(h){if(void 0!==d.userData)for(var E in d.userData)h.userData[E]=d.userData[E];if(void 0!==d.groups)for(y=0;y<d.groups.length;y++)r=d.groups[y],void 0===N.groups[r]&&(N.groups[r]=[]),N.groups[r].push(c)}}void 0!==h&&void 0!==d.children&&o(h,d.children)}}function u(e,t,n,r,i){var o=i.rotation,u=i.quaternion,a=i.scale;e.position.fromArray(i.position),u?e.quaternion.fromArray(u):e.rotation.fromArray(o),e.scale.fromArray(a),r&&e.traverse(function(e){e.material=r});var f=void 0!==i.visible?i.visible:!0;e.traverse(function(e){e.visible=f}),n.add(e),e.name=t,N.objects[t]=e,s()}function a(e){return function(t,n){t.name=e,N.geometries[e]=t,N.face_materials[e]=n,s(),E-=1,p.onLoadComplete(),c()}}function f(e,t,n,r){return function(i){u(i.content?i.content:i.dae?i.scene:i,e,t,n,r),E-=1,p.onLoadComplete(),c()}}function l(e){return function(t,n){t.name=e,N.geometries[e]=t,N.face_materials[e]=n}}function c(){p.callbackProgress({totalModels:x,totalTextures:T,loadedModels:x-E,loadedTextures:T-S},N),p.onLoadProgress();if(0===E&&0===S){for(var t=0;t<C.length;t++){var r=C[t],i=N.objects[r.targetName];i?r.object.target=i:(r.object.target=new e.Object3D,N.scene.add(r.object.target)),r.object.target.userData.targetInverse=r.object}n(N)}}function h(e,t){t(e);if(void 0!==e.children)for(var n in e.children)h(e.children[n],t)}var p=this,d=e.Loader.prototype.extractUrlBase(r),v,m,g,y,b,w,E,S,x,T,N,C=[],k=t,L;for(L in this.geometryHandlers)t=this.geometryHandlers[L].loaderClass,this.geometryHandlers[L].loaderObject=new t;for(L in this.hierarchyHandlers)t=this.hierarchyHandlers[L].loaderClass,this.hierarchyHandlers[L].loaderObject=new t;S=E=0,N={scene:new e.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},k.transform&&(L=k.transform.position,t=k.transform.rotation,r=k.transform.scale,L&&N.scene.position.fromArray(L),t&&N.scene.rotation.fromArray(t),r&&N.scene.scale.fromArray(r),L||t||r)&&(N.scene.updateMatrix(),N.scene.updateMatrixWorld()),L=function(e){return function(){S-=e,c(),p.onLoadComplete()}};for(var A in k.fogs)t=k.fogs[A],"linear"===t.type?y=new e.Fog(0,t.near,t.far):"exp2"===t.type&&(y=new e.FogExp2(0,t.density)),t=t.color,y.color.setRGB(t[0],t[1],t[2]),N.fogs[A]=y;for(var O in k.geometries)y=k.geometries[O],y.type in this.geometryHandlers&&(E+=1,p.onLoadStart());for(var M in k.objects)h(k.objects[M],function(e){e.type&&e.type in p.hierarchyHandlers&&(E+=1,p.onLoadStart())});x=E;for(O in k.geometries)if(y=k.geometries[O],"cube"===y.type)v=new e.BoxGeometry(y.width,y.height,y.depth,y.widthSegments,y.heightSegments,y.depthSegments),v.name=O,N.geometries[O]=v;else if("plane"===y.type)v=new e.PlaneGeometry(y.width,y.height,y.widthSegments,y.heightSegments),v.name=O,N.geometries[O]=v;else if("sphere"===y.type)v=new e.SphereGeometry(y.radius,y.widthSegments,y.heightSegments),v.name=O,N.geometries[O]=v;else if("cylinder"===y.type)v=new e.CylinderGeometry(y.topRad,y.botRad,y.height,y.radSegs,y.heightSegs),v.name=O,N.geometries[O]=v;else if("torus"===y.type)v=new e.TorusGeometry(y.radius,y.tube,y.segmentsR,y.segmentsT),v.name=O,N.geometries[O]=v;else if("icosahedron"===y.type)v=new e.IcosahedronGeometry(y.radius,y.subdivisions),v.name=O,N.geometries[O]=v;else if(y.type in this.geometryHandlers){M={};for(b in y)"type"!==b&&"url"!==b&&(M[b]=y[b]);this.geometryHandlers[y.type].loaderObject.load(i(y.url,k.urlBaseType),a(O),M)}else"embedded"===y.type&&(M=k.embeds[y.id],M.metadata=k.metadata,M&&(M=this.geometryHandlers.ascii.loaderObject.parse(M,""),l(O)(M.geometry,M.materials)));for(var _ in k.textures)if(O=k.textures[_],O.url instanceof Array)for(S+=O.url.length,b=0;b<O.url.length;b++)p.onLoadStart();else S+=1,p.onLoadStart();T=S;for(_ in k.textures){O=k.textures[_],void 0!==O.mapping&&void 0!==e[O.mapping]&&(O.mapping=new e[O.mapping]);if(O.url instanceof Array){M=O.url.length,y=[];for(b=0;b<M;b++)y[b]=i(O.url[b],k.urlBaseType);b=(b=/\.dds$/i.test(y[0]))?e.ImageUtils.loadCompressedTextureCube(y,O.mapping,L(M)):e.ImageUtils.loadTextureCube(y,O.mapping,L(M))}else b=/\.dds$/i.test(O.url),M=i(O.url,k.urlBaseType),y=L(1),b=b?e.ImageUtils.loadCompressedTexture(M,O.mapping,y):e.ImageUtils.loadTexture(M,O.mapping,y),void 0!==e[O.minFilter]&&(b.minFilter=e[O.minFilter]),void 0!==e[O.magFilter]&&(b.magFilter=e[O.magFilter]),O.anisotropy&&(b.anisotropy=O.anisotropy),O.repeat&&(b.repeat.set(O.repeat[0],O.repeat[1]),1!==O.repeat[0]&&(b.wrapS=e.RepeatWrapping),1!==O.repeat[1]&&(b.wrapT=e.RepeatWrapping)),O.offset&&b.offset.set(O.offset[0],O.offset[1]),O.wrap&&(M={repeat:e.RepeatWrapping,mirror:e.MirroredRepeatWrapping},void 0!==M[O.wrap[0]]&&(b.wrapS=M[O.wrap[0]]),void 0!==M[O.wrap[1]]&&(b.wrapT=M[O.wrap[1]]));N.textures[_]=b}var D,P;for(D in k.materials){_=k.materials[D];for(P in _.parameters)"envMap"===P||"map"===P||"lightMap"===P||"bumpMap"===P?_.parameters[P]=N.textures[_.parameters[P]]:"shading"===P?_.parameters[P]="flat"===_.parameters[P]?e.FlatShading:e.SmoothShading:"side"===P?_.parameters[P]="double"==_.parameters[P]?e.DoubleSide:"back"==_.parameters[P]?e.BackSide:e.FrontSide:"blending"===P?_.parameters[P]=_.parameters[P]in e?e[_.parameters[P]]:e.NormalBlending:"combine"===P?_.parameters[P]=_.parameters[P]in e?e[_.parameters[P]]:e.MultiplyOperation:"vertexColors"===P?"face"==_.parameters[P]?_.parameters[P]=e.FaceColors:_.parameters[P]&&(_.parameters[P]=e.VertexColors):"wrapRGB"===P&&(L=_.parameters[P],_.parameters[P]=new e.Vector3(L[0],L[1],L[2]));void 0!==_.parameters.opacity&&1>_.parameters.opacity&&(_.parameters.transparent=!0),_.parameters.normalMap?(L=e.ShaderLib.normalmap,O=e.UniformsUtils.clone(L.uniforms),b=_.parameters.color,M=_.parameters.specular,y=_.parameters.ambient,A=_.parameters.shininess,O.tNormal.value=N.textures[_.parameters.normalMap],_.parameters.normalScale&&O.uNormalScale.value.set(_.parameters.normalScale[0],_.parameters.normalScale[1]),_.parameters.map&&(O.tDiffuse.value=_.parameters.map,O.enableDiffuse.value=!0),_.parameters.envMap&&(O.tCube.value=_.parameters.envMap,O.enableReflection.value=!0,O.reflectivity.value=_.parameters.reflectivity),_.parameters.lightMap&&(O.tAO.value=_.parameters.lightMap,O.enableAO.value=!0),_.parameters.specularMap&&(O.tSpecular.value=N.textures[_.parameters.specularMap],O.enableSpecular.value=!0),_.parameters.displacementMap&&(O.tDisplacement.value=N.textures[_.parameters.displacementMap],O.enableDisplacement.value=!0,O.uDisplacementBias.value=_.parameters.displacementBias,O.uDisplacementScale.value=_.parameters.displacementScale),O.diffuse.value.setHex(b),O.specular.value.setHex(M),O.ambient.value.setHex(y),O.shininess.value=A,_.parameters.opacity&&(O.opacity.value=_.parameters.opacity),m=new e.ShaderMaterial({fragmentShader:L.fragmentShader,vertexShader:L.vertexShader,uniforms:O,lights:!0,fog:!0})):m=new e[_.type](_.parameters),m.name=D,N.materials[D]=m}for(D in k.materials)if(_=k.materials[D],_.parameters.materials){P=[];for(b=0;b<_.parameters.materials.length;b++)P.push(N.materials[_.parameters.materials[b]]);N.materials[D].materials=P}s(),N.cameras&&k.defaults.camera&&(N.currentCamera=N.cameras[k.defaults.camera]),N.fogs&&k.defaults.fog&&(N.scene.fog=N.fogs[k.defaults.fog]),p.callbackSync(N),c()}},e.TextureLoader=function(t){this.manager=void 0!==t?t:e.DefaultLoadingManager},e.TextureLoader.prototype={constructor:e.TextureLoader,load:function(t,n,r,i){r=new e.ImageLoader(this.manager),r.setCrossOrigin(this.crossOrigin),r.load(t,function(t){t=new e.Texture(t),t.needsUpdate=!0,void 0!==n&&n(t)})},setCrossOrigin:function(e){this.crossOrigin=e}},e.Material=function(){this.id=e.MaterialIdCount++,this.uuid=e.Math.generateUUID(),this.name="",this.side=e.FrontSide,this.opacity=1,this.transparent=!1,this.blending=e.NormalBlending,this.blendSrc=e.SrcAlphaFactor,this.blendDst=e.OneMinusSrcAlphaFactor,this.blendEquation=e.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.needsUpdate=this.visible=!0},e.Material.prototype={constructor:e.Material,setValues:function(t){if(void 0!==t)for(var n in t){var r=t[n];if(void 0===r)console.warn("THREE.Material: '"+n+"' parameter is undefined.");else if(n in this){var i=this[n];i instanceof e.Color?i.set(r):i instanceof e.Vector3&&r instanceof e.Vector3?i.copy(r):this[n]="overdraw"==n?Number(r):r}}},clone:function(t){return void 0===t&&(t=new e.Material),t.name=this.name,t.side=this.side,t.opacity=this.opacity,t.transparent=this.transparent,t.blending=this.blending,t.blendSrc=this.blendSrc,t.blendDst=this.blendDst,t.blendEquation=this.blendEquation,t.depthTest=this.depthTest,t.depthWrite=this.depthWrite,t.polygonOffset=this.polygonOffset,t.polygonOffsetFactor=this.polygonOffsetFactor,t.polygonOffsetUnits=this.polygonOffsetUnits,t.alphaTest=this.alphaTest,t.overdraw=this.overdraw,t.visible=this.visible,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.EventDispatcher.prototype.apply(e.Material.prototype),e.MaterialIdCount=0,e.LineBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.LineBasicMaterial.prototype=Object.create(e.Material.prototype),e.LineBasicMaterial.prototype.clone=function(){var t=new e.LineBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.linecap=this.linecap,t.linejoin=this.linejoin,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.LineDashedMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.LineDashedMaterial.prototype=Object.create(e.Material.prototype),e.LineDashedMaterial.prototype.clone=function(){var t=new e.LineDashedMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.linewidth=this.linewidth,t.scale=this.scale,t.dashSize=this.dashSize,t.gapSize=this.gapSize,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.MeshBasicMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshBasicMaterial.prototype=Object.create(e.Material.prototype),e.MeshBasicMaterial.prototype.clone=function(){var t=new e.MeshBasicMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t},e.MeshLambertMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.ambient=new e.Color(16777215),this.emissive=new e.Color(0),this.wrapAround=!1,this.wrapRGB=new e.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshLambertMaterial.prototype=Object.create(e.Material.prototype),e.MeshLambertMaterial.prototype.clone=function(){var t=new e.MeshLambertMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.MeshPhongMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.ambient=new e.Color(16777215),this.emissive=new e.Color(0),this.specular=new e.Color(1118481),this.shininess=30,this.wrapAround=this.metal=!1,this.wrapRGB=new e.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new e.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=e.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=e.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(t)},e.MeshPhongMaterial.prototype=Object.create(e.Material.prototype),e.MeshPhongMaterial.prototype.clone=function(){var t=new e.MeshPhongMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.ambient.copy(this.ambient),t.emissive.copy(this.emissive),t.specular.copy(this.specular),t.shininess=this.shininess,t.metal=this.metal,t.wrapAround=this.wrapAround,t.wrapRGB.copy(this.wrapRGB),t.map=this.map,t.lightMap=this.lightMap,t.bumpMap=this.bumpMap,t.bumpScale=this.bumpScale,t.normalMap=this.normalMap,t.normalScale.copy(this.normalScale),t.specularMap=this.specularMap,t.envMap=this.envMap,t.combine=this.combine,t.reflectivity=this.reflectivity,t.refractionRatio=this.refractionRatio,t.fog=this.fog,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.wireframeLinecap=this.wireframeLinecap,t.wireframeLinejoin=this.wireframeLinejoin,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.MeshDepthMaterial=function(t){e.Material.call(this),this.wireframe=this.morphTargets=!1,this.wireframeLinewidth=1,this.setValues(t)},e.MeshDepthMaterial.prototype=Object.create(e.Material.prototype),e.MeshDepthMaterial.prototype.clone=function(){var t=new e.MeshDepthMaterial;return e.Material.prototype.clone.call(this,t),t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},e.MeshNormalMaterial=function(t){e.Material.call(this,t),this.shading=e.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(t)},e.MeshNormalMaterial.prototype=Object.create(e.Material.prototype),e.MeshNormalMaterial.prototype.clone=function(){var t=new e.MeshNormalMaterial;return e.Material.prototype.clone.call(this,t),t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t},e.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},e.MeshFaceMaterial.prototype.clone=function(){for(var t=new e.MeshFaceMaterial,n=0;n<this.materials.length;n++)t.materials.push(this.materials[n].clone());return t},e.ParticleSystemMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(t)},e.ParticleSystemMaterial.prototype=Object.create(e.Material.prototype),e.ParticleSystemMaterial.prototype.clone=function(){var t=new e.ParticleSystemMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.size=this.size,t.sizeAttenuation=this.sizeAttenuation,t.vertexColors=this.vertexColors,t.fog=this.fog,t},e.ParticleBasicMaterial=e.ParticleSystemMaterial,e.ShaderMaterial=function(t){e.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=e.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=e.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(t)},e.ShaderMaterial.prototype=Object.create(e.Material.prototype),e.ShaderMaterial.prototype.clone=function(){var t=new e.ShaderMaterial;return e.Material.prototype.clone.call(this,t),t.fragmentShader=this.fragmentShader,t.vertexShader=this.vertexShader,t.uniforms=e.UniformsUtils.clone(this.uniforms),t.attributes=this.attributes,t.defines=this.defines,t.shading=this.shading,t.wireframe=this.wireframe,t.wireframeLinewidth=this.wireframeLinewidth,t.fog=this.fog,t.lights=this.lights,t.vertexColors=this.vertexColors,t.skinning=this.skinning,t.morphTargets=this.morphTargets,t.morphNormals=this.morphNormals,t},e.RawShaderMaterial=function(t){e.ShaderMaterial.call(this,t)},e.RawShaderMaterial.prototype=Object.create(e.ShaderMaterial.prototype),e.RawShaderMaterial.prototype.clone=function(){var t=new e.RawShaderMaterial;return e.ShaderMaterial.prototype.clone.call(this,t),t},e.SpriteMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(t)},e.SpriteMaterial.prototype=Object.create(e.Material.prototype),e.SpriteMaterial.prototype.clone=function(){var t=new e.SpriteMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.map=this.map,t.rotation=this.rotation,t.fog=this.fog,t},e.SpriteCanvasMaterial=function(t){e.Material.call(this),this.color=new e.Color(16777215),this.program=function(e,t){},this.setValues(t)},e.SpriteCanvasMaterial.prototype=Object.create(e.Material.prototype),e.SpriteCanvasMaterial.prototype.clone=function(){var t=new e.SpriteCanvasMaterial;return e.Material.prototype.clone.call(this,t),t.color.copy(this.color),t.program=this.program,t},e.ParticleCanvasMaterial=e.SpriteCanvasMaterial,e.Texture=function(t,n,r,i,s,o,u,a,f){this.id=e.TextureIdCount++,this.uuid=e.Math.generateUUID(),this.name="",this.image=t,this.mipmaps=[],this.mapping=void 0!==n?n:new e.UVMapping,this.wrapS=void 0!==r?r:e.ClampToEdgeWrapping,this.wrapT=void 0!==i?i:e.ClampToEdgeWrapping,this.magFilter=void 0!==s?s:e.LinearFilter,this.minFilter=void 0!==o?o:e.LinearMipMapLinearFilter,this.anisotropy=void 0!==f?f:1,this.format=void 0!==u?u:e.RGBAFormat,this.type=void 0!==a?a:e.UnsignedByteType,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},e.Texture.prototype={constructor:e.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(t){return void 0===t&&(t=new e.Texture),t.image=this.image,t.mipmaps=this.mipmaps.slice(0),t.mapping=this.mapping,t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.format=this.format,t.type=this.type,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.generateMipmaps=this.generateMipmaps,t.premultiplyAlpha=this.premultiplyAlpha,t.flipY=this.flipY,t.unpackAlignment=this.unpackAlignment,t},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.EventDispatcher.prototype.apply(e.Texture.prototype),e.TextureIdCount=0,e.CompressedTexture=function(t,n,r,i,s,o,u,a,f,l,c){e.Texture.call(this,null,o,u,a,f,l,i,s,c),this.image={width:n,height:r},this.mipmaps=t,this.generateMipmaps=!1},e.CompressedTexture.prototype=Object.create(e.Texture.prototype),e.CompressedTexture.prototype.clone=function(){var t=new e.CompressedTexture;return e.Texture.prototype.clone.call(this,t),t},e.DataTexture=function(t,n,r,i,s,o,u,a,f,l,c){e.Texture.call(this,null,o,u,a,f,l,i,s,c),this.image={data:t,width:n,height:r}},e.DataTexture.prototype=Object.create(e.Texture.prototype),e.DataTexture.prototype.clone=function(){var t=new e.DataTexture;return e.Texture.prototype.clone.call(this,t),t},e.ParticleSystem=function(t,n){e.Object3D.call(this),this.geometry=void 0!==t?t:new e.Geometry,this.material=void 0!==n?n:new e.ParticleSystemMaterial({color:16777215*Math.random()}),this.frustumCulled=this.sortParticles=!1},e.ParticleSystem.prototype=Object.create(e.Object3D.prototype),e.ParticleSystem.prototype.clone=function(t){return void 0===t&&(t=new e.ParticleSystem(this.geometry,this.material)),t.sortParticles=this.sortParticles,e.Object3D.prototype.clone.call(this,t),t},e.Line=function(t,n,r){e.Object3D.call(this),this.geometry=void 0!==t?t:new e.Geometry,this.material=void 0!==n?n:new e.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==r?r:e.LineStrip},e.LineStrip=0,e.LinePieces=1,e.Line.prototype=Object.create(e.Object3D.prototype),e.Line.prototype.clone=function(t){return void 0===t&&(t=new e.Line(this.geometry,this.material,this.type)),e.Object3D.prototype.clone.call(this,t),t},e.Mesh=function(t,n){e.Object3D.call(this),this.geometry=void 0!==t?t:new e.Geometry,this.material=void 0!==n?n:new e.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},e.Mesh.prototype=Object.create(e.Object3D.prototype),e.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},e.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},e.Mesh.prototype.clone=function(t,n){return void 0===t&&(t=new e.Mesh(this.geometry,this.material)),e.Object3D.prototype.clone.call(this,t,n),t},e.Bone=function(t){e.Object3D.call(this),this.skin=t,this.skinMatrix=new e.Matrix4,this.accumulatedSclWeight=this.accumulatedPosWeight=this.accumulatedRotWeight=0},e.Bone.prototype=Object.create(e.Object3D.prototype),e.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix());if(t||this.matrixWorldNeedsUpdate)e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0,this.accumulatedSclWeight=this.accumulatedPosWeight=this.accumulatedRotWeight=0;for(var n=0,r=this.children.length;n<r;n++)this.children[n].update(this.skinMatrix,t)},e.Skeleton=function(t,n){this.useVertexTexture=void 0!==n?n:!0,this.bones=[],this.boneMatrices=[];var r,i,s,o,u;if(void 0!==t){for(var a=0;a<t.length;++a)i=t[a],s=i.pos,o=i.rotq,u=i.scl,r=this.addBone(),r.name=i.name,r.position.set(s[0],s[1],s[2]),r.quaternion.set(o[0],o[1],o[2],o[3]),void 0!==u?r.scale.set(u[0],u[1],u[2]):r.scale.set(1,1,1);for(a=0;a<t.length;++a)i=t[a],-1!==i.parent&&this.bones[i.parent].add(this.bones[a]);r=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=r=256<r?64:64<r?32:16<r?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new e.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,e.RGBAFormat,e.FloatType),this.boneTexture.minFilter=e.NearestFilter,this.boneTexture.magFilter=e.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*r)}},e.Skeleton.prototype=Object.create(e.Mesh.prototype),e.Skeleton.prototype.addBone=function(t){return void 0===t&&(t=new e.Bone(this)),this.bones.push(t),t},e.Skeleton.prototype.calculateInverses=function(t){this.boneInverses=[],t=0;for(var n=this.bones.length;t<n;++t){var r=new e.Matrix4;r.getInverse(this.bones[t].skinMatrix),this.boneInverses.push(r)}},e.SkinnedMesh=function(t,n,r){e.Mesh.call(this,t,n),this.skeleton=new e.Skeleton(this.geometry&&this.geometry.bones,r);for(t=0;t<this.skeleton.bones.length;++t)n=this.skeleton.bones[t],void 0===n.parent&&this.add(n);this.identityMatrix=new e.Matrix4,this.pose()},e.SkinnedMesh.prototype=Object.create(e.Mesh.prototype),e.SkinnedMesh.prototype.updateMatrixWorld=function(){var t=new e.Matrix4;return function(n){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||n)this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1;n=0;for(var r=this.children.length;n<r;n++){var i=this.children[n];i instanceof e.Bone?i.update(this.identityMatrix,!1):i.updateMatrixWorld(!0)}void 0===this.skeleton.boneInverses&&this.skeleton.calculateInverses(),n=0;for(r=this.skeleton.bones.length;n<r;n++)t.multiplyMatrices(this.skeleton.bones[n].skinMatrix,this.skeleton.boneInverses[n]),t.flattenToArrayOffset(this.skeleton.boneMatrices,16*n);this.skeleton.useVertexTexture&&(this.skeleton.boneTexture.needsUpdate=!0)}}(),e.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},e.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof e.Geometry)for(var t=0;t<this.geometry.skinIndices.length;t++){var n=this.geometry.skinWeights[t],r=1/n.lengthManhattan();Infinity!==r?n.multiplyScalar(r):n.set(1)}},e.SkinnedMesh.prototype.clone=function(t){return void 0===t&&(t=new e.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),e.Mesh.prototype.clone.call(this,t),t},e.MorphAnimMesh=function(t,n){e.Mesh.call(this,t,n),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},e.MorphAnimMesh.prototype=Object.create(e.Mesh.prototype),e.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},e.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},e.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},e.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,r=/([a-z]+)(\d+)/,i=0,s=e.morphTargets.length;i<s;i++){var o=e.morphTargets[i].name.match(r);if(o&&1<o.length){o=o[1],n[o]||(n[o]={start:Infinity,end:-Infinity});var u=n[o];i<u.start&&(u.start=i),i>u.end&&(u.end=i),t||(t=o)}}e.firstAnimation=t},e.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},e.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=(n.end-n.start)/t*1e3,this.time=0):console.warn("animation["+e+"] undefined")},e.MorphAnimMesh.prototype.updateAnimation=function(t){var n=this.duration/this.length;this.time+=this.direction*t;if(this.mirroredLoop){if(this.time>this.duration||0>this.time)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)}else this.time%=this.duration,0>this.time&&(this.time+=this.duration);t=this.startKeyframe+e.Math.clamp(Math.floor(this.time/n),0,this.length-1),t!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[t]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=t),n=this.time%n/n,this.directionBackwards&&(n=1-n),this.morphTargetInfluences[this.currentKeyframe]=n,this.morphTargetInfluences[this.lastKeyframe]=1-n},e.MorphAnimMesh.prototype.clone=function(t){return void 0===t&&(t=new e.MorphAnimMesh(this.geometry,this.material)),t.duration=this.duration,t.mirroredLoop=this.mirroredLoop,t.time=this.time,t.lastKeyframe=this.lastKeyframe,t.currentKeyframe=this.currentKeyframe,t.direction=this.direction,t.directionBackwards=this.directionBackwards,e.Mesh.prototype.clone.call(this,t),t},e.LOD=function(){e.Object3D.call(this),this.objects=[]},e.LOD.prototype=Object.create(e.Object3D.prototype),e.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=0;n<this.objects.length&&!(t<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:t,object:e}),this.add(e)},e.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},e.LOD.prototype.update=function(){var t=new e.Vector3,n=new e.Vector3;return function(e){if(1<this.objects.length){t.setFromMatrixPosition(e.matrixWorld),n.setFromMatrixPosition(this.matrixWorld),e=t.distanceTo(n),this.objects[0].object.visible=!0;for(var r=1,i=this.objects.length;r<i;r++){if(!(e>=this.objects[r].distance))break;this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0}for(;r<i;r++)this.objects[r].object.visible=!1}}}(),e.LOD.prototype.clone=function(t){void 0===t&&(t=new e.LOD),e.Object3D.prototype.clone.call(this,t);for(var n=0,r=this.objects.length;n<r;n++){var i=this.objects[n].object.clone();i.visible=0===n,t.addLevel(i,this.objects[n].distance)}return t},e.Sprite=function(){var t=new e.Float32Attribute(3,3);t.set([-0.5,-0.5,0,.5,-0.5,0,.5,.5,0]);var n=new e.BufferGeometry;return n.addAttribute("position",t),function(t){e.Object3D.call(this),this.geometry=n,this.material=void 0!==t?t:new e.SpriteMaterial}}(),e.Sprite.prototype=Object.create(e.Object3D.prototype),e.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},e.Sprite.prototype.clone=function(t){return void 0===t&&(t=new e.Sprite(this.material)),e.Object3D.prototype.clone.call(this,t),t},e.Particle=e.Sprite,e.Scene=function(){e.Object3D.call(this),this.overrideMaterial=this.fog=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},e.Scene.prototype=Object.create(e.Object3D.prototype),e.Scene.prototype.__addObject=function(t){if(t instanceof e.Light)-1===this.__lights.indexOf(t)&&this.__lights.push(t),t.target&&void 0===t.target.parent&&this.add(t.target);else if(!(t instanceof e.Camera||t instanceof e.Bone)){this.__objectsAdded.push(t);var n=this.__objectsRemoved.indexOf(t);-1!==n&&this.__objectsRemoved.splice(n,1)}this.dispatchEvent({type:"objectAdded",object:t}),t.dispatchEvent({type:"addedToScene",scene:this});for(n=0;n<t.children.length;n++)this.__addObject(t.children[n])},e.Scene.prototype.__removeObject=function(t){if(t instanceof e.Light){var n=this.__lights.indexOf(t);-1!==n&&this.__lights.splice(n,1);if(t.shadowCascadeArray)for(n=0;n<t.shadowCascadeArray.length;n++)this.__removeObject(t.shadowCascadeArray[n])}else t instanceof e.Camera||(this.__objectsRemoved.push(t),n=this.__objectsAdded.indexOf(t),-1!==n&&this.__objectsAdded.splice(n,1));this.dispatchEvent({type:"objectRemoved",object:t}),t.dispatchEvent({type:"removedFromScene",scene:this});for(n=0;n<t.children.length;n++)this.__removeObject(t.children[n])},e.Scene.prototype.clone=function(t){return void 0===t&&(t=new e.Scene),e.Object3D.prototype.clone.call(this,t),null!==this.fog&&(t.fog=this.fog.clone()),null!==this.overrideMaterial&&(t.overrideMaterial=this.overrideMaterial.clone()),t.autoUpdate=this.autoUpdate,t.matrixAutoUpdate=this.matrixAutoUpdate,t},e.Fog=function(t,n,r){this.name="",this.color=new e.Color(t),this.near=void 0!==n?n:1,this.far=void 0!==r?r:1e3},e.Fog.prototype.clone=function(){return new e.Fog(this.color.getHex(),this.near,this.far)},e.FogExp2=function(t,n){this.name="",this.color=new e.Color(t),this.density=void 0!==n?n:25e-5},e.FogExp2.prototype.clone=function(){return new e.FogExp2(this.color.getHex(),this.density)},e.CanvasRenderer=function(t){function n(e,t,n,r){l(t),c(n),h(r),p(e.getStyle()),k.stroke(),ft.expandByScalar(2*t)}function r(e){d(e.getStyle()),k.fill()}function i(e){s(e.target)}function s(t){var n=t.wrapS===e.RepeatWrapping,r=t.wrapT===e.RepeatWrapping,i=t.image,s=document.createElement("canvas");s.width=i.width,s.height=i.height;var o=s.getContext("2d");o.setTransform(1,0,0,-1,0,i.height),o.drawImage(i,0,0),Z[t.id]=k.createPattern(s,!0===n&&!0===r?"repeat":!0===n&&!1===r?"repeat-x":!1===n&&!0===r?"repeat-y":"no-repeat")}function o(t,n,r,o,u,a,f,l,c,h,p,v,m){if(!(m instanceof e.DataTexture)){!1===m.hasEventListener("update",i)&&(void 0!==m.image&&0<m.image.width&&s(m),m.addEventListener("update",i));var g=Z[m.id];if(void 0!==g){d(g);var g=m.offset.x/m.repeat.x,y=m.offset.y/m.repeat.y,b=m.image.width*m.repeat.x;m=m.image.height*m.repeat.y,f=(f+g)*b,l=(l+y)*m,r-=t,o-=n,u-=t,a-=n,c=(c+g)*b-f,h=(h+y)*m-l,p=(p+g)*b-f,v=(v+y)*m-l,m=c*v-p*h,0!==m&&(g=1/m,m=(v*r-h*u)*g,h=(v*o-h*a)*g,r=(c*u-p*r)*g,o=(c*a-p*o)*g,t=t-m*f-r*l,n=n-h*f-o*l,k.save(),k.transform(m,h,r,o,t,n),k.fill(),k.restore())}else d("rgba(0,0,0,1)"),k.fill()}}function u(e,t,n){var r=t.x-e.x,i=t.y-e.y,s=r*r+i*i;0!==s&&(n/=Math.sqrt(s),r*=n,i*=n,t.x+=r,t.y+=i,e.x-=r,e.y-=i)}function a(e){O!==e&&(O=k.globalAlpha=e)}function f(t){M!==t&&(t===e.NormalBlending?k.globalCompositeOperation="source-over":t===e.AdditiveBlending?k.globalCompositeOperation="lighter":t===e.SubtractiveBlending&&(k.globalCompositeOperation="darker"),M=t)}function l(e){P!==e&&(P=k.lineWidth=e)}function c(e){H!==e&&(H=k.lineCap=e)}function h(e){B!==e&&(B=k.lineJoin=e)}function p(e){_!==e&&(_=k.strokeStyle=e)}function d(e){D!==e&&(D=k.fillStyle=e)}function v(e,t){if(j!==e||F!==t)k.setLineDash([e,t]),j=e,F=t}console.log("THREE.CanvasRenderer",e.REVISION);var m=e.Math.smoothstep;t=t||{};var g=this,y,b,w,E=new e.Projector,S=void 0!==t.canvas?t.canvas:document.createElement("canvas"),x=S.width,T=S.height,N=Math.floor(x/2),C=Math.floor(T/2),k=S.getContext("2d",{alpha:!0===t.alpha}),L=new e.Color(0),A=0,O=1,M=0,_=null,D=null,P=null,H=null,B=null,j=null,F=0,I,q,R,U;new e.RenderableVertex,new e.RenderableVertex;var z,W,X,V,$,J,K=new e.Color;new e.Color,new e.Color,new e.Color,new e.Color;var Q=new e.Color,G=new e.Color,Y=new e.Color,Z={},et,tt,nt,rt,it,st,ot,ut=new e.Box2,at=new e.Box2,ft=new e.Box2,lt=new e.Color,ct=new e.Color,ht=new e.Color,pt=new e.Vector3,dt=new e.Vector3,vt=new e.Vector3,mt=new e.Matrix3;void 0===k.setLineDash&&(k.setLineDash=function(){}),this.domElement=S,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,n){x=e*this.devicePixelRatio,T=t*this.devicePixelRatio,S.width=x,S.height=T,N=Math.floor(x/2),C=Math.floor(T/2),!1!==n&&(S.style.width=e+"px",S.style.height=t+"px"),ut.min.set(-N,-C),ut.max.set(N,C),at.min.set(-N,-C),at.max.set(N,C),O=1,M=0,B=H=P=D=_=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,n,r){k.setTransform(n*this.devicePixelRatio/x,0,0,-(r*this.devicePixelRatio)/T,e*this.devicePixelRatio,T-t*this.devicePixelRatio),k.translate(N,C)},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(e,t){L.set(e),A=void 0!==t?t:1,at.min.set(-N,-C),at.max.set(N,C)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===at.empty()&&(at.intersect(ut),at.expandByScalar(2),1>A&&k.clearRect(at.min.x|0,at.min.y|0,at.max.x-at.min.x|0,at.max.y-at.min.y|0),0<A&&(f(e.NormalBlending),a(1),d("rgba("+Math.floor(255*L.r)+","+Math.floor(255*L.g)+","+Math.floor(255*L.b)+","+A+")"),k.fillRect(at.min.x|0,at.min.y|0,at.max.x-at.min.x|0,at.max.y-at.min.y|0)),at.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(t,S){if(0==S instanceof e.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear(),g.info.render.vertices=0,g.info.render.faces=0,y=E.projectScene(t,S,this.sortObjects,this.sortElements),b=y.elements,w=y.lights,I=S,mt.getNormalMatrix(S.matrixWorldInverse),lt.setRGB(0,0,0),ct.setRGB(0,0,0),ht.setRGB(0,0,0);for(var x=0,T=w.length;x<T;x++){var L=w[x],A=L.color;L instanceof e.AmbientLight?lt.add(A):L instanceof e.DirectionalLight?ct.add(A):L instanceof e.PointLight&&ht.add(A)}x=0;for(T=b.length;x<T;x++){var O=b[x],M=O.material;if(void 0!==M&&0!==M.opacity){ft.makeEmpty();if(O instanceof e.RenderableSprite){q=O,q.x*=N,q.y*=C;var L=q,_=O,A=M;a(A.opacity),f(A.blending);var D=_.scale.x*N,_=_.scale.y*C,O=.5*Math.sqrt(D*D+_*_);ft.min.set(L.x-O,L.y-O),ft.max.set(L.x+O,L.y+O);if(A instanceof e.SpriteMaterial||A instanceof e.ParticleSystemMaterial){var P=A.map;if(null!==P){!1===P.hasEventListener("update",i)&&(void 0!==P.image&&0<P.image.width&&s(P),P.addEventListener("update",i)),O=Z[P.id],void 0!==O?d(O):d("rgba( 0, 0, 0, 1 )");var H=P.image,O=H.width*P.offset.x,M=H.height*P.offset.y,B=H.width*P.repeat.x,P=H.height*P.repeat.y,H=D/B,j=_/P;k.save(),k.translate(L.x,L.y),0!==A.rotation&&k.rotate(A.rotation),k.translate(-D/2,-_/2),k.scale(H,j),k.translate(-O,-M),k.fillRect(O,M,B,P)}else d(A.color.getStyle()),k.save(),k.translate(L.x,L.y),0!==A.rotation&&k.rotate(A.rotation),k.scale(D,-_),k.fillRect(-0.5,-0.5,1,1);k.restore()}else A instanceof e.SpriteCanvasMaterial&&(p(A.color.getStyle()),d(A.color.getStyle()),k.save(),k.translate(L.x,L.y),0!==A.rotation&&k.rotate(A.rotation),k.scale(D,_),A.program(k),k.restore())}else if(O instanceof e.RenderableLine){if(q=O.v1,R=O.v2,q.positionScreen.x*=N,q.positionScreen.y*=C,R.positionScreen.x*=N,R.positionScreen.y*=C,ft.setFromPoints([q.positionScreen,R.positionScreen]),!0===ut.isIntersectionBox(ft))if(L=q,A=R,D=O,_=M,a(_.opacity),f(_.blending),k.beginPath(),k.moveTo(L.positionScreen.x,L.positionScreen.y),k.lineTo(A.positionScreen.x,A.positionScreen.y),_ instanceof e.LineBasicMaterial){l(_.linewidth),c(_.linecap),h(_.linejoin);if(_.vertexColors!==e.VertexColors)p(_.color.getStyle());else if(O=D.vertexColors[0].getStyle(),D=D.vertexColors[1].getStyle(),O===D)p(O);else{try{var F=k.createLinearGradient(L.positionScreen.x,L.positionScreen.y,A.positionScreen.x,A.positionScreen.y);F.addColorStop(0,O),F.addColorStop(1,D)}catch(gt){F=O}p(F)}k.stroke(),ft.expandByScalar(2*_.linewidth)}else _ instanceof e.LineDashedMaterial&&(l(_.linewidth),c(_.linecap),h(_.linejoin),p(_.color.getStyle()),v(_.dashSize,_.gapSize),k.stroke(),ft.expandByScalar(2*_.linewidth),v(null,null))}else if(O instanceof e.RenderableFace){q=O.v1,R=O.v2,U=O.v3;if(-1>q.positionScreen.z||1<q.positionScreen.z)continue;if(-1>R.positionScreen.z||1<R.positionScreen.z)continue;if(-1>U.positionScreen.z||1<U.positionScreen.z)continue;q.positionScreen.x*=N,q.positionScreen.y*=C,R.positionScreen.x*=N,R.positionScreen.y*=C,U.positionScreen.x*=N,U.positionScreen.y*=C,0<M.overdraw&&(u(q.positionScreen,R.positionScreen,M.overdraw),u(R.positionScreen,U.positionScreen,M.overdraw),u(U.positionScreen,q.positionScreen,M.overdraw)),ft.setFromPoints([q.positionScreen,R.positionScreen,U.positionScreen]);if(!0===ut.isIntersectionBox(ft)){A=q,D=R,_=U,L=M,g.info.render.vertices+=3,g.info.render.faces++,a(L.opacity),f(L.blending),z=A.positionScreen.x,W=A.positionScreen.y,X=D.positionScreen.x,V=D.positionScreen.y,$=_.positionScreen.x,J=_.positionScreen.y;var M=z,B=W,P=X,H=V,j=$,yt=J;k.beginPath(),k.moveTo(M,B),k.lineTo(P,H),k.lineTo(j,yt),k.closePath();if((L instanceof e.MeshLambertMaterial||L instanceof e.MeshPhongMaterial)&&null===L.map){Q.copy(L.color),G.copy(L.emissive),L.vertexColors===e.FaceColors&&Q.multiply(O.color),K.copy(lt),dt.copy(A.positionWorld).add(D.positionWorld).add(_.positionWorld).divideScalar(3),A=dt,D=O.normalModel,_=K,O=0;for(M=w.length;O<M;O++)B=w[O],Y.copy(B.color),B instanceof e.DirectionalLight?(P=pt.setFromMatrixPosition(B.matrixWorld).normalize(),H=D.dot(P),0>=H||(H*=B.intensity,_.add(Y.multiplyScalar(H)))):B instanceof e.PointLight&&(P=pt.setFromMatrixPosition(B.matrixWorld),H=D.dot(pt.subVectors(P,A).normalize()),0>=H||(H*=0==B.distance?1:1-Math.min(A.distanceTo(P)/B.distance,1),0!=H&&(H*=B.intensity,_.add(Y.multiplyScalar(H)))));K.multiply(Q).add(G),!0===L.wireframe?n(K,L.wireframeLinewidth,L.wireframeLinecap,L.wireframeLinejoin):r(K)}else L instanceof e.MeshBasicMaterial||L instanceof e.MeshLambertMaterial||L instanceof e.MeshPhongMaterial?null!==L.map?L.map.mapping instanceof e.UVMapping&&(et=O.uvs,o(z,W,X,V,$,J,et[0].x,et[0].y,et[1].x,et[1].y,et[2].x,et[2].y,L.map)):null!==L.envMap?L.envMap.mapping instanceof e.SphericalReflectionMapping?(vt.copy(O.vertexNormalsModel[0]).applyMatrix3(mt),tt=.5*vt.x+.5,nt=.5*vt.y+.5,vt.copy(O.vertexNormalsModel[1]).applyMatrix3(mt),rt=.5*vt.x+.5,it=.5*vt.y+.5,vt.copy(O.vertexNormalsModel[2]).applyMatrix3(mt),st=.5*vt.x+.5,ot=.5*vt.y+.5,o(z,W,X,V,$,J,tt,nt,rt,it,st,ot,L.envMap)):L.envMap.mapping instanceof e.SphericalRefractionMapping&&(vt.copy(O.vertexNormalsModel[0]).applyMatrix3(mt),tt=-0.5*vt.x+.5,nt=-0.5*vt.y+.5,vt.copy(O.vertexNormalsModel[1]).applyMatrix3(mt),rt=-0.5*vt.x+.5,it=-0.5*vt.y+.5,vt.copy(O.vertexNormalsModel[2]).applyMatrix3(mt),st=-0.5*vt.x+.5,ot=-0.5*vt.y+.5,o(z,W,X,V,$,J,tt,nt,rt,it,st,ot,L.envMap)):(K.copy(L.color),L.vertexColors===e.FaceColors&&K.multiply(O.color),!0===L.wireframe?n(K,L.wireframeLinewidth,L.wireframeLinecap,L.wireframeLinejoin):r(K)):(L instanceof e.MeshDepthMaterial?K.r=K.g=K.b=1-m(A.positionScreen.z*A.positionScreen.w,I.near,I.far):L instanceof e.MeshNormalMaterial?(vt.copy(O.normalModel).applyMatrix3(mt),K.setRGB(vt.x,vt.y,vt.z).multiplyScalar(.5).addScalar(.5)):K.setRGB(1,1,1),!0===L.wireframe?n(K,L.wireframeLinewidth,L.wireframeLinecap,L.wireframeLinejoin):r(K))}}at.union(ft)}}}}},e.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\n	uniform vec3 fogColor;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",fog_fragment:"#ifdef USE_FOG\n	#ifdef USE_LOGDEPTHBUF_EXT\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n	#else\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n	#endif\n	#ifdef FOG_EXP2\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n	#endif\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	uniform samplerCube envMap;\n	uniform float flipEnvMap;\n	uniform int combine;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n		uniform bool useRefract;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\n	vec3 reflectVec;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n		if ( useRefract ) {\n			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n		} else { \n			reflectVec = reflect( cameraToVertex, worldNormal );\n		}\n	#else\n		reflectVec = vReflect;\n	#endif\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n		vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#else\n		vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#endif\n	#ifdef GAMMA_INPUT\n		cubeColor.xyz *= cubeColor.xyz;\n	#endif\n	if ( combine == 1 ) {\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n	} else if ( combine == 2 ) {\n		gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n	} else {\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n	}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n	varying vec3 vReflect;\n	uniform float refractionRatio;\n	uniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n	#ifdef USE_SKINNING\n		vec4 worldPosition = modelMatrix * skinned;\n	#endif\n	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n	#endif\n	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n	#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n	if ( useRefract ) {\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n	} else {\n		vReflect = reflect( cameraToVertex, worldNormal );\n	}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n	vec4 texelColor = texture2D( map, vUv );\n	#ifdef GAMMA_INPUT\n		texelColor.xyz *= texelColor.xyz;\n	#endif\n	gl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\n	varying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\n	vUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 );\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n		vec3 S = normalize(  q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n	}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\n	uniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n	vLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n	#ifdef DOUBLE_SIDED\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n		#ifdef WRAP_AROUND\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n		#endif\n	#endif\n	#ifdef WRAP_AROUND\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n		#ifdef DOUBLE_SIDED\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n		#endif\n	#endif\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n	#ifdef DOUBLE_SIDED\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n	#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n		#ifdef DOUBLE_SIDED\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n			#ifdef WRAP_AROUND\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n			#endif\n		#endif\n		#ifdef WRAP_AROUND\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n			#ifdef DOUBLE_SIDED\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n			#endif\n		#endif\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n		#ifdef DOUBLE_SIDED\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n		#endif\n	}\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n			spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n			lVector = normalize( lVector );\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n			#ifdef DOUBLE_SIDED\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n				#ifdef WRAP_AROUND\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n				#endif\n			#endif\n			#ifdef WRAP_AROUND\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n				#ifdef DOUBLE_SIDED\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n				#endif\n			#endif\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n			#ifdef DOUBLE_SIDED\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n			#endif\n		}\n	}\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n		float dotProduct = dot( transformedNormal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n		#ifdef DOUBLE_SIDED\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n		#endif\n	}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n	varying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n	vWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n	varying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\n	uniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\n	vec3 pointDiffuse  = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n		lVector = normalize( lVector );\n		float dotProduct = dot( normal, lVector );\n		#ifdef WRAP_AROUND\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n		#else\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n		#endif\n		pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n		float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n	}\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	vec3 spotDiffuse  = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n		lVector = normalize( lVector );\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n			spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n			float dotProduct = dot( normal, lVector );\n			#ifdef WRAP_AROUND\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n			#else\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n			#endif\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n		}\n	}\n#endif\n#if MAX_DIR_LIGHTS > 0\n	vec3 dirDiffuse  = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n		float dotProduct = dot( normal, dirVector );\n		#ifdef WRAP_AROUND\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n		#else\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n		#endif\n		dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n		float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n	}\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	vec3 hemiDiffuse  = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n		hemiDiffuse += diffuse * hemiColor;\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\n		vec3 lVectorGround = -lVector;\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n		float dotProductGround = dot( normal, lVectorGround );\n		float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n	}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n#endif\n#ifdef METAL\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n	varying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n	varying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n	#ifdef GAMMA_INPUT\n		vColor = color * color;\n	#else\n		vColor = color;\n	#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n	#ifdef BONE_TEXTURE\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n		mat4 getBoneMatrix( const in float i ) {\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n			y = dy * ( y + 0.5 );\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n			mat4 bone = mat4( v1, v2, v3, v4 );\n			return bone;\n		}\n	#else\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n		mat4 getBoneMatrix( const in float i ) {\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n		}\n	#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n	#ifdef USE_MORPHTARGETS\n	vec4 skinVertex = vec4( morphed, 1.0 );\n	#else\n	vec4 skinVertex = vec4( position, 1.0 );\n	#endif\n	vec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n	skinned      += boneMatY * skinVertex * skinWeight.y;\n	skinned      += boneMatZ * skinVertex * skinWeight.z;\n	skinned      += boneMatW * skinVertex * skinWeight.w;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n	#ifndef USE_MORPHNORMALS\n	uniform float morphTargetInfluences[ 8 ];\n	#else\n	uniform float morphTargetInfluences[ 4 ];\n	#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n	#ifndef USE_MORPHNORMALS\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n	#endif\n	morphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\n	mvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n	mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n	vec3 morphedNormal = vec3( 0.0 );\n	morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n	morphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n	mat4 skinMatrix = skinWeight.x * boneMatX;\n	skinMatrix 	+= skinWeight.y * boneMatY;\n	skinMatrix 	+= skinWeight.z * boneMatZ;\n	skinMatrix 	+= skinWeight.w * boneMatW;\n	#ifdef USE_MORPHNORMALS\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n	#else\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n	#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\n	objectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n	objectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n	objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n	objectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	float unpackDepth( const in vec4 rgba_depth ) {\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n	}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n	#ifdef SHADOWMAP_DEBUG\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n	#endif\n	#ifdef SHADOWMAP_CASCADE\n		int inFrustumCount = 0;\n	#endif\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n		#ifdef SHADOWMAP_CASCADE\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n		#else\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n		#endif\n		bool frustumTest = all( frustumTestVec );\n		if ( frustumTest ) {\n			shadowCoord.z += shadowBias[ i ];\n			#if defined( SHADOWMAP_TYPE_PCF )\n				float shadow = 0.0;\n				const float shadowDelta = 1.0 / 9.0;\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n				float shadow = 0.0;\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n				mat3 shadowKernel;\n				mat3 depthKernel;\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n			#else\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n				if ( fDepth < shadowCoord.z )\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n			#endif\n		}\n		#ifdef SHADOWMAP_DEBUG\n			#ifdef SHADOWMAP_CASCADE\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n			#else\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n			#endif\n		#endif\n	}\n	#ifdef GAMMA_OUTPUT\n		shadowColor *= shadowColor;\n	#endif\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n	}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		varying float vFragDepth;\n	#endif\n	uniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n	#ifdef USE_LOGDEPTHBUF_EXT\n		vFragDepth = 1.0 + gl_Position.w;\n#else\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n	#endif\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n	uniform float logDepthBufFC;\n	#ifdef USE_LOGDEPTHBUF_EXT\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n	#endif\n#endif",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif"},e.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++)for(n in r=this.clone(e[t]),r)i[n]=r[n];return i},clone:function(t){var n,r,i,s={};for(n in t)for(r in s[n]={},t[n])i=t[n][r],s[n][r]=i instanceof e.Color||i instanceof e.Vector2||i instanceof e.Vector3||i instanceof e.Vector4||i instanceof e.Matrix4||i instanceof e.Texture?i.clone():i instanceof Array?i.slice():i;return s}},e.UniformsLib={common:{diffuse:{type:"c",value:new e.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new e.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new e.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new e.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new e.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new e.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},e.ShaderLib={basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.shadowmap]),vertexShader:[e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"	#endif",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( diffuse, opacity );",e.ShaderChunk.logdepthbuf_fragment,e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{ambient:{type:"c",value:new e.Color(16777215)},emissive:{type:"c",value:new e.Color(0)},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n#endif",e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_lambert_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_lambert_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n#endif",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( vec3( 1.0 ), opacity );",e.ShaderChunk.logdepthbuf_fragment,e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED\n		if ( gl_FrontFacing )\n			gl_FragColor.xyz *= vLightFront;\n		else\n			gl_FragColor.xyz *= vLightBack;\n	#else\n		gl_FragColor.xyz *= vLightFront;\n	#endif",e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.bump,e.UniformsLib.normalmap,e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{ambient:{type:"c",value:new e.Color(16777215)},emissive:{type:"c",value:new e.Color(0)},specular:{type:"c",value:new e.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",e.ShaderChunk.map_pars_vertex,e.ShaderChunk.lightmap_pars_vertex,e.ShaderChunk.envmap_pars_vertex,e.ShaderChunk.lights_phong_pars_vertex,e.ShaderChunk.color_pars_vertex,e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.map_vertex,e.ShaderChunk.lightmap_vertex,e.ShaderChunk.color_vertex,e.ShaderChunk.morphnormal_vertex,e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,e.ShaderChunk.defaultnormal_vertex,"	vNormal = normalize( transformedNormal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = -mvPosition.xyz;",e.ShaderChunk.worldpos_vertex,e.ShaderChunk.envmap_vertex,e.ShaderChunk.lights_phong_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_pars_fragment,e.ShaderChunk.lightmap_pars_fragment,e.ShaderChunk.envmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.lights_phong_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.bumpmap_pars_fragment,e.ShaderChunk.normalmap_pars_fragment,e.ShaderChunk.specularmap_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( vec3( 1.0 ), opacity );",e.ShaderChunk.logdepthbuf_fragment,e.ShaderChunk.map_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.specularmap_fragment,e.ShaderChunk.lights_phong_fragment,e.ShaderChunk.lightmap_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.envmap_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:e.UniformsUtils.merge([e.UniformsLib.particle,e.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",e.ShaderChunk.color_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	#ifdef USE_SIZEATTENUATION\n		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n	#else\n		gl_PointSize = size;\n	#endif\n	gl_Position = projectionMatrix * mvPosition;",e.ShaderChunk.logdepthbuf_vertex,e.ShaderChunk.worldpos_vertex,e.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.map_particle_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( psColor, opacity );",e.ShaderChunk.logdepthbuf_fragment,e.ShaderChunk.map_particle_fragment,e.ShaderChunk.alphatest_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:e.UniformsUtils.merge([e.UniformsLib.common,e.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",e.ShaderChunk.color_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	gl_Position = projectionMatrix * mvPosition;",e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",e.ShaderChunk.color_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	gl_FragColor = vec4( diffuse, opacity );",e.ShaderChunk.logdepthbuf_fragment,e.ShaderChunk.color_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;\nuniform float mFar;\nuniform float opacity;",e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",e.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n	#else\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n	#endif\n	float color = 1.0 - smoothstep( mNear, mFar, depth );\n	gl_FragColor = vec4( vec3( color ), opacity );\n}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vNormal = normalize( normalMatrix * normal );",e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vNormal;",e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",e.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},normalmap:{uniforms:e.UniformsUtils.merge([e.UniformsLib.fog,e.UniformsLib.lights,e.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new e.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new e.Color(16777215)},specular:{type:"c",value:new e.Color(1118481)},ambient:{type:"c",value:new e.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new e.Vector2(0,0)},uRepeat:{type:"v2",value:new e.Vector2(1,1)},wrapRGB:{type:"v3",value:new e.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float refractionRatio;\nuniform float reflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\n	uniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",e.ShaderChunk.shadowmap_pars_fragment,e.ShaderChunk.fog_pars_fragment,e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",e.ShaderChunk.logdepthbuf_fragment,"	gl_FragColor = vec4( vec3( 1.0 ), opacity );\n	vec3 specularTex = vec3( 1.0 );\n	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\n	normalTex.xy *= uNormalScale;\n	normalTex = normalize( normalTex );\n	if( enableDiffuse ) {\n		#ifdef GAMMA_INPUT\n			vec4 texelColor = texture2D( tDiffuse, vUv );\n			texelColor.xyz *= texelColor.xyz;\n			gl_FragColor = gl_FragColor * texelColor;\n		#else\n			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n		#endif\n	}\n	if( enableAO ) {\n		#ifdef GAMMA_INPUT\n			vec4 aoColor = texture2D( tAO, vUv );\n			aoColor.xyz *= aoColor.xyz;\n			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n		#else\n			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n		#endif\n	}\n	if( enableSpecular )\n		specularTex = texture2D( tSpecular, vUv ).xyz;\n	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\n	vec3 finalNormal = tsb * normalTex;\n	#ifdef FLIP_SIDED\n		finalNormal = -finalNormal;\n	#endif\n	vec3 normal = normalize( finalNormal );\n	vec3 viewPosition = normalize( vViewPosition );\n	#if MAX_POINT_LIGHTS > 0\n		vec3 pointDiffuse = vec3( 0.0 );\n		vec3 pointSpecular = vec3( 0.0 );\n		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;\n			float pointDistance = 1.0;\n			if ( pointLightDistance[ i ] > 0.0 )\n				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\n			pointVector = normalize( pointVector );\n			#ifdef WRAP_AROUND\n				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\n				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\n				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n			#else\n				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n			#endif\n			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;\n			vec3 pointHalfVector = normalize( pointVector + viewPosition );\n			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\n			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n		}\n	#endif\n	#if MAX_SPOT_LIGHTS > 0\n		vec3 spotDiffuse = vec3( 0.0 );\n		vec3 spotSpecular = vec3( 0.0 );\n		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;\n			float spotDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\n			spotVector = normalize( spotVector );\n			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n			if ( spotEffect > spotLightAngleCos[ i ] ) {\n				spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n				#ifdef WRAP_AROUND\n					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\n					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\n					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n				#else\n					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n				#endif\n				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;\n				vec3 spotHalfVector = normalize( spotVector + viewPosition );\n				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n				float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\n				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n			}\n		}\n	#endif\n	#if MAX_DIR_LIGHTS > 0\n		vec3 dirDiffuse = vec3( 0.0 );\n		vec3 dirSpecular = vec3( 0.0 );\n		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\n			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n			vec3 dirVector = normalize( lDirection.xyz );\n			#ifdef WRAP_AROUND\n				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\n				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\n				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n			#else\n				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n			#endif\n			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;\n			vec3 dirHalfVector = normalize( dirVector + viewPosition );\n			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\n			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n		}\n	#endif\n	#if MAX_HEMI_LIGHTS > 0\n		vec3 hemiDiffuse  = vec3( 0.0 );\n		vec3 hemiSpecular = vec3( 0.0 );\n		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n			vec3 lVector = normalize( lDirection.xyz );\n			float dotProduct = dot( normal, lVector );\n			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n			hemiDiffuse += diffuse * hemiColor;\n			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n			float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\n			vec3 lVectorGround = -lVector;\n			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n			float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n			float dotProductGround = dot( normal, lVectorGround );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\n			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\n			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n		}\n	#endif\n	vec3 totalDiffuse = vec3( 0.0 );\n	vec3 totalSpecular = vec3( 0.0 );\n	#if MAX_DIR_LIGHTS > 0\n		totalDiffuse += dirDiffuse;\n		totalSpecular += dirSpecular;\n	#endif\n	#if MAX_HEMI_LIGHTS > 0\n		totalDiffuse += hemiDiffuse;\n		totalSpecular += hemiSpecular;\n	#endif\n	#if MAX_POINT_LIGHTS > 0\n		totalDiffuse += pointDiffuse;\n		totalSpecular += pointSpecular;\n	#endif\n	#if MAX_SPOT_LIGHTS > 0\n		totalDiffuse += spotDiffuse;\n		totalSpecular += spotSpecular;\n	#endif\n	#ifdef METAL\n		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n	#else\n		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n	#endif\n	if ( enableReflection ) {\n		vec3 vReflect;\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n		if ( useRefract ) {\n			vReflect = refract( cameraToVertex, normal, refractionRatio );\n		} else {\n			vReflect = reflect( cameraToVertex, normal );\n		}\n		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n		#ifdef GAMMA_INPUT\n			cubeColor.xyz *= cubeColor.xyz;\n		#endif\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );\n	}",e.ShaderChunk.shadowmap_fragment,e.ShaderChunk.linear_to_gamma_fragment,e.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\n	uniform sampler2D tDisplacement;\n	uniform float uDisplacementScale;\n	uniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.shadowmap_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.skinnormal_vertex,"	#ifdef USE_SKINNING\n		vNormal = normalize( normalMatrix * skinnedNormal.xyz );\n		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\n		vTangent = normalize( normalMatrix * skinnedTangent.xyz );\n	#else\n		vNormal = normalize( normalMatrix * normal );\n		vTangent = normalize( normalMatrix * tangent.xyz );\n	#endif\n	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\n	vUv = uv * uRepeat + uOffset;\n	vec3 displacedPosition;\n	#ifdef VERTEX_TEXTURES\n		if ( enableDisplacement ) {\n			vec3 dv = texture2D( tDisplacement, uv ).xyz;\n			float df = uDisplacementScale * dv.x + uDisplacementBias;\n			displacedPosition = position + normalize( normal ) * df;\n		} else {\n			#ifdef USE_SKINNING\n				vec4 skinVertex = vec4( position, 1.0 );\n				vec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n				skinned 	  += boneMatY * skinVertex * skinWeight.y;\n				skinned 	  += boneMatZ * skinVertex * skinWeight.z;\n				skinned 	  += boneMatW * skinVertex * skinWeight.w;\n				displacedPosition  = skinned.xyz;\n			#else\n				displacedPosition = position;\n			#endif\n		}\n	#else\n		#ifdef USE_SKINNING\n			vec4 skinVertex = vec4( position, 1.0 );\n			vec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n			skinned 	  += boneMatY * skinVertex * skinWeight.y;\n			skinned 	  += boneMatZ * skinVertex * skinWeight.z;\n			skinned 	  += boneMatW * skinVertex * skinWeight.w;\n			displacedPosition  = skinned.xyz;\n		#else\n			displacedPosition = position;\n		#endif\n	#endif\n	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\n	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\n	gl_Position = projectionMatrix * mvPosition;",e.ShaderChunk.logdepthbuf_vertex,"	vWorldPosition = worldPosition.xyz;\n	vViewPosition = -mvPosition.xyz;\n	#ifdef USE_SHADOWMAP\n		for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n		}\n	#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n	vWorldPosition = worldPosition.xyz;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",e.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",e.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[e.ShaderChunk.morphtarget_pars_vertex,e.ShaderChunk.skinning_pars_vertex,e.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",e.ShaderChunk.skinbase_vertex,e.ShaderChunk.morphtarget_vertex,e.ShaderChunk.skinning_vertex,e.ShaderChunk.default_vertex,e.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[e.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {\n	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n	const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n	res -= res.xxyz * bit_mask;\n	return res;\n}\nvoid main() {",e.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT\n		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n	#else\n		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n	#endif\n}"].join("\n")}},e.WebGLRenderer=function(t){function n(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;"v2"===s.type?o=2:"v3"===s.type?o=3:"v4"===s.type?o=4:"c"===s.type&&(o=3),s.size=o,s.array=new Float32Array(n*o),s.buffer=Ct.createBuffer(),s.buffer.belongsToAttribute=i,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function r(e,t){var n=t.geometry,r=e.faces3,u=3*r.length,a=1*r.length,f=3*r.length,r=i(t,e),l=o(r),c=s(r),h=r.vertexColors?r.vertexColors:!1;e.__vertexArray=new Float32Array(3*u),c&&(e.__normalArray=new Float32Array(3*u)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*u)),h&&(e.__colorArray=new Float32Array(3*u)),l&&(0<n.faceVertexUvs.length&&(e.__uvArray=new Float32Array(2*u)),1<n.faceVertexUvs.length&&(e.__uv2Array=new Float32Array(2*u))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*u),e.__skinWeightArray=new Float32Array(4*u)),n=null!==Mt&&21845<a?Uint32Array:Uint16Array,e.__typeArray=n,e.__faceArray=new n(3*a),e.__lineArray=new n(2*f);if(e.numMorphTargets)for(e.__morphTargetsArrays=[],n=0,l=e.numMorphTargets;n<l;n++)e.__morphTargetsArrays.push(new Float32Array(3*u));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],n=0,l=e.numMorphNormals;n<l;n++)e.__morphNormalsArrays.push(new Float32Array(3*u));e.__webglFaceCount=3*a,e.__webglLineCount=2*f;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var p in r.attributes){var a=r.attributes[p],f={},d;for(d in a)f[d]=a[d];if(!f.__webglInitialized||f.createUniqueBuffers)f.__webglInitialized=!0,n=1,"v2"===f.type?n=2:"v3"===f.type?n=3:"v4"===f.type?n=4:"c"===f.type&&(n=3),f.size=n,f.array=new Float32Array(u*n),f.buffer=Ct.createBuffer(),f.buffer.belongsToAttribute=p,a.needsUpdate=!0,f.__original=a;e.__webglCustomAttributesList.push(f)}}e.__inittedArrays=!0}function i(t,n){return t.material instanceof e.MeshFaceMaterial?t.material.materials[n.materialIndex]:t.material}function s(t){return t instanceof e.MeshBasicMaterial&&!t.envMap||t instanceof e.MeshDepthMaterial?!1:t&&void 0!==t.shading&&t.shading===e.SmoothShading?e.SmoothShading:e.FlatShading}function o(t){return t.map||t.lightMap||t.bumpMap||t.normalMap||t.specularMap||t instanceof e.ShaderMaterial?!0:!1}function u(e,t,n,r){for(var i in t){var s=t[i],o=n[i];if(0<=s)if(o){var u=o.itemSize;Ct.bindBuffer(Ct.ARRAY_BUFFER,o.buffer),f(s),Ct.vertexAttribPointer(s,u,Ct.FLOAT,!1,0,r*u*4)}else e.defaultAttributeValues&&(2===e.defaultAttributeValues[i].length?Ct.vertexAttrib2fv(s,e.defaultAttributeValues[i]):3===e.defaultAttributeValues[i].length&&Ct.vertexAttrib3fv(s,e.defaultAttributeValues[i]))}l()}function a(){for(var e=0,t=gt.length;e<t;e++)gt[e]=0}function f(e){gt[e]=1,0===yt[e]&&(Ct.enableVertexAttribArray(e),yt[e]=1)}function l(){for(var e=0,t=yt.length;e<t;e++)yt[e]!==gt[e]&&(Ct.disableVertexAttribArray(e),yt[e]=0)}function c(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function h(e,t){return t[0]-e[0]}function p(e,t,n){if(e.length)for(var r=0,i=e.length;r<i;r++)G=$=null,K=Q=et=Z=ot=st=tt=-1,Tt=!0,e[r].render(t,n,vt,mt),G=$=null,K=Q=et=Z=ot=st=tt=-1,Tt=!0}function d(t,n,r,i,s,o,u,a){var f,l,c,h;n?(l=t.length-1,h=n=-1):(l=0,n=t.length,h=1);for(var p=l;p!==n;p+=h)if(f=t[p],f.render){l=f.object,c=f.buffer;if(a)f=a;else{f=f[r];if(!f)continue;u&&X.setBlending(f.blending,f.blendEquation,f.blendSrc,f.blendDst),X.setDepthTest(f.depthTest),X.setDepthWrite(f.depthWrite),L(f.polygonOffset,f.polygonOffsetFactor,f.polygonOffsetUnits)}X.setMaterialFaces(f),c instanceof e.BufferGeometry?X.renderBufferDirect(i,s,o,f,c,l):X.renderBuffer(i,s,o,f,c,l)}}function v(e,t,n,r,i,s,o){for(var u,a,f=0,l=e.length;f<l;f++)if(u=e[f],a=u.object,a.visible){if(o)u=o;else{u=u[t];if(!u)continue;s&&X.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),X.setDepthTest(u.depthTest),X.setDepthWrite(u.depthWrite),L(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}X.renderImmediateObject(n,r,i,u,a)}}function m(t,i){var s,o,u;if(void 0===t.__webglInit&&(t.__webglInit=!0,t._modelViewMatrix=new e.Matrix4,t._normalMatrix=new e.Matrix3,o=t.geometry,void 0!==o&&void 0===o.__webglInit))if(o.__webglInit=!0,o.addEventListener("dispose",Wt),o instanceof e.BufferGeometry)for(u in o.attributes){var a="index"===u?Ct.ELEMENT_ARRAY_BUFFER:Ct.ARRAY_BUFFER,f=o.attributes[u];f.buffer=Ct.createBuffer(),Ct.bindBuffer(a,f.buffer),Ct.bufferData(a,f.array,Ct.STATIC_DRAW)}else if(t instanceof e.Mesh){for(s in u=t.material,void 0===o.geometryGroups&&o.makeGroups(u instanceof e.MeshFaceMaterial,Mt?4294967296:65535),o.geometryGroups)if(u=o.geometryGroups[s],!u.__webglVertexBuffer){a=u,a.__webglVertexBuffer=Ct.createBuffer(),a.__webglNormalBuffer=Ct.createBuffer(),a.__webglTangentBuffer=Ct.createBuffer(),a.__webglColorBuffer=Ct.createBuffer(),a.__webglUVBuffer=Ct.createBuffer(),a.__webglUV2Buffer=Ct.createBuffer(),a.__webglSkinIndicesBuffer=Ct.createBuffer(),a.__webglSkinWeightsBuffer=Ct.createBuffer(),a.__webglFaceBuffer=Ct.createBuffer(),a.__webglLineBuffer=Ct.createBuffer();var l=f=void 0;if(a.numMorphTargets)for(a.__webglMorphTargetsBuffers=[],f=0,l=a.numMorphTargets;f<l;f++)a.__webglMorphTargetsBuffers.push(Ct.createBuffer());if(a.numMorphNormals)for(a.__webglMorphNormalsBuffers=[],f=0,l=a.numMorphNormals;f<l;f++)a.__webglMorphNormalsBuffers.push(Ct.createBuffer());X.info.memory.geometries++,r(u,t),o.verticesNeedUpdate=!0,o.morphTargetsNeedUpdate=!0,o.elementsNeedUpdate=!0,o.uvsNeedUpdate=!0,o.normalsNeedUpdate=!0,o.tangentsNeedUpdate=!0,o.colorsNeedUpdate=!0}}else t instanceof e.Line?o.__webglVertexBuffer||(u=o,u.__webglVertexBuffer=Ct.createBuffer(),u.__webglColorBuffer=Ct.createBuffer(),u.__webglLineDistanceBuffer=Ct.createBuffer(),X.info.memory.geometries++,u=o,a=u.vertices.length,u.__vertexArray=new Float32Array(3*a),u.__colorArray=new Float32Array(3*a),u.__lineDistanceArray=new Float32Array(1*a),u.__webglLineCount=a,n(u,t),o.verticesNeedUpdate=!0,o.colorsNeedUpdate=!0,o.lineDistancesNeedUpdate=!0):t instanceof e.ParticleSystem&&!o.__webglVertexBuffer&&(u=o,u.__webglVertexBuffer=Ct.createBuffer(),u.__webglColorBuffer=Ct.createBuffer(),X.info.memory.geometries++,u=o,a=u.vertices.length,u.__vertexArray=new Float32Array(3*a),u.__colorArray=new Float32Array(3*a),u.__sortArray=[],u.__webglParticleCount=a,n(u,t),o.verticesNeedUpdate=!0,o.colorsNeedUpdate=!0);if(void 0===t.__webglActive){if(t instanceof e.Mesh){if(o=t.geometry,o instanceof e.BufferGeometry)g(i.__webglObjects,o,t);else if(o instanceof e.Geometry)for(s in o.geometryGroups)u=o.geometryGroups[s],g(i.__webglObjects,u,t)}else t instanceof e.Line||t instanceof e.ParticleSystem?(o=t.geometry,g(i.__webglObjects,o,t)):t instanceof e.ImmediateRenderObject||t.immediateRenderCallback?i.__webglObjectsImmediate.push({id:null,object:t,opaque:null,transparent:null,z:0}):t instanceof e.Sprite?i.__webglSprites.push(t):t instanceof e.LensFlare&&i.__webglFlares.push(t);t.__webglActive=!0}}function g(e,t,n){e.push({id:null,buffer:t,object:n,opaque:null,transparent:null,z:0})}function y(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function b(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function w(t,n){t instanceof e.Mesh||t instanceof e.ParticleSystem||t instanceof e.Line?E(n.__webglObjects,t):t instanceof e.Sprite?S(n.__webglSprites,t):t instanceof e.LensFlare?S(n.__webglFlares,t):(t instanceof e.ImmediateRenderObject||t.immediateRenderCallback)&&E(n.__webglObjectsImmediate,t),delete t.__webglActive}function E(e,t){for(var n=e.length-1;0<=n;n--)e[n].object===t&&e.splice(n,1)}function S(e,t){for(var n=e.length-1;0<=n;n--)e[n]===t&&e.splice(n,1)}function x(t,n,r,i,s){Y=0,i.needsUpdate&&(i.program&&Kt(i),X.initMaterial(i,n,r,s),i.needsUpdate=!1),i.morphTargets&&!s.__webglMorphTargetInfluences&&(s.__webglMorphTargetInfluences=new Float32Array(X.maxMorphTargets));var o=!1,u=i.program,a=u.uniforms,f=i.uniforms;u.id!==$&&(Ct.useProgram(u.program),$=u.id,o=!0),i.id!==K&&(K=i.id,o=!0);if(o||t!==G)Ct.uniformMatrix4fv(a.projectionMatrix,!1,t.projectionMatrix.elements),U&&Ct.uniform1f(a.logDepthBufFC,2/(Math.log(t.far+1)/Math.LN2)),t!==G&&(G=t);if(i.skinning)if(jt&&s.skeleton.useVertexTexture){if(null!==a.boneTexture){var l=T();Ct.uniform1i(a.boneTexture,l),X.setTexture(s.skeleton.boneTexture,l)}null!==a.boneTextureWidth&&Ct.uniform1i(a.boneTextureWidth,s.skeleton.boneTextureWidth),null!==a.boneTextureHeight&&Ct.uniform1i(a.boneTextureHeight,s.skeleton.boneTextureHeight)}else null!==a.boneGlobalMatrices&&Ct.uniformMatrix4fv(a.boneGlobalMatrices,!1,s.skeleton.boneMatrices);if(o){r&&i.fog&&(f.fogColor.value=r.color,r instanceof e.Fog?(f.fogNear.value=r.near,f.fogFar.value=r.far):r instanceof e.FogExp2&&(f.fogDensity.value=r.density));if(i instanceof e.MeshPhongMaterial||i instanceof e.MeshLambertMaterial||i.lights){if(Tt){var c,h=l=0,p=0,d,v,m,g=Nt,y=g.directional.colors,b=g.directional.positions,w=g.point.colors,E=g.point.positions,S=g.point.distances,x=g.spot.colors,k=g.spot.positions,L=g.spot.distances,O=g.spot.directions,M=g.spot.anglesCos,P=g.spot.exponents,H=g.hemi.skyColors,B=g.hemi.groundColors,j=g.hemi.positions,F=0,I=0,q=0,R=0,z=0,W=0,V=0,J=0,Q=c=0;r=m=Q=0;for(o=n.length;r<o;r++)if(c=n[r],!c.onlyShadow)if(d=c.color,v=c.intensity,m=c.distance,c instanceof e.AmbientLight)c.visible&&(X.gammaInput?(l+=d.r*d.r,h+=d.g*d.g,p+=d.b*d.b):(l+=d.r,h+=d.g,p+=d.b));else if(c instanceof e.DirectionalLight){if(z+=1,c.visible&&(xt.setFromMatrixPosition(c.matrixWorld),St.setFromMatrixPosition(c.target.matrixWorld),xt.sub(St),xt.normalize(),0!==xt.x||0!==xt.y||0!==xt.z))c=3*F,b[c]=xt.x,b[c+1]=xt.y,b[c+2]=xt.z,X.gammaInput?N(y,c,d,v*v):C(y,c,d,v),F+=1}else c instanceof e.PointLight?(W+=1,c.visible&&(Q=3*I,X.gammaInput?N(w,Q,d,v*v):C(w,Q,d,v),St.setFromMatrixPosition(c.matrixWorld),E[Q]=St.x,E[Q+1]=St.y,E[Q+2]=St.z,S[I]=m,I+=1)):c instanceof e.SpotLight?(V+=1,c.visible&&(Q=3*q,X.gammaInput?N(x,Q,d,v*v):C(x,Q,d,v),St.setFromMatrixPosition(c.matrixWorld),k[Q]=St.x,k[Q+1]=St.y,k[Q+2]=St.z,L[q]=m,xt.copy(St),St.setFromMatrixPosition(c.target.matrixWorld),xt.sub(St),xt.normalize(),O[Q]=xt.x,O[Q+1]=xt.y,O[Q+2]=xt.z,M[q]=Math.cos(c.angle),P[q]=c.exponent,q+=1)):c instanceof e.HemisphereLight&&(J+=1,c.visible&&(xt.setFromMatrixPosition(c.matrixWorld),xt.normalize(),0!==xt.x||0!==xt.y||0!==xt.z))&&(m=3*R,j[m]=xt.x,j[m+1]=xt.y,j[m+2]=xt.z,d=c.color,c=c.groundColor,X.gammaInput?(v*=v,N(H,m,d,v),N(B,m,c,v)):(C(H,m,d,v),C(B,m,c,v)),R+=1);r=3*F;for(o=Math.max(y.length,3*z);r<o;r++)y[r]=0;r=3*I;for(o=Math.max(w.length,3*W);r<o;r++)w[r]=0;r=3*q;for(o=Math.max(x.length,3*V);r<o;r++)x[r]=0;r=3*R;for(o=Math.max(H.length,3*J);r<o;r++)H[r]=0;r=3*R;for(o=Math.max(B.length,3*J);r<o;r++)B[r]=0;g.directional.length=F,g.point.length=I,g.spot.length=q,g.hemi.length=R,g.ambient[0]=l,g.ambient[1]=h,g.ambient[2]=p,Tt=!1}r=Nt,f.ambientLightColor.value=r.ambient,f.directionalLightColor.value=r.directional.colors,f.directionalLightDirection.value=r.directional.positions,f.pointLightColor.value=r.point.colors,f.pointLightPosition.value=r.point.positions,f.pointLightDistance.value=r.point.distances,f.spotLightColor.value=r.spot.colors,f.spotLightPosition.value=r.spot.positions,f.spotLightDistance.value=r.spot.distances,f.spotLightDirection.value=r.spot.directions,f.spotLightAngleCos.value=r.spot.anglesCos,f.spotLightExponent.value=r.spot.exponents,f.hemisphereLightSkyColor.value=r.hemi.skyColors,f.hemisphereLightGroundColor.value=r.hemi.groundColors,f.hemisphereLightDirection.value=r.hemi.positions}if(i instanceof e.MeshBasicMaterial||i instanceof e.MeshLambertMaterial||i instanceof e.MeshPhongMaterial){f.opacity.value=i.opacity,X.gammaInput?f.diffuse.value.copyGammaToLinear(i.color):f.diffuse.value=i.color,f.map.value=i.map,f.lightMap.value=i.lightMap,f.specularMap.value=i.specularMap,i.bumpMap&&(f.bumpMap.value=i.bumpMap,f.bumpScale.value=i.bumpScale),i.normalMap&&(f.normalMap.value=i.normalMap,f.normalScale.value.copy(i.normalScale));var Z;i.map?Z=i.map:i.specularMap?Z=i.specularMap:i.normalMap?Z=i.normalMap:i.bumpMap&&(Z=i.bumpMap),void 0!==Z&&(r=Z.offset,Z=Z.repeat,f.offsetRepeat.value.set(r.x,r.y,Z.x,Z.y)),f.envMap.value=i.envMap,f.flipEnvMap.value=i.envMap instanceof e.WebGLRenderTargetCube?1:-1,f.reflectivity.value=i.reflectivity,f.refractionRatio.value=i.refractionRatio,f.combine.value=i.combine,f.useRefract.value=i.envMap&&i.envMap.mapping instanceof e.CubeRefractionMapping}i instanceof e.LineBasicMaterial?(f.diffuse.value=i.color,f.opacity.value=i.opacity):i instanceof e.LineDashedMaterial?(f.diffuse.value=i.color,f.opacity.value=i.opacity,f.dashSize.value=i.dashSize,f.totalSize.value=i.dashSize+i.gapSize,f.scale.value=i.scale):i instanceof e.ParticleSystemMaterial?(f.psColor.value=i.color,f.opacity.value=i.opacity,f.size.value=i.size,f.scale.value=D.height/2,f.map.value=i.map):i instanceof e.MeshPhongMaterial?(f.shininess.value=i.shininess,X.gammaInput?(f.ambient.value.copyGammaToLinear(i.ambient),f.emissive.value.copyGammaToLinear(i.emissive),f.specular.value.copyGammaToLinear(i.specular)):(f.ambient.value=i.ambient,f.emissive.value=i.emissive,f.specular.value=i.specular),i.wrapAround&&f.wrapRGB.value.copy(i.wrapRGB)):i instanceof e.MeshLambertMaterial?(X.gammaInput?(f.ambient.value.copyGammaToLinear(i.ambient),f.emissive.value.copyGammaToLinear(i.emissive)):(f.ambient.value=i.ambient,f.emissive.value=i.emissive),i.wrapAround&&f.wrapRGB.value.copy(i.wrapRGB)):i instanceof e.MeshDepthMaterial?(f.mNear.value=t.near,f.mFar.value=t.far,f.opacity.value=i.opacity):i instanceof e.MeshNormalMaterial&&(f.opacity.value=i.opacity);if(s.receiveShadow&&!i._shadowPass&&f.shadowMatrix)for(r=Z=0,o=n.length;r<o;r++)l=n[r],l.castShadow&&(l instanceof e.SpotLight||l instanceof e.DirectionalLight&&!l.shadowCascade)&&(f.shadowMap.value[Z]=l.shadowMap,f.shadowMapSize.value[Z]=l.shadowMapSize,f.shadowMatrix.value[Z]=l.shadowMatrix,f.shadowDarkness.value[Z]=l.shadowDarkness,f.shadowBias.value[Z]=l.shadowBias,Z++);n=i.uniformsList,f=0;for(Z=n.length;f<Z;f++)if(o=u.uniforms[n[f][1]])if(r=n[f][0],h=r.type,l=r.value,"i"===h)Ct.uniform1i(o,l);else if("f"===h)Ct.uniform1f(o,l);else if("v2"===h)Ct.uniform2f(o,l.x,l.y);else if("v3"===h)Ct.uniform3f(o,l.x,l.y,l.z);else if("v4"===h)Ct.uniform4f(o,l.x,l.y,l.z,l.w);else if("c"===h)Ct.uniform3f(o,l.r,l.g,l.b);else if("iv1"===h)Ct.uniform1iv(o,l);else if("iv"===h)Ct.uniform3iv(o,l);else if("fv1"===h)Ct.uniform1fv(o,l);else if("fv"===h)Ct.uniform3fv(o,l);else if("v2v"===h){void 0===r._array&&(r._array=new Float32Array(2*l.length)),h=0;for(p=l.length;h<p;h++)g=2*h,r._array[g]=l[h].x,r._array[g+1]=l[h].y;Ct.uniform2fv(o,r._array)}else if("v3v"===h){void 0===r._array&&(r._array=new Float32Array(3*l.length)),h=0;for(p=l.length;h<p;h++)g=3*h,r._array[g]=l[h].x,r._array[g+1]=l[h].y,r._array[g+2]=l[h].z;Ct.uniform3fv(o,r._array)}else if("v4v"===h){void 0===r._array&&(r._array=new Float32Array(4*l.length)),h=0;for(p=l.length;h<p;h++)g=4*h,r._array[g]=l[h].x,r._array[g+1]=l[h].y,r._array[g+2]=l[h].z,r._array[g+3]=l[h].w;Ct.uniform4fv(o,r._array)}else if("m3"===h)Ct.uniformMatrix3fv(o,!1,l.elements);else if("m3v"===h){void 0===r._array&&(r._array=new Float32Array(9*l.length)),h=0;for(p=l.length;h<p;h++)l[h].flattenToArrayOffset(r._array,9*h);Ct.uniformMatrix3fv(o,!1,r._array)}else if("m4"===h)Ct.uniformMatrix4fv(o,!1,l.elements);else if("m4v"===h){void 0===r._array&&(r._array=new Float32Array(16*l.length)),h=0;for(p=l.length;h<p;h++)l[h].flattenToArrayOffset(r._array,16*h);Ct.uniformMatrix4fv(o,!1,r._array)}else if("t"===h){if(g=l,l=T(),Ct.uniform1i(o,l),g)if(g.image instanceof Array&&6===g.image.length){if(r=g,o=l,6===r.image.length)if(r.needsUpdate){r.image.__webglTextureCube||(r.addEventListener("dispose",Xt),r.image.__webglTextureCube=Ct.createTexture(),X.info.memory.textures++),Ct.activeTexture(Ct.TEXTURE0+o),Ct.bindTexture(Ct.TEXTURE_CUBE_MAP,r.image.__webglTextureCube),Ct.pixelStorei(Ct.UNPACK_FLIP_Y_WEBGL,r.flipY),o=r instanceof e.CompressedTexture,l=[];for(h=0;6>h;h++)X.autoScaleCubemaps&&!o?(p=l,g=h,y=r.image[h],w=Pt,y.width<=w&&y.height<=w||(E=Math.max(y.width,y.height),b=Math.floor(y.width*w/E),w=Math.floor(y.height*w/E),E=document.createElement("canvas"),E.width=b,E.height=w,E.getContext("2d").drawImage(y,0,0,y.width,y.height,0,0,b,w),y=E),p[g]=y):l[h]=r.image[h];h=l[0],p=e.Math.isPowerOfTwo(h.width)&&e.Math.isPowerOfTwo(h.height),g=_(r.format),y=_(r.type),A(Ct.TEXTURE_CUBE_MAP,r,p);for(h=0;6>h;h++)if(o)for(w=l[h].mipmaps,E=0,S=w.length;E<S;E++)b=w[E],r.format!==e.RGBAFormat?Ct.compressedTexImage2D(Ct.TEXTURE_CUBE_MAP_POSITIVE_X+h,E,g,b.width,b.height,0,b.data):Ct.texImage2D(Ct.TEXTURE_CUBE_MAP_POSITIVE_X+h,E,g,b.width,b.height,0,g,y,b.data);else Ct.texImage2D(Ct.TEXTURE_CUBE_MAP_POSITIVE_X+h,0,g,g,y,l[h]);r.generateMipmaps&&p&&Ct.generateMipmap(Ct.TEXTURE_CUBE_MAP),r.needsUpdate=!1,r.onUpdate&&r.onUpdate()}else Ct.activeTexture(Ct.TEXTURE0+o),Ct.bindTexture(Ct.TEXTURE_CUBE_MAP,r.image.__webglTextureCube)}else g instanceof e.WebGLRenderTargetCube?(r=g,Ct.activeTexture(Ct.TEXTURE0+l),Ct.bindTexture(Ct.TEXTURE_CUBE_MAP,r.__webglTexture)):X.setTexture(g,l)}else if("tv"===h){void 0===r._array&&(r._array=[]),h=0;for(p=r.value.length;h<p;h++)r._array[h]=T();Ct.uniform1iv(o,r._array),h=0;for(p=r.value.length;h<p;h++)g=r.value[h],l=r._array[h],g&&X.setTexture(g,l)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+h);(i instanceof e.ShaderMaterial||i instanceof e.MeshPhongMaterial||i.envMap)&&null!==a.cameraPosition&&(St.setFromMatrixPosition(t.matrixWorld),Ct.uniform3f(a.cameraPosition,St.x,St.y,St.z)),(i instanceof e.MeshPhongMaterial||i instanceof e.MeshLambertMaterial||i instanceof e.ShaderMaterial||i.skinning)&&null!==a.viewMatrix&&Ct.uniformMatrix4fv(a.viewMatrix,!1,t.matrixWorldInverse.elements)}return Ct.uniformMatrix4fv(a.modelViewMatrix,!1,s._modelViewMatrix.elements),a.normalMatrix&&Ct.uniformMatrix3fv(a.normalMatrix,!1,s._normalMatrix.elements),null!==a.modelMatrix&&Ct.uniformMatrix4fv(a.modelMatrix,!1,s.matrixWorld.elements),u}function T(){var e=Y;return e>=_t&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+_t),Y+=1,e}function N(e,t,n,r){e[t]=n.r*n.r*r,e[t+1]=n.g*n.g*r,e[t+2]=n.b*n.b*r}function C(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function k(e){e!==lt&&(Ct.lineWidth(e),lt=e)}function L(e,t,n){ut!==e&&(e?Ct.enable(Ct.POLYGON_OFFSET_FILL):Ct.disable(Ct.POLYGON_OFFSET_FILL),ut=e),!e||at===t&&ft===n||(Ct.polygonOffset(t,n),at=t,ft=n)}function A(t,n,r){r?(Ct.texParameteri(t,Ct.TEXTURE_WRAP_S,_(n.wrapS)),Ct.texParameteri(t,Ct.TEXTURE_WRAP_T,_(n.wrapT)),Ct.texParameteri(t,Ct.TEXTURE_MAG_FILTER,_(n.magFilter)),Ct.texParameteri(t,Ct.TEXTURE_MIN_FILTER,_(n.minFilter))):(Ct.texParameteri(t,Ct.TEXTURE_WRAP_S,Ct.CLAMP_TO_EDGE),Ct.texParameteri(t,Ct.TEXTURE_WRAP_T,Ct.CLAMP_TO_EDGE),Ct.texParameteri(t,Ct.TEXTURE_MAG_FILTER,M(n.magFilter)),Ct.texParameteri(t,Ct.TEXTURE_MIN_FILTER,M(n.minFilter))),At&&n.type!==e.FloatType&&(1<n.anisotropy||n.__oldAnisotropy)&&(Ct.texParameterf(t,At.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(n.anisotropy,Ht)),n.__oldAnisotropy=n.anisotropy)}function O(e,t){Ct.bindRenderbuffer(Ct.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Ct.renderbufferStorage(Ct.RENDERBUFFER,Ct.DEPTH_COMPONENT16,t.width,t.height),Ct.framebufferRenderbuffer(Ct.FRAMEBUFFER,Ct.DEPTH_ATTACHMENT,Ct.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Ct.renderbufferStorage(Ct.RENDERBUFFER,Ct.DEPTH_STENCIL,t.width,t.height),Ct.framebufferRenderbuffer(Ct.FRAMEBUFFER,Ct.DEPTH_STENCIL_ATTACHMENT,Ct.RENDERBUFFER,e)):Ct.renderbufferStorage(Ct.RENDERBUFFER,Ct.RGBA4,t.width,t.height)}function M(t){return t===e.NearestFilter||t===e.NearestMipMapNearestFilter||t===e.NearestMipMapLinearFilter?Ct.NEAREST:Ct.LINEAR}function _(t){if(t===e.RepeatWrapping)return Ct.REPEAT;if(t===e.ClampToEdgeWrapping)return Ct.CLAMP_TO_EDGE;if(t===e.MirroredRepeatWrapping)return Ct.MIRRORED_REPEAT;if(t===e.NearestFilter)return Ct.NEAREST;if(t===e.NearestMipMapNearestFilter)return Ct.NEAREST_MIPMAP_NEAREST;if(t===e.NearestMipMapLinearFilter)return Ct.NEAREST_MIPMAP_LINEAR;if(t===e.LinearFilter)return Ct.LINEAR;if(t===e.LinearMipMapNearestFilter)return Ct.LINEAR_MIPMAP_NEAREST;if(t===e.LinearMipMapLinearFilter)return Ct.LINEAR_MIPMAP_LINEAR;if(t===e.UnsignedByteType)return Ct.UNSIGNED_BYTE;if(t===e.UnsignedShort4444Type)return Ct.UNSIGNED_SHORT_4_4_4_4;if(t===e.UnsignedShort5551Type)return Ct.UNSIGNED_SHORT_5_5_5_1;if(t===e.UnsignedShort565Type)return Ct.UNSIGNED_SHORT_5_6_5;if(t===e.ByteType)return Ct.BYTE;if(t===e.ShortType)return Ct.SHORT;if(t===e.UnsignedShortType)return Ct.UNSIGNED_SHORT;if(t===e.IntType)return Ct.INT;if(t===e.UnsignedIntType)return Ct.UNSIGNED_INT;if(t===e.FloatType)return Ct.FLOAT;if(t===e.AlphaFormat)return Ct.ALPHA;if(t===e.RGBFormat)return Ct.RGB;if(t===e.RGBAFormat)return Ct.RGBA;if(t===e.LuminanceFormat)return Ct.LUMINANCE;if(t===e.LuminanceAlphaFormat)return Ct.LUMINANCE_ALPHA;if(t===e.AddEquation)return Ct.FUNC_ADD;if(t===e.SubtractEquation)return Ct.FUNC_SUBTRACT;if(t===e.ReverseSubtractEquation)return Ct.FUNC_REVERSE_SUBTRACT;if(t===e.ZeroFactor)return Ct.ZERO;if(t===e.OneFactor)return Ct.ONE;if(t===e.SrcColorFactor)return Ct.SRC_COLOR;if(t===e.OneMinusSrcColorFactor)return Ct.ONE_MINUS_SRC_COLOR;if(t===e.SrcAlphaFactor)return Ct.SRC_ALPHA;if(t===e.OneMinusSrcAlphaFactor)return Ct.ONE_MINUS_SRC_ALPHA;if(t===e.DstAlphaFactor)return Ct.DST_ALPHA;if(t===e.OneMinusDstAlphaFactor)return Ct.ONE_MINUS_DST_ALPHA;if(t===e.DstColorFactor)return Ct.DST_COLOR;if(t===e.OneMinusDstColorFactor)return Ct.ONE_MINUS_DST_COLOR;if(t===e.SrcAlphaSaturateFactor)return Ct.SRC_ALPHA_SATURATE;if(void 0!==Ot){if(t===e.RGB_S3TC_DXT1_Format)return Ot.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT1_Format)return Ot.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===e.RGBA_S3TC_DXT3_Format)return Ot.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===e.RGBA_S3TC_DXT5_Format)return Ot.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",e.REVISION),t=t||{};var D=void 0!==t.canvas?t.canvas:document.createElement("canvas"),P=void 0!==t.context?t.context:null,H=void 0!==t.precision?t.precision:"highp",B=void 0!==t.alpha?t.alpha:!1,j=void 0!==t.depth?t.depth:!0,F=void 0!==t.stencil?t.stencil:!0,I=void 0!==t.antialias?t.antialias:!1,q=void 0!==t.premultipliedAlpha?t.premultipliedAlpha:!0,R=void 0!==t.preserveDrawingBuffer?t.preserveDrawingBuffer:!1,U=void 0!==t.logarithmicDepthBuffer?t.logarithmicDepthBuffer:!1,z=new e.Color(0),W=0;this.domElement=D,this.context=null,this.devicePixelRatio=void 0!==t.devicePixelRatio?t.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=e.PCFShadowMap,this.shadowMapCullFace=e.CullFaceFront,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var X=this,V=[],$=null,J=null,K=-1,Q=null,G=null,Y=0,Z=-1,et=-1,tt=-1,nt=-1,rt=-1,it=-1,st=-1,ot=-1,ut=null,at=null,ft=null,lt=null,ct=0,ht=0,pt=D.width,dt=D.height,vt=0,mt=0,gt=new Uint8Array(16),yt=new Uint8Array(16),bt=new e.Frustum,wt=new e.Matrix4,Et=new e.Matrix4,St=new e.Vector3,xt=new e.Vector3,Tt=!0,Nt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},Ct,kt,Lt,At,Ot,Mt;(function(){try{var e={alpha:B,depth:j,stencil:F,antialias:I,premultipliedAlpha:q,preserveDrawingBuffer:R};Ct=P||D.getContext("webgl",e)||D.getContext("experimental-webgl",e);if(null===Ct)throw"Error creating WebGL context."}catch(t){console.error(t)}kt=Ct.getExtension("OES_texture_float"),Ct.getExtension("OES_texture_float_linear"),Lt=Ct.getExtension("OES_standard_derivatives"),At=Ct.getExtension("EXT_texture_filter_anisotropic")||Ct.getExtension("MOZ_EXT_texture_filter_anisotropic")||Ct.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),Ot=Ct.getExtension("WEBGL_compressed_texture_s3tc")||Ct.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Ct.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Mt=Ct.getExtension("OES_element_index_uint"),null===kt&&console.log("THREE.WebGLRenderer: Float textures not supported."),null===Lt&&console.log("THREE.WebGLRenderer: Standard derivatives not supported."),null===At&&console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),null===Ot&&console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),null===Mt&&console.log("THREE.WebGLRenderer: elementindex as unsigned integer not supported."),void 0===Ct.getShaderPrecisionFormat&&(Ct.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),U&&Ct.getExtension("EXT_frag_depth")})(),Ct.clearColor(0,0,0,1),Ct.clearDepth(1),Ct.clearStencil(0),Ct.enable(Ct.DEPTH_TEST),Ct.depthFunc(Ct.LEQUAL),Ct.frontFace(Ct.CCW),Ct.cullFace(Ct.BACK),Ct.enable(Ct.CULL_FACE),Ct.enable(Ct.BLEND),Ct.blendEquation(Ct.FUNC_ADD),Ct.blendFunc(Ct.SRC_ALPHA,Ct.ONE_MINUS_SRC_ALPHA),Ct.viewport(ct,ht,pt,dt),Ct.clearColor(z.r,z.g,z.b,W),this.context=Ct;var _t=Ct.getParameter(Ct.MAX_TEXTURE_IMAGE_UNITS),Dt=Ct.getParameter(Ct.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Ct.getParameter(Ct.MAX_TEXTURE_SIZE);var Pt=Ct.getParameter(Ct.MAX_CUBE_MAP_TEXTURE_SIZE),Ht=At?Ct.getParameter(At.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Bt=0<Dt,jt=Bt&&kt;Ot&&Ct.getParameter(Ct.COMPRESSED_TEXTURE_FORMATS);var Ft=Ct.getShaderPrecisionFormat(Ct.VERTEX_SHADER,Ct.HIGH_FLOAT),It=Ct.getShaderPrecisionFormat(Ct.VERTEX_SHADER,Ct.MEDIUM_FLOAT);Ct.getShaderPrecisionFormat(Ct.VERTEX_SHADER,Ct.LOW_FLOAT);var qt=Ct.getShaderPrecisionFormat(Ct.FRAGMENT_SHADER,Ct.HIGH_FLOAT),Rt=Ct.getShaderPrecisionFormat(Ct.FRAGMENT_SHADER,Ct.MEDIUM_FLOAT);Ct.getShaderPrecisionFormat(Ct.FRAGMENT_SHADER,Ct.LOW_FLOAT);var Ut=0<Ft.precision&&0<qt.precision,zt=0<It.precision&&0<Rt.precision;"highp"!==H||Ut||(zt?(H="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(H="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==H||zt||(H="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Ct},this.supportsVertexTextures=function(){return Bt},this.supportsFloatTextures=function(){return kt},this.supportsStandardDerivatives=function(){return Lt},this.supportsCompressedTextureS3TC=function(){return Ot},this.getMaxAnisotropy=function(){return Ht},this.getPrecision=function(){return H},this.setSize=function(e,t,n){D.width=e*this.devicePixelRatio,D.height=t*this.devicePixelRatio,!1!==n&&(D.style.width=e+"px",D.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,n,r){ct=e*this.devicePixelRatio,ht=t*this.devicePixelRatio,pt=n*this.devicePixelRatio,dt=r*this.devicePixelRatio,Ct.viewport(ct,ht,pt,dt)},this.setScissor=function(e,t,n,r){Ct.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,n*this.devicePixelRatio,r*this.devicePixelRatio)},this.enableScissorTest=function(e){e?Ct.enable(Ct.SCISSOR_TEST):Ct.disable(Ct.SCISSOR_TEST)},this.setClearColor=function(e,t){z.set(e),W=void 0!==t?t:1,Ct.clearColor(z.r,z.g,z.b,W)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return z},this.getClearAlpha=function(){return W},this.clear=function(e,t,n){var r=0;if(void 0===e||e)r|=Ct.COLOR_BUFFER_BIT;if(void 0===t||t)r|=Ct.DEPTH_BUFFER_BIT;if(void 0===n||n)r|=Ct.STENCIL_BUFFER_BIT;Ct.clear(r)},this.clearColor=function(){Ct.clear(Ct.COLOR_BUFFER_BIT)},this.clearDepth=function(){Ct.clear(Ct.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Ct.clear(Ct.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){$=null,K=Q=ot=st=tt=-1,Tt=!0,et=Z=-1,this.shadowMapPlugin.update(e,t)};var Wt=function(t){t=t.target,t.removeEventListener("dispose",Wt),t.__webglInit=void 0;if(t instanceof e.BufferGeometry){var n=t.attributes,r;for(r in n)void 0!==n[r].buffer&&Ct.deleteBuffer(n[r].buffer);X.info.memory.geometries--}else if(void 0!==t.geometryGroups)for(n in t.geometryGroups){r=t.geometryGroups[n];if(void 0!==r.numMorphTargets)for(var i=0,s=r.numMorphTargets;i<s;i++)Ct.deleteBuffer(r.__webglMorphTargetsBuffers[i]);if(void 0!==r.numMorphNormals)for(i=0,s=r.numMorphNormals;i<s;i++)Ct.deleteBuffer(r.__webglMorphNormalsBuffers[i]);Jt(r)}else Jt(t)},Xt=function(e){e=e.target,e.removeEventListener("dispose",Xt),e.image&&e.image.__webglTextureCube?Ct.deleteTexture(e.image.__webglTextureCube):e.__webglInit&&(e.__webglInit=!1,Ct.deleteTexture(e.__webglTexture)),X.info.memory.textures--},Vt=function(t){t=t.target,t.removeEventListener("dispose",Vt);if(t&&t.__webglTexture)if(Ct.deleteTexture(t.__webglTexture),t instanceof e.WebGLRenderTargetCube)for(var n=0;6>n;n++)Ct.deleteFramebuffer(t.__webglFramebuffer[n]),Ct.deleteRenderbuffer(t.__webglRenderbuffer[n]);else Ct.deleteFramebuffer(t.__webglFramebuffer),Ct.deleteRenderbuffer(t.__webglRenderbuffer);X.info.memory.textures--},$t=function(e){e=e.target,e.removeEventListener("dispose",$t),Kt(e)},Jt=function(e){void 0!==e.__webglVertexBuffer&&Ct.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Ct.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Ct.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Ct.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Ct.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Ct.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Ct.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Ct.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Ct.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Ct.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Ct.deleteBuffer(e.__webglLineDistanceBuffer);if(void 0!==e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Ct.deleteBuffer(e.__webglCustomAttributesList[t].buffer);X.info.memory.geometries--},Kt=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var n,r,i=!1;e=0;for(n=V.length;e<n;e++)if(r=V[e],r.program===t){r.usedTimes--,0===r.usedTimes&&(i=!0);break}if(!0===i){i=[],e=0;for(n=V.length;e<n;e++)r=V[e],r.program!==t&&i.push(r);V=i,Ct.deleteProgram(t),X.info.memory.programs--}}};this.renderBufferImmediate=function(t,n,r){a(),t.hasPositions&&!t.__webglVertexBuffer&&(t.__webglVertexBuffer=Ct.createBuffer()),t.hasNormals&&!t.__webglNormalBuffer&&(t.__webglNormalBuffer=Ct.createBuffer()),t.hasUvs&&!t.__webglUvBuffer&&(t.__webglUvBuffer=Ct.createBuffer()),t.hasColors&&!t.__webglColorBuffer&&(t.__webglColorBuffer=Ct.createBuffer()),t.hasPositions&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,t.__webglVertexBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,t.positionArray,Ct.DYNAMIC_DRAW),f(n.attributes.position),Ct.vertexAttribPointer(n.attributes.position,3,Ct.FLOAT,!1,0,0));if(t.hasNormals){Ct.bindBuffer(Ct.ARRAY_BUFFER,t.__webglNormalBuffer);if(r.shading===e.FlatShading){var i,s,o,u,c,h,p,d,v,m,g,y=3*t.count;for(g=0;g<y;g+=9)m=t.normalArray,i=m[g],s=m[g+1],o=m[g+2],u=m[g+3],h=m[g+4],d=m[g+5],c=m[g+6],p=m[g+7],v=m[g+8],i=(i+u+c)/3,s=(s+h+p)/3,o=(o+d+v)/3,m[g]=i,m[g+1]=s,m[g+2]=o,m[g+3]=i,m[g+4]=s,m[g+5]=o,m[g+6]=i,m[g+7]=s,m[g+8]=o}Ct.bufferData(Ct.ARRAY_BUFFER,t.normalArray,Ct.DYNAMIC_DRAW),f(n.attributes.normal),Ct.vertexAttribPointer(n.attributes.normal,3,Ct.FLOAT,!1,0,0)}t.hasUvs&&r.map&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,t.__webglUvBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,t.uvArray,Ct.DYNAMIC_DRAW),f(n.attributes.uv),Ct.vertexAttribPointer(n.attributes.uv,2,Ct.FLOAT,!1,0,0)),t.hasColors&&r.vertexColors!==e.NoColors&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,t.__webglColorBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,t.colorArray,Ct.DYNAMIC_DRAW),f(n.attributes.color),Ct.vertexAttribPointer(n.attributes.color,3,Ct.FLOAT,!1,0,0)),l(),Ct.drawArrays(Ct.TRIANGLES,0,t.count),t.count=0},this.renderBufferDirect=function(t,n,r,i,s,o){if(!1!==i.visible){var f=x(t,n,r,i,o);t=f.attributes,n=s.attributes,r=!1,f=16777215*s.id+2*f.id+(i.wireframe?1:0),f!==Q&&(Q=f,r=!0),r&&a();if(o instanceof e.Mesh)if(o=n.index){var l;o.array instanceof Uint32Array?(f=Ct.UNSIGNED_INT,l=4):(f=Ct.UNSIGNED_SHORT,l=2),s=s.offsets;if(0===s.length)r&&(u(i,t,n,0),Ct.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,o.buffer)),Ct.drawElements(Ct.TRIANGLES,o.array.length,f,0),X.info.render.calls++,X.info.render.vertices+=o.array.length,X.info.render.faces+=o.array.length/3;else{r=!0;for(var c=0,h=s.length;c<h;c++){var p=s[c].index;r&&(u(i,t,n,p),Ct.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,o.buffer)),Ct.drawElements(Ct.TRIANGLES,s[c].count,f,s[c].start*l),X.info.render.calls++,X.info.render.vertices+=s[c].count,X.info.render.faces+=s[c].count/3}}}else r&&u(i,t,n,0),i=s.attributes.position,Ct.drawArrays(Ct.TRIANGLES,0,i.array.length/3),X.info.render.calls++,X.info.render.vertices+=i.array.length/3,X.info.render.faces+=i.array.length/9;else if(o instanceof e.ParticleSystem)r&&u(i,t,n,0),i=n.position,Ct.drawArrays(Ct.POINTS,0,i.array.length/3),X.info.render.calls++,X.info.render.points+=i.array.length/3;else if(o instanceof e.Line)if(f=o.type===e.LineStrip?Ct.LINE_STRIP:Ct.LINES,k(i.linewidth),o=n.index)if(o.array instanceof Uint32Array?(f=Ct.UNSIGNED_INT,l=4):(f=Ct.UNSIGNED_SHORT,l=2),s=s.offsets,0===s.length)r&&(u(i,t,n,0),Ct.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,o.buffer)),Ct.drawElements(Ct.LINES,o.array.length,f,0),X.info.render.calls++,X.info.render.vertices+=o.array.length;else for(1<s.length&&(r=!0),c=0,h=s.length;c<h;c++)p=s[c].index,r&&(u(i,t,n,p),Ct.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,o.buffer)),Ct.drawElements(Ct.LINES,s[c].count,f,s[c].start*l),X.info.render.calls++,X.info.render.vertices+=s[c].count;else r&&u(i,t,n,0),i=n.position,Ct.drawArrays(f,0,i.array.length/3),X.info.render.calls++,X.info.render.points+=i.array.length/3}},this.renderBuffer=function(t,n,r,i,s,o){if(!1!==i.visible){var u,c;r=x(t,n,r,i,o),n=r.attributes,t=!1,r=16777215*s.id+2*r.id+(i.wireframe?1:0),r!==Q&&(Q=r,t=!0),t&&a();if(!i.morphTargets&&0<=n.position)t&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglVertexBuffer),f(n.position),Ct.vertexAttribPointer(n.position,3,Ct.FLOAT,!1,0,0));else if(o.morphTargetBase){r=i.program.attributes,-1!==o.morphTargetBase&&0<=r.position?(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglMorphTargetsBuffers[o.morphTargetBase]),f(r.position),Ct.vertexAttribPointer(r.position,3,Ct.FLOAT,!1,0,0)):0<=r.position&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglVertexBuffer),f(r.position),Ct.vertexAttribPointer(r.position,3,Ct.FLOAT,!1,0,0));if(o.morphTargetForcedOrder.length){var p=0;c=o.morphTargetForcedOrder;for(u=o.morphTargetInfluences;p<i.numSupportedMorphTargets&&p<c.length;)0<=r["morphTarget"+p]&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglMorphTargetsBuffers[c[p]]),f(r["morphTarget"+p]),Ct.vertexAttribPointer(r["morphTarget"+p],3,Ct.FLOAT,!1,0,0)),0<=r["morphNormal"+p]&&i.morphNormals&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglMorphNormalsBuffers[c[p]]),f(r["morphNormal"+p]),Ct.vertexAttribPointer(r["morphNormal"+p],3,Ct.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[p]=u[c[p]],p++}else{c=[],u=o.morphTargetInfluences;var d,v=u.length;for(d=0;d<v;d++)p=u[d],0<p&&c.push([p,d]);c.length>i.numSupportedMorphTargets?(c.sort(h),c.length=i.numSupportedMorphTargets):c.length>i.numSupportedMorphNormals?c.sort(h):0===c.length&&c.push([0,0]);for(p=0;p<i.numSupportedMorphTargets;)c[p]?(d=c[p][1],0<=r["morphTarget"+p]&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglMorphTargetsBuffers[d]),f(r["morphTarget"+p]),Ct.vertexAttribPointer(r["morphTarget"+p],3,Ct.FLOAT,!1,0,0)),0<=r["morphNormal"+p]&&i.morphNormals&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglMorphNormalsBuffers[d]),f(r["morphNormal"+p]),Ct.vertexAttribPointer(r["morphNormal"+p],3,Ct.FLOAT,!1,0,0)),o.__webglMorphTargetInfluences[p]=u[d]):o.__webglMorphTargetInfluences[p]=0,p++}null!==i.program.uniforms.morphTargetInfluences&&Ct.uniform1fv(i.program.uniforms.morphTargetInfluences,o.__webglMorphTargetInfluences)}if(t){if(s.__webglCustomAttributesList)for(u=0,c=s.__webglCustomAttributesList.length;u<c;u++)r=s.__webglCustomAttributesList[u],0<=n[r.buffer.belongsToAttribute]&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,r.buffer),f(n[r.buffer.belongsToAttribute]),Ct.vertexAttribPointer(n[r.buffer.belongsToAttribute],r.size,Ct.FLOAT,!1,0,0));0<=n.color&&(0<o.geometry.colors.length||0<o.geometry.faces.length?(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglColorBuffer),f(n.color),Ct.vertexAttribPointer(n.color,3,Ct.FLOAT,!1,0,0)):i.defaultAttributeValues&&Ct.vertexAttrib3fv(n.color,i.defaultAttributeValues.color)),0<=n.normal&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglNormalBuffer),f(n.normal),Ct.vertexAttribPointer(n.normal,3,Ct.FLOAT,!1,0,0)),0<=n.tangent&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglTangentBuffer),f(n.tangent),Ct.vertexAttribPointer(n.tangent,4,Ct.FLOAT,!1,0,0)),0<=n.uv&&(o.geometry.faceVertexUvs[0]?(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglUVBuffer),f(n.uv),Ct.vertexAttribPointer(n.uv,2,Ct.FLOAT,!1,0,0)):i.defaultAttributeValues&&Ct.vertexAttrib2fv(n.uv,i.defaultAttributeValues.uv)),0<=n.uv2&&(o.geometry.faceVertexUvs[1]?(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglUV2Buffer),f(n.uv2),Ct.vertexAttribPointer(n.uv2,2,Ct.FLOAT,!1,0,0)):i.defaultAttributeValues&&Ct.vertexAttrib2fv(n.uv2,i.defaultAttributeValues.uv2)),i.skinning&&0<=n.skinIndex&&0<=n.skinWeight&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglSkinIndicesBuffer),f(n.skinIndex),Ct.vertexAttribPointer(n.skinIndex,4,Ct.FLOAT,!1,0,0),Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglSkinWeightsBuffer),f(n.skinWeight),Ct.vertexAttribPointer(n.skinWeight,4,Ct.FLOAT,!1,0,0)),0<=n.lineDistance&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,s.__webglLineDistanceBuffer),f(n.lineDistance),Ct.vertexAttribPointer(n.lineDistance,1,Ct.FLOAT,!1,0,0))}l(),o instanceof e.Mesh?(o=s.__typeArray===Uint32Array?Ct.UNSIGNED_INT:Ct.UNSIGNED_SHORT,i.wireframe?(k(i.wireframeLinewidth),t&&Ct.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,s.__webglLineBuffer),Ct.drawElements(Ct.LINES,s.__webglLineCount,o,0)):(t&&Ct.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,s.__webglFaceBuffer),Ct.drawElements(Ct.TRIANGLES,s.__webglFaceCount,o,0)),X.info.render.calls++,X.info.render.vertices+=s.__webglFaceCount,X.info.render.faces+=s.__webglFaceCount/3):o instanceof e.Line?(o=o.type===e.LineStrip?Ct.LINE_STRIP:Ct.LINES,k(i.linewidth),Ct.drawArrays(o,0,s.__webglLineCount),X.info.render.calls++):o instanceof e.ParticleSystem&&(Ct.drawArrays(Ct.POINTS,0,s.__webglParticleCount),X.info.render.calls++,X.info.render.points+=s.__webglParticleCount)}},this.render=function(t,n,r,i){if(0==n instanceof e.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var s,o,u,a,f=t.__lights,l=t.fog;K=-1,Tt=!0,!0===t.autoUpdate&&t.updateMatrixWorld(),void 0===n.parent&&n.updateMatrixWorld(),n.matrixWorldInverse.getInverse(n.matrixWorld),wt.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),bt.setFromMatrix(wt),this.autoUpdateObjects&&this.initWebGLObjects(t),p(this.renderPluginsPre,t,n),X.info.render.calls=0,X.info.render.vertices=0,X.info.render.faces=0,X.info.render.points=0,this.setRenderTarget(r),(this.autoClear||i)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),a=t.__webglObjects,i=0;for(s=a.length;i<s;i++)if(o=a[i],u=o.object,o.id=i,o.render=!1,u.visible&&(!(u instanceof e.Mesh||u instanceof e.ParticleSystem)||!u.frustumCulled||bt.intersectsObject(u))){var h=u;h._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,h.matrixWorld),h._normalMatrix.getNormalMatrix(h._modelViewMatrix);var h=o,m=h.object,g=h.buffer,y=m.geometry,m=m.material;m instanceof e.MeshFaceMaterial?(m=m.materials[y instanceof e.BufferGeometry?0:g.materialIndex],m.transparent?(h.transparent=m,h.opaque=null):(h.opaque=m,h.transparent=null)):m&&(m.transparent?(h.transparent=m,h.opaque=null):(h.opaque=m,h.transparent=null)),o.render=!0,!0===this.sortObjects&&(null!==u.renderDepth?o.z=u.renderDepth:(St.setFromMatrixPosition(u.matrixWorld),St.applyProjection(wt),o.z=St.z))}this.sortObjects&&a.sort(c),a=t.__webglObjectsImmediate,i=0;for(s=a.length;i<s;i++)o=a[i],u=o.object,u.visible&&(u._modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,u.matrixWorld),u._normalMatrix.getNormalMatrix(u._modelViewMatrix),u=o.object.material,u.transparent?(o.transparent=u,o.opaque=null):(o.opaque=u,o.transparent=null));t.overrideMaterial?(i=t.overrideMaterial,this.setBlending(i.blending,i.blendEquation,i.blendSrc,i.blendDst),this.setDepthTest(i.depthTest),this.setDepthWrite(i.depthWrite),L(i.polygonOffset,i.polygonOffsetFactor,i.polygonOffsetUnits),d(t.__webglObjects,!1,"",n,f,l,!0,i),v(t.__webglObjectsImmediate,"",n,f,l,!1,i)):(i=null,this.setBlending(e.NoBlending),d(t.__webglObjects,!0,"opaque",n,f,l,!1,i),v(t.__webglObjectsImmediate,"opaque",n,f,l,!1,i),d(t.__webglObjects,!1,"transparent",n,f,l,!0,i),v(t.__webglObjectsImmediate,"transparent",n,f,l,!0,i)),p(this.renderPluginsPost,t,n),r&&r.generateMipmaps&&r.minFilter!==e.NearestFilter&&r.minFilter!==e.LinearFilter&&(r instanceof e.WebGLRenderTargetCube?(Ct.bindTexture(Ct.TEXTURE_CUBE_MAP,r.__webglTexture),Ct.generateMipmap(Ct.TEXTURE_CUBE_MAP),Ct.bindTexture(Ct.TEXTURE_CUBE_MAP,null)):(Ct.bindTexture(Ct.TEXTURE_2D,r.__webglTexture),Ct.generateMipmap(Ct.TEXTURE_2D),Ct.bindTexture(Ct.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,n,r,i){var s=x(e,t,n,r,i);Q=-1,X.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(s,Ct,bt):i.render(function(e){X.renderBufferImmediate(e,s,r)})},this.initWebGLObjects=function(t){t.__webglObjects||(t.__webglObjects=[],t.__webglObjectsImmediate=[],t.__webglSprites=[],t.__webglFlares=[]);for(;t.__objectsAdded.length;)m(t.__objectsAdded[0],t),t.__objectsAdded.splice(0,1);for(;t.__objectsRemoved.length;)w(t.__objectsRemoved[0],t),t.__objectsRemoved.splice(0,1);for(var n=0,u=t.__webglObjects.length;n<u;n++){var a=t.__webglObjects[n].object;void 0===a.__webglInit&&(void 0!==a.__webglActive&&w(a,t),m(a,t));var f=a,l=f.geometry,c=void 0,p=void 0,d=void 0;if(l instanceof e.BufferGeometry){var v=Ct.DYNAMIC_DRAW,g=l.attributes,E=void 0,S=void 0;for(E in g)S=g[E],S.needsUpdate&&("index"===E?(Ct.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,S.buffer),Ct.bufferData(Ct.ELEMENT_ARRAY_BUFFER,S.array,v)):(Ct.bindBuffer(Ct.ARRAY_BUFFER,S.buffer),Ct.bufferData(Ct.ARRAY_BUFFER,S.array,v)),S.needsUpdate=!1)}else if(f instanceof e.Mesh){for(var x=0,T=l.geometryGroupsList.length;x<T;x++)if(c=l.geometryGroupsList[x],d=i(f,c),l.buffersNeedUpdate&&r(c,f),p=d.attributes&&y(d),l.verticesNeedUpdate||l.morphTargetsNeedUpdate||l.elementsNeedUpdate||l.uvsNeedUpdate||l.normalsNeedUpdate||l.colorsNeedUpdate||l.tangentsNeedUpdate||p){var N=c,C=f,k=Ct.DYNAMIC_DRAW,L=!l.dynamic,A=d;if(N.__inittedArrays){var O=s(A),M=A.vertexColors?A.vertexColors:!1,_=o(A),D=O===e.SmoothShading,P=void 0,H=void 0,B=void 0,j=void 0,F=void 0,I=void 0,q=void 0,R=void 0,U=void 0,z=void 0,W=void 0,X=void 0,V=void 0,$=void 0,J=void 0,K=void 0,Q=void 0,G=void 0,Y=void 0,Z=void 0,et=void 0,tt=void 0,nt=void 0,rt=void 0,it=void 0,st=void 0,ot=void 0,ut=void 0,at=void 0,ft=void 0,lt=void 0,ct=void 0,ht=void 0,pt=void 0,dt=void 0,vt=void 0,mt=void 0,gt=void 0,yt=void 0,bt=void 0,xt=0,Tt=0,Nt=0,kt=0,Lt=0,At=0,Ot=0,Mt=0,_t=0,Dt=0,Pt=0,Ht=0,Bt=void 0,jt=N.__vertexArray,Ft=N.__uvArray,It=N.__uv2Array,qt=N.__normalArray,Rt=N.__tangentArray,Ut=N.__colorArray,zt=N.__skinIndexArray,Wt=N.__skinWeightArray,Xt=N.__morphTargetsArrays,Vt=N.__morphNormalsArrays,$t=N.__webglCustomAttributesList,Jt=void 0,Kt=N.__faceArray,Qt=N.__lineArray,Gt=C.geometry,Yt=Gt.elementsNeedUpdate,Zt=Gt.uvsNeedUpdate,en=Gt.normalsNeedUpdate,tn=Gt.tangentsNeedUpdate,nn=Gt.colorsNeedUpdate,rn=Gt.morphTargetsNeedUpdate,sn=Gt.vertices,on=N.faces3,un=Gt.faces,an=Gt.faceVertexUvs[0],fn=Gt.faceVertexUvs[1],ln=Gt.skinIndices,cn=Gt.skinWeights,hn=Gt.morphTargets,pn=Gt.morphNormals;if(Gt.verticesNeedUpdate){P=0;for(H=on.length;P<H;P++)j=un[on[P]],X=sn[j.a],V=sn[j.b],$=sn[j.c],jt[Tt]=X.x,jt[Tt+1]=X.y,jt[Tt+2]=X.z,jt[Tt+3]=V.x,jt[Tt+4]=V.y,jt[Tt+5]=V.z,jt[Tt+6]=$.x,jt[Tt+7]=$.y,jt[Tt+8]=$.z,Tt+=9;Ct.bindBuffer(Ct.ARRAY_BUFFER,N.__webglVertexBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,jt,k)}if(rn)for(dt=0,vt=hn.length;dt<vt;dt++){P=Pt=0;for(H=on.length;P<H;P++)yt=on[P],j=un[yt],X=hn[dt].vertices[j.a],V=hn[dt].vertices[j.b],$=hn[dt].vertices[j.c],mt=Xt[dt],mt[Pt]=X.x,mt[Pt+1]=X.y,mt[Pt+2]=X.z,mt[Pt+3]=V.x,mt[Pt+4]=V.y,mt[Pt+5]=V.z,mt[Pt+6]=$.x,mt[Pt+7]=$.y,mt[Pt+8]=$.z,A.morphNormals&&(D?(bt=pn[dt].vertexNormals[yt],G=bt.a,Y=bt.b,Z=bt.c):Z=Y=G=pn[dt].faceNormals[yt],gt=Vt[dt],gt[Pt]=G.x,gt[Pt+1]=G.y,gt[Pt+2]=G.z,gt[Pt+3]=Y.x,gt[Pt+4]=Y.y,gt[Pt+5]=Y.z,gt[Pt+6]=Z.x,gt[Pt+7]=Z.y,gt[Pt+8]=Z.z),Pt+=9;Ct.bindBuffer(Ct.ARRAY_BUFFER,N.__webglMorphTargetsBuffers[dt]),Ct.bufferData(Ct.ARRAY_BUFFER,Xt[dt],k),A.morphNormals&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,N.__webglMorphNormalsBuffers[dt]),Ct.bufferData(Ct.ARRAY_BUFFER,Vt[dt],k))}if(cn.length){P=0;for(H=on.length;P<H;P++)j=un[on[P]],rt=cn[j.a],it=cn[j.b],st=cn[j.c],Wt[Dt]=rt.x,Wt[Dt+1]=rt.y,Wt[Dt+2]=rt.z,Wt[Dt+3]=rt.w,Wt[Dt+4]=it.x,Wt[Dt+5]=it.y,Wt[Dt+6]=it.z,Wt[Dt+7]=it.w,Wt[Dt+8]=st.x,Wt[Dt+9]=st.y,Wt[Dt+10]=st.z,Wt[Dt+11]=st.w,ot=ln[j.a],ut=ln[j.b],at=ln[j.c],zt[Dt]=ot.x,zt[Dt+1]=ot.y,zt[Dt+2]=ot.z,zt[Dt+3]=ot.w,zt[Dt+4]=ut.x,zt[Dt+5]=ut.y,zt[Dt+6]=ut.z,zt[Dt+7]=ut.w,zt[Dt+8]=at.x,zt[Dt+9]=at.y,zt[Dt+10]=at.z,zt[Dt+11]=at.w,Dt+=12;0<Dt&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,N.__webglSkinIndicesBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,zt,k),Ct.bindBuffer(Ct.ARRAY_BUFFER,N.__webglSkinWeightsBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,Wt,k))}if(nn&&M){P=0;for(H=on.length;P<H;P++)j=un[on[P]],q=j.vertexColors,R=j.color,3===q.length&&M===e.VertexColors?(et=q[0],tt=q[1],nt=q[2]):nt=tt=et=R,Ut[_t]=et.r,Ut[_t+1]=et.g,Ut[_t+2]=et.b,Ut[_t+3]=tt.r,Ut[_t+4]=tt.g,Ut[_t+5]=tt.b,Ut[_t+6]=nt.r,Ut[_t+7]=nt.g,Ut[_t+8]=nt.b,_t+=9;0<_t&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,N.__webglColorBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,Ut,k))}if(tn&&Gt.hasTangents){P=0;for(H=on.length;P<H;P++)j=un[on[P]],U=j.vertexTangents,J=U[0],K=U[1],Q=U[2],Rt[Ot]=J.x,Rt[Ot+1]=J.y,Rt[Ot+2]=J.z,Rt[Ot+3]=J.w,Rt[Ot+4]=K.x,Rt[Ot+5]=K.y,Rt[Ot+6]=K.z,Rt[Ot+7]=K.w,Rt[Ot+8]=Q.x,Rt[Ot+9]=Q.y,Rt[Ot+10]=Q.z,Rt[Ot+11]=Q.w,Ot+=12;Ct.bindBuffer(Ct.ARRAY_BUFFER,N.__webglTangentBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,Rt,k)}if(en&&O){P=0;for(H=on.length;P<H;P++)if(j=un[on[P]],F=j.vertexNormals,I=j.normal,3===F.length&&D)for(ft=0;3>ft;ft++)ct=F[ft],qt[At]=ct.x,qt[At+1]=ct.y,qt[At+2]=ct.z,At+=3;else for(ft=0;3>ft;ft++)qt[At]=I.x,qt[At+1]=I.y,qt[At+2]=I.z,At+=3;Ct.bindBuffer(Ct.ARRAY_BUFFER,N.__webglNormalBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,qt,k)}if(Zt&&an&&_){P=0;for(H=on.length;P<H;P++)if(B=on[P],z=an[B],void 0!==z)for(ft=0;3>ft;ft++)ht=z[ft],Ft[Nt]=ht.x,Ft[Nt+1]=ht.y,Nt+=2;0<Nt&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,N.__webglUVBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,Ft,k))}if(Zt&&fn&&_){P=0;for(H=on.length;P<H;P++)if(B=on[P],W=fn[B],void 0!==W)for(ft=0;3>ft;ft++)pt=W[ft],It[kt]=pt.x,It[kt+1]=pt.y,kt+=2;0<kt&&(Ct.bindBuffer(Ct.ARRAY_BUFFER,N.__webglUV2Buffer),Ct.bufferData(Ct.ARRAY_BUFFER,It,k))}if(Yt){P=0;for(H=on.length;P<H;P++)Kt[Lt]=xt,Kt[Lt+1]=xt+1,Kt[Lt+2]=xt+2,Lt+=3,Qt[Mt]=xt,Qt[Mt+1]=xt+1,Qt[Mt+2]=xt,Qt[Mt+3]=xt+2,Qt[Mt+4]=xt+1,Qt[Mt+5]=xt+2,Mt+=6,xt+=3;Ct.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,N.__webglFaceBuffer),Ct.bufferData(Ct.ELEMENT_ARRAY_BUFFER,Kt,k),Ct.bindBuffer(Ct.ELEMENT_ARRAY_BUFFER,N.__webglLineBuffer),Ct.bufferData(Ct.ELEMENT_ARRAY_BUFFER,Qt,k)}if($t)for(ft=0,lt=$t.length;ft<lt;ft++)if(Jt=$t[ft],Jt.__original.needsUpdate){Ht=0;if(1===Jt.size){if(void 0===Jt.boundTo||"vertices"===Jt.boundTo)for(P=0,H=on.length;P<H;P++)j=un[on[P]],Jt.array[Ht]=Jt.value[j.a],Jt.array[Ht+1]=Jt.value[j.b],Jt.array[Ht+2]=Jt.value[j.c],Ht+=3;else if("faces"===Jt.boundTo)for(P=0,H=on.length;P<H;P++)Bt=Jt.value[on[P]],Jt.array[Ht]=Bt,Jt.array[Ht+1]=Bt,Jt.array[Ht+2]=Bt,Ht+=3}else if(2===Jt.size){if(void 0===Jt.boundTo||"vertices"===Jt.boundTo)for(P=0,H=on.length;P<H;P++)j=un[on[P]],X=Jt.value[j.a],V=Jt.value[j.b],$=Jt.value[j.c],Jt.array[Ht]=X.x,Jt.array[Ht+1]=X.y,Jt.array[Ht+2]=V.x,Jt.array[Ht+3]=V.y,Jt.array[Ht+4]=$.x,Jt.array[Ht+5]=$.y,Ht+=6;else if("faces"===Jt.boundTo)for(P=0,H=on.length;P<H;P++)$=V=X=Bt=Jt.value[on[P]],Jt.array[Ht]=X.x,Jt.array[Ht+1]=X.y,Jt.array[Ht+2]=V.x,Jt.array[Ht+3]=V.y,Jt.array[Ht+4]=$.x,Jt.array[Ht+5]=$.y,Ht+=6}else if(3===Jt.size){var dn;dn="c"===Jt.type?["r","g","b"]:["x","y","z"];if(void 0===Jt.boundTo||"vertices"===Jt.boundTo)for(P=0,H=on.length;P<H;P++)j=un[on[P]],X=Jt.value[j.a],V=Jt.value[j.b],$=Jt.value[j.c],Jt.array[Ht]=X[dn[0]],Jt.array[Ht+1]=X[dn[1]],Jt.array[Ht+2]=X[dn[2]],Jt.array[Ht+3]=V[dn[0]],Jt.array[Ht+4]=V[dn[1]],Jt.array[Ht+5]=V[dn[2]],Jt.array[Ht+6]=$[dn[0]],Jt.array[Ht+7]=$[dn[1]],Jt.array[Ht+8]=$[dn[2]],Ht+=9;else if("faces"===Jt.boundTo)for(P=0,H=on.length;P<H;P++)$=V=X=Bt=Jt.value[on[P]],Jt.array[Ht]=X[dn[0]],Jt.array[Ht+1]=X[dn[1]],Jt.array[Ht+2]=X[dn[2]],Jt.array[Ht+3]=V[dn[0]],Jt.array[Ht+4]=V[dn[1]],Jt.array[Ht+5]=V[dn[2]],Jt.array[Ht+6]=$[dn[0]],Jt.array[Ht+7]=$[dn[1]],Jt.array[Ht+8]=$[dn[2]],Ht+=9;else if("faceVertices"===Jt.boundTo)for(P=0,H=on.length;P<H;P++)Bt=Jt.value[on[P]],X=Bt[0],V=Bt[1],$=Bt[2],Jt.array[Ht]=X[dn[0]],Jt.array[Ht+1]=X[dn[1]],Jt.array[Ht+2]=X[dn[2]],Jt.array[Ht+3]=V[dn[0]],Jt.array[Ht+4]=V[dn[1]],Jt.array[Ht+5]=V[dn[2]],Jt.array[Ht+6]=$[dn[0]],Jt.array[Ht+7]=$[dn[1]],Jt.array[Ht+8]=$[dn[2]],Ht+=9}else if(4===Jt.size)if(void 0===Jt.boundTo||"vertices"===Jt.boundTo)for(P=0,H=on.length;P<H;P++)j=un[on[P]],X=Jt.value[j.a],V=Jt.value[j.b],$=Jt.value[j.c],Jt.array[Ht]=X.x,Jt.array[Ht+1]=X.y,Jt.array[Ht+2]=X.z,Jt.array[Ht+3]=X.w,Jt.array[Ht+4]=V.x,Jt.array[Ht+5]=V.y,Jt.array[Ht+6]=V.z,Jt.array[Ht+7]=V.w,Jt.array[Ht+8]=$.x,Jt.array[Ht+9]=$.y,Jt.array[Ht+10]=$.z,Jt.array[Ht+11]=$.w,Ht+=12;else if("faces"===Jt.boundTo)for(P=0,H=on.length;P<H;P++)$=V=X=Bt=Jt.value[on[P]],Jt.array[Ht]=X.x,Jt.array[Ht+1]=X.y,Jt.array[Ht+2]=X.z,Jt.array[Ht+3]=X.w,Jt.array[Ht+4]=V.x,Jt.array[Ht+5]=V.y,Jt.array[Ht+6]=V.z,Jt.array[Ht+7]=V.w,Jt.array[Ht+8]=$.x,Jt.array[Ht+9]=$.y,Jt.array[Ht+10]=$.z,Jt.array[Ht+11]=$.w,Ht+=12;else if("faceVertices"===Jt.boundTo)for(P=0,H=on.length;P<H;P++)Bt=Jt.value[on[P]],X=Bt[0],V=Bt[1],$=Bt[2],Jt.array[Ht]=X.x,Jt.array[Ht+1]=X.y,Jt.array[Ht+2]=X.z,Jt.array[Ht+3]=X.w,Jt.array[Ht+4]=V.x,Jt.array[Ht+5]=V.y,Jt.array[Ht+6]=V.z,Jt.array[Ht+7]=V.w,Jt.array[Ht+8]=$.x,Jt.array[Ht+9]=$.y,Jt.array[Ht+10]=$.z,Jt.array[Ht+11]=$.w,Ht+=12;Ct.bindBuffer(Ct.ARRAY_BUFFER,Jt.buffer),Ct.bufferData(Ct.ARRAY_BUFFER,Jt.array,k)}L&&(delete N.__inittedArrays,delete N.__colorArray,delete N.__normalArray,delete N.__tangentArray,delete N.__uvArray,delete N.__uv2Array,delete N.__faceArray,delete N.__vertexArray,delete N.__lineArray,delete N.__skinIndexArray,delete N.__skinWeightArray)}}l.verticesNeedUpdate=!1,l.morphTargetsNeedUpdate=!1,l.elementsNeedUpdate=!1,l.uvsNeedUpdate=!1,l.normalsNeedUpdate=!1,l.colorsNeedUpdate=!1,l.tangentsNeedUpdate=!1,l.buffersNeedUpdate=!1,d.attributes&&b(d)}else if(f instanceof e.Line){d=i(f,l),p=d.attributes&&y(d);if(l.verticesNeedUpdate||l.colorsNeedUpdate||l.lineDistancesNeedUpdate||p){var vn=l,mn=Ct.DYNAMIC_DRAW,gn=void 0,yn=void 0,bn=void 0,wn=void 0,En=void 0,Sn=void 0,xn=vn.vertices,Tn=vn.colors,Nn=vn.lineDistances,Cn=xn.length,kn=Tn.length,Ln=Nn.length,An=vn.__vertexArray,On=vn.__colorArray,Mn=vn.__lineDistanceArray,_n=vn.colorsNeedUpdate,Dn=vn.lineDistancesNeedUpdate,Pn=vn.__webglCustomAttributesList,Hn=void 0,Bn=void 0,jn=void 0,Fn=void 0,In=void 0,qn=void 0;if(vn.verticesNeedUpdate){for(gn=0;gn<Cn;gn++)wn=xn[gn],En=3*gn,An[En]=wn.x,An[En+1]=wn.y,An[En+2]=wn.z;Ct.bindBuffer(Ct.ARRAY_BUFFER,vn.__webglVertexBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,An,mn)}if(_n){for(yn=0;yn<kn;yn++)Sn=Tn[yn],En=3*yn,On[En]=Sn.r,On[En+1]=Sn.g,On[En+2]=Sn.b;Ct.bindBuffer(Ct.ARRAY_BUFFER,vn.__webglColorBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,On,mn)}if(Dn){for(bn=0;bn<Ln;bn++)Mn[bn]=Nn[bn];Ct.bindBuffer(Ct.ARRAY_BUFFER,vn.__webglLineDistanceBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,Mn,mn)}if(Pn)for(Hn=0,Bn=Pn.length;Hn<Bn;Hn++)if(qn=Pn[Hn],qn.needsUpdate&&(void 0===qn.boundTo||"vertices"===qn.boundTo)){En=0,Fn=qn.value.length;if(1===qn.size)for(jn=0;jn<Fn;jn++)qn.array[jn]=qn.value[jn];else if(2===qn.size)for(jn=0;jn<Fn;jn++)In=qn.value[jn],qn.array[En]=In.x,qn.array[En+1]=In.y,En+=2;else if(3===qn.size)if("c"===qn.type)for(jn=0;jn<Fn;jn++)In=qn.value[jn],qn.array[En]=In.r,qn.array[En+1]=In.g,qn.array[En+2]=In.b,En+=3;else for(jn=0;jn<Fn;jn++)In=qn.value[jn],qn.array[En]=In.x,qn.array[En+1]=In.y,qn.array[En+2]=In.z,En+=3;else if(4===qn.size)for(jn=0;jn<Fn;jn++)In=qn.value[jn],qn.array[En]=In.x,qn.array[En+1]=In.y,qn.array[En+2]=In.z,qn.array[En+3]=In.w,En+=4;Ct.bindBuffer(Ct.ARRAY_BUFFER,qn.buffer),Ct.bufferData(Ct.ARRAY_BUFFER,qn.array,mn)}}l.verticesNeedUpdate=!1,l.colorsNeedUpdate=!1,l.lineDistancesNeedUpdate=!1,d.attributes&&b(d)}else if(f instanceof e.ParticleSystem){d=i(f,l),p=d.attributes&&y(d);if(l.verticesNeedUpdate||l.colorsNeedUpdate||f.sortParticles||p){var Rn=l,Un=Ct.DYNAMIC_DRAW,zn=f,Wn=void 0,Xn=void 0,Vn=void 0,$n=void 0,Jn=void 0,Kn=void 0,Qn=Rn.vertices,Gn=Qn.length,Yn=Rn.colors,Zn=Yn.length,er=Rn.__vertexArray,tr=Rn.__colorArray,nr=Rn.__sortArray,rr=Rn.verticesNeedUpdate,ir=Rn.colorsNeedUpdate,sr=Rn.__webglCustomAttributesList,or=void 0,ur=void 0,ar=void 0,fr=void 0,lr=void 0,cr=void 0;if(zn.sortParticles){Et.copy(wt),Et.multiply(zn.matrixWorld);for(Wn=0;Wn<Gn;Wn++)Vn=Qn[Wn],St.copy(Vn),St.applyProjection(Et),nr[Wn]=[St.z,Wn];nr.sort(h);for(Wn=0;Wn<Gn;Wn++)Vn=Qn[nr[Wn][1]],$n=3*Wn,er[$n]=Vn.x,er[$n+1]=Vn.y,er[$n+2]=Vn.z;for(Xn=0;Xn<Zn;Xn++)$n=3*Xn,Kn=Yn[nr[Xn][1]],tr[$n]=Kn.r,tr[$n+1]=Kn.g,tr[$n+2]=Kn.b;if(sr)for(or=0,ur=sr.length;or<ur;or++)if(cr=sr[or],void 0===cr.boundTo||"vertices"===cr.boundTo)if($n=0,fr=cr.value.length,1===cr.size)for(ar=0;ar<fr;ar++)Jn=nr[ar][1],cr.array[ar]=cr.value[Jn];else if(2===cr.size)for(ar=0;ar<fr;ar++)Jn=nr[ar][1],lr=cr.value[Jn],cr.array[$n]=lr.x,cr.array[$n+1]=lr.y,$n+=2;else if(3===cr.size)if("c"===cr.type)for(ar=0;ar<fr;ar++)Jn=nr[ar][1],lr=cr.value[Jn],cr.array[$n]=lr.r,cr.array[$n+1]=lr.g,cr.array[$n+2]=lr.b,$n+=3;else for(ar=0;ar<fr;ar++)Jn=nr[ar][1],lr=cr.value[Jn],cr.array[$n]=lr.x,cr.array[$n+1]=lr.y,cr.array[$n+2]=lr.z,$n+=3;else if(4===cr.size)for(ar=0;ar<fr;ar++)Jn=nr[ar][1],lr=cr.value[Jn],cr.array[$n]=lr.x,cr.array[$n+1]=lr.y,cr.array[$n+2]=lr.z,cr.array[$n+3]=lr.w,$n+=4}else{if(rr)for(Wn=0;Wn<Gn;Wn++)Vn=Qn[Wn],$n=3*Wn,er[$n]=Vn.x,er[$n+1]=Vn.y,er[$n+2]=Vn.z;if(ir)for(Xn=0;Xn<Zn;Xn++)Kn=Yn[Xn],$n=3*Xn,tr[$n]=Kn.r,tr[$n+1]=Kn.g,tr[$n+2]=Kn.b;if(sr)for(or=0,ur=sr.length;or<ur;or++)if(cr=sr[or],cr.needsUpdate&&(void 0===cr.boundTo||"vertices"===cr.boundTo))if(fr=cr.value.length,$n=0,1===cr.size)for(ar=0;ar<fr;ar++)cr.array[ar]=cr.value[ar];else if(2===cr.size)for(ar=0;ar<fr;ar++)lr=cr.value[ar],cr.array[$n]=lr.x,cr.array[$n+1]=lr.y,$n+=2;else if(3===cr.size)if("c"===cr.type)for(ar=0;ar<fr;ar++)lr=cr.value[ar],cr.array[$n]=lr.r,cr.array[$n+1]=lr.g,cr.array[$n+2]=lr.b,$n+=3;else for(ar=0;ar<fr;ar++)lr=cr.value[ar],cr.array[$n]=lr.x,cr.array[$n+1]=lr.y,cr.array[$n+2]=lr.z,$n+=3;else if(4===cr.size)for(ar=0;ar<fr;ar++)lr=cr.value[ar],cr.array[$n]=lr.x,cr.array[$n+1]=lr.y,cr.array[$n+2]=lr.z,cr.array[$n+3]=lr.w,$n+=4}if(rr||zn.sortParticles)Ct.bindBuffer(Ct.ARRAY_BUFFER,Rn.__webglVertexBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,er,Un);if(ir||zn.sortParticles)Ct.bindBuffer(Ct.ARRAY_BUFFER,Rn.__webglColorBuffer),Ct.bufferData(Ct.ARRAY_BUFFER,tr,Un);if(sr)for(or=0,ur=sr.length;or<ur;or++)if(cr=sr[or],cr.needsUpdate||zn.sortParticles)Ct.bindBuffer(Ct.ARRAY_BUFFER,cr.buffer),Ct.bufferData(Ct.ARRAY_BUFFER,cr.array,Un)}l.verticesNeedUpdate=!1,l.colorsNeedUpdate=!1,d.attributes&&b(d)}}},this.initMaterial=function(t,n,r,i){var s,o,u,a;t.addEventListener("dispose",$t);var f,l,c,h;t instanceof e.MeshDepthMaterial?h="depth":t instanceof e.MeshNormalMaterial?h="normal":t instanceof e.MeshBasicMaterial?h="basic":t instanceof e.MeshLambertMaterial?h="lambert":t instanceof e.MeshPhongMaterial?h="phong":t instanceof e.LineBasicMaterial?h="basic":t instanceof e.LineDashedMaterial?h="dashed":t instanceof e.ParticleSystemMaterial&&(h="particle_basic"),h&&(s=e.ShaderLib[h],t.uniforms=e.UniformsUtils.clone(s.uniforms),t.vertexShader=s.vertexShader,t.fragmentShader=s.fragmentShader),c=a=u=o=s=0;for(var p=n.length;c<p;c++){var d=n[c];d.onlyShadow||!1===d.visible||(d instanceof e.DirectionalLight&&s++,d instanceof e.PointLight&&o++,d instanceof e.SpotLight&&u++,d instanceof e.HemisphereLight&&a++)}p=c=0;for(d=n.length;p<d;p++){var v=n[p];v.castShadow&&(v instanceof e.SpotLight&&c++,v instanceof e.DirectionalLight&&!v.shadowCascade&&c++)}n=c,jt&&i&&i.skeleton&&i.skeleton.useVertexTexture?c=1024:(c=Ct.getParameter(Ct.MAX_VERTEX_UNIFORM_VECTORS),c=Math.floor((c-20)/4),void 0!==i&&i instanceof e.SkinnedMesh&&(c=Math.min(i.skeleton.bones.length,c),c<i.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+i.skeleton.bones.length+", this GPU supports just "+c+" (try OpenGL instead of ANGLE)"))),r={precision:H,supportsVertexTextures:Bt,map:!!t.map,envMap:!!t.envMap,lightMap:!!t.lightMap,bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,specularMap:!!t.specularMap,vertexColors:t.vertexColors,fog:r,useFog:t.fog,fogExp:r instanceof e.FogExp2,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:U,skinning:t.skinning,maxBones:c,useVertexTexture:jt&&i&&i.skeleton&&i.skeleton.useVertexTexture,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:s,maxPointLights:o,maxSpotLights:u,maxHemiLights:a,maxShadows:n,shadowMapEnabled:this.shadowMapEnabled&&i.receiveShadow&&0<n,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:t.alphaTest,metal:t.metal,wrapAround:t.wrapAround,doubleSided:t.side===e.DoubleSide,flipSided:t.side===e.BackSide},i=[],h?i.push(h):(i.push(t.fragmentShader),i.push(t.vertexShader));for(var m in t.defines)i.push(m),i.push(t.defines[m]);for(l in r)i.push(l),i.push(r[l]);h=i.join();var g;l=0;for(m=V.length;l<m;l++)if(i=V[l],i.code===h){g=i,g.usedTimes++;break}void 0===g&&(g=new e.WebGLProgram(this,h,t,r),V.push(g),X.info.memory.programs=V.length),t.program=g,g=t.program.attributes;if(t.morphTargets)for(t.numSupportedMorphTargets=0,m="morphTarget",l=0;l<this.maxMorphTargets;l++)h=m+l,0<=g[h]&&t.numSupportedMorphTargets++;if(t.morphNormals)for(t.numSupportedMorphNormals=0,m="morphNormal",l=0;l<this.maxMorphNormals;l++)h=m+l,0<=g[h]&&t.numSupportedMorphNormals++;t.uniformsList=[];for(f in t.uniforms)t.uniformsList.push([t.uniforms[f],f])},this.setFaceCulling=function(t,n){t===e.CullFaceNone?Ct.disable(Ct.CULL_FACE):(n===e.FrontFaceDirectionCW?Ct.frontFace(Ct.CW):Ct.frontFace(Ct.CCW),t===e.CullFaceBack?Ct.cullFace(Ct.BACK):t===e.CullFaceFront?Ct.cullFace(Ct.FRONT):Ct.cullFace(Ct.FRONT_AND_BACK),Ct.enable(Ct.CULL_FACE))},this.setMaterialFaces=function(t){var n=t.side===e.DoubleSide;t=t.side===e.BackSide,Z!==n&&(n?Ct.disable(Ct.CULL_FACE):Ct.enable(Ct.CULL_FACE),Z=n),et!==t&&(t?Ct.frontFace(Ct.CW):Ct.frontFace(Ct.CCW),et=t)},this.setDepthTest=function(e){st!==e&&(e?Ct.enable(Ct.DEPTH_TEST):Ct.disable(Ct.DEPTH_TEST),st=e)},this.setDepthWrite=function(e){ot!==e&&(Ct.depthMask(e),ot=e)},this.setBlending=function(t,n,r,i){t!==tt&&(t===e.NoBlending?Ct.disable(Ct.BLEND):t===e.AdditiveBlending?(Ct.enable(Ct.BLEND),Ct.blendEquation(Ct.FUNC_ADD),Ct.blendFunc(Ct.SRC_ALPHA,Ct.ONE)):t===e.SubtractiveBlending?(Ct.enable(Ct.BLEND),Ct.blendEquation(Ct.FUNC_ADD),Ct.blendFunc(Ct.ZERO,Ct.ONE_MINUS_SRC_COLOR)):t===e.MultiplyBlending?(Ct.enable(Ct.BLEND),Ct.blendEquation(Ct.FUNC_ADD),Ct.blendFunc(Ct.ZERO,Ct.SRC_COLOR)):t===e.CustomBlending?Ct.enable(Ct.BLEND):(Ct.enable(Ct.BLEND),Ct.blendEquationSeparate(Ct.FUNC_ADD,Ct.FUNC_ADD),Ct.blendFuncSeparate(Ct.SRC_ALPHA,Ct.ONE_MINUS_SRC_ALPHA,Ct.ONE,Ct.ONE_MINUS_SRC_ALPHA)),tt=t);if(t===e.CustomBlending){if(n!==nt&&(Ct.blendEquation(_(n)),nt=n),r!==rt||i!==it)Ct.blendFunc(_(r),_(i)),rt=r,it=i}else it=rt=nt=null},this.setTexture=function(t,n){if(t.needsUpdate){t.__webglInit||(t.__webglInit=!0,t.addEventListener("dispose",Xt),t.__webglTexture=Ct.createTexture(),X.info.memory.textures++),Ct.activeTexture(Ct.TEXTURE0+n),Ct.bindTexture(Ct.TEXTURE_2D,t.__webglTexture),Ct.pixelStorei(Ct.UNPACK_FLIP_Y_WEBGL,t.flipY),Ct.pixelStorei(Ct.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),Ct.pixelStorei(Ct.UNPACK_ALIGNMENT,t.unpackAlignment);var r=t.image,i=e.Math.isPowerOfTwo(r.width)&&e.Math.isPowerOfTwo(r.height),s=_(t.format),o=_(t.type);A(Ct.TEXTURE_2D,t,i);var u=t.mipmaps;if(t instanceof e.DataTexture)if(0<u.length&&i){for(var a=0,f=u.length;a<f;a++)r=u[a],Ct.texImage2D(Ct.TEXTURE_2D,a,s,r.width,r.height,0,s,o,r.data);t.generateMipmaps=!1}else Ct.texImage2D(Ct.TEXTURE_2D,0,s,r.width,r.height,0,s,o,r.data);else if(t instanceof e.CompressedTexture)for(a=0,f=u.length;a<f;a++)r=u[a],t.format!==e.RGBAFormat?Ct.compressedTexImage2D(Ct.TEXTURE_2D,a,s,r.width,r.height,0,r.data):Ct.texImage2D(Ct.TEXTURE_2D,a,s,r.width,r.height,0,s,o,r.data);else if(0<u.length&&i){a=0;for(f=u.length;a<f;a++)r=u[a],Ct.texImage2D(Ct.TEXTURE_2D,a,s,s,o,r);t.generateMipmaps=!1}else Ct.texImage2D(Ct.TEXTURE_2D,0,s,s,o,t.image);t.generateMipmaps&&i&&Ct.generateMipmap(Ct.TEXTURE_2D),t.needsUpdate=!1,t.onUpdate&&t.onUpdate()}else Ct.activeTexture(Ct.TEXTURE0+n),Ct.bindTexture(Ct.TEXTURE_2D,t.__webglTexture)},this.setRenderTarget=function(t){var n=t instanceof e.WebGLRenderTargetCube;if(t&&!t.__webglFramebuffer){void 0===t.depthBuffer&&(t.depthBuffer=!0),void 0===t.stencilBuffer&&(t.stencilBuffer=!0),t.addEventListener("dispose",Vt),t.__webglTexture=Ct.createTexture(),X.info.memory.textures++;var r=e.Math.isPowerOfTwo(t.width)&&e.Math.isPowerOfTwo(t.height),i=_(t.format),s=_(t.type);if(n){t.__webglFramebuffer=[],t.__webglRenderbuffer=[],Ct.bindTexture(Ct.TEXTURE_CUBE_MAP,t.__webglTexture),A(Ct.TEXTURE_CUBE_MAP,t,r);for(var o=0;6>o;o++){t.__webglFramebuffer[o]=Ct.createFramebuffer(),t.__webglRenderbuffer[o]=Ct.createRenderbuffer(),Ct.texImage2D(Ct.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,i,t.width,t.height,0,i,s,null);var u=t,a=Ct.TEXTURE_CUBE_MAP_POSITIVE_X+o;Ct.bindFramebuffer(Ct.FRAMEBUFFER,t.__webglFramebuffer[o]),Ct.framebufferTexture2D(Ct.FRAMEBUFFER,Ct.COLOR_ATTACHMENT0,a,u.__webglTexture,0),O(t.__webglRenderbuffer[o],t)}r&&Ct.generateMipmap(Ct.TEXTURE_CUBE_MAP)}else t.__webglFramebuffer=Ct.createFramebuffer(),t.__webglRenderbuffer=t.shareDepthFrom?t.shareDepthFrom.__webglRenderbuffer:Ct.createRenderbuffer(),Ct.bindTexture(Ct.TEXTURE_2D,t.__webglTexture),A(Ct.TEXTURE_2D,t,r),Ct.texImage2D(Ct.TEXTURE_2D,0,i,t.width,t.height,0,i,s,null),i=Ct.TEXTURE_2D,Ct.bindFramebuffer(Ct.FRAMEBUFFER,t.__webglFramebuffer),Ct.framebufferTexture2D(Ct.FRAMEBUFFER,Ct.COLOR_ATTACHMENT0,i,t.__webglTexture,0),t.shareDepthFrom?t.depthBuffer&&!t.stencilBuffer?Ct.framebufferRenderbuffer(Ct.FRAMEBUFFER,Ct.DEPTH_ATTACHMENT,Ct.RENDERBUFFER,t.__webglRenderbuffer):t.depthBuffer&&t.stencilBuffer&&Ct.framebufferRenderbuffer(Ct.FRAMEBUFFER,Ct.DEPTH_STENCIL_ATTACHMENT,Ct.RENDERBUFFER,t.__webglRenderbuffer):O(t.__webglRenderbuffer,t),r&&Ct.generateMipmap(Ct.TEXTURE_2D);n?Ct.bindTexture(Ct.TEXTURE_CUBE_MAP,null):Ct.bindTexture(Ct.TEXTURE_2D,null),Ct.bindRenderbuffer(Ct.RENDERBUFFER,null),Ct.bindFramebuffer(Ct.FRAMEBUFFER,null)}t?(n=n?t.__webglFramebuffer[t.activeCubeFace]:t.__webglFramebuffer,r=t.width,t=t.height,s=i=0):(n=null,r=pt,t=dt,i=ct,s=ht),n!==J&&(Ct.bindFramebuffer(Ct.FRAMEBUFFER,n),Ct.viewport(i,s,r,t),J=n),vt=r,mt=t},this.shadowMapPlugin=new e.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new e.SpritePlugin),this.addPostPlugin(new e.LensFlarePlugin)},e.WebGLRenderTarget=function(t,n,r){this.width=t,this.height=n,r=r||{},this.wrapS=void 0!==r.wrapS?r.wrapS:e.ClampToEdgeWrapping,this.wrapT=void 0!==r.wrapT?r.wrapT:e.ClampToEdgeWrapping,this.magFilter=void 0!==r.magFilter?r.magFilter:e.LinearFilter,this.minFilter=void 0!==r.minFilter?r.minFilter:e.LinearMipMapLinearFilter,this.anisotropy=void 0!==r.anisotropy?r.anisotropy:1,this.offset=new e.Vector2(0,0),this.repeat=new e.Vector2(1,1),this.format=void 0!==r.format?r.format:e.RGBAFormat,this.type=void 0!==r.type?r.type:e.UnsignedByteType,this.depthBuffer=void 0!==r.depthBuffer?r.depthBuffer:!0,this.stencilBuffer=void 0!==r.stencilBuffer?r.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},e.WebGLRenderTarget.prototype={constructor:e.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var t=new e.WebGLRenderTarget(this.width,this.height);return t.wrapS=this.wrapS,t.wrapT=this.wrapT,t.magFilter=this.magFilter,t.minFilter=this.minFilter,t.anisotropy=this.anisotropy,t.offset.copy(this.offset),t.repeat.copy(this.repeat),t.format=this.format,t.type=this.type,t.depthBuffer=this.depthBuffer,t.stencilBuffer=this.stencilBuffer,t.generateMipmaps=this.generateMipmaps,t.shareDepthFrom=this.shareDepthFrom,t},dispose:function(){this.dispatchEvent({type:"dispose"})}},e.EventDispatcher.prototype.apply(e.WebGLRenderTarget.prototype),e.WebGLRenderTargetCube=function(t,n,r){e.WebGLRenderTarget.call(this,t,n,r),this.activeCubeFace=0},e.WebGLRenderTargetCube.prototype=Object.create(e.WebGLRenderTarget.prototype),e.WebGLProgram=function(){var t=0;return function(n,r,i,s){var o=n.context,u=i.fragmentShader,f=i.vertexShader,l=i.uniforms,c=i.attributes,h=i.defines,p=i.index0AttributeName;void 0===p&&!0===s.morphTargets&&(p="position");var d="SHADOWMAP_TYPE_BASIC";s.shadowMapType===e.PCFShadowMap?d="SHADOWMAP_TYPE_PCF":s.shadowMapType===e.PCFSoftShadowMap&&(d="SHADOWMAP_TYPE_PCF_SOFT");var v,m;v=[];for(var g in h)m=h[g],!1!==m&&(m="#define "+g+" "+m,v.push(m));v=v.join("\n"),h=o.createProgram(),i instanceof e.RawShaderMaterial?n=i="":(i=["precision "+s.precision+" float;","precision "+s.precision+" int;",v,s.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.gammaInput?"#define GAMMA_INPUT":"",n.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,"#define MAX_BONES "+s.maxBones,s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.vertexColors?"#define USE_COLOR":"",s.skinning?"#define USE_SKINNING":"",s.useVertexTexture?"#define BONE_TEXTURE":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals?"#define USE_MORPHNORMALS":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+d:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n	attribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\n	attribute vec3 morphTarget0;\n	attribute vec3 morphTarget1;\n	attribute vec3 morphTarget2;\n	attribute vec3 morphTarget3;\n	#ifdef USE_MORPHNORMALS\n		attribute vec3 morphNormal0;\n		attribute vec3 morphNormal1;\n		attribute vec3 morphNormal2;\n		attribute vec3 morphNormal3;\n	#else\n		attribute vec3 morphTarget4;\n		attribute vec3 morphTarget5;\n		attribute vec3 morphTarget6;\n		attribute vec3 morphTarget7;\n	#endif\n#endif\n#ifdef USE_SKINNING\n	attribute vec4 skinIndex;\n	attribute vec4 skinWeight;\n#endif\n"].join("\n"),n=["precision "+s.precision+" float;","precision "+s.precision+" int;",s.bumpMap||s.normalMap?"#extension GL_OES_standard_derivatives : enable":"",v,"#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,s.alphaTest?"#define ALPHATEST "+s.alphaTest:"",n.gammaInput?"#define GAMMA_INPUT":"",n.gammaOutput?"#define GAMMA_OUTPUT":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.vertexColors?"#define USE_COLOR":"",s.metal?"#define METAL":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+d:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",s.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n")),f=new e.WebGLShader(o,o.VERTEX_SHADER,i+f),u=new e.WebGLShader(o,o.FRAGMENT_SHADER,n+u),o.attachShader(h,f),o.attachShader(h,u),void 0!==p&&o.bindAttribLocation(h,0,p),o.linkProgram(h),!1===o.getProgramParameter(h,o.LINK_STATUS)&&(console.error("Could not initialise shader"),console.error("gl.VALIDATE_STATUS",o.getProgramParameter(h,o.VALIDATE_STATUS)),console.error("gl.getError()",o.getError())),""!==o.getProgramInfoLog(h)&&console.error("gl.getProgramInfoLog()",o.getProgramInfoLog(h)),o.deleteShader(f),o.deleteShader(u),p="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" "),s.useVertexTexture?(p.push("boneTexture"),p.push("boneTextureWidth"),p.push("boneTextureHeight")):p.push("boneGlobalMatrices"),s.logarithmicDepthBuffer&&p.push("logDepthBufFC");for(var y in l)p.push(y);l=p,y={},p=0;for(n=l.length;p<n;p++)d=l[p],y[d]=o.getUniformLocation(h,d);this.uniforms=y,p="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" ");for(l=0;l<s.maxMorphTargets;l++)p.push("morphTarget"+l);for(l=0;l<s.maxMorphNormals;l++)p.push("morphNormal"+l);for(var b in c)p.push(b);s=p,c={},b=0;for(l=s.length;b<l;b++)y=s[b],c[y]=o.getAttribLocation(h,y);return this.attributes=c,this.id=t++,this.code=r,this.usedTimes=1,this.program=h,this.vertexShader=f,this.fragmentShader=u,this}}(),e.WebGLShader=function(){var e=function(e){e=e.split("\n");for(var t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")};return function(t,n,r){return n=t.createShader(n),t.shaderSource(n,r),t.compileShader(n),!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&(console.error("THREE.WebGLShader:","gl.getShaderInfoLog()",t.getShaderInfoLog(n)),console.error(e(r))),n}}(),e.RenderableVertex=function(){this.position=new e.Vector3,this.positionWorld=new e.Vector3,this.positionScreen=new e.Vector4,this.visible=!0},e.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},e.RenderableFace=function(){this.id=0,this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.v3=new e.RenderableVertex,this.normalModel=new e.Vector3,this.vertexNormalsModel=[new e.Vector3,new e.Vector3,new e.Vector3],this.vertexNormalsLength=0,this.material=this.color=null,this.uvs=[new e.Vector2,new e.Vector2,new e.Vector2],this.z=0},e.RenderableObject=function(){this.id=0,this.object=null,this.z=0},e.RenderableSprite=function(){this.id=0,this.object=null,this.rotation=this.z=this.y=this.x=0,this.scale=new e.Vector2,this.material=null},e.RenderableLine=function(){this.id=0,this.v1=new e.RenderableVertex,this.v2=new e.RenderableVertex,this.vertexColors=[new e.Color,new e.Color],this.material=null,this.z=0},e.GeometryUtils={merge:function(t,n,r){console.warn("DEPRECATED: GeometryUtils's .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var i;n instanceof e.Mesh&&(n.matrixAutoUpdate&&n.updateMatrix(),i=n.matrix,n=n.geometry),t.merge(n,i,r)},randomPointInTriangle:function(){var t=new e.Vector3;return function(n,r,i){var s=new e.Vector3,o=e.Math.random16(),u=e.Math.random16();1<o+u&&(o=1-o,u=1-u);var f=1-o-u;return s.copy(n),s.multiplyScalar(o),t.copy(r),t.multiplyScalar(u),s.add(t),t.copy(i),t.multiplyScalar(f),s.add(t),s}}(),randomPointInFace:function(t,n,r){return e.GeometryUtils.randomPointInTriangle(n.vertices[t.a],n.vertices[t.b],n.vertices[t.c])},randomPointsInGeometry:function(t,n){function r(e){function t(n,r){if(r<n)return n;var i=n+Math.floor((r-n)/2);return l[i]>e?t(n,i-1):l[i]<e?t(i+1,r):i}return t(0,l.length-1)}var i,s,o=t.faces,u=t.vertices,a=o.length,f=0,l=[],c,h,p;for(s=0;s<a;s++)i=o[s],c=u[i.a],h=u[i.b],p=u[i.c],i._area=e.GeometryUtils.triangleArea(c,h,p),f+=i._area,l[s]=f;i=[];for(s=0;s<n;s++)u=e.Math.random16()*f,u=r(u),i[s]=e.GeometryUtils.randomPointInFace(o[u],t,!0);return i},triangleArea:function(){var t=new e.Vector3,n=new e.Vector3;return function(e,r,i){return t.subVectors(r,e),n.subVectors(i,e),t.cross(n),.5*t.length()}}(),center:function(t){t.computeBoundingBox();var n=t.boundingBox,r=new e.Vector3;return r.addVectors(n.min,n.max),r.multiplyScalar(-0.5),t.applyMatrix((new e.Matrix4).makeTranslation(r.x,r.y,r.z)),t.computeBoundingBox(),r}},e.ImageUtils={crossOrigin:void 0,loadTexture:function(t,n,r,i){var s=new e.ImageLoader;s.crossOrigin=this.crossOrigin;var o=new e.Texture(void 0,n);return n=s.load(t,function(){o.needsUpdate=!0,r&&r(o)},void 0,function(e){i&&i(e)}),o.image=n,o.sourceFile=t,o},loadCompressedTexture:function(t,n,r,i){var s=new e.CompressedTexture;s.mapping=n;var o=new XMLHttpRequest;return o.onload=function(){var t=e.ImageUtils.parseDDS(o.response,!0);s.format=t.format,s.mipmaps=t.mipmaps,s.image.width=t.width,s.image.height=t.height,s.generateMipmaps=!1,s.needsUpdate=!0,r&&r(s)},o.onerror=i,o.open("GET",t,!0),o.responseType="arraybuffer",o.send(null),s},loadTextureCube:function(t,n,r,i){var s=[];s.loadCount=0,i=new e.ImageLoader,i.crossOrigin=this.crossOrigin;var o=new e.Texture;o.image=s,void 0!==n&&(o.mapping=n),o.flipY=!1,n=0;for(var u=t.length;n<u;++n){var a=i.load(t[n],function(){s.loadCount+=1,6===s.loadCount&&(o.needsUpdate=!0,r&&r(o))});s[n]=a}return o},loadCompressedTextureCube:function(t,n,r,i){var s=[];s.loadCount=0;var o=new e.CompressedTexture;o.image=s,void 0!==n&&(o.mapping=n),o.flipY=!1,o.generateMipmaps=!1,n=function(t,n){return function(){var i=e.ImageUtils.parseDDS(t.response,!0);n.format=i.format,n.mipmaps=i.mipmaps,n.width=i.width,n.height=i.height,s.loadCount+=1,6===s.loadCount&&(o.format=i.format,o.needsUpdate=!0,r&&r(o))}};if(t instanceof Array)for(var u=0,a=t.length;u<a;++u){var f={};s[u]=f;var l=new XMLHttpRequest;l.onload=n(l,f),l.onerror=i,f=t[u],l.open("GET",f,!0),l.responseType="arraybuffer",l.send(null)}else l=new XMLHttpRequest,l.onload=function(){var t=e.ImageUtils.parseDDS(l.response,!0);if(t.isCubemap){for(var n=t.mipmaps.length/t.mipmapCount,i=0;i<n;i++){s[i]={mipmaps:[]};for(var u=0;u<t.mipmapCount;u++)s[i].mipmaps.push(t.mipmaps[i*t.mipmapCount+u]),s[i].format=t.format,s[i].width=t.width,s[i].height=t.height}o.format=t.format,o.needsUpdate=!0,r&&r(o)}},l.onerror=i,l.open("GET",t,!0),l.responseType="arraybuffer",l.send(null);return o},loadDDSTexture:function(t,n,r,i){var s=[];s.loadCount=0;var o=new e.CompressedTexture;o.image=s,void 0!==n&&(o.mapping=n),o.flipY=!1,o.generateMipmaps=!1;var u=new XMLHttpRequest;return u.onload=function(){var t=e.ImageUtils.parseDDS(u.response,!0);if(t.isCubemap)for(var n=t.mipmaps.length/t.mipmapCount,i=0;i<n;i++){s[i]={mipmaps:[]};for(var a=0;a<t.mipmapCount;a++)s[i].mipmaps.push(t.mipmaps[i*t.mipmapCount+a]),s[i].format=t.format,s[i].width=t.width,s[i].height=t.height}else o.image.width=t.width,o.image.height=t.height,o.mipmaps=t.mipmaps;o.format=t.format,o.needsUpdate=!0,r&&r(o)},u.onerror=i,u.open("GET",t,!0),u.responseType="arraybuffer",u.send(null),o},parseDDS:function(t,n){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function i(e,t,n,r){var i=n*r*4;e=new Uint8Array(e,t,i);for(var i=new Uint8Array(i),s=t=0,o=0;o<r;o++)for(var u=0;u<n;u++){var a=e[s];s++;var f=e[s];s++;var l=e[s];s++;var c=e[s];s++,i[t]=l,t++,i[t]=f,t++,i[t]=a,t++,i[t]=c,t++}return i}var s={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},o=r("DXT1"),u=r("DXT3"),a=r("DXT5"),f=new Int32Array(t,0,31);if(542327876!==f[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),s;if(!f[20]&4)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),s;var l=f[21],c=!1;switch(l){case o:o=8,s.format=e.RGB_S3TC_DXT1_Format;break;case u:o=16,s.format=e.RGBA_S3TC_DXT3_Format;break;case a:o=16,s.format=e.RGBA_S3TC_DXT5_Format;break;default:if(!(32==f[22]&&f[23]&16711680&&f[24]&65280&&f[25]&255&&f[26]&4278190080))return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(l&255,l>>8&255,l>>16&255,l>>24&255)),s;c=!0,o=64,s.format=e.RGBAFormat}s.mipmapCount=1,f[2]&131072&&!1!==n&&(s.mipmapCount=Math.max(1,f[7])),s.isCubemap=f[28]&512?!0:!1,s.width=f[4],s.height=f[3];for(var f=f[1]+4,u=s.width,a=s.height,l=s.isCubemap?6:1,h=0;h<l;h++){for(var p=0;p<s.mipmapCount;p++){if(c)var d=i(t,f,u,a),v=d.length;else v=Math.max(4,u)/4*Math.max(4,a)/4*o,d=new Uint8Array(t,f,v);s.mipmaps.push({data:d,width:u,height:a}),f+=v,u=Math.max(.5*u,1),a=Math.max(.5*a,1)}u=s.width,a=s.height}return s},getNormalMap:function(e,t){var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var r=e.width,i=e.height,s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");o.drawImage(e,0,0);for(var u=o.getImageData(0,0,r,i).data,a=o.createImageData(r,i),f=a.data,l=0;l<r;l++)for(var c=0;c<i;c++){var h=0>c-1?0:c-1,p=c+1>i-1?i-1:c+1,d=0>l-1?0:l-1,v=l+1>r-1?r-1:l+1,m=[],g=[0,0,u[4*(c*r+l)]/255*t];m.push([-1,0,u[4*(c*r+d)]/255*t]),m.push([-1,-1,u[4*(h*r+d)]/255*t]),m.push([0,-1,u[4*(h*r+l)]/255*t]),m.push([1,-1,u[4*(h*r+v)]/255*t]),m.push([1,0,u[4*(c*r+v)]/255*t]),m.push([1,1,u[4*(p*r+v)]/255*t]),m.push([0,1,u[4*(p*r+l)]/255*t]),m.push([-1,1,u[4*(p*r+d)]/255*t]),h=[],d=m.length;for(p=0;p<d;p++){var v=m[p],y=m[(p+1)%d],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]],y=[y[0]-g[0],y[1]-g[1],y[2]-g[2]];h.push(n([v[1]*y[2]-v[2]*y[1],v[2]*y[0]-v[0]*y[2],v[0]*y[1]-v[1]*y[0]]))}m=[0,0,0];for(p=0;p<h.length;p++)m[0]+=h[p][0],m[1]+=h[p][1],m[2]+=h[p][2];m[0]/=h.length,m[1]/=h.length,m[2]/=h.length,g=4*(c*r+l),f[g]=(m[0]+1)/2*255|0,f[g+1]=(m[1]+1)/2*255|0,f[g+2]=255*m[2]|0,f[g+3]=255}return o.putImageData(a,0,0),s},generateDataTexture:function(t,n,r){var i=t*n,s=new Uint8Array(3*i),o=Math.floor(255*r.r),u=Math.floor(255*r.g);r=Math.floor(255*r.b);for(var a=0;a<i;a++)s[3*a]=o,s[3*a+1]=u,s[3*a+2]=r;return t=new e.DataTexture(s,t,n,e.RGBFormat),t.needsUpdate=!0,t}},e.SceneUtils={createMultiMaterialObject:function(t,n){for(var r=new e.Object3D,i=0,s=n.length;i<s;i++)r.add(new e.Mesh(t,n[i]));return r},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(t,n,r){var i=new e.Matrix4;i.getInverse(r.matrixWorld),t.applyMatrix(i),n.remove(t),r.add(t)}},e.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(t){var n=this.getFace(),r=this.size/n.resolution,i=0,s=String(t).split(""),o=s.length,u=[];for(t=0;t<o;t++){var a=new e.Path,a=this.extractGlyphPoints(s[t],n,r,i,a),i=i+a.offset;u.push(a.path)}return{paths:u,offset:i/2}},extractGlyphPoints:function(t,n,r,i,s){var o=[],u,a,f,l,c,h,p,d,v,m,g,y=n.glyphs[t]||n.glyphs["?"];if(y){if(y.o)for(n=y._cachedOutline||(y._cachedOutline=y.o.split(" ")),l=n.length,t=0;t<l;)switch(f=n[t++],f){case"m":f=n[t++]*r+i,c=n[t++]*r,s.moveTo(f,c);break;case"l":f=n[t++]*r+i,c=n[t++]*r,s.lineTo(f,c);break;case"q":f=n[t++]*r+i,c=n[t++]*r,d=n[t++]*r+i,v=n[t++]*r,s.quadraticCurveTo(d,v,f,c);if(u=o[o.length-1])for(h=u.x,p=u.y,u=1,a=this.divisions;u<=a;u++){var b=u/a;e.Shape.Utils.b2(b,h,d,f),e.Shape.Utils.b2(b,p,v,c)}break;case"b":if(f=n[t++]*r+i,c=n[t++]*r,d=n[t++]*r+i,v=n[t++]*-r,m=n[t++]*r+i,g=n[t++]*-r,s.bezierCurveTo(f,c,d,v,m,g),u=o[o.length-1])for(h=u.x,p=u.y,u=1,a=this.divisions;u<=a;u++)b=u/a,e.Shape.Utils.b3(b,h,d,m,f),e.Shape.Utils.b3(b,p,v,g,c)}return{offset:y.ha*r,path:s}}}},e.FontUtils.generateShapes=function(t,n){n=n||{};var r=void 0!==n.curveSegments?n.curveSegments:4,i=void 0!==n.font?n.font:"helvetiker",s=void 0!==n.weight?n.weight:"normal",o=void 0!==n.style?n.style:"normal";e.FontUtils.size=void 0!==n.size?n.size:100,e.FontUtils.divisions=r,e.FontUtils.face=i,e.FontUtils.weight=s,e.FontUtils.style=o,r=e.FontUtils.drawText(t).paths,i=[],s=0;for(o=r.length;s<o;s++)Array.prototype.push.apply(i,r[s].toShapes());return i},function(e){var t=function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n};return e.Triangulate=function(e,n){var r=e.length;if(3>r)return null;var i=[],s=[],o=[],u,a,f;if(0<t(e))for(a=0;a<r;a++)s[a]=a;else for(a=0;a<r;a++)s[a]=r-1-a;var l=2*r;for(a=r-1;2<r;){if(0>=l--){console.log("Warning, unable to triangulate polygon!");break}u=a,r<=u&&(u=0),a=u+1,r<=a&&(a=0),f=a+1,r<=f&&(f=0);var c;e:{var h=c=void 0,p=void 0,d=void 0,v=void 0,m=void 0,g=void 0,y=void 0,w=void 0,h=e[s[u]].x,p=e[s[u]].y,d=e[s[a]].x,v=e[s[a]].y,m=e[s[f]].x,g=e[s[f]].y;if(1e-10>(d-h)*(g-p)-(v-p)*(m-h))c=!1;else{var E=void 0,S=void 0,x=void 0,T=void 0,N=void 0,C=void 0,k=void 0,L=void 0,A=void 0,O=void 0,A=L=k=w=y=void 0,E=m-d,S=g-v,x=h-m,T=p-g,N=d-h,C=v-p;for(c=0;c<r;c++)if(y=e[s[c]].x,w=e[s[c]].y,!(y===h&&w===p||y===d&&w===v||y===m&&w===g)&&(k=y-h,L=w-p,A=y-d,O=w-v,y-=m,w-=g,A=E*O-S*A,k=N*L-C*k,L=x*w-T*y,-1e-10<=A&&-1e-10<=L&&-1e-10<=k)){c=!1;break e}c=!0}}if(c){i.push([e[s[u]],e[s[a]],e[s[f]]]),o.push([s[u],s[a],s[f]]),u=a;for(f=a+1;f<r;u++,f++)s[u]=s[f];r--,l=2*r}}return n?o:i},e.Triangulate.area=t,e}(e.FontUtils),self._typeface_js={faces:e.FontUtils.faces,loadFace:e.FontUtils.loadFace},e.typeface_js=self._typeface_js,e.Curve=function(){},e.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},e.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},e.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},e.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},e.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},e.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t},e.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},e.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;s=t?t:e*n[i-1];for(var o=0,u=i-1,a;o<=u;)if(r=Math.floor(o+(u-o)/2),a=n[r]-s,0>a)o=r+1;else{if(!(0<a)){u=r;break}u=r-1}return r=u,n[r]==s?r/(i-1):(o=n[r],n=(r+(s-o)/(n[r+1]-o))/(i-1))},e.Curve.prototype.getTangent=function(e){var t=e-1e-4;return e+=1e-4,0>t&&(t=0),1<e&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},e.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},e.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e,t,n,r,i){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,r,i){e=.5*(n-e),r=.5*(r-t);var s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}},e.Curve.create=function(t,n){return t.prototype=Object.create(e.Curve.prototype),t.prototype.getPoint=n,t},e.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},e.CurvePath.prototype=Object.create(e.Curve.prototype),e.CurvePath.prototype.add=function(e){this.curves.push(e)},e.CurvePath.prototype.checkConnection=function(){},e.CurvePath.prototype.closePath=function(){var t=this.curves[0].getPoint(0),n=this.curves[this.curves.length-1].getPoint(1);t.equals(n)||this.curves.push(new e.LineCurve(n,t))},e.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength(),n=this.getCurveLengths();for(e=0;e<n.length;){if(n[e]>=t)return t=n[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},e.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},e.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},e.CurvePath.prototype.getBoundingBox=function(){var t=this.getPoints(),n,r,i,s,o,u;n=r=Number.NEGATIVE_INFINITY,s=o=Number.POSITIVE_INFINITY;var a,f,l,c,h=t[0]instanceof e.Vector3;c=h?new e.Vector3:new e.Vector2,f=0;for(l=t.length;f<l;f++)a=t[f],a.x>n?n=a.x:a.x<s&&(s=a.x),a.y>r?r=a.y:a.y<o&&(o=a.y),h&&(a.z>i?i=a.z:a.z<u&&(u=a.z)),c.add(a);return t={minX:s,minY:o,maxX:n,maxY:r},h&&(t.maxZ=i,t.minZ=u),t},e.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},e.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},e.CurvePath.prototype.createGeometry=function(t){for(var n=new e.Geometry,r=0;r<t.length;r++)n.vertices.push(new e.Vector3(t[r].x,t[r].y,t[r].z||0));return n},e.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},e.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},e.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},e.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;r=0;for(i=e.length;r<i;r++)s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o),o=t.getPoint(a),a=t.getTangent(a),a.set(-a.y,a.x).multiplyScalar(u),s.x=o.x+a.x,s.y=o.y+a.y;return e},e.Gyroscope=function(){e.Object3D.call(this)},e.Gyroscope.prototype=Object.create(e.Object3D.prototype),e.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},e.Gyroscope.prototype.translationWorld=new e.Vector3,e.Gyroscope.prototype.translationObject=new e.Vector3,e.Gyroscope.prototype.quaternionWorld=new e.Quaternion,e.Gyroscope.prototype.quaternionObject=new e.Quaternion,e.Gyroscope.prototype.scaleWorld=new e.Vector3,e.Gyroscope.prototype.scaleObject=new e.Vector3,e.Path=function(t){e.CurvePath.call(this),this.actions=[],t&&this.fromPoints(t)},e.Path.prototype=Object.create(e.CurvePath.prototype),e.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},e.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},e.Path.prototype.moveTo=function(t,n){var r=Array.prototype.slice.call(arguments);this.actions.push({action:e.PathActions.MOVE_TO,args:r})},e.Path.prototype.lineTo=function(t,n){var r=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=new e.LineCurve(new e.Vector2(i[i.length-2],i[i.length-1]),new e.Vector2(t,n));this.curves.push(i),this.actions.push({action:e.PathActions.LINE_TO,args:r})},e.Path.prototype.quadraticCurveTo=function(t,n,r,i){var s=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,o=new e.QuadraticBezierCurve(new e.Vector2(o[o.length-2],o[o.length-1]),new e.Vector2(t,n),new e.Vector2(r,i));this.curves.push(o),this.actions.push({action:e.PathActions.QUADRATIC_CURVE_TO,args:s})},e.Path.prototype.bezierCurveTo=function(t,n,r,i,s,o){var u=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,a=new e.CubicBezierCurve(new e.Vector2(a[a.length-2],a[a.length-1]),new e.Vector2(t,n),new e.Vector2(r,i),new e.Vector2(s,o));this.curves.push(a),this.actions.push({action:e.PathActions.BEZIER_CURVE_TO,args:u})},e.Path.prototype.splineThru=function(t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=[new e.Vector2(r[r.length-2],r[r.length-1])];Array.prototype.push.apply(r,t),r=new e.SplineCurve(r),this.curves.push(r),this.actions.push({action:e.PathActions.CSPLINE_THRU,args:n})},e.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args;this.absarc(e+o[o.length-2],t+o[o.length-1],n,r,i,s)},e.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)},e.Path.prototype.ellipse=function(e,t,n,r,i,s,o){var u=this.actions[this.actions.length-1].args;this.absellipse(e+u[u.length-2],t+u[u.length-1],n,r,i,s,o)},e.Path.prototype.absellipse=function(t,n,r,i,s,o,u){var a=Array.prototype.slice.call(arguments),f=new e.EllipseCurve(t,n,r,i,s,o,u);this.curves.push(f),f=f.getPoint(1),a.push(f.x),a.push(f.y),this.actions.push({action:e.PathActions.ELLIPSE,args:a})},e.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var n=[],r=0;r<e;r++)n.push(this.getPoint(r/e));return n},e.Path.prototype.getPoints=function(t,n){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(t,n);t=t||12;var r=[],i,s,o,u,a,f,l,c,h,p,d,v,m;i=0;for(s=this.actions.length;i<s;i++)switch(o=this.actions[i],u=o.action,o=o.args,u){case e.PathActions.MOVE_TO:r.push(new e.Vector2(o[0],o[1]));break;case e.PathActions.LINE_TO:r.push(new e.Vector2(o[0],o[1]));break;case e.PathActions.QUADRATIC_CURVE_TO:a=o[2],f=o[3],h=o[0],p=o[1],0<r.length?(u=r[r.length-1],d=u.x,v=u.y):(u=this.actions[i-1].args,d=u[u.length-2],v=u[u.length-1]);for(o=1;o<=t;o++)m=o/t,u=e.Shape.Utils.b2(m,d,h,a),m=e.Shape.Utils.b2(m,v,p,f),r.push(new e.Vector2(u,m));break;case e.PathActions.BEZIER_CURVE_TO:a=o[4],f=o[5],h=o[0],p=o[1],l=o[2],c=o[3],0<r.length?(u=r[r.length-1],d=u.x,v=u.y):(u=this.actions[i-1].args,d=u[u.length-2],v=u[u.length-1]);for(o=1;o<=t;o++)m=o/t,u=e.Shape.Utils.b3(m,d,h,l,a),m=e.Shape.Utils.b3(m,v,p,c,f),r.push(new e.Vector2(u,m));break;case e.PathActions.CSPLINE_THRU:u=this.actions[i-1].args,m=[new e.Vector2(u[u.length-2],u[u.length-1])],u=t*o[0].length,m=m.concat(o[0]),m=new e.SplineCurve(m);for(o=1;o<=u;o++)r.push(m.getPointAt(o/u));break;case e.PathActions.ARC:a=o[0],f=o[1],p=o[2],l=o[3],u=o[4],h=!!o[5],d=u-l,v=2*t;for(o=1;o<=v;o++)m=o/v,h||(m=1-m),m=l+m*d,u=a+p*Math.cos(m),m=f+p*Math.sin(m),r.push(new e.Vector2(u,m));break;case e.PathActions.ELLIPSE:for(a=o[0],f=o[1],p=o[2],c=o[3],l=o[4],u=o[5],h=!!o[6],d=u-l,v=2*t,o=1;o<=v;o++)m=o/v,h||(m=1-m),m=l+m*d,u=a+p*Math.cos(m),m=f+c*Math.sin(m),r.push(new e.Vector2(u,m))}return i=r[r.length-1],1e-10>Math.abs(i.x-r[0].x)&&1e-10>Math.abs(i.y-r[0].y)&&r.splice(r.length-1,1),n&&r.push(r[0]),r},e.Path.prototype.toShapes=function(t,n){function r(t){for(var n=[],r=0,i=t.length;r<i;r++){var s=t[r],o=new e.Shape;o.actions=s.actions,o.curves=s.curves,n.push(o)}return n}function i(e,t){for(var n=t.length,r=!1,i=n-1,s=0;s<n;i=s++){var o=t[i],u=t[s],a=u.x-o.x,f=u.y-o.y;if(1e-10<Math.abs(f)){if(0>f&&(o=t[s],a=-a,u=t[i],f=-f),!(e.y<o.y||e.y>u.y))if(e.y==o.y){if(e.x==o.x)return!0}else{i=f*(e.x-o.x)-a*(e.y-o.y);if(0==i)return!0;0>i||(r=!r)}}else if(e.y==o.y&&(u.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=u.x))return!0}return r}var s=function(t){var n,r,i,s,o=[],u=new e.Path;n=0;for(r=t.length;n<r;n++)i=t[n],s=i.args,i=i.action,i==e.PathActions.MOVE_TO&&0!=u.actions.length&&(o.push(u),u=new e.Path),u[i].apply(u,s);return 0!=u.actions.length&&o.push(u),o}(this.actions);if(0==s.length)return[];if(!0===n)return r(s);var o,u,a,f=[];if(1==s.length)return u=s[0],a=new e.Shape,a.actions=u.actions,a.curves=u.curves,f.push(a),f;var l=!e.Shape.Utils.isClockWise(s[0].getPoints()),l=t?!l:l;a=[];var c=[],h=[],p=0,d;c[p]=void 0,h[p]=[];var v,m;v=0;for(m=s.length;v<m;v++)u=s[v],d=u.getPoints(),o=e.Shape.Utils.isClockWise(d),(o=t?!o:o)?(!l&&c[p]&&p++,c[p]={s:new e.Shape,p:d},c[p].s.actions=u.actions,c[p].s.curves=u.curves,l&&p++,h[p]=[]):h[p].push({h:u,p:d[0]});if(!c[0])return r(s);if(1<c.length){v=!1,m=[],u=0;for(s=c.length;u<s;u++)a[u]=[];u=0;for(s=c.length;u<s;u++)for(o=h[u],l=0;l<o.length;l++){p=o[l],d=!0;for(var g=0;g<c.length;g++)i(p.p,c[g].p)&&(u!=g&&m.push({froms:u,tos:g,hole:l}),d?(d=!1,a[g].push(p)):v=!0);d&&a[u].push(p)}0<m.length&&(v||(h=a))}v=0;for(m=c.length;v<m;v++)for(a=c[v].s,f.push(a),u=h[v],s=0,o=u.length;s<o;s++)a.holes.push(u[s].h);return f},e.Shape=function(){e.Path.apply(this,arguments),this.holes=[]},e.Shape.prototype=Object.create(e.Path.prototype),e.Shape.prototype.extrude=function(t){return new e.ExtrudeGeometry(this,t)},e.Shape.prototype.makeGeometry=function(t){return new e.ShapeGeometry(this,t)},e.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},e.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},e.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},e.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},e.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},e.Shape.Utils={triangulateShape:function(t,n){function r(e,t,n){return e.x!=t.x?e.x<t.x?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:e.y<t.y?e.y<=n.y&&n.y<=t.y:t.y<=n.y&&n.y<=e.y}function i(e,t,n,i,s){var o=t.x-e.x,u=t.y-e.y,a=i.x-n.x,f=i.y-n.y,l=e.x-n.x,c=e.y-n.y,h=u*a-o*f,p=u*l-o*c;if(1e-10<Math.abs(h)){if(0<h){if(0>p||p>h)return[];a=f*l-a*c;if(0>a||a>h)return[]}else{if(0<p||p<h)return[];a=f*l-a*c;if(0<a||a<h)return[]}return 0==a?!s||0!=p&&p!=h?[e]:[]:a==h?!s||0!=p&&p!=h?[t]:[]:0==p?[n]:p==h?[i]:(s=a/h,[{x:e.x+s*o,y:e.y+s*u}])}return 0!=p||f*l!=a*c?[]:(u=0==o&&0==u,a=0==a&&0==f,u&&a?e.x!=n.x||e.y!=n.y?[]:[e]:u?r(n,i,e)?[e]:[]:a?r(e,t,n)?[n]:[]:(0!=o?(e.x<t.x?(o=e,a=e.x,u=t,e=t.x):(o=t,a=t.x,u=e,e=e.x),n.x<i.x?(t=n,h=n.x,f=i,n=i.x):(t=i,h=i.x,f=n,n=n.x)):(e.y<t.y?(o=e,a=e.y,u=t,e=t.y):(o=t,a=t.y,u=e,e=e.y),n.y<i.y?(t=n,h=n.y,f=i,n=i.y):(t=i,h=i.y,f=n,n=n.y)),a<=h?e<h?[]:e==h?s?[]:[t]:e<=n?[t,u]:[t,f]:a>n?[]:a==n?s?[]:[o]:e<=n?[o,u]:[o,f]))}function s(e,t,n,r){var i=t.x-e.x,s=t.y-e.y;t=n.x-e.x,n=n.y-e.y;var o=r.x-e.x;return r=r.y-e.y,e=i*n-s*t,i=i*r-s*o,1e-10<Math.abs(e)?(t=o*n-r*t,0<e?0<=i&&0<=t:0<=i||0<=t):0<i}var o,u,a,f,l,c={};a=t.concat(),o=0;for(u=n.length;o<u;o++)Array.prototype.push.apply(a,n[o]);o=0;for(u=a.length;o<u;o++)l=a[o].x+":"+a[o].y,void 0!==c[l]&&console.log("Duplicate point",l),c[l]=o;o=function(e,t){function n(e,t){var n=u.length-1,r=e-1;0>r&&(r=n);var i=e+1;return i>n&&(i=0),n=s(u[e],u[r],u[i],a[t]),n?(n=a.length-1,r=t-1,0>r&&(r=n),i=t+1,i>n&&(i=0),(n=s(a[t],a[r],a[i],u[e]))?!0:!1):!1}function r(e,t){var n,r;for(n=0;n<u.length;n++)if(r=n+1,r%=u.length,r=i(e,t,u[n],u[r],!0),0<r.length)return!0;return!1}function o(e,n){var r,s,o,u;for(r=0;r<f.length;r++)for(s=t[f[r]],o=0;o<s.length;o++)if(u=o+1,u%=s.length,u=i(e,n,s[o],s[u],!0),0<u.length)return!0;return!1}var u=e.concat(),a,f=[],l,c,h,p,v,m=[],g,y,b,w=0;for(l=t.length;w<l;w++)f.push(w);g=0;for(var E=2*f.length;0<f.length;){E--;if(0>E){console.log("Infinite Loop! Holes left:"+f.length+", Probably Hole outside Shape!");break}for(c=g;c<u.length;c++){h=u[c],l=-1;for(w=0;w<f.length;w++)if(p=f[w],v=h.x+":"+h.y+":"+p,void 0===m[v]){a=t[p];for(y=0;y<a.length;y++)if(p=a[y],n(c,y)&&!r(h,p)&&!o(h,p)){l=y,f.splice(w,1),g=u.slice(0,c+1),p=u.slice(c),y=a.slice(l),b=a.slice(0,l+1),u=g.concat(y).concat(b).concat(p),g=c;break}if(0<=l)break;m[v]=!0}if(0<=l)break}}return u}(t,n);var h=e.FontUtils.Triangulate(o,!1);o=0;for(u=h.length;o<u;o++)for(f=h[o],a=0;3>a;a++)l=f[a].x+":"+f[a].y,l=c[l],void 0!==l&&(f[a]=l);return h.concat()},isClockWise:function(t){return 0>e.FontUtils.Triangulate.area(t)},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},e.LineCurve=function(e,t){this.v1=e,this.v2=t},e.LineCurve.prototype=Object.create(e.Curve.prototype),e.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},e.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},e.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},e.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},e.QuadraticBezierCurve.prototype=Object.create(e.Curve.prototype),e.QuadraticBezierCurve.prototype.getPoint=function(t){var n;return n=e.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),t=e.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),new e.Vector2(n,t)},e.QuadraticBezierCurve.prototype.getTangent=function(t){var n;return n=e.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x),t=e.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y),n=new e.Vector2(n,t),n.normalize(),n},e.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},e.CubicBezierCurve.prototype=Object.create(e.Curve.prototype),e.CubicBezierCurve.prototype.getPoint=function(t){var n;return n=e.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=e.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new e.Vector2(n,t)},e.CubicBezierCurve.prototype.getTangent=function(t){var n;return n=e.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),t=e.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),n=new e.Vector2(n,t),n.normalize(),n},e.SplineCurve=function(e){this.points=void 0==e?[]:e},e.SplineCurve.prototype=Object.create(e.Curve.prototype),e.SplineCurve.prototype.getPoint=function(t){var n=new e.Vector2,r=[],i=this.points,s;return s=(i.length-1)*t,t=Math.floor(s),s-=t,r[0]=0==t?t:t-1,r[1]=t,r[2]=t>i.length-2?i.length-1:t+1,r[3]=t>i.length-3?i.length-1:t+2,n.x=e.Curve.Utils.interpolate(i[r[0]].x,i[r[1]].x,i[r[2]].x,i[r[3]].x,s),n.y=e.Curve.Utils.interpolate(i[r[0]].y,i[r[1]].y,i[r[2]].y,i[r[3]].y,s),n},e.EllipseCurve=function(e,t,n,r,i,s,o){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o},e.EllipseCurve.prototype=Object.create(e.Curve.prototype),e.EllipseCurve.prototype.getPoint=function(t){var n;return n=this.aEndAngle-this.aStartAngle,0>n&&(n+=2*Math.PI),n>2*Math.PI&&(n-=2*Math.PI),n=!0===this.aClockwise?this.aEndAngle+(1-t)*(2*Math.PI-n):this.aStartAngle+t*n,t=this.aX+this.xRadius*Math.cos(n),n=this.aY+this.yRadius*Math.sin(n),new e.Vector2(t,n)},e.ArcCurve=function(t,n,r,i,s,o){e.EllipseCurve.call(this,t,n,r,r,i,s,o)},e.ArcCurve.prototype=Object.create(e.EllipseCurve.prototype),e.LineCurve3=e.Curve.create(function(e,t){this.v1=e,this.v2=t},function(t){var n=new e.Vector3;return n.subVectors(this.v2,this.v1),n.multiplyScalar(t),n.add(this.v1),n}),e.QuadraticBezierCurve3=e.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(t){var n,r;return n=e.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x),r=e.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y),t=e.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z),new e.Vector3(n,r,t)}),e.CubicBezierCurve3=e.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(t){var n,r;return n=e.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x),r=e.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=e.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new e.Vector3(n,r,t)}),e.SplineCurve3=e.Curve.create(function(e){this.points=void 0==e?[]:e},function(t){var n=new e.Vector3,r=[],i=this.points,s;t*=i.length-1,s=Math.floor(t),t-=s,r[0]=0==s?s:s-1,r[1]=s,r[2]=s>i.length-2?i.length-1:s+1,r[3]=s>i.length-3?i.length-1:s+2,s=i[r[0]];var o=i[r[1]],u=i[r[2]],r=i[r[3]];return n.x=e.Curve.Utils.interpolate(s.x,o.x,u.x,r.x,t),n.y=e.Curve.Utils.interpolate(s.y,o.y,u.y,r.y,t),n.z=e.Curve.Utils.interpolate(s.z,o.z,u.z,r.z,t),n}),e.ClosedSplineCurve3=e.Curve.create(function(e){this.points=void 0==e?[]:e},function(t){var n=new e.Vector3,r=[],i=this.points,s;return s=(i.length-0)*t,t=Math.floor(s),s-=t,t+=0<t?0:(Math.floor(Math.abs(t)/i.length)+1)*i.length,r[0]=(t-1)%i.length,r[1]=t%i.length,r[2]=(t+1)%i.length,r[3]=(t+2)%i.length,n.x=e.Curve.Utils.interpolate(i[r[0]].x,i[r[1]].x,i[r[2]].x,i[r[3]].x,s),n.y=e.Curve.Utils.interpolate(i[r[0]].y,i[r[1]].y,i[r[2]].y,i[r[3]].y,s),n.z=e.Curve.Utils.interpolate(i[r[0]].z,i[r[1]].z,i[r[2]].z,i[r[3]].z,s),n}),e.AnimationHandler=function(){var t=[],n={},r={update:function(e){for(var n=0;n<t.length;n++)t[n].update(e)},addToUpdate:function(e){-1===t.indexOf(e)&&t.push(e)},removeFromUpdate:function(e){e=t.indexOf(e),-1!==e&&t.splice(e,1)},add:function(t){void 0!==n[t.name]&&console.log("THREE.AnimationHandler.add: Warning! "+t.name+" already exists in library. Overwriting."),n[t.name]=t;if(!0!==t.initialized){for(var r=0;r<t.hierarchy.length;r++){for(var i=0;i<t.hierarchy[r].keys.length;i++)if(0>t.hierarchy[r].keys[i].time&&(t.hierarchy[r].keys[i].time=0),void 0!==t.hierarchy[r].keys[i].rot&&!(t.hierarchy[r].keys[i].rot instanceof e.Quaternion)){var s=t.hierarchy[r].keys[i].rot;t.hierarchy[r].keys[i].rot=(new e.Quaternion).fromArray(s)}if(t.hierarchy[r].keys.length&&void 0!==t.hierarchy[r].keys[0].morphTargets){s={};for(i=0;i<t.hierarchy[r].keys.length;i++)for(var o=0;o<t.hierarchy[r].keys[i].morphTargets.length;o++){var u=t.hierarchy[r].keys[i].morphTargets[o];s[u]=-1}t.hierarchy[r].usedMorphTargets=s;for(i=0;i<t.hierarchy[r].keys.length;i++){var a={};for(u in s){for(o=0;o<t.hierarchy[r].keys[i].morphTargets.length;o++)if(t.hierarchy[r].keys[i].morphTargets[o]===u){a[u]=t.hierarchy[r].keys[i].morphTargetsInfluences[o];break}o===t.hierarchy[r].keys[i].morphTargets.length&&(a[u]=0)}t.hierarchy[r].keys[i].morphTargetsInfluences=a}}for(i=1;i<t.hierarchy[r].keys.length;i++)t.hierarchy[r].keys[i].time===t.hierarchy[r].keys[i-1].time&&(t.hierarchy[r].keys.splice(i,1),i--);for(i=0;i<t.hierarchy[r].keys.length;i++)t.hierarchy[r].keys[i].index=i}t.initialized=!0}},remove:function(e){void 0===n[e]&&console.log("THREE.AnimationHandler.add: Warning! "+e+" doesn't exists in library. Doing nothing."),n[e]=void 0},get:function(e){if("string"==typeof e)return n[e]?n[e]:null},parse:function(t){var n=[];if(t instanceof e.SkinnedMesh)for(var r=0;r<t.skeleton.bones.length;r++)n.push(t.skeleton.bones[r]);else i(t,n);return n}},i=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)i(e.children[n],t)};return r.LINEAR=0,r.CATMULLROM=1,r.CATMULLROM_FORWARD=2,r}(),e.Animation=function(t,n){this.root=t,this.data=e.AnimationHandler.get(n),this.hierarchy=e.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.weight=0,this.interpolationType=e.AnimationHandler.LINEAR},e.Animation.prototype.keyTypes=["pos","rot","scl"],e.Animation.prototype.play=function(t,n){this.currentTime=void 0!==t?t:0,this.weight=void 0!==n?n:1,this.isPlaying=!0,this.isPaused=!1,this.reset(),e.AnimationHandler.addToUpdate(this)},e.Animation.prototype.pause=function(){!0===this.isPaused?e.AnimationHandler.addToUpdate(this):e.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},e.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,e.AnimationHandler.removeFromUpdate(this)},e.Animation.prototype.reset=function(){for(var t=0,n=this.hierarchy.length;t<n;t++){var r=this.hierarchy[t];r.matrixAutoUpdate=!0,void 0===r.animationCache&&(r.animationCache={}),void 0===r.animationCache[this.data.name]&&(r.animationCache[this.data.name]={},r.animationCache[this.data.name].prevKey={pos:0,rot:0,scl:0},r.animationCache[this.data.name].nextKey={pos:0,rot:0,scl:0},r.animationCache[this.data.name].originalMatrix=r instanceof e.Bone?r.skinMatrix:r.matrix);for(var r=r.animationCache[this.data.name],i=0;3>i;i++){for(var s=this.keyTypes[i],o=this.data.hierarchy[t].keys[0],u=this.getNextKeyWith(s,t,1);u.time<this.currentTime&&u.index>o.index;)o=u,u=this.getNextKeyWith(s,t,u.index+1);r.prevKey[s]=o,r.nextKey[s]=u}}},e.Animation.prototype.update=function(){var t=[],n=new e.Vector3,r=new e.Vector3,i=new e.Quaternion,s=function(e,t){var n=[],r=[],i,s,u,a,l,c;return i=(e.length-1)*t,s=Math.floor(i),i-=s,n[0]=0===s?s:s-1,n[1]=s,n[2]=s>e.length-2?s:s+1,n[3]=s>e.length-3?s:s+2,s=e[n[0]],a=e[n[1]],l=e[n[2]],c=e[n[3]],n=i*i,u=i*n,r[0]=o(s[0],a[0],l[0],c[0],i,n,u),r[1]=o(s[1],a[1],l[1],c[1],i,n,u),r[2]=o(s[2],a[2],l[2],c[2],i,n,u),r},o=function(e,t,n,r,i,s,o){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t};return function(o){if(!1!==this.isPlaying&&(this.currentTime+=o*this.timeScale,0!==this.weight)){var u;o=this.data.length;if(!0===this.loop&&this.currentTime>o)this.currentTime%=o,this.reset();else if(!1===this.loop&&this.currentTime>o){this.stop();return}o=0;for(var f=this.hierarchy.length;o<f;o++)for(var l=this.hierarchy[o],h=l.animationCache[this.data.name],p=0;3>p;p++){u=this.keyTypes[p];var v=h.prevKey[u],m=h.nextKey[u];if(m.time<=this.currentTime){v=this.data.hierarchy[o].keys[0];for(m=this.getNextKeyWith(u,o,1);m.time<this.currentTime&&m.index>v.index;)v=m,m=this.getNextKeyWith(u,o,m.index+1);h.prevKey[u]=v,h.nextKey[u]=m}l.matrixAutoUpdate=!0,l.matrixWorldNeedsUpdate=!0;var g=(this.currentTime-v.time)/(m.time-v.time),y=v[u],w=m[u];0>g&&(g=0),1<g&&(g=1);if("pos"===u){if(u=l.position,this.interpolationType===e.AnimationHandler.LINEAR)r.x=y[0]+(w[0]-y[0])*g,r.y=y[1]+(w[1]-y[1])*g,r.z=y[2]+(w[2]-y[2])*g,l instanceof e.Bone&&(v=this.weight/(this.weight+l.accumulatedPosWeight),u.lerp(r,v),l.accumulatedPosWeight+=this.weight);else if(this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD)t[0]=this.getPrevKeyWith("pos",o,v.index-1).pos,t[1]=y,t[2]=w,t[3]=this.getNextKeyWith("pos",o,m.index+1).pos,g=.33*g+.33,m=s(t,g),l instanceof e.Bone?(v=this.weight/(this.weight+l.accumulatedPosWeight),l.accumulatedPosWeight+=this.weight):v=1,u.x+=(m[0]-u.x)*v,u.y+=(m[1]-u.y)*v,u.z+=(m[2]-u.z)*v,this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD&&(g=s(t,1.01*g),n.set(g[0],g[1],g[2]),n.sub(u),n.y=0,n.normalize(),u=Math.atan2(n.x,n.z),l.rotation.set(0,u,0))}else"rot"===u?(e.Quaternion.slerp(y,w,i,g),l instanceof e.Bone?0===l.accumulatedRotWeight?(l.quaternion.copy(i),l.accumulatedRotWeight=this.weight):(v=this.weight/(this.weight+l.accumulatedRotWeight),e.Quaternion.slerp(l.quaternion,i,l.quaternion,v),l.accumulatedRotWeight+=this.weight):l.quaternion.copy(i)):"scl"===u&&(u=l.scale,r.x=y[0]+(w[0]-y[0])*g,r.y=y[1]+(w[1]-y[1])*g,r.z=y[2]+(w[2]-y[2])*g,l instanceof e.Bone&&(v=this.weight/(this.weight+l.accumulatedSclWeight),u.lerp(r,v),l.accumulatedSclWeight+=this.weight))}return!0}}}(),e.Animation.prototype.getNextKeyWith=function(t,n,r){var i=this.data.hierarchy[n].keys;for(r=this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD?r<i.length-1?r:i.length-1:r%i.length;r<i.length;r++)if(void 0!==i[r][t])return i[r];return this.data.hierarchy[n].keys[0]},e.Animation.prototype.getPrevKeyWith=function(t,n,r){var i=this.data.hierarchy[n].keys;for(r=this.interpolationType===e.AnimationHandler.CATMULLROM||this.interpolationType===e.AnimationHandler.CATMULLROM_FORWARD?0<r?r:0:0<=r?r:r+i.length;0<=r;r--)if(void 0!==i[r][t])return i[r];return this.data.hierarchy[n].keys[i.length-1]},e.KeyFrameAnimation=function(t,n){this.root=t,this.data=e.AnimationHandler.get(n),this.hierarchy=e.AnimationHandler.parse(t),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0;for(var r=0,i=this.hierarchy.length;r<i;r++){var s=this.data.hierarchy[r].sids,o=this.hierarchy[r];if(this.data.hierarchy[r].keys.length&&s){for(var u=0;u<s.length;u++){var a=s[u],f=this.getNextKeyWith(a,r,0);f&&f.apply(a)}o.matrixAutoUpdate=!1,this.data.hierarchy[r].node.updateMatrix(),o.matrixWorldNeedsUpdate=!0}}},e.KeyFrameAnimation.prototype.play=function(t){this.currentTime=void 0!==t?t:0;if(!1===this.isPlaying){this.isPlaying=!0;var n=this.hierarchy.length,r,i;for(t=0;t<n;t++)r=this.hierarchy[t],i=this.data.hierarchy[t],void 0===i.animationCache&&(i.animationCache={},i.animationCache.prevKey=null,i.animationCache.nextKey=null,i.animationCache.originalMatrix=r instanceof e.Bone?r.skinMatrix:r.matrix),r=this.data.hierarchy[t].keys,r.length&&(i.animationCache.prevKey=r[0],i.animationCache.nextKey=r[1],this.startTime=Math.min(r[0].time,this.startTime),this.endTime=Math.max(r[r.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,e.AnimationHandler.addToUpdate(this)},e.KeyFrameAnimation.prototype.pause=function(){this.isPaused?e.AnimationHandler.addToUpdate(this):e.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},e.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,e.AnimationHandler.removeFromUpdate(this);for(var t=0;t<this.data.hierarchy.length;t++){var n=this.hierarchy[t],r=this.data.hierarchy[t];if(void 0!==r.animationCache){var i=r.animationCache.originalMatrix;n instanceof e.Bone?(i.copy(n.skinMatrix),n.skinMatrix=i):(i.copy(n.matrix),n.matrix=i),delete r.animationCache}}},e.KeyFrameAnimation.prototype.update=function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale,e=this.data.length,!0===this.loop&&this.currentTime>e&&(this.currentTime%=e),this.currentTime=Math.min(this.currentTime,e),e=0;for(var t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e],r=this.data.hierarchy[e],i=r.keys,r=r.animationCache;if(i.length){var s=r.prevKey,o=r.nextKey;if(o.time<=this.currentTime){for(;o.time<this.currentTime&&o.index>s.index;)s=o,o=i[s.index+1];r.prevKey=s,r.nextKey=o}o.time>=this.currentTime?s.interpolate(o,this.currentTime):s.interpolate(o,o.time),this.data.hierarchy[e].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}}},e.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n%=t.length;n<t.length;n++)if(t[n].hasTarget(e))return t[n];return t[0]},e.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n=0<=n?n:n+t.length;0<=n;n--)if(t[n].hasTarget(e))return t[n];return t[t.length-1]},e.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},e.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var e=0,t=0;return function(n){if(!1!==this.isPlaying){this.currentTime+=n,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration),n=this.duration/this.frames;var r=Math.floor(this.currentTime/n);r!=t&&(this.mesh.morphTargetInfluences[e]=0,this.mesh.morphTargetInfluences[t]=1,this.mesh.morphTargetInfluences[r]=0,e=t,t=r),this.mesh.morphTargetInfluences[r]=this.currentTime%n/n,this.mesh.morphTargetInfluences[e]=1-this.mesh.morphTargetInfluences[r]}}}()},e.CubeCamera=function(t,n,r){e.Object3D.call(this);var i=new e.PerspectiveCamera(90,1,t,n);i.up.set(0,-1,0),i.lookAt(new e.Vector3(1,0,0)),this.add(i);var s=new e.PerspectiveCamera(90,1,t,n);s.up.set(0,-1,0),s.lookAt(new e.Vector3(-1,0,0)),this.add(s);var o=new e.PerspectiveCamera(90,1,t,n);o.up.set(0,0,1),o.lookAt(new e.Vector3(0,1,0)),this.add(o);var u=new e.PerspectiveCamera(90,1,t,n);u.up.set(0,0,-1),u.lookAt(new e.Vector3(0,-1,0)),this.add(u);var a=new e.PerspectiveCamera(90,1,t,n);a.up.set(0,-1,0),a.lookAt(new e.Vector3(0,0,1)),this.add(a);var f=new e.PerspectiveCamera(90,1,t,n);f.up.set(0,-1,0),f.lookAt(new e.Vector3(0,0,-1)),this.add(f),this.renderTarget=new e.WebGLRenderTargetCube(r,r,{format:e.RGBFormat,magFilter:e.LinearFilter,minFilter:e.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,r=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,i,n),n.activeCubeFace=1,e.render(t,s,n),n.activeCubeFace=2,e.render(t,o,n),n.activeCubeFace=3,e.render(t,u,n),n.activeCubeFace=4,e.render(t,a,n),n.generateMipmaps=r,n.activeCubeFace=5,e.render(t,f,n)}},e.CubeCamera.prototype=Object.create(e.Object3D.prototype),e.CombinedCamera=function(t,n,r,i,s,o,u){e.Camera.call(this),this.fov=r,this.left=-t/2,this.right=t/2,this.top=n/2,this.bottom=-n/2,this.cameraO=new e.OrthographicCamera(t/-2,t/2,n/2,n/-2,o,u),this.cameraP=new e.PerspectiveCamera(r,t/n,i,s),this.zoom=1,this.toPerspective()},e.CombinedCamera.prototype=Object.create(e.Camera.prototype),e.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},e.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},e.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},e.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},e.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},e.CombinedCamera.prototype.setLens=function(t,n){void 0===n&&(n=24);var r=2*e.Math.radToDeg(Math.atan(n/(2*t)));return this.setFov(r),r},e.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},e.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},e.BoxGeometry=function(t,n,r,i,s,o){function u(t,n,r,i,s,o,u,f){var l,c=a.widthSegments,p=a.heightSegments,d=s/2,v=o/2,m=a.vertices.length;if("x"===t&&"y"===n||"y"===t&&"x"===n)l="z";else if("x"===t&&"z"===n||"z"===t&&"x"===n)l="y",p=a.depthSegments;else if("z"===t&&"y"===n||"y"===t&&"z"===n)l="x",c=a.depthSegments;var g=c+1,y=p+1,b=s/c,w=o/p,E=new e.Vector3;E[l]=0<u?1:-1;for(s=0;s<y;s++)for(o=0;o<g;o++){var S=new e.Vector3;S[t]=(o*b-d)*r,S[n]=(s*w-v)*i,S[l]=u,a.vertices.push(S)}for(s=0;s<p;s++)for(o=0;o<c;o++)v=o+g*s,t=o+g*(s+1),n=o+1+g*(s+1),r=o+1+g*s,i=new e.Vector2(o/c,1-s/p),u=new e.Vector2(o/c,1-(s+1)/p),l=new e.Vector2((o+1)/c,1-(s+1)/p),d=new e.Vector2((o+1)/c,1-s/p),v=new e.Face3(v+m,t+m,r+m),v.normal.copy(E),v.vertexNormals.push(E.clone(),E.clone(),E.clone()),v.materialIndex=f,a.faces.push(v),a.faceVertexUvs[0].push([i,u,d]),v=new e.Face3(t+m,n+m,r+m),v.normal.copy(E),v.vertexNormals.push(E.clone(),E.clone(),E.clone()),v.materialIndex=f,a.faces.push(v),a.faceVertexUvs[0].push([u.clone(),l,d.clone()])}e.Geometry.call(this),this.parameters={width:t,height:n,depth:r,widthSegments:i,heightSegments:s,depthSegments:o},this.widthSegments=i||1,this.heightSegments=s||1,this.depthSegments=o||1;var a=this;i=t/2,s=n/2,o=r/2,u("z","y",-1,-1,r,n,i,0),u("z","y",1,-1,r,n,-i,1),u("x","z",1,1,t,r,s,2),u("x","z",1,-1,t,r,-s,3),u("x","y",1,-1,t,n,o,4),u("x","y",-1,-1,t,n,-o,5),this.mergeVertices()},e.BoxGeometry.prototype=Object.create(e.Geometry.prototype),e.CircleGeometry=function(t,n,r,i){e.Geometry.call(this),this.parameters={radius:t,segments:n,thetaStart:r,thetaLength:i},t=t||50,n=void 0!==n?Math.max(3,n):8,r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI;var s,o=[];s=new e.Vector3;var u=new e.Vector2(.5,.5);this.vertices.push(s),o.push(u);for(s=0;s<=n;s++){var a=new e.Vector3,f=r+s/n*i;a.x=t*Math.cos(f),a.y=t*Math.sin(f),this.vertices.push(a),o.push(new e.Vector2((a.x/t+1)/2,(a.y/t+1)/2))}r=new e.Vector3(0,0,1);for(s=1;s<=n;s++)this.faces.push(new e.Face3(s,s+1,0,[r.clone(),r.clone(),r.clone()])),this.faceVertexUvs[0].push([o[s].clone(),o[s+1].clone(),u.clone()]);this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,t)},e.CircleGeometry.prototype=Object.create(e.Geometry.prototype),e.CubeGeometry=function(t,n,r,i,s,o){return console.warn("DEPRECATED: THREE.CubeGeometry is deprecated. Use THREE.BoxGeometry instead."),new e.BoxGeometry(t,n,r,i,s,o)},e.CylinderGeometry=function(t,n,r,i,s,o){e.Geometry.call(this),this.parameters={radiusTop:t,radiusBottom:n,height:r,radialSegments:i,heightSegments:s,openEnded:o},t=void 0!==t?t:20,n=void 0!==n?n:20,r=void 0!==r?r:100,i=i||8,s=s||1,o=void 0!==o?o:!1;var u=r/2,a,f,l=[],c=[];for(f=0;f<=s;f++){var h=[],p=[],d=f/s,v=d*(n-t)+t;for(a=0;a<=i;a++){var m=a/i,g=new e.Vector3;g.x=v*Math.sin(m*Math.PI*2),g.y=-d*r+u,g.z=v*Math.cos(m*Math.PI*2),this.vertices.push(g),h.push(this.vertices.length-1),p.push(new e.Vector2(m,1-d))}l.push(h),c.push(p)}r=(n-t)/r;for(a=0;a<i;a++)for(0!==t?(h=this.vertices[l[0][a]].clone(),p=this.vertices[l[0][a+1]].clone()):(h=this.vertices[l[1][a]].clone(),p=this.vertices[l[1][a+1]].clone()),h.setY(Math.sqrt(h.x*h.x+h.z*h.z)*r).normalize(),p.setY(Math.sqrt(p.x*p.x+p.z*p.z)*r).normalize(),f=0;f<s;f++){var d=l[f][a],v=l[f+1][a],m=l[f+1][a+1],g=l[f][a+1],y=h.clone(),b=h.clone(),w=p.clone(),E=p.clone(),S=c[f][a].clone(),x=c[f+1][a].clone(),T=c[f+1][a+1].clone(),N=c[f][a+1].clone();this.faces.push(new e.Face3(d,v,g,[y,b,E])),this.faceVertexUvs[0].push([S,x,N]),this.faces.push(new e.Face3(v,m,g,[b.clone(),w,E.clone()])),this.faceVertexUvs[0].push([x.clone(),T,N.clone()])}if(!1===o&&0<t)for(this.vertices.push(new e.Vector3(0,u,0)),a=0;a<i;a++)d=l[0][a],v=l[0][a+1],m=this.vertices.length-1,y=new e.Vector3(0,1,0),b=new e.Vector3(0,1,0),w=new e.Vector3(0,1,0),S=c[0][a].clone(),x=c[0][a+1].clone(),T=new e.Vector2(x.x,0),this.faces.push(new e.Face3(d,v,m,[y,b,w])),this.faceVertexUvs[0].push([S,x,T]);if(!1===o&&0<n)for(this.vertices.push(new e.Vector3(0,-u,0)),a=0;a<i;a++)d=l[f][a+1],v=l[f][a],m=this.vertices.length-1,y=new e.Vector3(0,-1,0),b=new e.Vector3(0,-1,0),w=new e.Vector3(0,-1,0),S=c[f][a+1].clone(),x=c[f][a].clone(),T=new e.Vector2(x.x,1),this.faces.push(new e.Face3(d,v,m,[y,b,w])),this.faceVertexUvs[0].push([S,x,T]);this.computeFaceNormals()},e.CylinderGeometry.prototype=Object.create(e.Geometry.prototype),e.ExtrudeGeometry=function(t,n){"undefined"!=typeof t&&(e.Geometry.call(this),t=t instanceof Array?t:[t],this.shapebb=t[t.length-1].getBoundingBox(),this.addShapeList(t,n),this.computeFaceNormals())},e.ExtrudeGeometry.prototype=Object.create(e.Geometry.prototype),e.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,r=0;r<n;r++)this.addShape(e[r],t)},e.ExtrudeGeometry.prototype.addShape=function(t,n){function r(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).add(e)}function i(t,n,r){var i=e.Math.sign,s=1,s=t.x-n.x,o=t.y-n.y,u=r.x-t.x,a=r.y-t.y,f=s*s+o*o;if(1e-10<Math.abs(s*a-o*u)){var l=Math.sqrt(f),i=Math.sqrt(u*u+a*a),f=n.x-o/l;n=n.y+s/l,u=((r.x-a/i-f)*a-(r.y+u/i-n)*u)/(s*a-o*u),r=f+s*u-t.x,t=n+o*u-t.y,s=r*r+t*t;if(2>=s)return new e.Vector2(r,t);s=Math.sqrt(s/2)}else t=!1,1e-10<s?1e-10<u&&(t=!0):-1e-10>s?-1e-10>u&&(t=!0):i(o)==i(a)&&(t=!0),t?(r=-o,t=s,s=Math.sqrt(f)):(r=s,t=o,s=Math.sqrt(f/2));return new e.Vector2(r/s,t/s)}function s(r,i){var s,o;for(R=r.length;0<=--R;){s=R,o=R-1,0>o&&(o=r.length-1);for(var u=0,a=d+2*c,u=0;u<a;u++){var f=F*u,l=F*(u+1),h=i+s+f,f=i+o+f,p=i+o+l,l=i+s+l,v=r,m=u,g=a,y=s,E=o,h=h+A,f=f+A,p=p+A,l=l+A;L.faces.push(new e.Face3(h,f,l,null,null,b)),L.faces.push(new e.Face3(f,p,l,null,null,b)),h=w.generateSideWallUV(L,t,v,n,h,f,p,l,m,g,y,E),L.faceVertexUvs[0].push([h[0],h[1],h[3]]),L.faceVertexUvs[0].push([h[1],h[2],h[3]])}}}function o(t,n,r){L.vertices.push(new e.Vector3(t,n,r))}function u(r,i,s,o){r+=A,i+=A,s+=A,L.faces.push(new e.Face3(r,i,s,null,null,y)),r=o?w.generateBottomUV(L,t,n,r,i,s):w.generateTopUV(L,t,n,r,i,s),L.faceVertexUvs[0].push(r)}var a=void 0!==n.amount?n.amount:100,f=void 0!==n.bevelThickness?n.bevelThickness:6,l=void 0!==n.bevelSize?n.bevelSize:f-2,c=void 0!==n.bevelSegments?n.bevelSegments:3,h=void 0!==n.bevelEnabled?n.bevelEnabled:!0,p=void 0!==n.curveSegments?n.curveSegments:12,d=void 0!==n.steps?n.steps:1,v=n.extrudePath,m,g=!1,y=n.material,b=n.extrudeMaterial,w=void 0!==n.UVGenerator?n.UVGenerator:e.ExtrudeGeometry.WorldUVGenerator,E,S,x,T;v&&(m=v.getSpacedPoints(d),g=!0,h=!1,E=void 0!==n.frames?n.frames:new e.TubeGeometry.FrenetFrames(v,d,!1),S=new e.Vector3,x=new e.Vector3,T=new e.Vector3),h||(l=f=c=0);var N,C,k,L=this,A=this.vertices.length,v=t.extractPoints(p),p=v.shape,O=v.holes;if(v=!e.Shape.Utils.isClockWise(p)){p=p.reverse(),C=0;for(k=O.length;C<k;C++)N=O[C],e.Shape.Utils.isClockWise(N)&&(O[C]=N.reverse());v=!1}var M=e.Shape.Utils.triangulateShape(p,O),_=p;C=0;for(k=O.length;C<k;C++)N=O[C],p=p.concat(N);var D,P,H,B,j,F=p.length,I,q=M.length,v=[],R=0;H=_.length,D=H-1;for(P=R+1;R<H;R++,D++,P++)D===H&&(D=0),P===H&&(P=0),v[R]=i(_[R],_[D],_[P]);var U=[],z,W=v.concat();C=0;for(k=O.length;C<k;C++){N=O[C],z=[],R=0,H=N.length,D=H-1;for(P=R+1;R<H;R++,D++,P++)D===H&&(D=0),P===H&&(P=0),z[R]=i(N[R],N[D],N[P]);U.push(z),W=W.concat(z)}for(D=0;D<c;D++){H=D/c,B=f*(1-H),P=l*Math.sin(H*Math.PI/2),R=0;for(H=_.length;R<H;R++)j=r(_[R],v[R],P),o(j.x,j.y,-B);C=0;for(k=O.length;C<k;C++)for(N=O[C],z=U[C],R=0,H=N.length;R<H;R++)j=r(N[R],z[R],P),o(j.x,j.y,-B)}P=l;for(R=0;R<F;R++)j=h?r(p[R],W[R],P):p[R],g?(x.copy(E.normals[0]).multiplyScalar(j.x),S.copy(E.binormals[0]).multiplyScalar(j.y),T.copy(m[0]).add(x).add(S),o(T.x,T.y,T.z)):o(j.x,j.y,0);for(H=1;H<=d;H++)for(R=0;R<F;R++)j=h?r(p[R],W[R],P):p[R],g?(x.copy(E.normals[H]).multiplyScalar(j.x),S.copy(E.binormals[H]).multiplyScalar(j.y),T.copy(m[H]).add(x).add(S),o(T.x,T.y,T.z)):o(j.x,j.y,a/d*H);for(D=c-1;0<=D;D--){H=D/c,B=f*(1-H),P=l*Math.sin(H*Math.PI/2),R=0;for(H=_.length;R<H;R++)j=r(_[R],v[R],P),o(j.x,j.y,a+B);C=0;for(k=O.length;C<k;C++)for(N=O[C],z=U[C],R=0,H=N.length;R<H;R++)j=r(N[R],z[R],P),g?o(j.x,j.y+m[d-1].y,m[d-1].x+B):o(j.x,j.y,a+B)}(function(){if(h){var e;e=0*F;for(R=0;R<q;R++)I=M[R],u(I[2]+e,I[1]+e,I[0]+e,!0);e=d+2*c,e*=F;for(R=0;R<q;R++)I=M[R],u(I[0]+e,I[1]+e,I[2]+e,!1)}else{for(R=0;R<q;R++)I=M[R],u(I[2],I[1],I[0],!0);for(R=0;R<q;R++)I=M[R],u(I[0]+F*d,I[1]+F*d,I[2]+F*d,!1)}})(),function(){var e=0;s(_,e),e+=_.length,C=0;for(k=O.length;C<k;C++)N=O[C],s(N,e),e+=N.length}()},e.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(t,n,r,i,s,o){return n=t.vertices[s].x,s=t.vertices[s].y,r=t.vertices[o].x,o=t.vertices[o].y,[new e.Vector2(t.vertices[i].x,t.vertices[i].y),new e.Vector2(n,s),new e.Vector2(r,o)]},generateBottomUV:function(e,t,n,r,i,s){return this.generateTopUV(e,t,n,r,i,s)},generateSideWallUV:function(t,n,r,i,s,o,u,a,f,l,c,h){n=t.vertices[s].x,r=t.vertices[s].y,s=t.vertices[s].z,i=t.vertices[o].x,f=t.vertices[o].y,o=t.vertices[o].z,l=t.vertices[u].x,c=t.vertices[u].y,u=t.vertices[u].z,h=t.vertices[a].x;var p=t.vertices[a].y;return t=t.vertices[a].z,.01>Math.abs(r-f)?[new e.Vector2(n,1-s),new e.Vector2(i,1-o),new e.Vector2(l,1-u),new e.Vector2(h,1-t)]:[new e.Vector2(r,1-s),new e.Vector2(f,1-o),new e.Vector2(c,1-u),new e.Vector2(p,1-t)]}},e.ExtrudeGeometry.__v1=new e.Vector2,e.ExtrudeGeometry.__v2=new e.Vector2,e.ExtrudeGeometry.__v3=new e.Vector2,e.ExtrudeGeometry.__v4=new e.Vector2,e.ExtrudeGeometry.__v5=new e.Vector2,e.ExtrudeGeometry.__v6=new e.Vector2,e.ShapeGeometry=function(t,n){e.Geometry.call(this),0==t instanceof Array&&(t=[t]),this.shapebb=t[t.length-1].getBoundingBox(),this.addShapeList(t,n),this.computeFaceNormals()},e.ShapeGeometry.prototype=Object.create(e.Geometry.prototype),e.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++)this.addShape(e[n],t);return this},e.ShapeGeometry.prototype.addShape=function(t,n){void 0===n&&(n={});var r=n.material,i=void 0===n.UVGenerator?e.ExtrudeGeometry.WorldUVGenerator:n.UVGenerator,s,o,u,a=this.vertices.length;s=t.extractPoints(void 0!==n.curveSegments?n.curveSegments:12);var f=s.shape,l=s.holes;if(!e.Shape.Utils.isClockWise(f))for(f=f.reverse(),s=0,o=l.length;s<o;s++)u=l[s],e.Shape.Utils.isClockWise(u)&&(l[s]=u.reverse());var c=e.Shape.Utils.triangulateShape(f,l);s=0;for(o=l.length;s<o;s++)u=l[s],f=f.concat(u);l=f.length,o=c.length;for(s=0;s<l;s++)u=f[s],this.vertices.push(new e.Vector3(u.x,u.y,0));for(s=0;s<o;s++)l=c[s],f=l[0]+a,u=l[1]+a,l=l[2]+a,this.faces.push(new e.Face3(f,u,l,null,null,r)),this.faceVertexUvs[0].push(i.generateBottomUV(this,t,n,f,u,l))},e.LatheGeometry=function(t,n,r,i){e.Geometry.call(this),n=n||12,r=r||0,i=i||2*Math.PI;for(var s=1/(t.length-1),o=1/n,u=0,a=n;u<=a;u++)for(var f=r+u*o*i,l=Math.cos(f),c=Math.sin(f),f=0,h=t.length;f<h;f++){var p=t[f],d=new e.Vector3;d.x=l*p.x-c*p.y,d.y=c*p.x+l*p.y,d.z=p.z,this.vertices.push(d)}r=t.length,u=0;for(a=n;u<a;u++)for(f=0,h=t.length-1;f<h;f++){n=c=f+r*u,i=c+r;var l=c+1+r,c=c+1,p=u*o,d=f*s,v=p+o,m=d+s;this.faces.push(new e.Face3(n,i,c)),this.faceVertexUvs[0].push([new e.Vector2(p,d),new e.Vector2(v,d),new e.Vector2(p,m)]),this.faces.push(new e.Face3(i,l,c)),this.faceVertexUvs[0].push([new e.Vector2(v,d),new e.Vector2(v,m),new e.Vector2(p,m)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},e.LatheGeometry.prototype=Object.create(e.Geometry.prototype),e.PlaneGeometry=function(t,n,r,i){e.Geometry.call(this),this.parameters={width:t,height:n,widthSegments:r,heightSegments:i};var s=t/2,o=n/2;r=r||1,i=i||1;var u=r+1,a=i+1,f=t/r,l=n/i,c=new e.Vector3(0,0,1);for(t=0;t<a;t++){var h=t*l-o;for(n=0;n<u;n++)this.vertices.push(new e.Vector3(n*f-s,-h,0))}for(t=0;t<i;t++)for(n=0;n<r;n++){var p=n+u*t,s=n+u*(t+1),o=n+1+u*(t+1),a=n+1+u*t,f=new e.Vector2(n/r,1-t/i),l=new e.Vector2(n/r,1-(t+1)/i),h=new e.Vector2((n+1)/r,1-(t+1)/i),d=new e.Vector2((n+1)/r,1-t/i),p=new e.Face3(p,s,a);p.normal.copy(c),p.vertexNormals.push(c.clone(),c.clone(),c.clone()),this.faces.push(p),this.faceVertexUvs[0].push([f,l,d]),p=new e.Face3(s,o,a),p.normal.copy(c),p.vertexNormals.push(c.clone(),c.clone(),c.clone()),this.faces.push(p),this.faceVertexUvs[0].push([l.clone(),h,d.clone()])}},e.PlaneGeometry.prototype=Object.create(e.Geometry.prototype),e.RingGeometry=function(t,n,r,i,s,o){e.Geometry.call(this),t=t||0,n=n||50,s=void 0!==s?s:0,o=void 0!==o?o:2*Math.PI,r=void 0!==r?Math.max(3,r):8,i=void 0!==i?Math.max(3,i):8;var u,a=[],f=t,l=(n-t)/i;for(t=0;t<=i;t++){for(u=0;u<=r;u++){var c=new e.Vector3,h=s+u/r*o;c.x=f*Math.cos(h),c.y=f*Math.sin(h),this.vertices.push(c),a.push(new e.Vector2((c.x/n+1)/2,(c.y/n+1)/2))}f+=l}n=new e.Vector3(0,0,1);for(t=0;t<i;t++)for(s=t*r,u=0;u<=r;u++)h=u+s,o=h+t,l=h+r+t,c=h+r+1+t,this.faces.push(new e.Face3(o,l,c,[n.clone(),n.clone(),n.clone()])),this.faceVertexUvs[0].push([a[o].clone(),a[l].clone(),a[c].clone()]),o=h+t,l=h+r+1+t,c=h+1+t,this.faces.push(new e.Face3(o,l,c,[n.clone(),n.clone(),n.clone()])),this.faceVertexUvs[0].push([a[o].clone(),a[l].clone(),a[c].clone()]);this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,f)},e.RingGeometry.prototype=Object.create(e.Geometry.prototype),e.SphereGeometry=function(t,n,r,i,s,o,u){e.Geometry.call(this),this.parameters={radius:t,widthSegments:n,heightSegments:r,phiStart:i,phiLength:s,thetaStart:o,thetaLength:u},t=t||50,n=Math.max(3,Math.floor(n)||8),r=Math.max(2,Math.floor(r)||6),i=void 0!==i?i:0,s=void 0!==s?s:2*Math.PI,o=void 0!==o?o:0,u=void 0!==u?u:Math.PI;var a,f,l=[],c=[];for(f=0;f<=r;f++){var h=[],p=[];for(a=0;a<=n;a++){var d=a/n,v=f/r,m=new e.Vector3;m.x=-t*Math.cos(i+d*s)*Math.sin(o+v*u),m.y=t*Math.cos(o+v*u),m.z=t*Math.sin(i+d*s)*Math.sin(o+v*u),this.vertices.push(m),h.push(this.vertices.length-1),p.push(new e.Vector2(d,1-v))}l.push(h),c.push(p)}for(f=0;f<r;f++)for(a=0;a<n;a++){i=l[f][a+1],s=l[f][a],o=l[f+1][a],u=l[f+1][a+1];var h=this.vertices[i].clone().normalize(),p=this.vertices[s].clone().normalize(),d=this.vertices[o].clone().normalize(),v=this.vertices[u].clone().normalize(),m=c[f][a+1].clone(),g=c[f][a].clone(),y=c[f+1][a].clone(),b=c[f+1][a+1].clone();Math.abs(this.vertices[i].y)===t?(m.x=(m.x+g.x)/2,this.faces.push(new e.Face3(i,o,u,[h,d,v])),this.faceVertexUvs[0].push([m,y,b])):Math.abs(this.vertices[o].y)===t?(y.x=(y.x+b.x)/2,this.faces.push(new e.Face3(i,s,o,[h,p,d])),this.faceVertexUvs[0].push([m,g,y])):(this.faces.push(new e.Face3(i,s,u,[h,p,v])),this.faceVertexUvs[0].push([m,g,b]),this.faces.push(new e.Face3(s,o,u,[p.clone(),d,v.clone()])),this.faceVertexUvs[0].push([g.clone(),y,b.clone()]))}this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,t)},e.SphereGeometry.prototype=Object.create(e.Geometry.prototype),e.TextGeometry=function(t,n){n=n||{};var r=e.FontUtils.generateShapes(t,n);n.amount=void 0!==n.height?n.height:50,void 0===n.bevelThickness&&(n.bevelThickness=10),void 0===n.bevelSize&&(n.bevelSize=8),void 0===n.bevelEnabled&&(n.bevelEnabled=!1),e.ExtrudeGeometry.call(this,r,n)},e.TextGeometry.prototype=Object.create(e.ExtrudeGeometry.prototype),e.TorusGeometry=function(t,n,r,i,s){e.Geometry.call(this),this.parameters={radius:t,tube:n,radialSegments:r,tubularSegments:i,arc:s},t=t||100,n=n||40,r=r||8,i=i||6,s=s||2*Math.PI;for(var o=new e.Vector3,u=[],a=[],f=0;f<=r;f++)for(var l=0;l<=i;l++){var c=l/i*s,h=f/r*Math.PI*2;o.x=t*Math.cos(c),o.y=t*Math.sin(c);var p=new e.Vector3;p.x=(t+n*Math.cos(h))*Math.cos(c),p.y=(t+n*Math.cos(h))*Math.sin(c),p.z=n*Math.sin(h),this.vertices.push(p),u.push(new e.Vector2(l/i,f/r)),a.push(p.clone().sub(o).normalize())}for(f=1;f<=r;f++)for(l=1;l<=i;l++)t=(i+1)*f+l-1,n=(i+1)*(f-1)+l-1,s=(i+1)*(f-1)+l,o=(i+1)*f+l,c=new e.Face3(t,n,o,[a[t].clone(),a[n].clone(),a[o].clone()]),this.faces.push(c),this.faceVertexUvs[0].push([u[t].clone(),u[n].clone(),u[o].clone()]),c=new e.Face3(n,s,o,[a[n].clone(),a[s].clone(),a[o].clone()]),this.faces.push(c),this.faceVertexUvs[0].push([u[n].clone(),u[s].clone(),u[o].clone()]);this.computeFaceNormals()},e.TorusGeometry.prototype=Object.create(e.Geometry.prototype),e.TorusKnotGeometry=function(t,n,r,i,s,o,u){function a(t,n,r,i,s){var o=Math.cos(t),u=Math.sin(t);return t*=n/r,n=Math.cos(t),o*=i*(2+n)*.5,u=i*(2+n)*u*.5,i=s*i*Math.sin(t)*.5,new e.Vector3(o,u,i)}e.Geometry.call(this),this.parameters={radius:t,tube:n,radialSegments:r,tubularSegments:i,p:s,q:o,heightScale:u},t=t||100,n=n||40,r=r||64,i=i||8,s=s||2,o=o||3,u=u||1;for(var f=Array(r),l=new e.Vector3,c=new e.Vector3,h=new e.Vector3,p=0;p<r;++p){f[p]=Array(i);var d=p/r*2*s*Math.PI,v=a(d,o,s,t,u),d=a(d+.01,o,s,t,u);l.subVectors(d,v),c.addVectors(d,v),h.crossVectors(l,c),c.crossVectors(h,l),h.normalize(),c.normalize();for(d=0;d<i;++d){var m=d/i*2*Math.PI,g=-n*Math.cos(m),m=n*Math.sin(m),y=new e.Vector3;y.x=v.x+g*c.x+m*h.x,y.y=v.y+g*c.y+m*h.y,y.z=v.z+g*c.z+m*h.z,f[p][d]=this.vertices.push(y)-1}}for(p=0;p<r;++p)for(d=0;d<i;++d)s=(p+1)%r,o=(d+1)%i,t=f[p][d],n=f[s][d],s=f[s][o],o=f[p][o],u=new e.Vector2(p/r,d/i),l=new e.Vector2((p+1)/r,d/i),c=new e.Vector2((p+1)/r,(d+1)/i),h=new e.Vector2(p/r,(d+1)/i),this.faces.push(new e.Face3(t,n,o)),this.faceVertexUvs[0].push([u,l,h]),this.faces.push(new e.Face3(n,s,o)),this.faceVertexUvs[0].push([l.clone(),c,h.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},e.TorusKnotGeometry.prototype=Object.create(e.Geometry.prototype),e.TubeGeometry=function(t,n,r,i,s){e.Geometry.call(this),this.parameters={path:t,segments:n,radius:r,radialSegments:i,closed:s},n=n||64,r=r||1,i=i||8,s=s||!1;var o=[],u,a,f=n+1,l,c,h,p,d=new e.Vector3,v,m,g;v=new e.TubeGeometry.FrenetFrames(t,n,s),m=v.normals,g=v.binormals,this.tangents=v.tangents,this.normals=m,this.binormals=g;for(v=0;v<f;v++)for(o[v]=[],l=v/(f-1),p=t.getPointAt(l),u=m[v],a=g[v],l=0;l<i;l++)c=l/i*2*Math.PI,h=-r*Math.cos(c),c=r*Math.sin(c),d.copy(p),d.x+=h*u.x+c*a.x,d.y+=h*u.y+c*a.y,d.z+=h*u.z+c*a.z,o[v][l]=this.vertices.push(new e.Vector3(d.x,d.y,d.z))-1;for(v=0;v<n;v++)for(l=0;l<i;l++)f=s?(v+1)%n:v+1,d=(l+1)%i,t=o[v][l],r=o[f][l],f=o[f][d],d=o[v][d],m=new e.Vector2(v/n,l/i),g=new e.Vector2((v+1)/n,l/i),u=new e.Vector2((v+1)/n,(l+1)/i),a=new e.Vector2(v/n,(l+1)/i),this.faces.push(new e.Face3(t,r,d)),this.faceVertexUvs[0].push([m,g,a]),this.faces.push(new e.Face3(r,f,d)),this.faceVertexUvs[0].push([g.clone(),u,a.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},e.TubeGeometry.prototype=Object.create(e.Geometry.prototype),e.TubeGeometry.FrenetFrames=function(t,n,r){new e.Vector3;var i=new e.Vector3;new e.Vector3;var s=[],o=[],u=[],a=new e.Vector3,f=new e.Matrix4;n+=1;var l,c,h;this.tangents=s,this.normals=o,this.binormals=u;for(l=0;l<n;l++)c=l/(n-1),s[l]=t.getTangentAt(c),s[l].normalize();o[0]=new e.Vector3,u[0]=new e.Vector3,t=Number.MAX_VALUE,l=Math.abs(s[0].x),c=Math.abs(s[0].y),h=Math.abs(s[0].z),l<=t&&(t=l,i.set(1,0,0)),c<=t&&(t=c,i.set(0,1,0)),h<=t&&i.set(0,0,1),a.crossVectors(s[0],i).normalize(),o[0].crossVectors(s[0],a),u[0].crossVectors(s[0],o[0]);for(l=1;l<n;l++)o[l]=o[l-1].clone(),u[l]=u[l-1].clone(),a.crossVectors(s[l-1],s[l]),1e-4<a.length()&&(a.normalize(),i=Math.acos(e.Math.clamp(s[l-1].dot(s[l]),-1,1)),o[l].applyMatrix4(f.makeRotationAxis(a,i))),u[l].crossVectors(s[l],o[l]);if(r)for(i=Math.acos(e.Math.clamp(o[0].dot(o[n-1]),-1,1)),i/=n-1,0<s[0].dot(a.crossVectors(o[0],o[n-1]))&&(i=-i),l=1;l<n;l++)o[l].applyMatrix4(f.makeRotationAxis(s[l],i*l)),u[l].crossVectors(s[l],o[l])},e.PolyhedronGeometry=function(t,n,r,i){function s(t){var n=t.normalize().clone();n.index=f.vertices.push(n)-1;var r=Math.atan2(t.z,-t.x)/2/Math.PI+.5;return t=Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5,n.uv=new e.Vector2(r,1-t),n}function o(t,n,r){var i=new e.Face3(t.index,n.index,r.index,[t.clone(),n.clone(),r.clone()]);f.faces.push(i),g.copy(t).add(n).add(r).divideScalar(3),i=Math.atan2(g.z,-g.x),f.faceVertexUvs[0].push([a(t.uv,t,i),a(n.uv,n,i),a(r.uv,r,i)])}function u(e,t){var n=Math.pow(2,t);Math.pow(4,t);for(var r=s(f.vertices[e.a]),i=s(f.vertices[e.b]),u=s(f.vertices[e.c]),a=[],l=0;l<=n;l++){a[l]=[];for(var c=s(r.clone().lerp(u,l/n)),h=s(i.clone().lerp(u,l/n)),p=n-l,d=0;d<=p;d++)a[l][d]=0==d&&l==n?c:s(c.clone().lerp(h,d/p))}for(l=0;l<n;l++)for(d=0;d<2*(n-l)-1;d++)r=Math.floor(d/2),0==d%2?o(a[l][r+1],a[l+1][r],a[l][r]):o(a[l][r+1],a[l+1][r+1],a[l+1][r])}function a(t,n,r){return 0>r&&1===t.x&&(t=new e.Vector2(t.x-1,t.y)),0===n.x&&0===n.z&&(t=new e.Vector2(r/2/Math.PI+.5,t.y)),t.clone()}e.Geometry.call(this),r=r||1,i=i||0;for(var f=this,l=0,c=t.length;l<c;l+=3)s(new e.Vector3(t[l],t[l+1],t[l+2]));t=this.vertices;for(var h=[],p=l=0,c=n.length;l<c;l+=3,p++){var d=t[n[l]],v=t[n[l+1]],m=t[n[l+2]];h[p]=new e.Face3(d.index,v.index,m.index,[d.clone(),v.clone(),m.clone()])}for(var g=new e.Vector3,l=0,c=h.length;l<c;l++)u(h[l],i);l=0;for(c=this.faceVertexUvs[0].length;l<c;l++)n=this.faceVertexUvs[0][l],i=n[0].x,t=n[1].x,h=n[2].x,p=Math.max(i,Math.max(t,h)),d=Math.min(i,Math.min(t,h)),.9<p&&.1>d&&(.2>i&&(n[0].x+=1),.2>t&&(n[1].x+=1),.2>h&&(n[2].x+=1));l=0;for(c=this.vertices.length;l<c;l++)this.vertices[l].multiplyScalar(r);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new e.Sphere(new e.Vector3,r)},e.PolyhedronGeometry.prototype=Object.create(e.Geometry.prototype),e.IcosahedronGeometry=function(t,n){this.parameters={radius:t,detail:n};var r=(1+Math.sqrt(5))/2;e.PolyhedronGeometry.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,n)},e.IcosahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.OctahedronGeometry=function(t,n){this.parameters={radius:t,detail:n},e.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,n)},e.OctahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.TetrahedronGeometry=function(t,n){e.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,n)},e.TetrahedronGeometry.prototype=Object.create(e.Geometry.prototype),e.ParametricGeometry=function(t,n,r){e.Geometry.call(this);var i=this.vertices,s=this.faces,o=this.faceVertexUvs[0],u,a,f,l,c=n+1;for(u=0;u<=r;u++)for(l=u/r,a=0;a<=n;a++)f=a/n,f=t(f,l),i.push(f);var h,p,d,v;for(u=0;u<r;u++)for(a=0;a<n;a++)t=u*c+a,i=u*c+a+1,l=(u+1)*c+a+1,f=(u+1)*c+a,h=new e.Vector2(a/n,u/r),p=new e.Vector2((a+1)/n,u/r),d=new e.Vector2((a+1)/n,(u+1)/r),v=new e.Vector2(a/n,(u+1)/r),s.push(new e.Face3(t,i,f)),o.push([h,p,v]),s.push(new e.Face3(i,l,f)),o.push([p.clone(),d,v.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},e.ParametricGeometry.prototype=Object.create(e.Geometry.prototype),e.AxisHelper=function(t){t=t||1;var n=new e.Geometry;n.vertices.push(new e.Vector3,new e.Vector3(t,0,0),new e.Vector3,new e.Vector3(0,t,0),new e.Vector3,new e.Vector3(0,0,t)),n.colors.push(new e.Color(16711680),new e.Color(16755200),new e.Color(65280),new e.Color(11206400),new e.Color(255),new e.Color(43775)),t=new e.LineBasicMaterial({vertexColors:e.VertexColors}),e.Line.call(this,n,t,e.LinePieces)},e.AxisHelper.prototype=Object.create(e.Line.prototype),e.ArrowHelper=function(t,n,r,i,s,o){e.Object3D.call(this),void 0===i&&(i=16776960),void 0===r&&(r=1),void 0===s&&(s=.2*r),void 0===o&&(o=.2*s),this.position=n,n=new e.Geometry,n.vertices.push(new e.Vector3(0,0,0)),n.vertices.push(new e.Vector3(0,1,0)),this.line=new e.Line(n,new e.LineBasicMaterial({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),n=new e.CylinderGeometry(0,.5,1,5,1),n.applyMatrix((new e.Matrix4).makeTranslation(0,-0.5,0)),this.cone=new e.Mesh(n,new e.MeshBasicMaterial({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(r,s,o)},e.ArrowHelper.prototype=Object.create(e.Object3D.prototype),e.ArrowHelper.prototype.setDirection=function(){var t=new e.Vector3,n;return function(e){.99999<e.y?this.quaternion.set(0,0,0,1):-0.99999>e.y?this.quaternion.set(1,0,0,0):(t.set(e.z,0,-e.x).normalize(),n=Math.acos(e.y),this.quaternion.setFromAxisAngle(t,n))}}(),e.ArrowHelper.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},e.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},e.BoxHelper=function(t){var n=[new e.Vector3(1,1,1),new e.Vector3(-1,1,1),new e.Vector3(-1,-1,1),new e.Vector3(1,-1,1),new e.Vector3(1,1,-1),new e.Vector3(-1,1,-1),new e.Vector3(-1,-1,-1),new e.Vector3(1,-1,-1)];this.vertices=n;var r=new e.Geometry;r.vertices.push(n[0],n[1],n[1],n[2],n[2],n[3],n[3],n[0],n[4],n[5],n[5],n[6],n[6],n[7],n[7],n[4],n[0],n[4],n[1],n[5],n[2],n[6],n[3],n[7]),e.Line.call(this,r,new e.LineBasicMaterial({color:16776960}),e.LinePieces),void 0!==t&&this.update(t)},e.BoxHelper.prototype=Object.create(e.Line.prototype),e.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var n=t.boundingBox.min,t=t.boundingBox.max,r=this.vertices;r[0].set(t.x,t.y,t.z),r[1].set(n.x,t.y,t.z),r[2].set(n.x,n.y,t.z),r[3].set(t.x,n.y,t.z),r[4].set(t.x,t.y,n.z),r[5].set(n.x,t.y,n.z),r[6].set(n.x,n.y,n.z),r[7].set(t.x,n.y,n.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},e.BoundingBoxHelper=function(t,n){var r=void 0!==n?n:8947848;this.object=t,this.box=new e.Box3,e.Mesh.call(this,new e.BoxGeometry(1,1,1),new e.MeshBasicMaterial({color:r,wireframe:!0}))},e.BoundingBoxHelper.prototype=Object.create(e.Mesh.prototype),e.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},e.CameraHelper=function(t){function n(e,t,n){r(e,n),r(t,n)}function r(t,n){i.vertices.push(new e.Vector3),i.colors.push(new e.Color(n)),void 0===o[t]&&(o[t]=[]),o[t].push(i.vertices.length-1)}var i=new e.Geometry,s=new e.LineBasicMaterial({color:16777215,vertexColors:e.FaceColors}),o={};n("n1","n2",16755200),n("n2","n4",16755200),n("n4","n3",16755200),n("n3","n1",16755200),n("f1","f2",16755200),n("f2","f4",16755200),n("f4","f3",16755200),n("f3","f1",16755200),n("n1","f1",16755200),n("n2","f2",16755200),n("n3","f3",16755200),n("n4","f4",16755200),n("p","n1",16711680),n("p","n2",16711680),n("p","n3",16711680),n("p","n4",16711680),n("u1","u2",43775),n("u2","u3",43775),n("u3","u1",43775),n("c","t",16777215),n("p","c",3355443),n("cn1","cn2",3355443),n("cn3","cn4",3355443),n("cf1","cf2",3355443),n("cf3","cf4",3355443),e.Line.call(this,i,s,e.LinePieces),this.camera=t,this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},e.CameraHelper.prototype=Object.create(e.Line.prototype),e.CameraHelper.prototype.update=function(){var t=new e.Vector3,n=new e.Camera,r=new e.Projector;return function(){function e(e,s,o,u){t.set(s,o,u),r.unprojectVector(t,n),e=i.pointMap[e];if(void 0!==e)for(s=0,o=e.length;s<o;s++)i.geometry.vertices[e[s]].copy(t)}var i=this;n.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-1,-1,-1),e("n2",1,-1,-1),e("n3",-1,1,-1),e("n4",1,1,-1),e("f1",-1,-1,1),e("f2",1,-1,1),e("f3",-1,1,1),e("f4",1,1,1),e("u1",.7,1.1,-1),e("u2",-0.7,1.1,-1),e("u3",0,2,-1),e("cf1",-1,0,1),e("cf2",1,0,1),e("cf3",0,-1,1),e("cf4",0,1,1),e("cn1",-1,0,-1),e("cn2",1,0,-1),e("cn3",0,-1,-1),e("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),e.DirectionalLightHelper=function(t,n){e.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,n=n||1;var r=new e.Geometry;r.vertices.push(new e.Vector3(-n,n,0),new e.Vector3(n,n,0),new e.Vector3(n,-n,0),new e.Vector3(-n,-n,0),new e.Vector3(-n,n,0));var i=new e.LineBasicMaterial({fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new e.Line(r,i),this.add(this.lightPlane),r=new e.Geometry,r.vertices.push(new e.Vector3,new e.Vector3),i=new e.LineBasicMaterial({fog:!1}),i.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new e.Line(r,i),this.add(this.targetLine),this.update()},e.DirectionalLightHelper.prototype=Object.create(e.Object3D.prototype),e.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},e.DirectionalLightHelper.prototype.update=function(){var t=new e.Vector3,n=new e.Vector3,r=new e.Vector3;return function(){t.setFromMatrixPosition(this.light.matrixWorld),n.setFromMatrixPosition(this.light.target.matrixWorld),r.subVectors(n,t),this.lightPlane.lookAt(r),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(r),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),e.EdgesHelper=function(t,n){var r=void 0!==n?n:16777215,i=[0,0],s={},o=function(e,t){return e-t},u=["a","b","c"],a=new e.BufferGeometry,f=t.geometry.clone();f.mergeVertices(),f.computeFaceNormals();for(var l=f.vertices,f=f.faces,c=0,h=0,p=f.length;h<p;h++)for(var d=f[h],v=0;3>v;v++){i[0]=d[u[v]],i[1]=d[u[(v+1)%3]],i.sort(o);var m=i.toString();void 0===s[m]?(s[m]={vert1:i[0],vert2:i[1],face1:h,face2:void 0},c++):s[m].face2=h}a.addAttribute("position",new e.Float32Attribute(2*c,3)),i=a.attributes.position.array,o=0;for(m in s)if(u=s[m],void 0===u.face2||.9999>f[u.face1].normal.dot(f[u.face2].normal))c=l[u.vert1],i[o++]=c.x,i[o++]=c.y,i[o++]=c.z,c=l[u.vert2],i[o++]=c.x,i[o++]=c.y,i[o++]=c.z;e.Line.call(this,a,new e.LineBasicMaterial({color:r}),e.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=t.matrixWorld},e.EdgesHelper.prototype=Object.create(e.Line.prototype),e.FaceNormalsHelper=function(t,n,r,i){this.object=t,this.size=void 0!==n?n:1,t=void 0!==r?r:16776960,i=void 0!==i?i:1,n=new e.Geometry,r=0;for(var s=this.object.geometry.faces.length;r<s;r++)n.vertices.push(new e.Vector3,new e.Vector3);e.Line.call(this,n,new e.LineBasicMaterial({color:t,linewidth:i}),e.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new e.Matrix3,this.update()},e.FaceNormalsHelper.prototype=Object.create(e.Line.prototype),e.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,n=t.geometry.vertices,r=t.geometry.faces,i=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(i);for(var s=t=0,o=r.length;t<o;t++,s+=2){var u=r[t];e[s].copy(n[u.a]).add(n[u.b]).add(n[u.c]).divideScalar(3).applyMatrix4(i),e[s+1].copy(u.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[s])}return this.geometry.verticesNeedUpdate=!0,this},e.GridHelper=function(t,n){var r=new e.Geometry,i=new e.LineBasicMaterial({vertexColors:e.VertexColors});this.color1=new e.Color(4473924),this.color2=new e.Color(8947848);for(var s=-t;s<=t;s+=n){r.vertices.push(new e.Vector3(-t,0,s),new e.Vector3(t,0,s),new e.Vector3(s,0,-t),new e.Vector3(s,0,t));var o=0===s?this.color1:this.color2;r.colors.push(o,o,o,o)}e.Line.call(this,r,i,e.LinePieces)},e.GridHelper.prototype=Object.create(e.Line.prototype),e.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},e.HemisphereLightHelper=function(t,n,r,i){e.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new e.Color,new e.Color],t=new e.SphereGeometry(n,4,2),t.applyMatrix((new e.Matrix4).makeRotationX(-Math.PI/2));for(n=0;8>n;n++)t.faces[n].color=this.colors[4>n?0:1];n=new e.MeshBasicMaterial({vertexColors:e.FaceColors,wireframe:!0}),this.lightSphere=new e.Mesh(t,n),this.add(this.lightSphere),this.update()},e.HemisphereLightHelper.prototype=Object.create(e.Object3D.prototype),e.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},e.HemisphereLightHelper.prototype.update=function(){var t=new e.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(t.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),e.PointLightHelper=function(t,n){this.light=t,this.light.updateMatrixWorld();var r=new e.SphereGeometry(n,4,2),i=new e.MeshBasicMaterial({wireframe:!0,fog:!1});i.color.copy(this.light.color).multiplyScalar(this.light.intensity),e.Mesh.call(this,r,i),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},e.PointLightHelper.prototype=Object.create(e.Mesh.prototype),e.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},e.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},e.SkeletonHelper=function(t){for(var n=t.skeleton,r=new e.Geometry,i=0;i<n.bones.length;i++)n.bones[i].parent instanceof e.Bone&&(r.vertices.push(new e.Vector3),r.vertices.push(new e.Vector3),r.colors.push(new e.Color(0,0,1)),r.colors.push(new e.Color(0,1,0)));i=new e.LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,transparent:!0}),e.Line.call(this,r,i,e.LinePieces),this.skeleton=n,this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,this.update()},e.SkeletonHelper.prototype=Object.create(e.Line.prototype),e.SkeletonHelper.prototype.update=function(){for(var t=this.geometry,n=0,r=0;r<this.skeleton.bones.length;r++){var i=this.skeleton.bones[r];i.parent instanceof e.Bone&&(t.vertices[n].setFromMatrixPosition(i.skinMatrix),t.vertices[n+1].setFromMatrixPosition(i.parent.skinMatrix),n+=2)}t.verticesNeedUpdate=!0,t.computeBoundingSphere()},e.SpotLightHelper=function(t){e.Object3D.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrixWorld=t.matrixWorld,this.matrixAutoUpdate=!1,t=new e.CylinderGeometry(0,1,1,8,1,!0),t.applyMatrix((new e.Matrix4).makeTranslation(0,-0.5,0)),t.applyMatrix((new e.Matrix4).makeRotationX(-Math.PI/2));var n=new e.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new e.Mesh(t,n),this.add(this.cone),this.update()},e.SpotLightHelper.prototype=Object.create(e.Object3D.prototype),e.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},e.SpotLightHelper.prototype.update=function(){var t=new e.Vector3,n=new e.Vector3;return function(){var e=this.light.distance?this.light.distance:1e4,r=e*Math.tan(this.light.angle);this.cone.scale.set(r,r,e),t.setFromMatrixPosition(this.light.matrixWorld),n.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(n.sub(t)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),e.VertexNormalsHelper=function(t,n,r,i){this.object=t,this.size=void 0!==n?n:1,n=void 0!==r?r:16711680,i=void 0!==i?i:1,r=new e.Geometry,t=t.geometry.faces;for(var s=0,o=t.length;s<o;s++)for(var u=0,a=t[s].vertexNormals.length;u<a;u++)r.vertices.push(new e.Vector3),r.vertices.push(new e.Vector3);e.Line.call(this,r,new e.LineBasicMaterial({color:n,linewidth:i}),e.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new e.Matrix3,this.update()},e.VertexNormalsHelper.prototype=Object.create(e.Line.prototype),e.VertexNormalsHelper.prototype.update=function(t){var n=new e.Vector3;return function(e){e=["a","b","c","d"],this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var t=this.geometry.vertices,r=this.object.geometry.vertices,i=this.object.geometry.faces,s=this.object.matrixWorld,o=0,u=0,a=i.length;u<a;u++)for(var f=i[u],l=0,c=f.vertexNormals.length;l<c;l++){var h=f.vertexNormals[l];t[o].copy(r[f[e[l]]]).applyMatrix4(s),n.copy(h).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),n.add(t[o]),o+=1,t[o].copy(n),o+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),e.VertexTangentsHelper=function(t,n,r,i){this.object=t,this.size=void 0!==n?n:1,n=void 0!==r?r:255,i=void 0!==i?i:1,r=new e.Geometry,t=t.geometry.faces;for(var s=0,o=t.length;s<o;s++)for(var u=0,a=t[s].vertexTangents.length;u<a;u++)r.vertices.push(new e.Vector3),r.vertices.push(new e.Vector3);e.Line.call(this,r,new e.LineBasicMaterial({color:n,linewidth:i}),e.LinePieces),this.matrixAutoUpdate=!1,this.update()},e.VertexTangentsHelper.prototype=Object.create(e.Line.prototype),e.VertexTangentsHelper.prototype.update=function(t){var n=new e.Vector3;return function(e){e=["a","b","c","d"],this.object.updateMatrixWorld(!0);for(var t=this.geometry.vertices,r=this.object.geometry.vertices,i=this.object.geometry.faces,s=this.object.matrixWorld,o=0,u=0,a=i.length;u<a;u++)for(var f=i[u],l=0,c=f.vertexTangents.length;l<c;l++){var h=f.vertexTangents[l];t[o].copy(r[f[e[l]]]).applyMatrix4(s),n.copy(h).transformDirection(s).multiplyScalar(this.size),n.add(t[o]),o+=1,t[o].copy(n),o+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),e.WireframeHelper=function(t,n){var r=void 0!==n?n:16777215,i=[0,0],s={},o=function(e,t){return e-t},u=["a","b","c"],a=new e.BufferGeometry;if(t.geometry instanceof e.Geometry){for(var f=t.geometry.vertices,l=t.geometry.faces,c=0,h=new Uint32Array(6*l.length),p=0,d=l.length;p<d;p++)for(var v=l[p],m=0;3>m;m++){i[0]=v[u[m]],i[1]=v[u[(m+1)%3]],i.sort(o);var g=i.toString();void 0===s[g]&&(h[2*c]=i[0],h[2*c+1]=i[1],s[g]=!0,c++)}a.addAttribute("position",new e.Float32Attribute(2*c,3)),i=a.attributes.position.array,p=0;for(d=c;p<d;p++)for(m=0;2>m;m++)c=f[h[2*p+m]],u=6*p+3*m,i[u+0]=c.x,i[u+1]=c.y,i[u+2]=c.z}else if(t.geometry instanceof e.BufferGeometry&&void 0!==t.geometry.attributes.index){for(var f=t.geometry.attributes.position.array,d=t.geometry.attributes.index.array,l=t.geometry.offsets,c=0,h=new Uint32Array(2*d.length),v=0,y=l.length;v<y;++v)for(var m=l[v].start,g=l[v].count,u=l[v].index,p=m,b=m+g;p<b;p+=3)for(m=0;3>m;m++)i[0]=u+d[p+m],i[1]=u+d[p+(m+1)%3],i.sort(o),g=i.toString(),void 0===s[g]&&(h[2*c]=i[0],h[2*c+1]=i[1],s[g]=!0,c++);a.addAttribute("position",new e.Float32Attribute(2*c,3)),i=a.attributes.position.array,p=0;for(d=c;p<d;p++)for(m=0;2>m;m++)u=6*p+3*m,c=3*h[2*p+m],i[u+0]=f[c],i[u+1]=f[c+1],i[u+2]=f[c+2]}else if(t.geometry instanceof e.BufferGeometry)for(f=t.geometry.attributes.position.array,c=f.length/3,h=c/3,a.addAttribute("position",new e.Float32Attribute(2*c,3)),i=a.attributes.position.array,p=0,d=h;p<d;p++)for(m=0;3>m;m++)u=18*p+6*m,h=9*p+3*m,i[u+0]=f[h],i[u+1]=f[h+1],i[u+2]=f[h+2],c=9*p+(m+1)%3*3,i[u+3]=f[c],i[u+4]=f[c+1],i[u+5]=f[c+2];e.Line.call(this,a,new e.LineBasicMaterial({color:r}),e.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=t.matrixWorld},e.WireframeHelper.prototype=Object.create(e.Line.prototype),e.ImmediateRenderObject=function(){e.Object3D.call(this),this.render=function(e){}},e.ImmediateRenderObject.prototype=Object.create(e.Object3D.prototype),e.LensFlare=function(t,n,r,i,s){e.Object3D.call(this),this.lensFlares=[],this.positionScreen=new e.Vector3,this.customUpdateCallback=void 0,void 0!==t&&this.add(t,n,r,i,s)},e.LensFlare.prototype=Object.create(e.Object3D.prototype),e.LensFlare.prototype.add=function(t,n,r,i,s,o){void 0===n&&(n=-1),void 0===r&&(r=0),void 0===o&&(o=1),void 0===s&&(s=new e.Color(16777215)),void 0===i&&(i=e.NormalBlending),r=Math.min(r,Math.max(0,r)),this.lensFlares.push({texture:t,size:n,distance:r,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:s,blending:i})},e.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,n,r=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;e<t;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+r*n.distance,n.y=this.positionScreen.y+i*n.distance,n.wantedRotation=n.x*Math.PI*.25,n.rotation+=.25*(n.wantedRotation-n.rotation)},e.MorphBlendMesh=function(t,n){e.Mesh.call(this,t,n),this.animationsMap={},this.animationsList=[];var r=this.geometry.morphTargets.length;this.createAnimation("__default",0,r-1,r/1),this.setAnimationWeight("__default",1)},e.MorphBlendMesh.prototype=Object.create(e.Mesh.prototype),e.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){t={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},e.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t=/([a-z]+)(\d+)/,n,r={},i=this.geometry,s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s].name.match(t);if(u&&1<u.length){var a=u[1];r[a]||(r[a]={start:Infinity,end:-Infinity}),u=r[a],s<u.start&&(u.start=s),s>u.end&&(u.end=s),n||(n=a)}}for(a in r)u=r[a],this.createAnimation(a,u.start,u.end,e);this.firstAnimation=n},e.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){if(e=this.animationsMap[e])e.direction=1,e.directionBackwards=!1},e.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){if(e=this.animationsMap[e])e.direction=-1,e.directionBackwards=!0},e.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},e.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},e.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},e.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},e.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;if(e=this.animationsMap[e])t=e.time;return t},e.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;if(e=this.animationsMap[e])t=e.duration;return t},e.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},e.MorphBlendMesh.prototype.stopAnimation=function(e){if(e=this.animationsMap[e])e.active=!1},e.MorphBlendMesh.prototype.update=function(t){for(var n=0,r=this.animationsList.length;n<r;n++){var i=this.animationsList[n];if(i.active){var s=i.duration/i.length;i.time+=i.direction*t;if(i.mirroredLoop){if(i.time>i.duration||0>i.time)i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),0>i.time&&(i.time=0,i.directionBackwards=!1)}else i.time%=i.duration,0>i.time&&(i.time+=i.duration);var o=i.startFrame+e.Math.clamp(Math.floor(i.time/s),0,i.length-1),u=i.weight;o!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*u,this.morphTargetInfluences[o]=0,i.lastFrame=i.currentFrame,i.currentFrame=o),s=i.time%s/s,i.directionBackwards&&(s=1-s),this.morphTargetInfluences[i.currentFrame]=s*u,this.morphTargetInfluences[i.lastFrame]=(1-s)*u}}},e.LensFlarePlugin=function(){function t(e,t){var r=n.createProgram(),i=n.createShader(n.FRAGMENT_SHADER),s=n.createShader(n.VERTEX_SHADER),o="precision "+t+" float;\n";return n.shaderSource(i,o+e.fragmentShader),n.shaderSource(s,o+e.vertexShader),n.compileShader(i),n.compileShader(s),n.attachShader(r,i),n.attachShader(r,s),n.linkProgram(r),r}var n,r,i,s,o,u,a,f,l,c,h,p,d;this.init=function(v){n=v.context,r=v,i=v.getPrecision(),s=new Float32Array(16),o=new Uint16Array(6),v=0,s[v++]=-1,s[v++]=-1,s[v++]=0,s[v++]=0,s[v++]=1,s[v++]=-1,s[v++]=1,s[v++]=0,s[v++]=1,s[v++]=1,s[v++]=1,s[v++]=1,s[v++]=-1,s[v++]=1,s[v++]=0,s[v++]=1,v=0,o[v++]=0,o[v++]=1,o[v++]=2,o[v++]=0,o[v++]=2,o[v++]=3,u=n.createBuffer(),a=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,u),n.bufferData(n.ARRAY_BUFFER,s,n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a),n.bufferData(n.ELEMENT_ARRAY_BUFFER,o,n.STATIC_DRAW),f=n.createTexture(),l=n.createTexture(),n.bindTexture(n.TEXTURE_2D,f),n.texImage2D(n.TEXTURE_2D,0,n.RGB,16,16,0,n.RGB,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.bindTexture(n.TEXTURE_2D,l),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,16,16,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),0>=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(c=!1,h=t(e.ShaderFlares.lensFlare,i)):(c=!0,h=t(e.ShaderFlares.lensFlareVertexTexture,i)),p={},d={},p.vertex=n.getAttribLocation(h,"position"),p.uv=n.getAttribLocation(h,"uv"),d.renderType=n.getUniformLocation(h,"renderType"),d.map=n.getUniformLocation(h,"map"),d.occlusionMap=n.getUniformLocation(h,"occlusionMap"),d.opacity=n.getUniformLocation(h,"opacity"),d.color=n.getUniformLocation(h,"color"),d.scale=n.getUniformLocation(h,"scale"),d.rotation=n.getUniformLocation(h,"rotation"),d.screenPosition=n.getUniformLocation(h,"screenPosition")},this.render=function(t,i,s,o){t=t.__webglFlares;var v=t.length;if(v){var m=new e.Vector3,y=o/s,w=.5*s,E=.5*o,S=16/o,x=new e.Vector2(S*y,S),T=new e.Vector3(1,1,0),N=new e.Vector2(1,1),C=d,S=p;n.useProgram(h),n.enableVertexAttribArray(p.vertex),n.enableVertexAttribArray(p.uv),n.uniform1i(C.occlusionMap,0),n.uniform1i(C.map,1),n.bindBuffer(n.ARRAY_BUFFER,u),n.vertexAttribPointer(S.vertex,2,n.FLOAT,!1,16,0),n.vertexAttribPointer(S.uv,2,n.FLOAT,!1,16,8),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,a),n.disable(n.CULL_FACE),n.depthMask(!1);var L,A,O,M,_;for(L=0;L<v;L++)if(S=16/o,x.set(S*y,S),M=t[L],m.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]),m.applyMatrix4(i.matrixWorldInverse),m.applyProjection(i.projectionMatrix),T.copy(m),N.x=T.x*w+w,N.y=T.y*E+E,c||0<N.x&&N.x<s&&0<N.y&&N.y<o)for(n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,f),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGB,N.x-8,N.y-8,16,16,0),n.uniform1i(C.renderType,0),n.uniform2f(C.scale,x.x,x.y),n.uniform3f(C.screenPosition,T.x,T.y,T.z),n.disable(n.BLEND),n.enable(n.DEPTH_TEST),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,N.x-8,N.y-8,16,16,0),n.uniform1i(C.renderType,1),n.disable(n.DEPTH_TEST),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,f),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0),M.positionScreen.copy(T),M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares(),n.uniform1i(C.renderType,2),n.enable(n.BLEND),A=0,O=M.lensFlares.length;A<O;A++)_=M.lensFlares[A],.001<_.opacity&&.001<_.scale&&(T.x=_.x,T.y=_.y,T.z=_.z,S=_.size*_.scale/o,x.x=S*y,x.y=S,n.uniform3f(C.screenPosition,T.x,T.y,T.z),n.uniform2f(C.scale,x.x,x.y),n.uniform1f(C.rotation,_.rotation),n.uniform1f(C.opacity,_.opacity),n.uniform3f(C.color,_.color.r,_.color.g,_.color.b),r.setBlending(_.blending,_.blendEquation,_.blendSrc,_.blendDst),r.setTexture(_.texture,1),n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0));n.enable(n.CULL_FACE),n.enable(n.DEPTH_TEST),n.depthMask(!0)}}},e.ShadowMapPlugin=function(){var t,n,r,i,s,o,u=new e.Frustum,a=new e.Matrix4,f=new e.Vector3,l=new e.Vector3,c=new e.Vector3;this.init=function(u){t=u.context,n=u,u=e.ShaderLib.depthRGBA;var a=e.UniformsUtils.clone(u.uniforms);r=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a}),i=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,morphTargets:!0}),s=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,skinning:!0}),o=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0,o._shadowPass=!0},this.render=function(e,t){n.shadowMapEnabled&&n.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(p,v){var m,y,w,E,S,x,T,N,C,L=[];E=0,t.clearColor(1,1,1,1),t.disable(t.BLEND),t.enable(t.CULL_FACE),t.frontFace(t.CCW),n.shadowMapCullFace===e.CullFaceFront?t.cullFace(t.FRONT):t.cullFace(t.BACK),n.setDepthTest(!0),m=0;for(y=p.__lights.length;m<y;m++)if(w=p.__lights[m],w.castShadow)if(w instanceof e.DirectionalLight&&w.shadowCascade)for(S=0;S<w.shadowCascadeCount;S++){var A;if(w.shadowCascadeArray[S])A=w.shadowCascadeArray[S];else{C=w,T=S,A=new e.DirectionalLight,A.isVirtual=!0,A.onlyShadow=!0,A.castShadow=!0,A.shadowCameraNear=C.shadowCameraNear,A.shadowCameraFar=C.shadowCameraFar,A.shadowCameraLeft=C.shadowCameraLeft,A.shadowCameraRight=C.shadowCameraRight,A.shadowCameraBottom=C.shadowCameraBottom,A.shadowCameraTop=C.shadowCameraTop,A.shadowCameraVisible=C.shadowCameraVisible,A.shadowDarkness=C.shadowDarkness,A.shadowBias=C.shadowCascadeBias[T],A.shadowMapWidth=C.shadowCascadeWidth[T],A.shadowMapHeight=C.shadowCascadeHeight[T],A.pointsWorld=[],A.pointsFrustum=[];var O=A.pointsWorld;x=A.pointsFrustum;for(N=0;8>N;N++)O[N]=new e.Vector3,x[N]=new e.Vector3;O=C.shadowCascadeNearZ[T],C=C.shadowCascadeFarZ[T],x[0].set(-1,-1,O),x[1].set(1,-1,O),x[2].set(-1,1,O),x[3].set(1,1,O),x[4].set(-1,-1,C),x[5].set(1,-1,C),x[6].set(-1,1,C),x[7].set(1,1,C),A.originalCamera=v,x=new e.Gyroscope,x.position.copy(w.shadowCascadeOffset),x.add(A),x.add(A.target),v.add(x),w.shadowCascadeArray[S]=A,console.log("Created virtualLight",A)}T=w,O=S,C=T.shadowCascadeArray[O],C.position.copy(T.position),C.target.position.copy(T.target.position),C.lookAt(C.target),C.shadowCameraVisible=T.shadowCameraVisible,C.shadowDarkness=T.shadowDarkness,C.shadowBias=T.shadowCascadeBias[O],x=T.shadowCascadeNearZ[O],T=T.shadowCascadeFarZ[O],C=C.pointsFrustum,C[0].z=x,C[1].z=x,C[2].z=x,C[3].z=x,C[4].z=T,C[5].z=T,C[6].z=T,C[7].z=T,L[E]=A,E++}else L[E]=w,E++;m=0;for(y=L.length;m<y;m++){w=L[m],w.shadowMap||(S=e.LinearFilter,n.shadowMapType===e.PCFSoftShadowMap&&(S=e.NearestFilter),w.shadowMap=new e.WebGLRenderTarget(w.shadowMapWidth,w.shadowMapHeight,{minFilter:S,magFilter:S,format:e.RGBAFormat}),w.shadowMapSize=new e.Vector2(w.shadowMapWidth,w.shadowMapHeight),w.shadowMatrix=new e.Matrix4);if(!w.shadowCamera){if(w instanceof e.SpotLight)w.shadowCamera=new e.PerspectiveCamera(w.shadowCameraFov,w.shadowMapWidth/w.shadowMapHeight,w.shadowCameraNear,w.shadowCameraFar);else{if(!(w instanceof e.DirectionalLight)){console.error("Unsupported light type for shadow");continue}w.shadowCamera=new e.OrthographicCamera(w.shadowCameraLeft,w.shadowCameraRight,w.shadowCameraTop,w.shadowCameraBottom,w.shadowCameraNear,w.shadowCameraFar)}p.add(w.shadowCamera),!0===p.autoUpdate&&p.updateMatrixWorld()}w.shadowCameraVisible&&!w.cameraHelper&&(w.cameraHelper=new e.CameraHelper(w.shadowCamera),w.shadowCamera.add(w.cameraHelper));if(w.isVirtual&&A.originalCamera==v){S=v,E=w.shadowCamera,x=w.pointsFrustum,C=w.pointsWorld,f.set(Infinity,Infinity,Infinity),l.set(-Infinity,-Infinity,-Infinity);for(T=0;8>T;T++)O=C[T],O.copy(x[T]),e.ShadowMapPlugin.__projector.unprojectVector(O,S),O.applyMatrix4(E.matrixWorldInverse),O.x<f.x&&(f.x=O.x),O.x>l.x&&(l.x=O.x),O.y<f.y&&(f.y=O.y),O.y>l.y&&(l.y=O.y),O.z<f.z&&(f.z=O.z),O.z>l.z&&(l.z=O.z);E.left=f.x,E.right=l.x,E.top=l.y,E.bottom=f.y,E.updateProjectionMatrix()}E=w.shadowMap,x=w.shadowMatrix,S=w.shadowCamera,S.position.setFromMatrixPosition(w.matrixWorld),c.setFromMatrixPosition(w.target.matrixWorld),S.lookAt(c),S.updateMatrixWorld(),S.matrixWorldInverse.getInverse(S.matrixWorld),w.cameraHelper&&(w.cameraHelper.visible=w.shadowCameraVisible),w.shadowCameraVisible&&w.cameraHelper.update(),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(S.projectionMatrix),x.multiply(S.matrixWorldInverse),a.multiplyMatrices(S.projectionMatrix,S.matrixWorldInverse),u.setFromMatrix(a),n.setRenderTarget(E),n.clear(),C=p.__webglObjects,w=0;for(E=C.length;w<E;w++)T=C[w],x=T.object,T.render=!1,!x.visible||!x.castShadow||(x instanceof e.Mesh||x instanceof e.ParticleSystem)&&x.frustumCulled&&!u.intersectsObject(x)||(x._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,x.matrixWorld),T.render=!0);var M;w=0;for(E=C.length;w<E;w++)T=C[w],T.render&&(x=T.object,T=T.buffer,O=x.material instanceof e.MeshFaceMaterial?x.material.materials[0]:x.material,N=void 0!==x.geometry.morphTargets&&0<x.geometry.morphTargets.length&&O.morphTargets,M=x instanceof e.SkinnedMesh&&O.skinning,N=x.customDepthMaterial?x.customDepthMaterial:M?N?o:s:N?i:r,n.setMaterialFaces(O),T instanceof e.BufferGeometry?n.renderBufferDirect(S,p.__lights,null,N,T,x):n.renderBuffer(S,p.__lights,null,N,T,x));C=p.__webglObjectsImmediate,w=0;for(E=C.length;w<E;w++)T=C[w],x=T.object,x.visible&&x.castShadow&&(x._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,x.matrixWorld),n.renderImmediateObject(S,p.__lights,null,r,x))}m=n.getClearColor(),y=n.getClearAlpha(),t.clearColor(m.r,m.g,m.b,y),t.enable(t.BLEND),n.shadowMapCullFace===e.CullFaceFront&&t.cullFace(t.BACK)}},e.ShadowMapPlugin.__projector=new e.Projector,e.SpritePlugin=function(){function y(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,b,w,E,S,x,T,N,C;this.init=function(y){b=y.context,w=y,S=new Float32Array([-0.5,-0.5,0,0,.5,-0.5,1,0,.5,.5,1,1,-0.5,.5,0,1]),x=new Uint16Array([0,1,2,0,2,3]),T=b.createBuffer(),N=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,T),b.bufferData(b.ARRAY_BUFFER,S,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,N),b.bufferData(b.ELEMENT_ARRAY_BUFFER,x,b.STATIC_DRAW),y=b.createProgram();var A=b.createShader(b.VERTEX_SHADER),O=b.createShader(b.FRAGMENT_SHADER);b.shaderSource(A,["precision "+w.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n")),b.shaderSource(O,["precision "+w.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n")),b.compileShader(A),b.compileShader(O),b.attachShader(y,A),b.attachShader(y,O),b.linkProgram(y),C=y,m=b.getAttribLocation(C,"position"),g=b.getAttribLocation(C,"uv"),t=b.getUniformLocation(C,"uvOffset"),n=b.getUniformLocation(C,"uvScale"),r=b.getUniformLocation(C,"rotation"),i=b.getUniformLocation(C,"scale"),s=b.getUniformLocation(C,"color"),o=b.getUniformLocation(C,"map"),u=b.getUniformLocation(C,"opacity"),a=b.getUniformLocation(C,"modelViewMatrix"),f=b.getUniformLocation(C,"projectionMatrix"),l=b.getUniformLocation(C,"fogType"),c=b.getUniformLocation(C,"fogDensity"),h=b.getUniformLocation(C,"fogNear"),p=b.getUniformLocation(C,"fogFar"),d=b.getUniformLocation(C,"fogColor"),v=b.getUniformLocation(C,"alphaTest"),y=document.createElement("canvas"),y.width=8,y.height=8,A=y.getContext("2d"),A.fillStyle="#ffffff",A.fillRect(0,0,y.width,y.height),E=new e.Texture(y),E.needsUpdate=!0},this.render=function(S,x,A,O){A=S.__webglSprites;if(O=A.length){b.useProgram(C),b.enableVertexAttribArray(m),b.enableVertexAttribArray(g),b.disable(b.CULL_FACE),b.enable(b.BLEND),b.bindBuffer(b.ARRAY_BUFFER,T),b.vertexAttribPointer(m,2,b.FLOAT,!1,16,0),b.vertexAttribPointer(g,2,b.FLOAT,!1,16,8),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,N),b.uniformMatrix4fv(f,!1,x.projectionMatrix.elements),b.activeTexture(b.TEXTURE0),b.uniform1i(o,0);var M=0,_=0,D=S.fog;D?(b.uniform3f(d,D.color.r,D.color.g,D.color.b),D instanceof e.Fog?(b.uniform1f(h,D.near),b.uniform1f(p,D.far),b.uniform1i(l,1),_=M=1):D instanceof e.FogExp2&&(b.uniform1f(c,D.density),b.uniform1i(l,2),_=M=2)):(b.uniform1i(l,0),_=M=0);for(var P,H=[],D=0;D<O;D++)P=A[D],!1!==P.visible&&(P._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,P.matrixWorld),P.z=-P._modelViewMatrix.elements[14]);A.sort(y);for(D=0;D<O;D++)P=A[D],!1!==P.visible&&(x=P.material,b.uniform1f(v,x.alphaTest),b.uniformMatrix4fv(a,!1,P._modelViewMatrix.elements),H[0]=P.scale.x,H[1]=P.scale.y,P=S.fog&&x.fog?_:0,M!==P&&(b.uniform1i(l,P),M=P),null!==x.map?(b.uniform2f(t,x.map.offset.x,x.map.offset.y),b.uniform2f(n,x.map.repeat.x,x.map.repeat.y)):(b.uniform2f(t,0,0),b.uniform2f(n,1,1)),b.uniform1f(u,x.opacity),b.uniform3f(s,x.color.r,x.color.g,x.color.b),b.uniform1f(r,x.rotation),b.uniform2fv(i,H),w.setBlending(x.blending,x.blendEquation,x.blendSrc,x.blendDst),w.setDepthTest(x.depthTest),w.setDepthWrite(x.depthWrite),x.map&&x.map.image&&x.map.image.width?w.setTexture(x.map,0):w.setTexture(E,0),b.drawElements(b.TRIANGLES,6,b.UNSIGNED_SHORT,0));b.enable(b.CULL_FACE)}}},e.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var t,n,r,i,s,o,u=new e.Frustum,a=new e.Matrix4;this.init=function(u){t=u.context,n=u,u=e.ShaderLib.depthRGBA;var a=e.UniformsUtils.clone(u.uniforms);r=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a}),i=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,morphTargets:!0}),s=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,skinning:!0}),o=new e.ShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:a,morphTargets:!0,skinning:!0}),r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0,o._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(l,p){var v,m,y,w,E,S;t.clearColor(1,1,1,1),t.disable(t.BLEND),n.setDepthTest(!0),!0===l.autoUpdate&&l.updateMatrixWorld(),p.matrixWorldInverse.getInverse(p.matrixWorld),a.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),u.setFromMatrix(a),n.setRenderTarget(this.renderTarget),n.clear(),S=l.__webglObjects,v=0;for(m=S.length;v<m;v++)y=S[v],E=y.object,y.render=!1,!E.visible||(E instanceof e.Mesh||E instanceof e.ParticleSystem)&&E.frustumCulled&&!u.intersectsObject(E)||(E._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,E.matrixWorld),y.render=!0);var x;v=0;for(m=S.length;v<m;v++)y=S[v],y.render&&(E=y.object,y=y.buffer,E instanceof e.ParticleSystem&&!E.customDepthMaterial||((x=E.material instanceof e.MeshFaceMaterial?E.material.materials[0]:E.material)&&n.setMaterialFaces(E.material),w=void 0!==E.geometry.morphTargets&&0<E.geometry.morphTargets.length&&x.morphTargets,x=E instanceof e.SkinnedMesh&&x.skinning,w=E.customDepthMaterial?E.customDepthMaterial:x?w?o:s:w?i:r,y instanceof e.BufferGeometry?n.renderBufferDirect(p,l.__lights,null,w,y,E):n.renderBuffer(p,l.__lights,null,w,y,E)));S=l.__webglObjectsImmediate,v=0;for(m=S.length;v<m;v++)y=S[v],E=y.object,E.visible&&(E._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,E.matrixWorld),n.renderImmediateObject(p,l.__lights,null,r,E));v=n.getClearColor(),m=n.getClearAlpha(),t.clearColor(v.r,v.g,v.b,m),t.enable(t.BLEND)}},e.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},e}),define("three-extras/shader-copy",["three"],function(e){e.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}}),define("three-extras/pass-shader",["three"],function(e){e.ShaderPass=function(t,n,r){this.textureID=n!==undefined?n:"tDiffuse",this.textureIDAlt=r!==undefined?r:"tDiffuse2",this.uniforms=e.UniformsUtils.clone(t.uniforms),this.material=new e.ShaderMaterial({uniforms:this.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,transparent:!0}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.camera=new e.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new e.Scene,this.quad=new e.Mesh(new e.PlaneGeometry(2,2),null),this.scene.add(this.quad)},e.ShaderPass.prototype={render:function(e,t,n,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n),this.uniforms[this.textureIDAlt]&&(this.uniforms[this.textureIDAlt].value=t),this.quad.material=this.material,this.renderToScreen?e.render(this.scene,this.camera):e.render(this.scene,this.camera,t,this.clear)}}}),define("three-extras/pass-mask",["three"],function(e){e.MaskPass=function(e,t){this.scene=e,this.camera=t,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},e.MaskPass.prototype={render:function(e,t,n,r){var i=e.context;i.colorMask(!1,!1,!1,!1),i.depthMask(!1);var s,o;this.inverse?(s=0,o=1):(s=1,o=0),i.enable(i.STENCIL_TEST),i.stencilOp(i.REPLACE,i.REPLACE,i.REPLACE),i.stencilFunc(i.ALWAYS,s,4294967295),i.clearStencil(o),e.render(this.scene,this.camera,n,this.clear),e.render(this.scene,this.camera,t,this.clear),i.colorMask(!0,!0,!0,!0),i.depthMask(!0),i.stencilFunc(i.EQUAL,1,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP)}},e.ClearMaskPass=function(){this.enabled=!0},e.ClearMaskPass.prototype={render:function(e,t,n,r){var i=e.context;i.disable(i.STENCIL_TEST)}}}),define("three-extras/effect-composer",["three","three-extras/shader-copy","three-extras/pass-shader","three-extras/pass-mask"],function(e){e.EffectComposer=function(t,n){this.renderer=t;if(n===undefined){var r=window.innerWidth||1,i=window.innerHeight||1,s={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat,stencilBuffer:!1};n=new e.WebGLRenderTarget(r,i,s)}this.renderTarget1=n,this.renderTarget2=n.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],e.CopyShader===undefined&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new e.ShaderPass(e.CopyShader)},e.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(t){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var n=!1,r,i,s=this.passes.length;for(i=0;i<s;i++){r=this.passes[i];if(!r.enabled)continue;r.render(this.renderer,this.writeBuffer,this.readBuffer,t,n);if(r.needsSwap){if(n){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,t),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}r instanceof e.MaskPass?n=!0:r instanceof e.ClearMaskPass&&(n=!1)}},reset:function(e){e===undefined&&(e=this.renderTarget1.clone(),e.width=window.innerWidth,e.height=window.innerHeight),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){var n=this.renderTarget1.clone();n.width=e,n.height=t,this.reset(n)}}}),define("three-extras/pass-bloom",["three"],function(e){e.BloomPass=function(t,n,r,i){t=t!==undefined?t:1,n=n!==undefined?n:25,r=r!==undefined?r:4,i=i!==undefined?i:256;var s={minFilter:e.LinearFilter,magFilter:e.LinearFilter,format:e.RGBFormat};this.renderTargetX=new e.WebGLRenderTarget(i,i,s),this.renderTargetY=new e.WebGLRenderTarget(i,i,s),e.CopyShader===undefined&&console.error("THREE.BloomPass relies on THREE.CopyShader");var o=e.CopyShader;this.copyUniforms=e.UniformsUtils.clone(o.uniforms),this.copyUniforms.opacity.value=t,this.materialCopy=new e.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:e.AdditiveBlending,transparent:!0}),e.ConvolutionShader===undefined&&console.error("THREE.BloomPass relies on THREE.ConvolutionShader");var u=e.ConvolutionShader;this.convolutionUniforms=e.UniformsUtils.clone(u.uniforms),this.convolutionUniforms.uImageIncrement.value=e.BloomPass.blurx,this.convolutionUniforms.cKernel.value=e.ConvolutionShader.buildKernel(r),this.materialConvolution=new e.ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:u.vertexShader,fragmentShader:u.fragmentShader,defines:{KERNEL_SIZE_FLOAT:n.toFixed(1),KERNEL_SIZE_INT:n.toFixed(0)}}),this.enabled=!0,this.needsSwap=!1,this.clear=!1,this.camera=new e.OrthographicCamera(-1,1,1,-1,0,1),this.scene=new e.Scene,this.quad=new e.Mesh(new e.PlaneGeometry(2,2),null),this.scene.add(this.quad)},e.BloomPass.prototype={render:function(t,n,r,i,s){s&&t.context.disable(t.context.STENCIL_TEST),this.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=r,this.convolutionUniforms.uImageIncrement.value=e.BloomPass.blurX,t.render(this.scene,this.camera,this.renderTargetX,!0),this.convolutionUniforms.tDiffuse.value=this.renderTargetX,this.convolutionUniforms.uImageIncrement.value=e.BloomPass.blurY,t.render(this.scene,this.camera,this.renderTargetY,!0),this.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY,s&&t.context.enable(t.context.STENCIL_TEST),t.render(this.scene,this.camera,r,this.clear)}},e.BloomPass.blurX=new e.Vector2(.001953125,0),e.BloomPass.blurY=new e.Vector2(0,.001953125)}),define("three-extras/pass-render",["three"],function(e){e.RenderPass=function(t,n,r,i,s){this.scene=t,this.camera=n,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=s!==undefined?s:1,this.oldClearColor=new e.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},e.RenderPass.prototype={render:function(e,t,n,r){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.render(this.scene,this.camera,n,this.clear),this.clearColor&&e.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}}}),define("three-extras/shader-convolution",["three"],function(e){e.ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{type:"t",value:null},uImageIncrement:{type:"v2",value:new e.Vector2(.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-(e*e)/(2*t*t))}var n,r,i,s,o=25,u=2*Math.ceil(e*3)+1;u>o&&(u=o),s=(u-1)*.5,r=new Array(u),i=0;for(n=0;n<u;++n)r[n]=t(n-s,e),i+=r[n];for(n=0;n<u;++n)r[n]/=i;return r}}}),define("three-extras/shader-fxaa",["three"],function(e){e.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new e.Vector2(1/1024,1/512)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","void main() {","vec3 rgbNW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbNE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * resolution ).xyz;","vec3 rgbSW = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * resolution ).xyz;","vec3 rgbSE = texture2D( tDiffuse, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * resolution ).xyz;","vec4 rgbaM  = texture2D( tDiffuse,  gl_FragCoord.xy  * resolution );","vec3 rgbM  = rgbaM.xyz;","float opacity  = rgbaM.w;","vec3 luma = vec3( 0.299, 0.587, 0.114 );","float lumaNW = dot( rgbNW, luma );","float lumaNE = dot( rgbNE, luma );","float lumaSW = dot( rgbSW, luma );","float lumaSE = dot( rgbSE, luma );","float lumaM  = dot( rgbM,  luma );","float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","vec2 dir;","dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","dir = min( vec2( FXAA_SPAN_MAX,  FXAA_SPAN_MAX),","max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),","dir * rcpDirMin)) * resolution;","vec3 rgbA = texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz;","rgbA += texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz;","rgbA *= 0.5;","vec3 rgbB = texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * -0.5 ).xyz;","rgbB += texture2D( tDiffuse, gl_FragCoord.xy  * resolution + dir * 0.5 ).xyz;","rgbB *= 0.25;","rgbB += rgbA * 0.5;","float lumaB = dot( rgbB, luma );","if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) ) {","gl_FragColor = vec4( rgbA, opacity );","} else {","gl_FragColor = vec4( rgbB, opacity );","}","}"].join("\n")}}),define("three-extras/shader-hblur",["three"],function(e){e.HorizontalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}}),define("three-extras/shader-vblur",["three"],function(e){e.VerticalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}}),define("three-extras/shader-blur",["three"],function(e){e.BlurShader={uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")}}),define("three-extras/shader-blend",["three"],function(e){e.BlendShader={uniforms:{tDiffuse:{type:"t",value:null},tDiffuse2:{type:"t",value:null},mixRatio:{type:"f",value:.5},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform float mixRatio;","uniform sampler2D tDiffuse;","uniform sampler2D tDiffuse2;","varying vec2 vUv;","void main() {","vec4 texel1 = texture2D( tDiffuse, vUv );","vec4 texel2 = texture2D( tDiffuse2, vUv );","gl_FragColor = texel1 * texel2;","}"].join("\n")}}),define("three-extras",["three","three-extras/effect-composer","three-extras/pass-bloom","three-extras/pass-mask","three-extras/pass-render","three-extras/pass-shader","three-extras/shader-convolution","three-extras/shader-copy","three-extras/shader-fxaa","three-extras/shader-hblur","three-extras/shader-vblur","three-extras/shader-blur","three-extras/shader-blend"],function(e){}),define("core/util/easing",{linear:function(e,t,n,r,i){return t/i*(r-n)+n},easeInQuad:function(e,t,n,r,i){return r*(t/=i)*t+n},easeOutQuad:function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},easeInOutQuad:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},easeInCubic:function(e,t,n,r,i){return r*(t/=i)*t*t+n},easeOutCubic:function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},easeInOutCubic:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},easeInQuart:function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},easeOutQuart:function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},easeInOutQuart:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},easeInQuint:function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},easeOutQuint:function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},easeInOutQuint:function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},easeInSine:function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},easeOutSine:function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},easeInOutSine:function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},easeInExpo:function(e,t,n,r,i){return t==0?n:r*Math.pow(2,10*(t/i-1))+n},easeOutExpo:function(e,t,n,r,i){return t==i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},easeInOutExpo:function(e,t,n,r,i){return t==0?n:t==i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},easeInCirc:function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},easeOutCirc:function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},easeInOutCirc:function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},easeInElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return-(u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o))+n},easeOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i)==1)return n+r;o||(o=i*.3);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return u*Math.pow(2,-10*t)*Math.sin((t*i-s)*2*Math.PI/o)+r+n},easeInOutElastic:function(e,t,n,r,i){var s=1.70158,o=0,u=r;if(t==0)return n;if((t/=i/2)==2)return n+r;o||(o=i*.3*1.5);if(u<Math.abs(r)){u=r;var s=o/4}else var s=o/(2*Math.PI)*Math.asin(r/u);return t<1?-0.5*u*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)+n:u*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*2*Math.PI/o)*.5+r+n},easeInBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*(t/=i)*t*((s+1)*t-s)+n},easeOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},easeInOutBack:function(e,t,n,r,i,s){return s==undefined&&(s=1.70158),(t/=i/2)<1?r/2*t*t*(((s*=1.525)+1)*t-s)+n:r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},easeInBounce:function(e,t,n,r,i){return r-jQuery.easing.easeOutBounce(e,i-t,0,r,i)+n},easeOutBounce:function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},easeInOutBounce:function(e,t,n,r,i){return t<i/2?jQuery.easing.easeInBounce(e,t*2,0,r,i)*.5+n:jQuery.easing.easeOutBounce(e,t*2-i,0,r,i)*.5+r*.5+n}}),define("core/util/animator",["core/util/event_base","core/util/easing"],function(e,t){var n=function(n){e.call(this);var r=n||{};this.duration=r.duration||1e3,this.timeline=null,this.easing=t.linear,r.easing&&(typeof r.easing=="function"?this.easing=r.easing:(this.easing=t[r.easing],this.easing==undefined&&(console.warn("Animator: Unknown easing: ",r.easing),this.easing=t.linear))),this.propEasing=t.linear,r.propEasing&&(typeof r.propEasing=="function"?this.propEasing=r.propEasing:(this.propEasing=t[r.propEasing],this.propEasing==undefined&&(console.warn("Animator: Unknown easing: ",r.propEasing),this.propEasing=t.linear))),r.timeline!==undefined&&this.setTimeline(r.timeline),this.assignFn={},this.animating=!1,this.loop=!1,this.toPosition=this.duration,this.fromPosition=0,this.timeOffset=0,this.completedCallback=null,this.chainCallback=null,this.__onUpdateCallbacks=[]};return n.prototype=Object.create(e.prototype),n.prototype.bind=function(e,t,n,r){if(typeof t=="function")this.assignFn[e]=t;else{var i=this.timeline.mapping[e]||function(e,t){return e};this.assignFn[e]=function(e,t,n,r,i){return function(e,s){t[n]=r(e,s),i&&t[i](e,s)}}(e,t,n,i,r)}this.timeline.defaults[e]!=undefined&&this.assignFn[e](this.timeline.defaults[e])},n.prototype.setTimeline=function(e){this.timeline=Object.create(e);if(this.timeline["keyframes"]==undefined){console.error("Animator: Invalid timeline specified: Keyframes are not defined!");return}this.timeline["config"]==undefined&&(this.timeline.config={}),this.timeline["mapping"]==undefined&&(this.timeline.mapping={}),this.timeline["tags"]==undefined&&(this.timeline.tags={}),this.timeline["defaults"]==undefined&&(this.timeline.defaults={}),this.timeline.keyframes.length===undefined&&(this.timeline.keyframes=[this.timeline.keyframes]);if(!this.timeline.optimized){var n=this.timeline.keyframes[0][0].p,r=n;for(var i=0;i<this.timeline.keyframes.length;i++){var s=this.timeline.keyframes[i];for(var o=0;o<s.length;o++)s[o].p<n&&(n=s[o].p),s[o].p>r&&(r=s[o].p)}var u=r-n;for(var i=0;i<this.timeline.keyframes.length;i++){var s=this.timeline.keyframes[i];for(var o=0;o<s.length;o++){s[o].p=(s[o].p-n)/u,s[o].e=s[o].e||{},s[o].v=s[o].v||{};for(k in s[o].e)if(typeof s[o].e[k]=="string"){var a=s[o].e[k];s[o].e[k]=t[a],s[o].e[k]==undefined&&(console.warn("Animator: Unknown easing '"+a+"' for property '"+k+"' in keyframe #",o),s[o].e[k]=this.propEasing)}}s._tFrom=0,s._tTo=1}for(k in this.timeline.tags)typeof this.timeline.tags[k]!="function"&&(this.timeline.tags[k]=(this.timeline.tags[k]-n)/u);this.timeline.optimized=!0}},n.prototype.setAnimationPos=function(e){if(!this.timeline){console.warn("Animator: Animation requested, but timeline has not been defined");return}for(var t=0;t<this.timeline.keyframes.length;t++){var n=this.timeline.keyframes[t],r=!1,i=!1;if(e<=n[0].p)s=0,o=1,r=!0;else if(e>=n[n.length-1].p)o=n.length-1,s=o-1,i=!0;else{var s=n._tFrom,o=n._tTo;if(e>=n[s].p)for(;;){if(!(s+1<n.length)){o=n.length-1;break}if(n[s+1].p>e){o=s+1;break}s++}else for(;;){if(!(o-1>0)){s=0;break}if(n[o-1].p<e){s=o-1;break}o--}}n._tFrom=s,n._tTo=o;var u=n[o].p-n[s].p,a=e-n[s].p,f=n[s].e||{},l=n[s].v,c=n[o].v;for(k in l)if(typeof l[k]!="function"){var h=l[k],p=c[k],d=f[k]||this.propEasing,v=this.assignFn[k]||function(e,t){console.warn("Animator: Missing assign function for property",k)};if(p==undefined)continue;r?v(h,this.timeline.config):i?v(p,this.timeline.config):v(d(null,a,0,p-h,u)+h,this.timeline.config)}}},n.prototype.update=function(e){if(!this.animating)return;this.timeOffset+=e,this.timeOffset>this.duration&&(this.timeOffset=this.duration);var t=this.easing(null,this.timeOffset,0,this.toPosition-this.fromPosition,this.duration)+this.fromPosition,n=t/this.duration;for(var r=0;r<this.__onUpdateCallbacks.length;r++)try{this.__onUpdateCallbacks[r](this.timeOffset)}catch(i){console.warn("Animator: onUpdate() callback #"+r+" raised exception",i)}this.timeOffset==this.duration&&(this.completedCallback&&(this.completedCallback(),this.completedCallback=null),this.chainCallback&&this.chainCallback(),this.loop?this.timeOffset=0:this.animating=!1),this.setAnimationPos(n)},n.prototype.start=function(e,t){return typeof e=="function"&&(t=e,e=!1),this.loop=e==undefined?!1:e,this.completedCallback=t||null,this.fromPosition=0,this.toPosition=this.duration,this.timeOffset=0,this.animating=!0,this},n.prototype.goto=function(e,t){var n=this.easing(null,this.timeOffset,0,this.toPosition-this.fromPosition,this.duration)+this.fromPosition;e<0&&(e=0),e>this.duration&&(e=this.duration);if(e==n){var r=n/this.duration;this.setAnimationPos(r);return}return this.fromPosition=n,this.toPosition=e,this.timeOffset=0,this.completedCallback=t,this.loop=!1,this.animating=!0,this},n.prototype.gotoTag=function(e,t){if(this.timeline.tags[e]==undefined){console.warn("Animator: Missing tag '"+e+"' in the timeline");return}var n=this.timeline.tags[e]*this.duration;this.goto(n,t)},n.prototype.onUpdate=function(e){this.__onUpdateCallbacks.push(e)},n.prototype.offUpdate=function(e){var t=this.__onUpdateCallbacks.indexOf(e);if(t<0)return;this.__onUpdateCallbacks.splice(t,1)},n}),define("vas-3d/util/marching-cubes-lookup",[],function(){var e={};return e.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),e.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),e}),define("vas-3d/util/metaballs",["three","vas-3d/util/marching-cubes-lookup"],function(e,t){var n=function(t,n,r,i){this.axisMin=t||-5,this.axisMax=n||5,this.isolevel=r||.5,this.size=i||30;var i=this.size,s=i*i,o=i*i*i,t=this.axisMin,n=this.axisMax,u=n-t;this.points=[];for(var a=0;a<i;a++)for(var f=0;f<i;f++)for(var l=0;l<i;l++){var c=t+u*l/(i-1),h=t+u*f/(i-1),p=t+u*a/(i-1);this.points.push(new e.Vector3(c,h,p))}this.values=[];for(var l=0;l<o;l++)this.values[l]=0;this.balls=[]};return n.prototype.reset=function(){for(var e=0;e<this.values.length;e++)this.values[e]=0},n.prototype.addBall=function(e){this.balls.push(e)},n.prototype.updateValues=function(){this.reset();for(var e=0;e<this.balls.length;e++){var t=this.balls[e];for(var n=0;n<this.values.length;n++){var r=1-t.distanceToSquared(this.points[n]);this.values[n]+=Math.exp(-(r*r))}}},n.prototype.getGeometry=function(){var n=this.size,r=n*n,i=n*n*n,s=this.isolevel,o=0,u=new Array(12),a=0,f=new e.Geometry;for(var l=0;l<n-1;l++)for(var c=0;c<n-1;c++)for(var h=0;h<n-1;h++){var p=h+n*c+r*l,d=p+1,v=p+n,m=v+1,g=p+r,y=d+r,b=v+r,w=m+r,E=this.values[p],S=this.values[d],x=this.values[v],T=this.values[m],N=this.values[g],C=this.values[y],k=this.values[b],L=this.values[w],A=0;E<s&&(A|=1),S<s&&(A|=2),x<s&&(A|=8),T<s&&(A|=4),N<s&&(A|=16),C<s&&(A|=32),k<s&&(A|=128),L<s&&(A|=64);var O=t.edgeTable[A];if(O===0)continue;var M=.5;O&1&&(M=(s-E)/(S-E),u[0]=this.points[p].clone().lerp(this.points[d],M)),O&2&&(M=(s-S)/(T-S),u[1]=this.points[d].clone().lerp(this.points[m],M)),O&4&&(M=(s-x)/(T-x),u[2]=this.points[v].clone().lerp(this.points[m],M)),O&8&&(M=(s-E)/(x-E),u[3]=this.points[p].clone().lerp(this.points[v],M)),O&16&&(M=(s-N)/(C-N),u[4]=this.points[g].clone().lerp(this.points[y],M)),O&32&&(M=(s-C)/(L-C),u[5]=this.points[y].clone().lerp(this.points[w],M)),O&64&&(M=(s-k)/(L-k),u[6]=this.points[b].clone().lerp(this.points[w],M)),O&128&&(M=(s-N)/(k-N),u[7]=this.points[g].clone().lerp(this.points[b],M)),O&256&&(M=(s-E)/(N-E),u[8]=this.points[p].clone().lerp(this.points[g],M)),O&512&&(M=(s-S)/(C-S),u[9]=this.points[d].clone().lerp(this.points[y],M)),O&1024&&(M=(s-T)/(L-T),u[10]=this.points[m].clone().lerp(this.points[w],M)),O&2048&&(M=(s-x)/(k-x),u[11]=this.points[v].clone().lerp(this.points[b],M));var _=0;A<<=4;while(t.triTable[A+_]!=-1){var D=t.triTable[A+_],P=t.triTable[A+_+1],H=t.triTable[A+_+2];f.vertices.push(u[D].clone()),f.vertices.push(u[P].clone()),f.vertices.push(u[H].clone()),f.faces.push(new e.Face3(a,a+1,a+2)),f.faceVertexUvs[o].push([new e.Vector2(0,0),new e.Vector2(0,1),new e.Vector2(1,1)]),a+=3,_+=3}}return f.mergeVertices(),f.computeFaceNormals(),f.computeVertexNormals(),f},n}),define("vas-3d/util/fluctuation",["three","vas-3d/util/metaballs"],function(e,t){var n=function(n){var r=n||{};this.isolevel=r.isolevel||.5,this.radius=r.radius||4,this.blobs=r.blobs||3,this.detail=r.detail||20,this.metaballBounds=3,this.color=r.color||16776960,this.transparent=r.transparent||!0,this.geometry=new e.Geometry,this.material=new e.MeshPhongMaterial({color:this.color,side:e.BackSide,transparent:this.transparent,opacity:1}),this.metaballs=new t(-this.metaballBounds,this.metaballBounds,this.isolevel,this.detail),this.blobStates=[];for(var i=0;i<this.blobs;i++){var s={v:new e.Vector3(0,0,0),q:(new e.Quaternion(Math.random(),Math.random(),Math.random(),Math.random())).normalize(),ps:Math.max(Math.random(),.5)};this.metaballs.addBall(s.v),this.blobStates.push(s)}e.Object3D.call(this)};return n.prototype=Object.create(e.Object3D.prototype),n.prototype.regenerate=function(){this.mesh!=null&&this.remove(this.mesh),this.metaballs.updateValues(),this.geometry=this.metaballs.getGeometry(),this.mesh=new e.Mesh(this.geometry,this.material),this.add(this.mesh),this.mesh.scale.set(this.radius/this.metaballBounds,this.radius/this.metaballBounds,this.radius/this.metaballBounds)},n.prototype.setPhase=function(e){var t=this.metaballBounds/2;for(var n=0;n<this.blobs;n++){var r=this.blobStates[n];r.v.set(Math.cos(e*r.ps)*t,Math.sin(e*r.ps)*t,0),r.v.applyQuaternion(r.q)}this.regenerate()},n.prototype.setOpacity=function(e){this.material.opacity=e},n}),define("three-extras/shader-fluctuation",["three"],function(e){e.FluctuationShader={defines:{PI:"3.14159265"},uniforms:{tSkin:{type:"t",value:null},scale:{type:"v2",value:new e.Vector2(1,1)},rotation:{type:"f",value:0},flucMinDiam:{type:"f",value:.5},flucMaxDiam:{type:"f",value:1},vP1:{type:"v4",value:new e.Vector4(0,.25,1,.11548)},vP2:{type:"v4",value:new e.Vector4(1.8,.2,1,-0.04357)},vP3:{type:"v4",value:new e.Vector4(4,.15,1,.59512)},vP4:{type:"v4",value:new e.Vector4(5,.22,1,-0.14778)},vP5:{type:"v4",value:new e.Vector4(6,.05,1,.33154)},fTime:{type:"f",value:0},fOpacity:{type:"f",value:1}},vertexShader:["uniform float rotation;","uniform vec2 scale;","varying vec2 vUv;","void main() {","vUv = uv;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += position.xy * scale;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"),fragmentShader:["uniform vec4 vP1;","uniform vec4 vP2;","uniform vec4 vP3;","uniform vec4 vP4;","uniform vec4 vP5;","uniform float flucMinDiam;","uniform float flucMaxDiam;","uniform float fTime;","uniform float fOpacity;","uniform sampler2D tSkin;","varying vec2 vUv;","#define tPart01(t) 	 		mix( vec2(0.0,0.0), vec2(0.5,0.5), t )","#define tPart02(t) 	 		mix( vec2(0.5,0.0), vec2(1.0,0.5), t )","#define tBack01(t) 	 		mix( vec2(0.0,0.5), vec2(0.5,1.0), t )","#define tBack02(t) 	 		mix( vec2(0.5,0.5), vec2(1.0,1.0), t )","#define tRotate(t,a)	   	   (mat2( vec2(cos(a), -sin(a)), vec2(sin(a), cos(a)) ) * (t - vec2(0.5,0.5) )) + vec2(0.5,0.5)","#define circleMask(x)	 		distance( x, vec2(0.5,0.5) ) <= 0.5","#define blend_Screen(c1,c2)	(1.0-((1.0-c1.rgb)*(1.0-c2.rgb)))","#define blend_Add(c1,c2)		min(c1.rgb + c2.rgb, 1.0)","#define blend_Multiply(c1,c2)	c1.rgb * c2.rgb","#define glc_AlphaBlend(c)		texelColor = mix(texelColor, c, c.a)","#define glc_MultiplyBlend(c)	texelColor = mix(texelColor, vec4(blend_Multiply( texelColor, c), 1.0), c.a)","#define glc_ScreenBlend(c)		texelColor = mix(texelColor, vec4(  blend_Screen( texelColor, c), 1.0), c.a)","#define glc_AddBlend(c)		texelColor = mix(texelColor, vec4(     blend_Add( texelColor, c), 1.0), c.a)","void main() {","vec2 comSize = vec2( 0.5, 0.5 );","vec2 comCenter = vec2( 0.5, 0.5 );","vec2 p1Size = comSize * vP1.z * ((sin(fTime*vP1.w*4.0+1.570796325)+1.0)/2.0+0.5);","vec2 p1Edge = vec2( cos(vP1.x + fTime*vP1.w)*vP1.y, sin(vP1.x + fTime*vP1.w)*vP1.y ) + comCenter - p1Size/2.0;","vec2 p2Size = comSize * vP2.z * ((sin(fTime*vP2.w*4.0+1.570796325)+1.0)/2.0+0.5);","vec2 p2Edge = vec2( cos(vP2.x + fTime*vP2.w)*vP2.y, sin(vP2.x + fTime*vP2.w)*vP2.y ) + comCenter - p2Size/2.0;","vec2 p3Size = comSize * vP3.z * ((sin(fTime*vP3.w*4.0+4.712388975)+1.0)/2.0+0.5);","vec2 p3Edge = vec2( cos(vP3.x + fTime*vP3.w)*vP3.y, sin(vP3.x + fTime*vP3.w)*vP3.y ) + comCenter - p3Size/2.0;","vec2 p4Size = comSize * vP4.z * ((sin(fTime*vP4.w*4.0+4.712388975)+1.0)/2.0+0.5);","vec2 p4Edge = vec2( cos(vP4.x + fTime*vP4.w)*vP4.y, sin(vP4.x + fTime*vP4.w)*vP4.y ) + comCenter - p4Size/2.0;","vec2 p5Size = comSize * vP5.z * ((sin(fTime*vP5.w*4.0+4.712388975)+1.0)/2.0+0.5);","vec2 p5Edge = vec2( cos(vP5.x + fTime*vP5.w)*vP5.y, sin(vP5.x + fTime*vP5.w)*vP5.y ) + comCenter - p5Size/2.0;","vec4 texel1 = vec4( 0.0, 0.0, 0.0, 0.0 );","if ( all(greaterThanEqual(vUv,p1Edge)) && all(lessThanEqual(vUv,p1Edge+p1Size)) ) {","texel1 = texture2D( tSkin, tPart01( (vUv-p1Edge)/p1Size ) );","}","vec4 texel2 = vec4( 0.0, 0.0, 0.0, 0.0 );","if ( all(greaterThanEqual(vUv,p2Edge)) && all(lessThanEqual(vUv,p2Edge+p2Size)) ) {","texel2 = texture2D( tSkin, tPart02( (vUv-p2Edge)/p2Size ) );","}","vec4 texel3 = vec4( 0.0, 0.0, 0.0, 0.0 );","if ( all(greaterThanEqual(vUv,p3Edge)) && all(lessThanEqual(vUv,p3Edge+p3Size)) ) {","texel3 = texture2D( tSkin, tPart01( (vUv-p3Edge)/p3Size ) );","}","vec4 texel4 = vec4( 0.0, 0.0, 0.0, 0.0 );","if ( all(greaterThanEqual(vUv,p4Edge)) && all(lessThanEqual(vUv,p4Edge+p5Size)) ) {","texel4 = texture2D( tSkin, tPart02( (vUv-p4Edge)/p5Size ) );","}","vec4 texel5 = vec4( 0.0, 0.0, 0.0, 0.0 );","if ( all(greaterThanEqual(vUv,p5Edge)) && all(lessThanEqual(vUv,p5Edge+p5Size)) ) {","texel5 = texture2D( tSkin, tPart01( (vUv-p5Edge)/p5Size ) );","}","vec2 backPos = tRotate( vUv, fTime*0.04 );","vec4 texelColor = vec4( 1.0, 1.0, 1.0, 0.0 );","if (circleMask(backPos))","glc_AlphaBlend( texture2D( tSkin, tBack01( backPos ) ) );","backPos = tRotate( vUv, -fTime*0.03 );","if (circleMask(backPos))","glc_AlphaBlend( texture2D( tSkin, tBack01( backPos ) ) );","glc_ScreenBlend( texel1 );","glc_ScreenBlend( texel2 );","glc_ScreenBlend( texel3 );","glc_ScreenBlend( texel4 );","glc_ScreenBlend( texel5 );","if (fOpacity*texelColor.a < 0.05) discard;","gl_FragColor = vec4( vec3(1.0,1.0,1.0)*texelColor.xyz, texelColor.a * fOpacity );","}"].join("\n")}}),define("vas-3d/util/fluctuation-sprite",["three","three-extras/shader-fluctuation"],function(e){var t=function(t){var n=t||{};this.lookTarget=t.lookAt||null,this.radius=t.radius||1,this.mapSkin=t.mapSkin||e.ImageUtils.loadTexture("static/img/skin01.png"),this.uniforms=e.UniformsUtils.clone(e.FluctuationShader.uniforms),this.uniforms.tSkin.value=this.mapSkin,this.material=new e.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.FluctuationShader.vertexShader,fragmentShader:e.FluctuationShader.fragmentShader,transparent:!0,depthWrite:!1,opacity:1}),this.geometry=new e.PlaneGeometry(this.radius,this.radius),e.Mesh.call(this,this.geometry,this.material)};return t.prototype=Object.create(e.Mesh.prototype),t.prototype.setParticleXY=function(e,t,n,r){var i=Math.atan2(t.y/t.x),s=Math.sqrt(t.x*t.x+t.y*t.y),o=n||1,u=r||Math.random();this.uniforms["vP"+e].value.set(i,s,o,u)},t.prototype.setParticleAR=function(e,t,n,r,i){var s=t,o=n,u=r||1,a=i||Math.random();this.uniforms["vP"+e].value.set(s,o,u,a)},t.prototype.setPhase=function(e){this.lookTarget&&this.lookAt(this.lookTarget),this.uniforms.fTime.value=e},t}),define("vas-3d/util/feyman",["three"],function(e){var t=function(t,n,r,i){e.Vector3.call(this,n,r,i),this.diagram=t};t.prototype=Object.create(e.Vector3.prototype),t.prototype.addKink=function(e,n,r,i){var s=new t(this.diagram,e||0,n||0,r||0);return this.diagram.lines.push({linkType:i,from:this,to:s}),s};var n=function(){e.Object3D.call(this),this.lines=[],this.lineObject=null,this.material=new e.LineBasicMaterial({color:16711680,linewidth:1,transparent:!0,opacity:1})};return n.prototype=Object.create(e.Object3D.prototype),n.prototype.addKink=function(e,n,r){return new t(this,e||0,n||0,r||0)},n.prototype.update=function(){this.lineObject&&this.remove(this.lineObject);var t=new e.Geometry;for(var n=0;n<this.lines.length;n++)t.vertices.push(this.lines[n].from),t.vertices.push(this.lines[n].to);this.lineObject=new e.Line(t,this.material,e.LinePieces),this.add(this.lineObject)},n}),define("vas-3d/scenes/fractal-test",["three","three-extras"],function(e,t){var n={},r=250,i=150,s=80,o=20,u=5;return n.config={rA:s,rB:o,rC:u,p1:[-3*r,0],p2:[-2*r,0],p3:[-2*r+o/2,o/2],p4:[-2*r+o/2,-o/2],p5:[-r,i/2],p6:[-r,-i/2],p7:[-r+u,-i/2],p8:[-r,-i/2-u],p9:[-r/2,-i],p10:[-u/2,0],p20:[u/2,0],p21:[r,-i/2],p22:[r/2,i],p23:[2*r,0],p24:[r,i/2],p25:[3*r,0]},n.getDefinitions=function(e){return{THREE:"three",THREEx:"three-extras",FeymanDiagram:"vas-3d/util/feyman",FluctuationSprite:"vas-3d/util/fluctuation-sprite",HazeSprite:"vas-3d/util/haze-sprite"}},n.getMaps=function(e,t){return{particles:{src:"static/img/sprites.png",sprites:[4,4]},fluxes:{src:"static/img/particle-skins.png",sprites:[2,2]},"fluc-glow":{src:"static/img/star-blue-purple-glow.png"},"fluc-particle":{src:"static/img/particle-03.png"},backflux:{src:"static/img/yellow_glow.png"},fluxskin01:{src:"static/img/skin01.png"},fluxskin02:{src:"static/img/skin02.png"},partHazeNoise:{src:"static/img/particle-noise.jpg"},partHazeMask:{src:"static/img/particle-mask.jpg"},partHazeDiffuse:{src:"static/img/particle-03.png"}}},n.getMaterials=function(e,t,n){return{partA0:new t.THREE.SpriteMaterial({map:n.get("particles",0,3),color:16777215,fog:!0,transparent:!0}),partB0:new t.THREE.SpriteMaterial({map:n.get("particles",2,3),color:16777215,fog:!0,transparent:!0}),partB1:new t.THREE.SpriteMaterial({map:n.get("particles",2,2),color:16777215,fog:!0,transparent:!0}),partC0:new t.THREE.SpriteMaterial({map:n.get("particles",1,2),color:16777215,fog:!0,transparent:!0}),partC1:new t.THREE.SpriteMaterial({map:n.get("particles",0,3),color:16777215,fog:!0,transparent:!0}),backflux0:new t.THREE.MeshBasicMaterial({map:n.get("fluxes",0,1),color:16777215,fog:!0,transparent:!0})}},n.getGeometries=function(e,t){return{}},n.getObjects=function(t,n,r,i,s){return{grid:{create:function(){var e=new n.THREE.GridHelper(1e4,250);return e.position.y=-400,e}},feyman0:{create:function(){var e=new n.FeymanDiagram;return e.position.z=-10,e.k0=e.addKink(t.p1[0],t.p1[1]),e.k1=e.k0.addKink(t.p2[0],t.p2[1]),e.k2=e.k1.addKink(t.p6[0],t.p6[1]),e.k3=e.k1.addKink(t.p5[0],t.p5[1]),e.k4=e.k2.addKink(t.p9[0],t.p9[1]),e.k5=e.k2.addKink(t.p10[0],t.p10[1]),e},bind:{"feyman0.a":function(e,t){e.material.opacity=t}},update:function(e,t){e.update()}},feyman1:{create:function(){var e=new n.FeymanDiagram;return e.position.z=-10,e.k0=e.addKink(t.p25[0],t.p25[1]),e.k1=e.k0.addKink(t.p23[0],t.p23[1]),e.k2=e.k1.addKink(t.p24[0],t.p24[1]),e.k3=e.k1.addKink(t.p21[0],t.p21[1]),e.k4=e.k2.addKink(t.p22[0],t.p22[1]),e.k5=e.k2.addKink(t.p20[0],t.p20[1]),e},bind:{"feyman1.a":function(e,t){e.material.opacity=t}},update:function(e,t){e.update()}},backflux0:{create:function(){var t=new n.HazeSprite({mapDiffuse:r.get("partHazeDiffuse"),mapNoise:r.get("partHazeNoise"),mapMask:r.get("partHazeMask")});return t.p1=new e.Vector3(0,0,-100),t.p2=new e.Vector3(0,0,-100),t.rescale=function(){var e=this.p2.clone().sub(this.p1),t=this.p2.clone().add(this.p1).divideScalar(2),n=e.length();this.position.copy(t),this.scale.set(n,n,n)},t.t=0,t},update:function(e,t){e.setPhase(e.t+=t/1e4)},bind:{"backflux0.p1.x":function(e,t){e.p1.setX(t-20),e.rescale()},"backflux0.p1.y":function(e,t){e.p1.setY(t),e.rescale()},"backflux0.p2.x":function(e,t){e.p2.setX(t+100),e.rescale()},"backflux0.p2.y":function(e,t){e.p2.setY(t),e.rescale()},"backflux0.a":function(e,t){e.setOpacity(t)}}},backflux1:{create:function(){var t=new n.HazeSprite({mapDiffuse:r.get("partHazeDiffuse"),mapNoise:r.get("partHazeNoise"),mapMask:r.get("partHazeMask")});return t.p1=new e.Vector3(0,0,-100),t.p2=new e.Vector3(0,0,-100),t.rescale=function(){var e=this.p2.clone().sub(this.p1),t=this.p2.clone().add(this.p1).divideScalar(2),n=e.length();this.position.copy(t),this.scale.set(n,n,n)},t.t=0,t},update:function(e,t){e.setPhase(e.t+=t/1e4)},bind:{"backflux1.p1.x":function(e,t){e.p1.setX(t-20),e.rescale()},"backflux1.p1.y":function(e,t){e.p1.setY(t),e.rescale()},"backflux1.p2.x":function(e,t){e.p2.setX(t+100),e.rescale()},"backflux1.p2.y":function(e,t){e.p2.setY(t),e.rescale()},"backflux1.a":function(e,t){e.setOpacity(t)}}},flucA0:{create:function(){var e=new n.FluctuationSprite({radius:t.rA,mapSkin:r.get("fluxskin01")});return e.position.z=-5,e.setParticleAR(1,Math.PI/4,.25),e.setParticleAR(2,-Math.PI/4,.25),e},bind:{"flucA0.x":function(e,t){e.position.setX(t)},"flucA0.y":function(e,t){e.position.setY(t)},"flucA0.a":function(e,t){e.uniforms.fOpacity.value=t},"flucA0.p":function(e,t){e.setPhase(t)},"flucA0.s":function(e,t){e.uniforms.scale.value.set(t,t)}}},flucB1:{create:function(){var e=new n.FluctuationSprite({radius:t.rB,mapSkin:r.get("fluxskin02")});return e.position.z=-5,e.setParticleAR(1,0,.25),e.setParticleAR(2,-Math.PI/2,.25),e},bind:{"flucB1.x":function(e,t){e.position.setX(t)},"flucB1.y":function(e,t){e.position.setY(t)},"flucB1.a":function(e,t){e.uniforms.fOpacity.value=t},"flucB1.p":function(e,t){e.setPhase(t)},"flucB1.s":function(e,t){e.uniforms.scale.value.set(t,t)}}},partA0:{create:function(){var e=new n.THREE.Sprite(i.get("partA0"));return e.scale.set(t.rA,t.rA,t.rA),e},bind:{"partA0.x":function(e,t){e.position.setX(t)},"partA0.y":function(e,t){e.position.setY(t)},"partA0.a":function(e,t){e.material.opacity=t}}},partB0:{create:function(){var e=new n.THREE.Sprite(i.get("partB0"));return e.scale.set(t.rB,t.rB,t.rB),e},bind:{"partB0.x":function(e,t){e.position.setX(t)},"partB0.y":function(e,t){e.position.setY(t)},"partB0.a":function(e,t){e.material.opacity=t}}},partB1:{create:function(){var e=new n.THREE.Sprite(i.get("partB1"));return e.scale.set(t.rB,t.rB,t.rB),e},bind:{"partB1.x":function(e,t){e.position.setX(t)},"partB1.y":function(e,t){e.position.setY(t)},"partB1.a":function(e,t){e.material.opacity=t}}},partC0:{create:function(){var e=new n.THREE.Sprite(i.get("partC0"));return e.scale.set(t.rC,t.rC,t.rC),e},bind:{"partC0.x":function(e,t){e.position.setX(t)},"partC0.y":function(e,t){e.position.setY(t)},"partC0.a":function(e,t){e.material.opacity=t}}},partC1:{create:function(){var e=new n.THREE.Sprite(i.get("partC1"));return e.scale.set(t.rC,t.rC,t.rC),e},bind:{"partC1.x":function(e,t){e.position.setX(t)},"partC1.y":function(e,t){e.position.setY(t)},"partC1.a":function(e,t){e.material.opacity=t}}}}},n.getTimeline=function(e){return{defaults:{"backflux0.a":0,"backflux0.p1.x":e.p1[0],"backflux0.p1.y":e.p1[1],"backflux0.p2.x":e.p2[0],"backflux0.p2.y":e.p2[1],"backflux1.a":0,"backflux1.p1.x":e.p20[0],"backflux1.p1.y":e.p20[1],"backflux1.p2.x":e.p25[0],"backflux1.p2.y":e.p25[1],"partA0.a":0,"partB0.a":0,"partB1.a":0,"partC0.a":0,"partC1.a":0,"flucA0.a":1,"flucA0.s":1,"flucB1.a":0,"flucB1.s":1,"feyman0.a":0,"feyman1.a":0,"cam.x":0,"cam.y":0,"cam.z":1800},tags:{start:0,split1:1,split2:2,"final":3,end:4},keyframes:[[{p:0,v:{"backflux0.p2.x":e.p1[0],"backflux0.p2.y":e.p1[1]}},{p:3,v:{"backflux0.p2.x":e.p10[0],"backflux0.p2.y":e.p10[1]}}],[{p:0,v:{"camera.x":e.p1[0],"camera.y":e.p1[1],"camera.target.x":e.p1[0],"camera.target.y":e.p1[1],"camera.z":1800,"camera.target.z":0},e:{}},{p:1,v:{"camera.x":e.p2[0],"camera.y":e.p2[1],"camera.target.x":e.p2[0],"camera.target.y":e.p2[1],"camera.z":200,"camera.target.z":0},e:{}},{p:2,v:{"camera.x":e.p6[0],"camera.y":e.p6[1],"camera.target.x":e.p6[0],"camera.target.y":e.p6[1],"camera.z":100,"camera.target.z":0},e:{}},{p:3,v:{"camera.x":e.p10[0],"camera.y":e.p10[1],"camera.target.x":e.p10[0],"camera.target.y":e.p10[1],"camera.z":50,"camera.target.z":0},e:{"camera.z":"easeOutExpo"}},{p:4,v:{"camera.x":e.p10[0],"camera.y":e.p10[1],"camera.target.x":e.p10[0],"camera.target.y":e.p10[1],"camera.z":1800,"camera.target.z":0}}],[{p:0,v:{"partA0.a":1,"flucA0.a":0,"flucA0.p":50}},{p:.5,v:{"partA0.a":0,"flucA0.a":1,"flucA0.p":25}},{p:1,v:{"backflux0.a":0,"backflux1.a":0,"flucA0.p":0,"flucA0.a":1,"flucA0.s":1}},{p:1.1,v:{"backflux0.a":.2,"backflux1.a":.2,"flucA0.p":-1,"flucA0.a":0,"flucA0.s":1,"flucB1.a":0,"flucB1.s":1,"flucB1.p":50}},{p:1.5,v:{"backflux0.a":1,"backflux1.a":1,"flucA0.a":0,"flucA0.s":1,"flucB1.a":1,"flucB1.s":1,"flucB1.p":25}},{p:2,v:{"flucB1.p":0,"flucB1.s":1,"flucB1.a":1}},{p:2.1,v:{"flucB1.s":1,"flucB1.a":0,"flucB1.p":-1}},{p:3,v:{"flucB1.s":1,"flucB1.a":0,"feyman0.a":0,"feyman1.a":0}},{p:4,v:{"feyman0.a":1,"feyman1.a":1}}],[{p:0,v:{"partB0.a":0,"partB1.a":0}},{p:.8,v:{"partB0.a":0,"partB1.a":0}},{p:1,v:{"partB0.a":1,"partB1.a":1}},{p:1.8,v:{"partB0.a":1,"partC0.a":0,"partC1.a":0}},{p:2,v:{"partC0.a":1,"partC1.a":1}}],[{p:0,v:{"partA0.x":e.p1[0],"partA0.y":e.p1[1],"flucA0.x":e.p1[0],"flucA0.y":e.p1[1]}},{p:1,v:{"partA0.x":e.p2[0],"partA0.y":e.p2[1],"flucA0.x":e.p2[0],"flucA0.y":e.p2[1],"partB0.x":e.p3[0],"partB0.y":e.p3[1],"partB1.x":e.p4[0],"partB1.y":e.p4[1],"flucB1.x":e.p4[0],"flucB1.y":e.p4[1]}},{p:2,v:{"partB0.x":e.p5[0],"partB0.y":e.p5[1],"partB1.x":e.p6[0],"partB1.y":e.p6[1],"flucB1.x":e.p6[0],"flucB1.y":e.p6[1],"partC0.x":e.p7[0],"partC0.y":e.p7[1],"partC1.x":e.p8[0],"partC1.y":e.p8[1]}},{p:3,v:{"partC0.x":e.p10[0],"partC0.y":e.p10[1],"partC1.x":e.p9[0],"partC1.y":e.p9[1]}}]]}},n}),define("vas-3d/modules/exp-3d",["three","three-extras","core/util/animator","core/registry","core/base/components","vas-3d/util/fluctuation","vas-3d/util/fluctuation-sprite","vas-3d/util/feyman","vas-3d/scenes/fractal-test"],function(e,t,n,r,i,s,o,u,a){var f="data:image/gif;base64,R0lGODlhQABAAIAAAP8A/////yH5BAEAAAEALAAAAABAAEAAAAJFhI+py+0Po5y02ouz3rz7D4biSJbmiabqyrbuC8fyTNf2jef6zvf+DwwKh8Si8YhMKpfMpvMJjUqn1Kr1is1qt9yuF1AAADs=",l=function(t){this.get=function(n,r,i){if(t[n]==undefined)return console.warn("Scene: Could not find map '"+n+"'"),e.ImageUtils.loadTexture(f);var s=t[n],o=e.ImageUtils.loadTexture(s.src);if(s.sprites!==undefined){var u=1/s.sprites[0],a=1/s.sprites[1];o.repeat.set(u,a);var l=r||0,c=i||0;o.offset.set(u*l,a*c)}return o}},c=function(t){this.get=function(n){return t[n]==undefined?(console.warn("Scene: Could not find material '"+n+"'"),new e.MeshBasicMaterial({color:16711935,side:e.DoubleSide})):t[n]},this.bindTimeUpdates=function(e){for(var n in t){var r=t[n];r.uniforms!==undefined&&r.uniforms.fSceneTime!==undefined&&r.uniforms["fSceneTime"].type=="f"&&(console.log("Will: ",r),e.onUpdate(function(e){r.uniforms.fSceneTime.value=e}))}}},h=function(t){this.get=function(n){return t[n]==undefined?(console.warn("Scene: Could not find geometry '"+n+"'"),new e.SphereGeometry(1)):t[n]}},d={};d.AutoScene=function(t,r){var i=this;this.mainScene=new e.Object3D,this.glowScene=new e.Object3D,this.camera=new e.Vector3(0,0,1800),this.cameraTarget=new e.Vector3(0,0,0),this.update=function(e){};var s=r.config||{},o=r.getDefinitions(s),u=[],a=[];for(k in o)a.push(k),u.push(o[k]);requirejs(u,function(){var e={},t=Array.prototype.slice.call(arguments);for(var o=0;o<t.length;o++)e[a[o]]=t[o];var u=new l(r.getMaps(s,e)),f=new c(r.getMaterials(s,e,u)),d=new h(r.getGeometries(s,e)),v=new n({duration:1e4,timeline:r.getTimeline(s)});v.bind("camera.x",i.camera,"x"),v.bind("camera.y",i.camera,"y"),v.bind("camera.z",i.camera,"z"),v.bind("camera.target.x",i.cameraTarget,"x"),v.bind("camera.target.y",i.cameraTarget,"y"),v.bind("camera.target.z",i.cameraTarget,"z"),f.bindTimeUpdates(v),window.anim0=v;var m=r.getObjects(s,e,u,f,d),g=[];for(k in m){var y=m[k];if(typeof y=="object"){var b=y.create();i.mainScene.add(b);if(y["bind"]!=undefined)for(p in y.bind)v.bind(p,function(e,t){return function(n,r){return t(e,n,r)}}(b,y.bind[p]));y["update"]!=undefined&&g.push(function(e,t){return function(n){return t(e,n)}}(b,y.update))}i.update=function(e){for(var t=0;t<g.length;t++)g[t](e);v.update(e)}}})};var v=function(t){i.ExplainScreen.call(this,t),this.container=t,this.mouse=new e.Vector2,this.half=new e.Vector2,this.camera=new e.PerspectiveCamera(20,640/480,1,1e4),this.camera.position.z=1800,this.mainScene=new e.Scene,this.glowScene=new e.Scene,this.renderer=new e.WebGLRenderer({antialias:!0}),this.renderer.setClearColor(16777215),this.container.append(this.renderer.domElement),this.renderer.autoClear=!0,this.renderer.sortObjects=!0,this.composer=new e.EffectComposer(this.renderer),this.renderGlow=new e.RenderPass(this.glowScene,this.camera),this.renderMain=new e.RenderPass(this.mainScene,this.camera),this.effectBloom=new e.BloomPass(1.3),this.effectFXAA=new e.ShaderPass(e.FXAAShader),this.effectCopyBlur=new e.ShaderPass(e.CopyShader),this.effectCopy=new e.ShaderPass(e.CopyShader),this.effectHBlur=new e.ShaderPass(e.HorizontalBlurShader),this.effectVBlur=new e.ShaderPass(e.VerticalBlurShader),this.effectBlend=new e.ShaderPass(e.BlendShader),this.renderGlow.clear=!0,this.renderMain.clear=!0,this.effectVBlur.needsSwap=!1,this.effectCopy.renderToScreen=!0,this.composer.addPass(this.renderGlow),this.composer.addPass(this.effectHBlur),this.composer.addPass(this.effectVBlur),this.composer.addPass(this.renderMain),this.composer.addPass(this.effectBlend),this.composer.addPass(this.effectFXAA),this.composer.addPass(this.effectCopy),light=new e.DirectionalLight(16777215),light.position.set(0,0,1),this.mainScene.add(light),this.activeScene=new d.AutoScene(this,a),this.mainScene.fog=new e.FogExp2(16777215,25e-5),this.mainScene.add(this.activeScene.mainScene),this.glowScene.add(this.activeScene.glowScene),$(this.container).mousemove(function(e){this.mouse.x=(e.offsetX-this.half.x)/this.half.x,this.mouse.y=(e.offsetY-this.half.y)/this.half.y}.bind(this)),this.animating=!1,this.lastFrameTime=Date.now();var n=$('<div class="parameter"><h1>B1</h1><div class="title">This is the B1 parameter</div></div>');n.css({left:50,top:50}),this.hostDOM.append(n)};v.prototype=Object.create(i.ExplainScreen.prototype),v.prototype.onResize=function(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.half.x=e/2,this.half.y=t/2,this.renderer.setSize(e,t);var n=4;this.effectFXAA.uniforms.resolution.value.set(1/e,1/t),this.effectHBlur.uniforms.h.value=n/e,this.effectVBlur.uniforms.v.value=n/t,this.composer.reset()},v.prototype.focusProcess=function(e){anim0.start()},v.prototype.animate=function(){if(!this.animating)return;requestAnimationFrame(this.animate.bind(this)),this.render()},v.prototype.render=function(){var t=Date.now(),n=t-this.lastFrameTime;this.lastFrameTime=t,this.activeScene.update(n);var r=this.activeScene.camera.clone(),i=this.activeScene.cameraTarget.clone(),s=i.clone().sub(r),o=new e.Vector3(0,1,0),u=s.clone(),a=(new e.Matrix4).makeRotationAxis(o,Math.PI/2);u.applyMatrix4(a);var f=5,l=s.length()/f;o.normalize().multiplyScalar(this.mouse.y*l/20),u.normalize().multiplyScalar(this.mouse.x*l),r.add(u).add(o),this.camera.position.set(r.x,r.y,r.z),this.camera.lookAt(i),this.renderer.clear(),this.renderer.render(this.mainScene,this.camera)},v.prototype.onWillShow=function(e){this.animating=!0,this.animate(),e()},v.prototype.onHidden=function(){this.animating=!1},r.registerComponent("explain.physics",v)}),define("vas-3d/modules/globe-3d",["three","three-extras","core/registry","core/base/component"],function(e,t,n,r){var i=function(t){r.call(this,t),this.animating=!0,this.half={x:0,y:0},window.d=this,this.camera=new e.PerspectiveCamera(20,640/480,1,1e4),this.camera.position.z=375,this.scene=new e.Scene,this.renderer=new e.WebGLRenderer({antialias:!0,alpha:!0}),this.hostDOM.append(this.renderer.domElement),this.light=new e.AmbientLight(16777215),this.light.position.set(500,500,500),this.scene.add(this.light),this.globeRadius=50,this.globeHost=new e.Object3D,this.scene.add(this.globeHost);var n=new e.SphereGeometry(this.globeRadius,30,20),i=new e.MeshBasicMaterial({color:16777215,wireframe:!1,transparent:!0,side:e.DoubleSide,map:e.ImageUtils.loadTexture("static/img/earth.png")});this.sphere=new e.Mesh(n,i),this.sphere.position.set(0,0,0),this.globeHost.add(this.sphere),this.pinGeometry=new e.SphereGeometry(2),this.pinMaterial=new e.MeshBasicMaterial({color:16711680}),this.pinLineMaterial=new e.LineBasicMaterial({color:16711680}),this.pins=[]};i.prototype=Object.create(r.prototype),i.prototype.addPin=function(t,n,r){var i=r||6;n-=5;var s=new e.Mesh(this.pinGeometry,this.pinMaterial);s.rotateZ(t*Math.PI/180),s.rotateY(n*Math.PI/180),s.translateX(this.globeRadius+i);var o=new e.Geometry;o.vertices.push(new e.Vector3(0,0,0)),o.vertices.push(new e.Vector3(i,0,0));var u=new e.Line(o,this.pinLineMaterial);return u.rotateZ(t*Math.PI/180),u.rotateY(n*Math.PI/180),u.translateX(this.globeRadius),this.globeHost.add(s),this.globeHost.add(u),this.pins.push(s),s._line=u,s},i.prototype.removePin=function(e){var t=this.pins.indexof(e);if(t<0)return;this.pins.splice(t,1),this.globeHost.remove(e._line),this.globeHost.remove(e)},i.prototype.removeAllPins=function(){for(var e=0;e<this.pins.length;e++)this.globeHost.remove(this.pins[e]._line),this.globeHost.remove(this.pins[e]);this.pins=[]},i.prototype.animate=function(){if(!this.animating)return;requestAnimationFrame(this.animate.bind(this)),this.render()},i.prototype.render=function(){this.globeHost.rotateY(.01),this.renderer.render(this.scene,this.camera)},i.prototype.onResize=function(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.half.x=e/2,this.half.y=t/2,this.renderer.setSize(e,t)},i.prototype.onHidden=function(){this.animating=!1},i.prototype.onWillShow=function(e){this.animating=!0,this.animate(),e()},n.registerComponent("widget.globe3d",i,1)}),define(["vas-3d/modules/exp-3d","vas-3d/modules/globe-3d"]),requirejs.config({baseUrl:"static/js/lib",paths:{core:"../vas-core.js",liveq:"../liveq.js","vas-3d":"../vas-3d.js","vas-basic":"../vas-basic.js","vas-editor":"../vas-editor.js"}}),requirejs(["jquery","core/main","liveq/core","vas-basic/main","vas-3d/main"],function(e,t){e(function(){t.initialize(function(){t.run()})})}),define("../bootstrap",function(){});